{% load wagtailimages_tags %}

{% if value.imagem %}
    {% comment %}
    Template inteligente para ImageBlock - se adapta ao contexto
    {% endcomment %}
    
    {% if value.link %}
        <a href="{{ value.link }}" {% if value.abrir_nova_aba %}target="_blank" rel="noopener"{% endif %}>
    {% endif %}
    
    {% comment %} Verifica se tem classe específica ou usa original {% endcomment %}
    {% if value.css_class %}
        {% image value.imagem original as img %}
        <img src="{{ img.url }}" 
             alt="{{ value.alt_text|default:img.alt }}" 
             class="{{ value.css_class }}"
             loading="lazy">
    {% else %}
        {% comment %} Para newsletter - tamanho específico {% endcomment %}
        {% image value.imagem fill-500x400 as img %}
        <img  
             src="{{ img.url }}" 
             alt="{{ value.alt_text|default:img.alt }}"
             loading="lazy">
    {% endif %}
    
    {% if value.link %}
        </a>
    {% endif %}
    
    {% if value.caption %}
        <figcaption>{{ value.caption }}</figcaption>
    {% endif %}
{% endif %}