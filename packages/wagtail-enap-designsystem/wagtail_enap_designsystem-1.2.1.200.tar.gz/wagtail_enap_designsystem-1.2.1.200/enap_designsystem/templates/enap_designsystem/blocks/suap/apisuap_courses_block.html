<!-- enap_designsystem/blocks/suap/suap_courses_block.html -->
{% load wagtailcore_tags wagtailimages_tags %}
{% load static %}
<div style="width:100%;display: flex;justify-content: center;">
<section class="section-curso-cards-suap">
    <div class="suap-wrapper-texts">
        {% if bloco_suap.title %}
            <h2 style="color: {{value.cor_title}}" class="suap-h2-title">{{ bloco_suap.title }}</h2>
        {% endif %}
        
        {% if bloco_suap.description %}
            <h3 style="color: {{value.cor_description}}" class="suap-sub-title">{{ bloco_suap.description }}</h3>
        {% endif %}
    </div>
    
    {% if cursos_suap %}
        {% if value.estilo_cards == "eventos" %}
        <div class="container suap-courses-section">
            <div class="suap-courses-carousel-container" id="suap-courses-carousel-container">
                <div class="suap-courses-carousel-items" id="suap-courses-carousel-items">
                    {% for curso in cursos_suap %}
                    <div class="suap-courses-carousel-item">
                        <a href="{{ curso.url}}" class="suap-courses-item-link" target="_blank" rel="noopener noreferrer">
                            <div class="suap-courses-carousel-item-content">
                                <div class="suap-courses-carousel-datetime">
                                    {% if curso.data_inicio_aula %}
                                        <div class="suap-course-date">
                                            <span class="suap-course-day">
                                                {{ curso.data_inicio_aula|date:"d" }}
                                            </span>
                                            <div class="suap-course-month-year">
                                                <span class="suap-text-date">
                                                    {{ curso.data_inicio_aula|date:"F" }}
                                                </span>
                                                <span class="suap-text-date">
                                                    {{ curso.data_inicio_aula|date:"Y" }}
                                                </span>
                                            </div>
                                            <span class="suap-text-date">
                                                {{ curso.data_inicio_aula|date:"l" }}
                                            </span>
                                        </div>
                                        {% if curso.carga_horaria %}
                                            <p class="suap-course-time">{{ curso.carga_horaria }}h de duração</p>
                                        {% endif %}
                                    {% elif curso.data_inicio %}
                                        <div class="suap-course-date">
                                            <span class="suap-course-day">
                                                {{ curso.data_inicio|date:"d" }}
                                            </span>
                                            <div class="suap-course-month-year">
                                                <span class="suap-text-date">
                                                    {{ curso.data_inicio|date:"F" }}
                                                </span>
                                                <span class="suap-text-date">
                                                    {{ curso.data_inicio|date:"Y" }}
                                                </span>
                                            </div>
                                            <span class="suap-text-date">
                                                {{ curso.data_inicio|date:"l" }}
                                            </span>
                                        </div>
                                        {% if curso.carga_horaria %}
                                            <p class="suap-course-time">{{ curso.carga_horaria }}h de duração</p>
                                        {% endif %}
                                    {% else %}
                                        <div class="suap-course-icon">
                                            <i class="fa-solid fa-graduation-cap" style="font-size: 44px; color: #007D7A;"></i>
                                        </div>
                                        {% if curso.carga_horaria %}
                                            <div class="suap-course-duration">
                                                <span class="suap-text-date">{{ curso.carga_horaria }}h</span>
                                            </div>
                                        {% endif %}
                                        {% if curso.modalidade %}
                                            <p class="suap-course-modality">{{ curso.modalidade }}</p>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                <div class="suap-courses-carousel-content">
                                    <div class="suap-course-tag suap-course-tag-{{ curso.tipo_conteudo }}">
                                        {% if curso.tipo_conteudo == 'evento' %}
                                            Evento
                                        {% else %}
                                            Curso
                                        {% endif %}
                                    </div>
                                    {% if curso.descricao %}
                                        <h3 class="suap-courses-title">{{ curso.descricao }}</h3>
                                    {% endif %}
                                    {% if curso.breve_descricao %}
                                        <p class="suap-card-text">{{ curso.breve_descricao|truncatewords:10 }}</p>
                                    {% endif %}
                                    
                                    <!-- Status de inscrições -->
                                    {% if curso.incricoes %}
                                        <div class="suap-course-inscricoes">
                                            <i class="fa-solid fa-calendar-check"></i> {{ curso.incricoes }}
                                        </div>
                                    {% endif %}
                                    
                                    <div class="suap-course-location">
                                        {% if curso.modalidade %}
                                            {% if "distância" in curso.modalidade or "remot" in curso.modalidade|lower %}
                                                <i class="fa-solid fa-laptop"></i> {{ curso.modalidade }}
                                            {% elif "presencial" in curso.modalidade|lower %}
                                                <i class="fa-solid fa-location-dot"></i> {{ curso.modalidade }}
                                            {% else %}
                                                <i class="fa-solid fa-graduation-cap"></i> {{ curso.modalidade }}
                                            {% endif %}
                                        {% else %}
                                            <i class="fa-solid fa-laptop"></i> Online
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-curso-suap carousel-control-curso-suap-prev" style="left: 0px;">
                    <span class="visually-hidden">Rolar para esquerda</span>
                    <span class="material-symbols-outlined setas seta-esquerda">chevron_left</span>
                </button>
                <button class="carousel-control-curso-suap carousel-control-curso-suap-next" style="right: 0px;">
                    <span class="visually-hidden">Rolar para direita</span>
                    <span class="material-symbols-outlined setas seta-direita">chevron_right</span>
                </button>
            </div>
        </div>
        {% elif value.estilo_cards == "cursos" %}
        <div class="wrapper-carousel-container01">
            <div class="carousel-container01">
                <div class="carousel-items01" id="cursos-suap-carousel">
                    {% for curso in cursos_suap %}
                    <a href="{{curso.url}}" class="btn1">
                    <div class="carousel-item-wrapper-suap">
                        <div class="carousel-item-curso-suap">
                            <div class="image-curso">
                                    <h3 title="{{ curso.titulo }}">
                                            <img class="img-fluid" src="{% static 'enap_designsystem/blocks/suap/default_2.png' %}" alt="Imagem padrão com logo da Enap e fundo verde" width="236" height="140" loading="lazy">
                                    </h3>
                            </div>
                            <div class="content-curso">    
                                <div class="card-body">
                                    <div class="tag tag-{{ curso.tipo_conteudo }}">
                                        {% if curso.tipo_conteudo == 'evento' %}
                                            Evento
                                        {% else %}
                                            Curso
                                        {% endif %}
                                    </div>
                                <h3 class="h3-card" style=" display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; ">{{ curso.descricao }}</h3>
                                <p class="card-text-text" style=" display: -webkit-box; color: #434A54; font-size: 16px; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; ">{{ curso.breve_descricao }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    </a>
                    {% endfor %}
                </div>
                
                <button class="carousel-control-curso-suap carousel-control-curso-suap-prev">
                    <span class="visually-hidden">Rolar para esquerda</span>
                    <span class="material-symbols-outlined setas seta-esquerda">chevron_left</span>
                </button>
                <button class="carousel-control-curso-suap carousel-control-curso-suap-next">
                    <span class="visually-hidden">Rolar para direita</span>
                    <span class="material-symbols-outlined setas seta-direita">chevron_right</span>
                </button>
                
            </div>
        </div>
        {% endif %}
        {% if bloco_suap.url_button %}
        <a class="suap-btn-todos" href="{{ bloco_suap.url_button }}">{{ bloco_suap.button }}</a>
        {% endif %}
    {% else %}
        <div class="suap-courses-empty">
            <p>Nenhum curso disponível no momento.</p>
        </div>
        {% if bloco_suap.url_button %}
        <a class="suap-btn-todos" href="{{ bloco_suap.url_button }}">{{ bloco_suap.button }}</a>
        {% endif %}
    {% endif %}
</section>
</div>
<style>

    .carousel-item-curso-suap{
        background-color: #FFFFFF;
    }
    .suap-course-inscricoes {
        margin: 8px 0;
        font-size: 14px;
        color: #6c757d;
    }
    
    .suap-course-inscricoes i {
        margin-right: 4px;
    }

    .suap-btn-todos{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        text-decoration: none;
        color: #007D7A;
        border: 1px solid #007D7A;
        padding: 8px 24px;
        border-radius: 40px;
        margin: auto;
        background-color: white;
        font-weight: 600;
    }
    .suap-btn-todos:hover{
        background-color: #006969;
        color: #ffffff;
        border: 1px solid #006969;
    }

    .suap-btn-todos:active{
        background-color: #025257;
        color: #ffffff;
        border: 1px solid #025257;
    }
    .suap-courses-section {
        max-width: 1142px;
        margin: auto;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 40px;
        overflow: hidden;
        padding: 0;
    }
    
    .suap-wrapper-texts {
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
        align-items: {{value.posicao_title}};
    }
    
    .suap-h2-title {
        margin: 0;
        font-size: 40px;
        font-weight: 600;
        color: #434A54;
    }
    
    .suap-sub-title {
        font-size: 20px;
        font-weight: 400;
        margin: 10px 0 0 0;
        color: #434A54;
    }
    
    .suap-wrapper {
        position: relative;
        width: 1142px;
        margin: auto;
    }
    
    .suap-courses-carousel-container {
        position: relative;
        max-width: 1142px;
        margin: auto;
        width: 100%;
    }
    
    .suap-courses-carousel-items {
        display: flex;
        transition: transform 0.3s ease-in-out;
        gap: 25px;
        cursor: grab;
        width: calc(100% + 25px);
        margin-right: -25px;
    }
    
    .suap-courses-carousel-items:active {
        cursor: grabbing;
    }
    
    .suap-courses-carousel-item {
        flex-shrink: 0;
        width: 364px;
        margin-right: 0;
    }
    
    .suap-courses-item-link {
        text-decoration: none;
        color: inherit;
        display: block;
    }
    
    .suap-courses-carousel-item-content {
        display: flex;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #C8D1E0;
        height: 300px;
    }
    
    .suap-courses-carousel-datetime {
        width: 35%;
        border-radius: 8px 0 0 8px;
        overflow: hidden;
        text-align: center;
        background-color: #EBEFF5;
        padding: 20px 10px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }
    
    .suap-course-icon {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .suap-course-date {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .suap-course-day {
        font-size: 44px;
        color: #007D7A;
        font-weight: 700;
        line-height: 1;
    }
    
    .suap-course-month-year {
        margin: 5px 0;
    }
    
    .suap-course-time {
        font-size: 14px;
        color: #58606E;
        margin-top: 10px;
        margin-bottom: 0;
    }
    
    .suap-text-date {
        font-size: 16px;
        color: #58606E;
        font-weight: 600;
        text-align: center;
    }
    
    .suap-course-modality {
        font-size: 14px;
        color: #58606E;
        margin-top: 10px;
        margin-bottom: 0;
    }
    
    .suap-courses-carousel-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        width: 65%;
        background-color: white;
        height: 100%;
        padding: 20px;
        text-align: left;
    }
    
    .suap-course-tag {
        border: 1px solid #FC7D5C;
        font-size: 14px;
        color: #FC7D5C;
        border-radius: 24px;
        padding: 0px 15px;
        display: inline-block;
    }
    
    .suap-courses-title {
        font-size: 20px;
        color: #007D7A;
        text-decoration: none;
        font-weight: 500;
        margin: 10px 0;
    }
    
    .suap-card-text {
        text-align: left;
        margin: 0;
        font-size: 14px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        flex-grow: 1;
    }
    
    .suap-course-location {
        font-size: 14px;
        color: #58606E;
    }
    
    .suap-courses-carousel-control {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 30px;
        color: #333;
        cursor: pointer;
        border: none;
        background-color: transparent;
        z-index: 10;
    }
    
    .suap-courses-carousel-control-prev {
        left: -5px;
    }
    
    .suap-courses-carousel-control-next {
        right: -5px;
    }
    
    .suap-courses-empty {
        text-align: center;
        padding: 3rem;
        color: #666;
        font-style: italic;
    }
    
    .carousel-control-curso-suap {
        display: block;
    }
    
    /* Estilos responsivos */
    @media (max-width: 992px) {
        .suap-courses-section {
            gap: 30px;
            padding-left: 10px;
        }
        
        .suap-h2-title {
            font-size: 32px;
        }
        
        .suap-sub-title {
            font-size: 20px;
            text-align: left;
        }

        .suap-wrapper-texts {
            margin-top: 40px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            max-width: 81vw;
        }
    }
    
    @media (max-width: 1142px) {
        .suap-wrapper {
            width: 100%;
            padding: 0 20px;
        }
    }
    
    @media (max-width: 768px) {
        .suap-courses-carousel-item {
            width: 70vw;
            max-width: 400px;
        }

        .suap-wrapper {
            width: 100%;
            padding: 0px;
        }
        
        .suap-courses-carousel-control {
            display: none !important;
        }
        
        .suap-h2-title {
            font-size: 32px;
        }
        
        .suap-sub-title {
            font-size: 20px;
            text-align: left;
        }
    }
    
    @media (max-width: 576px) {
        .suap-courses-carousel-item-content {
            flex-direction: column;
            height: 100%;
        }
        
        .suap-courses-carousel-datetime {
            width: 100%;
            height: auto;
            border-radius: 8px 8px 0 0;
            padding: 15px;
        }
        
        .suap-courses-carousel-content {
            width: 100%;
            height: auto;
            padding: 15px;
            gap: 10px;
        }
        
        .suap-course-icon i {
            font-size: 36px !important;
        }
        
        .suap-courses-title {
            font-size: 18px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Função genérica para inicializar um carrossel
        function initCarousel({
            containerSelector,
            itemsSelector,
            prevBtnSelector,
            nextBtnSelector,
            itemWidth,
            itemGap,
            useItemsAsContainer = false // NOVO: permite usar o próprio items como container
        }) {
            const container = document.querySelector(containerSelector);
            const carouselItems = container ? container.querySelector(itemsSelector) : null;
            const prevBtn = container ? container.querySelector(prevBtnSelector) : null;
            const nextBtn = container ? container.querySelector(nextBtnSelector) : null;
            if (!container || !carouselItems || !prevBtn || !nextBtn) return;
            const items = carouselItems.querySelectorAll(':scope > *');
            let currentIndex = 0;
            let startX, moveX, initialPosition;
            let isDragging = false;
            const itemTotalWidth = itemWidth + itemGap;

            function isMobile() {
                return window.innerWidth <= 768;
            }
            function getVisibleItems() {
                // Use o próprio items como container se necessário
                const base = useItemsAsContainer ? carouselItems : container;
                const containerWidth = base.offsetWidth;
                return Math.max(1, Math.floor(containerWidth / itemTotalWidth));
            }
            function getMaxIndex() {
                return Math.max(0, items.length - getVisibleItems());
            }
            function getScrollAmount() {
                return isMobile() ? 1 : 3;
            }
            function showSlide(index) {
                const maxIndex = getMaxIndex();
                currentIndex = Math.max(0, Math.min(index, maxIndex));
                const offset = Math.round(currentIndex * itemTotalWidth);
                carouselItems.style.transform = `translateX(-${offset}px)`;
                updateButtons(maxIndex);
            }
            function updateButtons(maxIndex) {
                if (currentIndex <= 0) {
                    prevBtn.style.display = 'none';
                    nextBtn.style.display = items.length > getVisibleItems() ? 'block' : 'none';
                } else if (currentIndex >= maxIndex) {
                    prevBtn.style.display = 'block';
                    nextBtn.style.display = 'none';
                } else {
                    prevBtn.style.display = 'block';
                    nextBtn.style.display = 'block';
                }
            }
            prevBtn.addEventListener('click', () => {
                const amount = getScrollAmount();
                const step = Math.min(amount, currentIndex);
                showSlide(currentIndex - step);
            });
            nextBtn.addEventListener('click', () => {
                const amount = getScrollAmount();
                const maxIndex = getMaxIndex();
                const step = Math.min(amount, maxIndex - currentIndex);
                showSlide(currentIndex + step);
            });
            carouselItems.addEventListener('touchstart', handleStart, { passive: true });
            carouselItems.addEventListener('touchmove', handleMove, { passive: false });
            carouselItems.addEventListener('touchend', handleEnd, { passive: true });
            carouselItems.addEventListener('mousedown', handleStart);
            carouselItems.addEventListener('mousemove', handleMove);
            carouselItems.addEventListener('mouseup', handleEnd);
            carouselItems.addEventListener('mouseleave', handleEnd);

            function handleStart(e) {
                isDragging = true;
                startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                initialPosition = currentIndex * itemTotalWidth;
                carouselItems.style.transition = 'none';
            }
            function handleMove(e) {
                if (!isDragging) return;
                moveX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const diff = moveX - startX;
                const maxIndex = getMaxIndex();
                if (currentIndex === 0 && diff > 50) {
                    carouselItems.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
                } else if (currentIndex >= maxIndex && diff < -50) {
                    carouselItems.style.transform = `translateX(${diff / 3 - initialPosition}px)`;
                } else {
                    carouselItems.style.transform = `translateX(${diff - initialPosition}px)`;
                }
                if (Math.abs(diff) > 10 && e.type === 'touchmove') {
                    e.preventDefault();
                }
            }
            function handleEnd() {
                if (!isDragging) return;
                isDragging = false;
                carouselItems.style.transition = 'transform 0.3s ease-in-out';
                const diff = moveX - startX;
                const threshold = itemWidth / 4;
                if (diff > threshold) {
                    const amount = getScrollAmount();
                    const step = Math.min(amount, currentIndex);
                    showSlide(currentIndex - step);
                } else if (diff < -threshold) {
                    const amount = getScrollAmount();
                    const maxIndex = getMaxIndex();
                    const step = Math.min(amount, maxIndex - currentIndex);
                    showSlide(currentIndex + step);
                } else {
                    showSlide(currentIndex);
                }
            }
            const links = carouselItems.querySelectorAll('a');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    if (isDragging || (moveX && Math.abs(moveX - startX) > 10)) {
                        e.preventDefault();
                    }
                });
            });
            window.addEventListener('resize', function() {
                setTimeout(function() {
                    const maxIndex = getMaxIndex();
                    if (currentIndex > maxIndex) {
                        currentIndex = maxIndex;
                    }
                    carouselItems.style.transition = 'transform 0.3s ease-in-out';
                    showSlide(currentIndex);
                }, 100);
            });
            window.addEventListener('load', function() {
                setTimeout(function() {
                    carouselItems.style.transition = 'transform 0.3s ease-in-out';
                    showSlide(0);
                }, 100);
            });
            showSlide(0);
        }

        // Inicializa carrossel de eventos (cards grandes)
        if (document.getElementById('suap-courses-carousel-container')) {
            initCarousel({
                containerSelector: '#suap-courses-carousel-container',
                itemsSelector: '#suap-courses-carousel-items',
                prevBtnSelector: '.carousel-control-curso-suap-prev',
                nextBtnSelector: '.carousel-control-curso-suap-next',
                itemWidth: 364,
                itemGap: 25
            });
        }

        // Inicializa carrossel de cursos (cards pequenos) - usa items como container base
        if (document.querySelector('.carousel-container01')) {
            initCarousel({
                containerSelector: '.carousel-container01',
                itemsSelector: '.carousel-items01',
                prevBtnSelector: '.carousel-control-curso-suap-prev',
                nextBtnSelector: '.carousel-control-curso-suap-next',
                itemWidth: 268,
                itemGap: 25,
                useItemsAsContainer: true // NOVO: corrige cálculo de largura
            });
        }
    });
</script>