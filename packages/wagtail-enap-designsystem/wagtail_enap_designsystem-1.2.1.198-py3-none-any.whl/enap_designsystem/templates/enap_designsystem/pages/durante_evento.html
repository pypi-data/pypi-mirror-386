{% extends "enap_designsystem/base.html" %}
{% load wagtailcore_tags %}

{% block metadata %}
    {% comment %} <meta name="viewport" content="width=device-width, initial-scale=1.0"> {% endcomment %}
{% endblock %}

{% block title %}
    <title>{{ page.page_title }}</title>
{% endblock %}

{%block govnavbar %}
    <div style="background-color: #071E41;">
        <div class="menu">
            <div class="logo">
                <img style="width: 51px; height: 18px;" src="{% static 'enap_designsystem/icons/logo-white.png' %}" alt="Passar pro lado esquerdo" alt="Logo GovBR" height="40">
            </div>
            <a href="https://www.gov.br/secom/pt-br/acesso-a-informacao/comunicabr">Comunica BR</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/acessoainformacao/pt-br">Acesso à informação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/participacao-social/">Participe</a>
            <div class="separator"></div>
            <a href="https://www4.planalto.gov.br/legislacao/">Legislação</a>
            <div class="separator"></div>
            <a href="https://www.gov.br/pt-br/orgaos-do-governo">Órgãos do Governo</a>
        </div>
    </div>
{% endblock %}

{% block navbar %}
    {% if page.navbar %}
        {% include "enap_designsystem/blocks/navbar/navbar_block.html" with navbar=page.navbar %}
    {% else %}
        <p style="color: red;">DEBUG: Nenhuma Navbar foi definida.</p>
    {% endif %}
{% endblock %}

{% block content %}
<div class="durante-evento-page">
    
    <!-- Banner AO VIVO -->
    {% if page.banner_ao_vivo %}
        <section class="banner-ao-vivo-section">
            <div class="live-indicator">
                <span class="live-dot"></span>
                <span class="live-text">AO VIVO</span>
            </div>
            {% for block in page.banner_ao_vivo %}
                {% include_block block %}
            {% endfor %}
        </section>
    {% endif %}

    <!-- Transmissão/Stream -->
    {% if page.transmissao %}
        <section class="transmissao-section py-4">
                            {% for block in page.transmissao %}
                                {% include_block block %}
                            {% endfor %}
        </section>
    {% endif %}

    <!-- Programação Atual -->
    {% if page.programacao %}
        <section class="programacao-section py-5 bg-light">
                {% for block in page.programacao %}
                    {% include_block block %}
                {% endfor %}
        </section>
    {% endif %}

    <!-- Palestrantes Ativos -->
    {% if page.palestrantes_atual %}
        <section class="palestrantes-atual-section py-5">
                {% for block in page.palestrantes_atual %}
                    {% include_block block %}
                {% endfor %}
        </section>
    {% endif %}

    <!-- Galeria ao Vivo -->
    {% if page.galeria_ao_vivo %}
        <section class="galeria-ao-vivo-section py-5 bg-dark text-white">
                {% for block in page.galeria_ao_vivo %}
                    {% include_block block %}
                {% endfor %}
        </section>
    {% endif %}

    <!-- Área de Interação/Chat -->
    {% if page.interacao %}
        <section class="interacao-section py-5 bg-primary">
                            {% for block in page.interacao %}
                                {% include_block block %}
                            {% endfor %}
        </section>
    {% endif %}

</div>

<!-- CSS específico para durante evento -->
<style>
.durante-evento-page {
    overflow-x: hidden;
}

/* Indicador AO VIVO */
.banner-ao-vivo-section {
    position: relative;
}

.live-indicator {
    position: absolute;
    top: 20px;
    right: 20px;
    background: #dc3545;
    color: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 0.9rem;
    z-index: 1000;
    display: flex;
    align-items: center;
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    animation: pulse-live 2s infinite;
}

.live-dot {
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    margin-right: 8px;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

@keyframes pulse-live {
    0% { transform: scale(0.2); }
    50% { transform: scale(0.5); }
    100% { transform: scale(0.3); }
}

/* Seção de Transmissão */
.streaming-container {
    background: #000;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.stream-header h2 {
    color: #fff;
}

.viewer-count {
    background: rgba(255,255,255,0.1);
    color: #fff;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
}

/* Programação */
.programacao-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.current-time {
    font-size: 1.2rem;
    color: #007bff;
    font-weight: 600;
}

/* Palestrantes Ativos */
.speaking-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    background: #28a745;
    border-radius: 50%;
    margin-right: 10px;
    animation: pulse-speak 1.5s infinite;
}

@keyframes pulse-speak {
    0% { transform: scale(0.3); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
    70% { transform: scale(0.3); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
    100% { transform: scale(0.3); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
}

/* Galeria ao Vivo */
.galeria-ao-vivo-section {
    background: linear-gradient(135deg, #343a40 0%, #212529 100%);
}

.auto-refresh {
    color: #6c757d;
    font-size: 0.9rem;
}

.auto-refresh i {
    animation: rotate 2s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Chat/Interação */
.chat-container {
    background: rgba(255,255,255,0.1);
    border-radius: 15px;
    padding: 30px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

.chat-stats {
    font-size: 1.1rem;
}

/* Responsividade */
@media (max-width: 768px) {
    .live-indicator {
        top: 10px;
        right: 10px;
        padding: 6px 12px;
        font-size: 0.8rem;
    }
    
    .stream-header {
        flex-direction: column;
        text-align: center;
    }
    
    .stream-header .viewer-count {
        margin-top: 10px;
    }
    
    .chat-stats span {
        display: block;
        margin-bottom: 10px;
    }
    
    .galeria-header {
        flex-direction: column;
        text-align: center;
    }
    
    .auto-refresh {
        margin-top: 10px;
    }
}

/* Animações de entrada */
.transmissao-section,
.programacao-section,
.palestrantes-atual-section,
.galeria-ao-vivo-section,
.interacao-section {
    opacity: 0;
    transform: translateY(30px);
    animation: slideInUp 0.8s ease forwards;
}

.programacao-section { animation-delay: 0.1s; }
.palestrantes-atual-section { animation-delay: 0.2s; }
.galeria-ao-vivo-section { animation-delay: 0.3s; }
.interacao-section { animation-delay: 0.4s; }

@keyframes slideInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<!-- JavaScript para durante evento -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Atualizar horário atual
    function updateCurrentTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('pt-BR', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        const timeElement = document.getElementById('current-time');
        if (timeElement) {
            timeElement.textContent = timeString;
        }
    }
    
    // Atualizar a cada segundo
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    // Simular contador de visualizadores
    function updateViewerCount() {
        const viewerElement = document.getElementById('viewer-count');
        if (viewerElement) {
            const baseCount = 1200;
            const randomVariation = Math.floor(Math.random() * 100);
            const currentCount = baseCount + randomVariation;
            viewerElement.textContent = currentCount.toLocaleString('pt-BR');
        }
    }
    
    // Atualizar contador de viewers a cada 10 segundos
    updateViewerCount();
    setInterval(updateViewerCount, 10000);
    
    // Simular contador de mensagens
    function updateMessageCount() {
        const messageElement = document.getElementById('message-count');
        if (messageElement) {
            let currentCount = parseInt(messageElement.textContent) || 324;
            currentCount += Math.floor(Math.random() * 3) + 1;
            messageElement.textContent = currentCount;
        }
    }
    
    // Atualizar mensagens a cada 5 segundos
    setInterval(updateMessageCount, 5000);
    
    // Simular contador de likes
    function updateLikeCount() {
        const likeElement = document.getElementById('like-count');
        if (likeElement) {
            let currentCount = parseInt(likeElement.textContent.replace('.', '')) || 1891;
            currentCount += Math.floor(Math.random() * 5) + 1;
            likeElement.textContent = currentCount.toLocaleString('pt-BR');
        }
    }
    
    // Atualizar likes a cada 3 segundos
    setInterval(updateLikeCount, 3000);
    
    // Fullscreen para vídeo (se houver)
    const videoElements = document.querySelectorAll('video');
    videoElements.forEach(video => {
        video.addEventListener('dblclick', function() {
            if (video.requestFullscreen) {
                video.requestFullscreen();
            }
        });
    });
});
</script>

{% endblock %}

{% block footer %}
    {% include "enap_designsystem/includes/footer.html" %}
{% endblock %}