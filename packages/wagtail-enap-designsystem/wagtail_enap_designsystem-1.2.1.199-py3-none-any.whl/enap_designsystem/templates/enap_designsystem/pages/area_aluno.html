{% extends "enap_designsystem/base.html" %}
{% load static %}
{% load wagtailcore_tags wagtailimages_tags %}


{% block metadata %}
    {% comment %} <meta name="viewport" content="width=device-width, initial-scale=1.0"> {% endcomment %}
{% endblock %}


{% block title %}
	<title>{{ page.title }}</title>
{% endblock %}

{%block govnavbar %}
    <div style="background-color: #071E41;">
        <div class="menu">
            <div class="logo">
                <img style="width: 51px; height: 18px;" src="{% static 'enap_designsystem/icons/logo-white.png' %}" alt="Passar pro lado esquerdo" alt="Logo GovBR" height="40">
            </div>
            <a href="#">Comunica BR</a>
            <div class="separator"></div>
            <a href="#">Acesso √† informa√ß√£o</a>
            <div class="separator"></div>
            <a href="#">Participe</a>
            <div class="separator"></div>
            <a href="#">Legisla√ß√£o</a>
            <div class="separator"></div>
            <a href="#">√ìrg√£os do Governo</a>
        </div>
    </div>
{% endblock %}


{% block navbar %}
    {% if page.navbar %}
        {% include "enap_designsystem/blocks/navbar/navbar_block.html" with navbar=page.navbar %}
    {% else %}
        <p style="color: red;">DEBUG: Nenhuma Navbar foi definida.</p>
    {% endif %}
{% endblock %}


{% block content %}
<section class="section-header-aluno">
    <div class="container-aluno">
        <div class="profile-section">
            <div class="profile-image">
                <img src="{{ aluno_foto }}" alt="Foto do perfil do aluno">
            </div>
            <div class="profile-info">
                <h1 class="title-green-aluno">√Årea do aluno</h1>
                <p class="greeting">Ol√°, <span class="name">{{ primeiro_nome }}</span></p>
                <p>Boas vindas √† √°rea do aluno.</p>
                <p>Aqui voc√™ acompanha a sua jornada<br>de transforma√ß√£o pelo conhecimento.</p>
            </div>
        </div>
        
        <div class="aluno-divider"></div>
        
        <div class="stats-section">
            <div class="stat-card eventos">
                <div class="stat-number">{{ aluno_estatisticas.eventos|default:"0" }}</div>
                <div class="stat-label">Eventos</div>
            </div>
            <div class="stat-card oficinas">
                <div class="stat-number">{{ aluno_estatisticas.oficinas|default:"0" }}</div>
                <div class="stat-label">Oficinas</div>
            </div>
            <div class="stat-card card-cursos">
                <div class="stat-number">{{ aluno_estatisticas.cursos|default:"0" }}</div>
                <div class="stat-label">Cursos</div>
            </div>
        </div>
    </div>
</section>

<section class="section-cursos">
	<div class="container-area-aluno-cursos">
		<h2 class="curso-titulo">Cursos</h2>

		<!-- Eventos -->
		<div class="curso-item">
			<div class="curso-header" onclick="toggleCurso(this)">
				<span class="curso-label">Eventos programados</span>
				<div class="curso-right">
					<span class="curso-badge">{{ aluno_cursos.eventos|length }}</span>
					<span class="curso-toggle">‚ñæ</span>
				</div>
			</div>
			<div class="curso-conteudo" hidden>
				{% for curso in aluno_cursos.eventos %}
					<div class="curso-box">
						<strong>{{ curso.nome }}</strong>
						<p><b>Per√≠odo:</b> {{ curso.dataInicio|date:"d/m/Y" }} at√© {{ curso.dataTermino|date:"d/m/Y" }}</p>
						<p><b>Tipo:</b> {{ curso.tipo|default:"‚Äî" }}</p>
						<p><b>Situa√ß√£o:</b> {{ curso.situacao|default:"‚Äî" }}</p>
						{% if curso.documentos %}
							<p><b>Documentos:</b></p>
							<ul>
								{% for doc in curso.documentos %}
									<li><a href="{{ doc }}" target="_blank">{{ doc }}</a></li>
								{% endfor %}
							</ul>
						{% endif %}
						{% if curso.linkCurso %}
							<a href="{{ curso.linkCurso }}" target="_blank"><button>Acessar curso</button></a>
						{% endif %}
					</div>
				{% empty %}
					<p>Nenhum curso dispon√≠vel nesta categoria.</p>
				{% endfor %}
			</div>
			<hr />
		</div>

		<!-- Em andamento -->
		<div class="curso-item">
			<div class="curso-header" onclick="toggleCurso(this)">
				<span class="curso-label">Cursos em andamento</span>
				<div class="curso-right">
					<span class="curso-badge">{{ aluno_cursos.andamento|length }}</span>
					<span class="curso-toggle">‚ñæ</span>
				</div>
			</div>
			<div class="curso-conteudo" hidden>
				{% for curso in aluno_cursos.andamento %}
					<div class="curso-box">
						<strong>{{ curso.nome }}</strong>
						<p><b>Per√≠odo:</b> {{ curso.dataInicio|date:"d/m/Y" }} at√© {{ curso.dataTermino|date:"d/m/Y" }}</p>
						<p><b>Tipo:</b> {{ curso.tipo|default:"‚Äî" }}</p>
						<p><b>Situa√ß√£o:</b> {{ curso.situacao|default:"‚Äî" }}</p>
						{% if curso.linkCurso %}
							<a href="{{ curso.linkCurso }}" target="_blank"><button>Acessar curso</button></a>
						{% endif %}
					</div>
				{% empty %}
					<p>Nenhum curso dispon√≠vel nesta categoria.</p>
				{% endfor %}
			</div>
			<hr />
		</div>

		<!-- Matriculados -->
		<div class="curso-item">
			<div class="curso-header" onclick="toggleCurso(this)">
				<span class="curso-label">Cursos matriculados</span>
				<div class="curso-right">
					<span class="curso-badge">{{ aluno_cursos.matriculado|length }}</span>
					<span class="curso-toggle">‚ñæ</span>
				</div>
			</div>
			<div class="curso-conteudo" hidden>
				{% for curso in aluno_cursos.matriculado %}
					<div class="curso-box">
						<strong>{{ curso.nome }}</strong>
						<p><b>Per√≠odo:</b> {{ curso.dataInicio|date:"d/m/Y" }} at√© {{ curso.dataTermino|date:"d/m/Y" }}</p>
						<p><b>Tipo:</b> {{ curso.tipo|default:"‚Äî" }}</p>
						<p><b>Situa√ß√£o:</b> {{ curso.situacao|default:"‚Äî" }}</p>
						{% if curso.linkCurso %}
							<a href="{{ curso.linkCurso }}" target="_blank"><button>Acessar curso</button></a>
						{% endif %}
					</div>
				{% empty %}
					<p>Nenhum curso dispon√≠vel nesta categoria.</p>
				{% endfor %}
			</div>
			<hr />
		</div>

		<!-- Em an√°lise -->
		<div class="curso-item">
			<div class="curso-header" onclick="toggleCurso(this)">
				<span class="curso-label">Inscri√ß√µes em an√°lise</span>
				<div class="curso-right">
					<span class="curso-badge">{{ aluno_cursos.analise|length }}</span>
					<span class="curso-toggle">‚ñæ</span>
				</div>
			</div>
			<div class="curso-conteudo" hidden>
				{% for curso in aluno_cursos.analise %}
					<div class="curso-box">
						<strong>{{ curso.nome }}</strong>
						<p><b>Tipo:</b> {{ curso.tipo|default:"‚Äî" }}</p>
						<p><b>Situa√ß√£o:</b> {{ curso.situacao|default:"‚Äî" }}</p>
						{% if curso.linkCurso %}
							<a href="{{ curso.linkCurso }}" target="_blank"><button>Acessar curso</button></a>
						{% endif %}
					</div>
				{% empty %}
					<p>Nenhuma inscri√ß√£o em an√°lise nesta categoria.</p>
				{% endfor %}
			</div>
			<hr />
		</div>
	</div>
</section>

<section class="section-certificados">
	<div class="container-certificados">
		<h2 class="certificado-titulo">Certificados</h2>

		{% for grupo in certificados_nomeados %}
			<div class="certificado-item">
                <div class="certificado-header" onclick="this.nextElementSibling.classList.toggle('show')">
                    <span class="certificado-label">{{ grupo.titulo }}</span>
                    <span class="certificado-toggle">‚ñæ</span>
                </div>
                <div class="certificado-body" style="display: none;">
                    {% if grupo.lista %}
                        <div class="curso-box"> <!-- opcional trocar por .certificado-box -->
                            <table class="certificado-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Per√≠odo / Emiss√£o</th>
                                        <th>LinkedIn</th>
                                        <th>Documentos</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for cert in grupo.lista %}
                                    <tr>
                                        <td>
                                            {% if cert.nome %}
                                                {{ cert.nome }}
                                            {% elif cert.descricao %}
                                                {{ cert.descricao }}
                                            {% else %}
                                                (Sem nome)
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if cert.dataInicioAula and cert.dataFimAula %}
                                                {{ cert.dataInicioAula|date:"d/m/Y" }} at√© {{ cert.dataFimAula|date:"d/m/Y" }}
                                            {% elif cert.dataEmissao %}
                                                Emitido em {{ cert.dataEmissao|date:"d/m/Y" }}
                                            {% else %}
                                                ‚Äî
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if cert.linkLinkedin %}
                                                <a href="{{ cert.linkLinkedin }}" target="_blank" title="Adicionar ao LinkedIn" >üîó</a>
                                            {% else %}
                                                ‚Äî
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if cert.documentos %}
                                                {% for doc in cert.documentos %}
                                                    <a href="{{ doc.url }}" target="_blank" title="{{ doc.descricao }}">
                                                        üìÑ {{ doc.slug|title }}
                                                    </a><br>
                                                {% endfor %}
                                            {% else %}
                                                ‚Äî
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p>Nenhum certificado encontrado.</p>
                    {% endif %}
                </div>
            </div>
		{% endfor %}
	</div>
</section>


{% load wagtailcore_tags %}

<section>
    <div class="container-medium"> 
        <div class="padding-global">
            <div class="main">
                {% include_block page.body %}
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block footer %}
    {% include "enap_designsystem/includes/footer.html" %}
{% endblock %}


{% block styleinline %}
    {% comment %} STYLE INLINE AQUI {% endcomment %}
    <style>
    </style>
{% endblock %}


{% block stylecss %}
    {% comment %} ARQUIVOS CSS AQUI {% endcomment %}
    {% comment %} 
        Evite deixar arquivos aqui, utilize eles no enap_designsystem/base.html
        na √°rea de {% if debug %} de DESENVOLVIMENTO
    {% endcomment %}
    
{% endblock %}


{% block scriptinline %}
    {% comment %} SCRIPT INLINE AQUI {% endcomment %}
    <script>
        function clearInput() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchInput').focus();
            toggleClearButton();
        }
    
        function toggleClearButton() {
            const input = document.getElementById('searchInput');
            const clearButton = document.getElementById('clearButton');
            clearButton.style.display = input.value ? 'block' : 'none';
        }
    
        // Fun√ß√£o para verificar se √© dispositivo m√≥vel
        function isMobile() {
            return window.innerWidth <= 768; // Defina o breakpoint apropriado para seu site
        }
    
        // Quando o documento carrega, torna o search container vis√≠vel apenas no desktop
        document.addEventListener('DOMContentLoaded', function() {
            const searchContainer = document.querySelector('.search-container');
            
            if (!isMobile()) {
                // Vers√£o desktop - sempre vis√≠vel
                searchContainer.classList.add('visible');
                searchContainer.classList.add('show');
            }
        });
    
        // Durante o scroll, comportamento responsivo
        window.addEventListener('scroll', function() {
            const searchContainer = document.querySelector('.search-container');
            const scrollPosition = window.scrollY;
            
            if (isMobile()) {
                // Vers√£o mobile - s√≥ vis√≠vel ap√≥s scroll
                if (scrollPosition > 200) {
                    searchContainer.classList.add('show');
                } else {
                    searchContainer.classList.remove('show');
                }
            } else {
                // Vers√£o desktop - sempre vis√≠vel
                searchContainer.classList.add('visible');
                searchContainer.classList.add('show');
            }
        });
    
        // Recalcular quando a janela for redimensionada
        window.addEventListener('resize', function() {
            const searchContainer = document.querySelector('.search-container');
            
            if (!isMobile()) {
                // Vers√£o desktop - sempre vis√≠vel
                searchContainer.classList.add('visible');
                searchContainer.classList.add('show');
            } else {
                // Vers√£o mobile - verificar posi√ß√£o de scroll
                const scrollPosition = window.scrollY;
                if (scrollPosition <= 200) {
                    searchContainer.classList.remove('show');
                }
            }
        });

        function toggleCurso(headerEl) {
            const container = headerEl.closest(".curso-item");
            const contentEl = container.querySelector(".curso-conteudo");

            // Fecha os outros
            document.querySelectorAll(".curso-conteudo").forEach(el => {
                if (el !== contentEl) el.hidden = true;
            });

            contentEl.hidden = !contentEl.hidden;

            const toggleEl = headerEl.querySelector(".curso-toggle");
            if (toggleEl) {
                toggleEl.textContent = contentEl.hidden ? "‚ñæ" : "‚ñ¥";
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const first = document.querySelector(".accordion-body");
            if (first) first.classList.add("show");
        });

        document.querySelectorAll('.certificado-header').forEach(header => {
            header.addEventListener('click', () => {
                const content = header.nextElementSibling;
                content.style.display = content.style.display === 'none' || !content.style.display
                    ? 'block'
                    : 'none';
            });
        });
    </script>
{% endblock %}


{% block scriptjs %}
    {% comment %} ARQUIVOS JS AQUI {% endcomment %}
{% endblock %}