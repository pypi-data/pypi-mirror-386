{% load static %}
{% load wagtailimages_tags %}
{% block content %}
<style>
    .events-container {
        --main-color: {{ cor_principal }};
    }
    
    .section-title_events .gradient-text {
        background: linear-gradient(45deg, var(--main-color), #9c27b0);
    }

    .filter-button:hover,
    .filter-button.active {
    background-color: var(--main-color);
    color: white;
    }

    .event-category {
        background-color: var(--main-color);
    }

    .event-action {
        color: var(--main-color);}
</style>

<section id="eventos" class="section">
    <div class="container">
        <div class="section-header_events">
            <h2 class="section-title_events">{{ value.titulo_secao|safe }}</h2>
            <p class="section-description_events">
                {{ value.descricao_secao }}
            </p>
        </div>
        
        <div class="events-container" style="--main-color: {{ cor_principal }}">
            <div class="events-filter">
                <button class="filter-button active" data-filter="all">Todos</button>
                {% for categoria in categorias %}
                <button class="filter-button" data-filter="{{ categoria.slug }}">{{ categoria.nome }}</button>
                {% endfor %}
            </div>
            
            <div class="events-grid">
                {% for evento in eventos_ordenados %}
                    {% comment %} Determinando o slug da categoria para o filtro {% endcomment %}
                    {% for cat in categorias %}
                        {% if cat.nome == evento.categoria %}
                            {% with cat_slug=cat.slug %}
                                <div class="event-card" data-category="{{ cat_slug }}">
                                    <div class="event-image">
                                        {% image evento.imagem fill-400x200 as img %}
                                        <img src="{{ img.url }}" alt="{{ evento.titulo }}">
                                        <div class="event-category">{{ evento.categoria }}</div>
                                        <div class="event-date">
                                            <span class="day">{{ evento.data|date:"d" }}</span>
                                            <span>{{ evento.data|date:"M" }}</span>
                                        </div>
                                    </div>
                                    <div class="event-content">
                                        <h3 class="event-title">{{ evento.titulo }}</h3>
                                        <div class="event-info">
                                            <div class="event-info-item">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <polyline points="12 6 12 12 16 14"></polyline>
                                                </svg>
                                                {{ evento.hora_inicio|time:"H:i" }} - {{ evento.hora_fim|time:"H:i" }}
                                            </div>
                                            <div class="event-info-item">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                                    <circle cx="12" cy="10" r="3"></circle>
                                                </svg>
                                                {{ evento.local }}
                                            </div>
                                        </div>
                                        <p class="event-description">
                                            {{ evento.descricao }}
                                        </p>
                                        <div class="event-footer">
                                            <div class="available-spots {% if evento.vagas_disponiveis <= 5 %}limited-spots{% endif %}">
                                                {% if evento.vagas_disponiveis == 0 %}
                                                    Evento lotado
                                                {% elif evento.vagas_disponiveis == 1 %}
                                                    Última vaga disponível
                                                {% elif evento.vagas_disponiveis <= 5 %}
                                                    Apenas {{ evento.vagas_disponiveis }} vagas restantes
                                                {% else %}
                                                    {{ evento.vagas_disponiveis }} vagas disponíveis
                                                {% endif %}
                                            </div>
                                            <a href="#" class="event-action">
                                                Inscrever-se
                                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M5 12h14"></path>
                                                    <path d="M12 5l7 7-7 7"></path>
                                                </svg>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endwith %}
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    </div>
</section>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterButtons = document.querySelectorAll('.filter-button');
        const eventCards = document.querySelectorAll('.event-card');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                filterButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get filter value
                const filterValue = this.getAttribute('data-filter');
                
                // Filter events
                eventCards.forEach(card => {
                    if (filterValue === 'all' || card.getAttribute('data-category') === filterValue) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    });
</script>
{% endblock %}