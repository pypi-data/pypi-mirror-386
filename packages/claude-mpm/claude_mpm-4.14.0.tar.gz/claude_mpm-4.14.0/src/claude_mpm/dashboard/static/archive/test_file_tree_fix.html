<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Tree Tab Fix Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        h2 {
            color: #569cd6;
            margin-top: 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #005a9e;
        }
        .status {
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-size: 14px;
        }
        .info {
            background: #2d4a5d;
            color: #9cdcfe;
            border: 1px solid #3e6379;
        }
        .success {
            background: #1b3b1b;
            color: #4ec24e;
            border: 1px solid #2d5a2d;
        }
        .error {
            background: #5a1d1d;
            color: #f48771;
            border: 1px solid #8b2c2c;
        }
        .log-output {
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 3px;
            padding: 10px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        .log-entry.info { color: #9cdcfe; }
        .log-entry.success { color: #4ec24e; }
        .log-entry.error { color: #f48771; }
        .log-entry.warning { color: #dcdcaa; }
    </style>
</head>
<body>
    <h1>üîß File Tree Tab Fix Verification</h1>
    
    <div class="test-section">
        <h2>Test Configuration</h2>
        <div class="status info">
            <strong>Dashboard URL:</strong> http://localhost:8765<br>
            <strong>Issue:</strong> File Tree tab shows Events list instead of D3.js tree<br>
            <strong>Expected:</strong> File Tree tab should show D3.js tree or empty state
        </div>
        <button onclick="openDashboard()">Open Dashboard</button>
        <button onclick="testFileTree()">Test File Tree Tab</button>
        <button onclick="checkTabState()">Check Tab State</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Debug Log</h2>
        <div class="log-output" id="log-output"></div>
    </div>

    <script>
        const dashboardUrl = 'http://localhost:8765';
        let dashboardWindow = null;
        
        function log(message, type = 'info') {
            const logOutput = document.getElementById('log-output');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logOutput.appendChild(entry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
            document.getElementById('test-results').innerHTML = '';
            log('Logs cleared', 'info');
        }
        
        function openDashboard() {
            dashboardWindow = window.open(dashboardUrl + '#file_tree', 'dashboard');
            log('Opening dashboard with File Tree tab...', 'info');
            
            setTimeout(() => {
                if (dashboardWindow && !dashboardWindow.closed) {
                    log('Dashboard window opened', 'success');
                    log('Navigate to File Tree tab and check what content is displayed', 'warning');
                    checkTabState();
                } else {
                    log('Failed to open dashboard window', 'error');
                }
            }, 2000);
        }
        
        function testFileTree() {
            log('Testing File Tree tab behavior...', 'info');
            
            if (!dashboardWindow || dashboardWindow.closed) {
                log('Dashboard window not open. Opening...', 'warning');
                openDashboard();
                setTimeout(() => testFileTree(), 3000);
                return;
            }
            
            try {
                // Try to interact with the dashboard window
                dashboardWindow.location.hash = '#file_tree';
                log('Set URL hash to #file_tree', 'info');
                
                setTimeout(() => {
                    checkTabState();
                }, 1000);
                
            } catch (e) {
                log('Cannot interact with dashboard due to same-origin policy', 'error');
                log('Please manually click on File Tree tab and observe the content', 'warning');
            }
        }
        
        function checkTabState() {
            if (!dashboardWindow || dashboardWindow.closed) {
                log('Dashboard window not available', 'error');
                return;
            }
            
            const results = document.getElementById('test-results');
            results.innerHTML = '';
            
            log('Checking dashboard state...', 'info');
            
            // Create manual checklist
            const checklist = `
                <div class="status info">
                    <strong>Manual Verification Checklist:</strong><br><br>
                    
                    1. <strong>URL Hash Check:</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Is the URL showing #file_tree? ‚úì/‚úó<br><br>
                    
                    2. <strong>Tab Button Highlight:</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Is ONLY the "üìù File Tree" tab button highlighted? ‚úì/‚úó<br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Are any other tabs also highlighted? (Should be NO)<br><br>
                    
                    3. <strong>Content Display:</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ What do you see in the main content area?<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ùå WRONG: "Search events..." input box<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ùå WRONG: "All Events" dropdown<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚ùå WRONG: List of hook events<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚úÖ CORRECT: "üìÅ File Activity Tree" title<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚úÖ CORRECT: "No file operations recorded yet" message<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚úÖ CORRECT: D3.js tree visualization (if files have been accessed)<br><br>
                    
                    4. <strong>Console Errors:</strong><br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Open browser console (F12)<br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Any errors related to CodeViewer? ‚úì/‚úó<br>
                    &nbsp;&nbsp;&nbsp;‚Ä¢ Any errors about containers not found? ‚úì/‚úó<br><br>
                    
                    <strong>Current Issue Status:</strong><br>
                    If you see Events content in File Tree tab, the issue is NOT fixed.
                </div>
            `;
            
            results.innerHTML = checklist;
            
            log('Manual verification checklist displayed', 'success');
            log('Please check each item in the dashboard', 'warning');
        }
        
        // Auto-run on load
        window.addEventListener('load', () => {
            log('File Tree Fix Test Suite loaded', 'info');
            log('Click "Open Dashboard" to begin testing', 'info');
            log('The dashboard should open directly to File Tree tab', 'info');
            
            // Provide diagnostic info
            setTimeout(() => {
                log('', 'info');
                log('DIAGNOSTIC STEPS:', 'warning');
                log('1. Open dashboard and click File Tree tab', 'info');
                log('2. Check browser console for errors (F12)', 'info');
                log('3. Note EXACTLY what content you see', 'info');
                log('4. If you see Events list, the bug persists', 'error');
                log('5. If you see File Tree or empty state, it\'s fixed!', 'success');
            }, 1000);
        });
    </script>
</body>
</html>