create or replace procedure PLUGIN.ASSIGN_OUTBOUND_TARGET_TYPE(PLUGIN_FQN VARCHAR)
   returns object
   language javascript
   COMMENT = $$
   Called by the setup script during installation/upgrade, used in the rare situation where you need to rename existing connection methods as part of a release.
   $$
   execute as owner
as
$$
// snowflake object automatically injected by Snowpark

try{
    snowflake.log("info", "ASSIGN_OUTBOUND_TARGET_TYPE called");
    var appsResults = snowflake.createStatement( {
        sqlText: `select 
                    APPLICATION_NAME,
                    EXTERNAL_ACCESS_INTEGRATIONS
                from DATA.OMNATA_REGISTRATION`,
        binds:[]
    } ).execute();
    let applicationName;
    if (appsResults.next())  {
        applicationName = appsResults.getColumnValue(1);
        var assignOutboundTargetTypeResult = snowflake.createStatement( {
            sqlText: `call ${applicationName}.API.ASSIGN_OUTBOUND_TARGET_TYPE(?)`,
            binds:[PLUGIN_FQN]
        } ).execute();
        assignOutboundTargetTypeResult.next();
        snowflake.log("info", `ASSIGN_OUTBOUND_TARGET_TYPE result: ${assignOutboundTargetTypeResult.getColumnValue(1)}`);
    }else{
        snowflake.log("info", `Plugin not registered yet, skipping outbound target type assignment`);
    }
    return {
        "success": true,
        "data": {}
    }
}
catch(e){
    snowflake.log("error", e.message);
    return {
       "success": false,
       "error": `ASSIGN_OUTBOUND_TARGET_TYPE: ${String(e)}`
    }
}

$$
;
