CREATE or replace PROCEDURE PLUGIN.FETCH_SYNCS(CONNECTION_ID NUMERIC(38,0) DEFAULT NULL)
RETURNS TABLE()
LANGUAGE SQL
as
DECLARE

SYNCS resultset;
SYNC_ENGINE_DATABASE_NAME varchar;
PROC_NAME varchar;
PLUGIN_REGISTRATION_EXCEPTION EXCEPTION (-20001, 'Plugin is not registered to a sync engine instance');
c1 CURSOR FOR select min(APPLICATION_NAME) from DATA.OMNATA_REGISTRATION;
BEGIN

OPEN c1;
FETCH c1 INTO SYNC_ENGINE_DATABASE_NAME;
IF (:SYNC_ENGINE_DATABASE_NAME = null) THEN
   RAISE PLUGIN_REGISTRATION_EXCEPTION;
END IF;

select CONCAT(:SYNC_ENGINE_DATABASE_NAME,'.API.PLUGIN_FETCH_SYNCS') into :PROC_NAME;

SYNCS:= (call IDENTIFIER(:PROC_NAME)(current_database(),PLUGIN.TOKEN(),:CONNECTION_ID));

RETURN TABLE(SYNCS);

END;