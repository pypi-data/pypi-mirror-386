
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Enhanced utilities and extensions for fsspec filesystems.">
      
      
      
        <link rel="canonical" href="https://legout.github.com/fsspec-utils/advanced/">
      
      
        <link rel="prev" href="../architecture/">
      
      
        <link rel="next" href="../contributing/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Advanced Usage - fsspec-utils</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="fsspec-utils" class="md-header__button md-logo" aria-label="fsspec-utils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            fsspec-utils
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced Usage
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/legout/fsspec-utils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    legout/fsspec-utils
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../quickstart/" class="md-tabs__link">
        
  
  
    
  
  Quickstart

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../architecture/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Advanced Usage

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="fsspec-utils" class="md-nav__button md-logo" aria-label="fsspec-utils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    fsspec-utils
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/legout/fsspec-utils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    legout/fsspec-utils
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unified-filesystem-creation-with-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      Unified Filesystem Creation with filesystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unified Filesystem Creation with filesystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#detailed-caching-for-improved-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Caching for Improved Performance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Caching for Improved Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-and-first-read-populating-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Setup and First Read (Populating Cache)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-read-using-cache" class="md-nav__link">
    <span class="md-ellipsis">
      Second Read (Using Cache)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-from-cache-after-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Reading from Cache after Deletion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-filesystem-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Filesystem Implementations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Filesystem Implementations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gitlab-filesystem-gitlabfilesystem" class="md-nav__link">
    <span class="md-ellipsis">
      GitLab Filesystem (GitLabFileSystem)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-data-reading-and-writing-read_files-write_files" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Data Reading and Writing (read_files, write_files)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Data Reading and Writing (read_files, write_files)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#universal-read_files" class="md-nav__link">
    <span class="md-ellipsis">
      Universal read_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-and-processing-multiple-files-pyarrow-tables-batch-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Reading and Processing Multiple Files (PyArrow Tables, Batch Processing)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reading and Processing Multiple Files (PyArrow Tables, Batch Processing)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-parquet-files" class="md-nav__link">
    <span class="md-ellipsis">
      Reading Parquet Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-csv-files" class="md-nav__link">
    <span class="md-ellipsis">
      Reading CSV Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-json-files" class="md-nav__link">
    <span class="md-ellipsis">
      Reading JSON Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-parquet-handling-and-delta-lake-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Parquet Handling and Delta Lake Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-options-management" class="md-nav__link">
    <span class="md-ellipsis">
      Storage Options Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Storage Options Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loading-from-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Loading from Environment Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-storage-options" class="md-nav__link">
    <span class="md-ellipsis">
      Merging Storage Options
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-on-github-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Note on GitHub Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Tips
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flexible-storage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Flexible Storage Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flexible Storage Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-storage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Local Storage Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conceptual-aws-s3-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual AWS S3 Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conceptual-azure-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual Azure Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conceptual-gcs-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptual GCS Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec-utils API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.core.base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.core.base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.core.ext/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.core.ext
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Storage Options
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Storage Options
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.storage_options.base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.storage_options.base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.storage_options.cloud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.storage_options.cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.storage_options.core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.storage_options.core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.storage_options.git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.storage_options.git
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.datetime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.datetime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.misc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.polars/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.polars
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.pyarrow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.pyarrow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.sql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.sql
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/fsspec_utils.utils.types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fsspec_utils.utils.types
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="advanced-usage">Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h1>
<p><code>fsspec-utils</code> extends the capabilities of <code>fsspec</code> to provide a more robust and feature-rich experience for handling diverse file systems and data formats. This section delves into advanced features, configurations, and performance tips to help you get the most out of the library.</p>
<h2 id="unified-filesystem-creation-with-filesystem">Unified Filesystem Creation with <code>filesystem</code><a class="headerlink" href="#unified-filesystem-creation-with-filesystem" title="Permanent link">&para;</a></h2>
<p>The <code>fsspec_utils.core.filesystem</code> function offers a centralized and enhanced way to instantiate <code>fsspec</code> filesystem objects. It supports:</p>
<ul>
<li><strong>Intelligent Caching</strong>: Automatically wraps filesystems with <code>MonitoredSimpleCacheFileSystem</code> for improved performance and verbose logging of cache operations.</li>
<li><strong>Structured Storage Options</strong>: Integrates seamlessly with <code>fsspec_utils.storage_options</code> classes, allowing for type-safe and organized configuration of cloud and Git-based storage.</li>
<li><strong>Protocol Inference</strong>: Can infer the filesystem protocol directly from a URI or path, reducing boilerplate.</li>
</ul>
<p><strong>Example: Cached S3 Filesystem with Structured Options</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">AwsStorageOptions</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># Configure S3 options using the structured class</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="n">s3_opts</span> <span class="o">=</span> <span class="n">AwsStorageOptions</span><span class="p">(</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="n">access_key_id</span><span class="o">=</span><span class="s2">&quot;YOUR_ACCESS_KEY&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">secret_access_key</span><span class="o">=</span><span class="s2">&quot;YOUR_SECRET_KEY&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="c1"># Create a cached S3 filesystem using the &#39;filesystem&#39; helper</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">storage_options</span><span class="o">=</span><span class="n">s3_opts</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">cache_storage</span><span class="o">=</span><span class="s2">&quot;/tmp/s3_cache&quot;</span><span class="p">,</span> <span class="c1"># Optional: specify cache directory</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># Enable verbose cache logging</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="c1"># Use the filesystem as usual</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="nb">print</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s2">&quot;s3://your-bucket/&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<h3 id="detailed-caching-for-improved-performance">Detailed Caching for Improved Performance<a class="headerlink" href="#detailed-caching-for-improved-performance" title="Permanent link">&para;</a></h3>
<p><code>fsspec-utils</code> provides an enhanced caching mechanism that improves performance for repeated file operations, especially useful for remote filesystems.</p>
<p>This example demonstrates how caching improves read performance. The first read populates the cache, while subsequent reads retrieve data directly from the cache, significantly reducing access time. It also shows that data can still be retrieved from the cache even if the original source becomes unavailable.</p>
<p><strong>Caching in fsspec-utils</strong> is an enhanced mechanism that improves performance for repeated file operations, especially useful for remote filesystems where network latency can significantly impact performance.</p>
<p>The <code>filesystem()</code> function provides several parameters for configuring caching:</p>
<ul>
<li><code>cached</code>: When set to <code>True</code>, enables caching for all read operations</li>
<li><code>cache_storage</code>: Specifies the directory where cached files will be stored</li>
<li><code>verbose</code>: When set to <code>True</code>, provides detailed logging about cache operations</li>
</ul>
<p><strong>Step-by-step walkthrough:</strong></p>
<ol>
<li>
<p><strong>First read (populating cache)</strong>: When reading a file for the first time, the data is retrieved from the source (disk, network, etc.) and stored in the cache directory. This takes longer than subsequent reads because it involves both reading from the source and writing to the cache.</p>
</li>
<li>
<p><strong>Second read (using cache)</strong>: When the same file is read again, the data is retrieved directly from the cache instead of the source. This is significantly faster because it avoids network latency or disk I/O.</p>
</li>
<li>
<p><strong>Demonstrating cache effectiveness</strong>: Even after the original file is removed, the cached version can still be accessed. This demonstrates that the cache acts as a persistent copy of the data, independent of the source file.</p>
</li>
<li>
<p><strong>Performance comparison</strong>: The timing results clearly show the performance benefits of caching, with subsequent reads being orders of magnitude faster than the initial read.</p>
</li>
</ol>
<p>This caching mechanism is particularly valuable when working with:</p>
<ul>
<li>Remote filesystems (S3, GCS, Azure) where network latency is a bottleneck</li>
<li>Frequently accessed files that don't change often</li>
<li>Applications that read the same data multiple times</li>
<li>Environments with unreliable network connections</li>
</ul>
<h4 id="setup-and-first-read-populating-cache">Setup and First Read (Populating Cache)<a class="headerlink" href="#setup-and-first-read-populating-cache" title="Permanent link">&para;</a></h4>
<p>In this step, we create a sample JSON file and initialize the <code>fsspec-utils</code> filesystem with caching enabled. The first read operation retrieves data from the source and populates the cache.</p>
<p><strong>Setup steps:</strong></p>
<ol>
<li>Create a temporary directory for our example</li>
<li>Create sample data file</li>
<li>Configure filesystem with caching</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">examples.caching.setup_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_sample_data_file</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created temporary directory: </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">sample_file</span> <span class="o">=</span> <span class="n">create_sample_data_file</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>    <span class="n">protocol_or_path</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">,</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>    <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>    <span class="n">cache_storage</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== First read (populating cache) ===&quot;</span><span class="p">)</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="n">data1</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="n">first_read_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First read completed in </span><span class="si">{</span><span class="n">first_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="second-read-using-cache">Second Read (Using Cache)<a class="headerlink" href="#second-read-using-cache" title="Permanent link">&para;</a></h4>
<p>Now, let's read the same file again to see the performance improvement from using the cache.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Second read (using cache) ===&quot;</span><span class="p">)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">data2</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">second_read_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second read completed in </span><span class="si">{</span><span class="n">second_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>The second read retrieves data directly from the cache, which is significantly faster than reading from the source again.</p>
<h4 id="reading-from-cache-after-deletion">Reading from Cache after Deletion<a class="headerlink" href="#reading-from-cache-after-deletion" title="Permanent link">&para;</a></h4>
<p>To demonstrate that the cache is persistent, we'll remove the original file and try to read it again.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Demonstrating cache effectiveness ===&quot;</span><span class="p">)</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing original file...&quot;</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original file exists: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Third read (from cache only) ===&quot;</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="n">data3</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">sample_file</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="n">third_read_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Third read completed in </span><span class="si">{</span><span class="n">third_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Successfully read from cache even after original file was removed&quot;</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Performance Comparison ===&quot;</span><span class="p">)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First read (from disk): </span><span class="si">{</span><span class="n">first_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second read (from cache): </span><span class="si">{</span><span class="n">second_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Third read (from cache): </span><span class="si">{</span><span class="n">third_read_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up temporary directory: </span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This step proves that the cache acts as a persistent copy of the data, allowing access even if the original source is unavailable.</p>
<h2 id="custom-filesystem-implementations">Custom Filesystem Implementations<a class="headerlink" href="#custom-filesystem-implementations" title="Permanent link">&para;</a></h2>
<p><code>fsspec-utils</code> provides specialized filesystem implementations for unique use cases:</p>
<h3 id="gitlab-filesystem-gitlabfilesystem">GitLab Filesystem (<code>GitLabFileSystem</code>)<a class="headerlink" href="#gitlab-filesystem-gitlabfilesystem" title="Permanent link">&para;</a></h3>
<p>Access files directly from GitLab repositories. This is particularly useful for configuration files, datasets, or code stored in private or public GitLab instances.</p>
<p><strong>Example: Reading from a GitLab Repository</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1"># Instantiate a GitLab filesystem</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="n">gitlab_fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="s2">&quot;gitlab&quot;</span><span class="p">,</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>        <span class="s2">&quot;project_name&quot;</span><span class="p">:</span> <span class="s2">&quot;your-group/your-project&quot;</span><span class="p">,</span> <span class="c1"># Or &quot;project_id&quot;: 12345</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>        <span class="s2">&quot;ref&quot;</span><span class="p">:</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="c1"># Branch, tag, or commit SHA</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>        <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;glpat_YOUR_PRIVATE_TOKEN&quot;</span> <span class="c1"># Required for private repos</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="p">}</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="c1"># List files in the repository root</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="nb">print</span><span class="p">(</span><span class="n">gitlab_fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="c1"># Read a specific file</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="n">content</span> <span class="o">=</span> <span class="n">gitlab_fs</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;README.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">[:</span><span class="mi">200</span><span class="p">])</span> <span class="c1"># Print first 200 characters</span>
</code></pre></div></td></tr></table></div>
<h2 id="advanced-data-reading-and-writing-read_files-write_files">Advanced Data Reading and Writing (<code>read_files</code>, <code>write_files</code>)<a class="headerlink" href="#advanced-data-reading-and-writing-read_files-write_files" title="Permanent link">&para;</a></h2>
<p>The <code>fsspec_utils.core.ext</code> module (exposed via <code>AbstractFileSystem</code> extensions) provides powerful functions for reading and writing various data formats (JSON, CSV, Parquet) with advanced features like:</p>
<ul>
<li><strong>Batch Processing</strong>: Efficiently handle large datasets by processing files in configurable batches.</li>
<li><strong>Parallel Processing</strong>: Leverage multi-threading to speed up file I/O operations.</li>
<li><strong>Schema Unification &amp; Optimization</strong>: Automatically unifies schemas when concatenating multiple files and optimizes data types for memory efficiency (e.g., using Polars' <code>opt_dtypes</code> or PyArrow's schema casting).</li>
<li><strong>File Path Tracking</strong>: Optionally include the source file path as a column in the resulting DataFrame/Table.</li>
</ul>
<h3 id="universal-read_files">Universal <code>read_files</code><a class="headerlink" href="#universal-read_files" title="Permanent link">&para;</a></h3>
<p>The <code>read_files</code> function acts as a universal reader, delegating to format-specific readers (JSON, CSV, Parquet) while maintaining consistent options.</p>
<p><strong>Example: Reading CSVs in Batches with Parallelism</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="c1"># Assuming you have multiple CSV files like &#39;data/part_0.csv&#39;, &#39;data/part_1.csv&#39;, etc.</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># on your local filesystem</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="c1"># Read CSV files in batches of 10, using multiple threads, and including file path</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">for</span> <span class="n">batch_df</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_files</span><span class="p">(</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="s2">&quot;data/*.csv&quot;</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="n">include_file_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="n">use_threads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="p">):</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed batch with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows. Columns: </span><span class="si">{</span><span class="n">batch_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">batch_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<h3 id="reading-and-processing-multiple-files-pyarrow-tables-batch-processing">Reading and Processing Multiple Files (PyArrow Tables, Batch Processing)<a class="headerlink" href="#reading-and-processing-multiple-files-pyarrow-tables-batch-processing" title="Permanent link">&para;</a></h3>
<p><code>fsspec-utils</code> simplifies reading multiple files of various formats (Parquet, CSV, JSON) from a folder into a single PyArrow Table or Polars DataFrame.</p>
<p><strong>Reading multiple files into a single table</strong> is a powerful feature that allows you to efficiently process data distributed across multiple files. This is particularly useful when dealing with large datasets that are split into smaller files for better organization or parallel processing.</p>
<p><strong>Key concepts demonstrated:</strong></p>
<ol>
<li>
<p><strong>Glob patterns</strong>: The <code>**/*.parquet</code>, <code>**/*.csv</code>, and <code>**/*.json</code> patterns are used to select files recursively from the directory and its subdirectories. The <code>**</code> pattern matches any directories, allowing the function to find files in nested directories.</p>
</li>
<li>
<p><strong>Concat parameter</strong>: The <code>concat=True</code> parameter tells the function to combine data from multiple files into a single table or DataFrame. When set to <code>False</code>, the function would return a list of individual tables/DataFrames.</p>
</li>
<li>
<p><strong>Format flexibility</strong>: The same interface can be used to read different file formats (Parquet, CSV, JSON), making it easy to work with heterogeneous data sources.</p>
</li>
</ol>
<p><strong>Step-by-step explanation:</strong></p>
<ol>
<li>
<p><strong>Creating sample data</strong>: We create two subdirectories and populate them with sample data in three different formats (Parquet, CSV, JSON). Each format contains the same structured data but in different serialization formats.</p>
</li>
<li>
<p><strong>Reading Parquet files</strong>: Using <code>fs.read_parquet("**/*.parquet", concat=True)</code>, we read all Parquet files recursively and combine them into a single PyArrow Table. Parquet is a columnar storage format that is highly efficient for analytical workloads.</p>
</li>
<li>
<p><strong>Reading CSV files</strong>: Using <code>fs.read_csv("**/*.csv", concat=True)</code>, we read all CSV files and combine them into a Polars DataFrame, which we then convert to a PyArrow Table for consistency.</p>
</li>
<li>
<p><strong>Reading JSON files</strong>: Using <code>fs.read_json("**/*.json", as_dataframe=True, concat=True)</code>, we read all JSON files and combine them into a Polars DataFrame, then convert it to a PyArrow Table.</p>
</li>
<li>
<p><strong>Verification</strong>: Finally, we verify that all three tables have the same number of rows, confirming that the data was correctly read and combined across all files and formats.</p>
</li>
</ol>
<p>The flexibility of <code>fsspec-utils</code> allows you to use the same approach with different data sources, including remote filesystems like S3, GCS, or Azure Blob Storage, simply by changing the filesystem path.</p>
<h4 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h4>
<p>First, we'll create a temporary directory with sample data in different formats.</p>
<p><strong>Setup steps:</strong></p>
<ol>
<li>Create a temporary directory for our example</li>
<li>Create sample data in subdirectories</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span>
<span class="normal"><a href="#__codelineno-6-8">8</a></span>
<span class="normal"><a href="#__codelineno-6-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">examples.read_folder.create_dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_sample_dataset</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="n">create_sample_dataset</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This step sets up the environment by creating a temporary directory and populating it with sample data files.</p>
<h4 id="reading-parquet-files">Reading Parquet Files<a class="headerlink" href="#reading-parquet-files" title="Permanent link">&para;</a></h4>
<p>Now, let's read all the Parquet files from the directory and its subdirectories into a single PyArrow Table.</p>
<p><strong>Reading Parquet files:</strong></p>
<ol>
<li>Read Parquet files using glob pattern</li>
<li>Display table information and sample data</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span>
<span class="normal"><a href="#__codelineno-7-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Reading Parquet Files ===&quot;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">parquet_table</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;**/*.parquet&quot;</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read Parquet files into PyArrow Table&quot;</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table shape: </span><span class="si">{</span><span class="n">parquet_table</span><span class="o">.</span><span class="n">num_rows</span><span class="si">}</span><span class="s2"> rows x </span><span class="si">{</span><span class="n">parquet_table</span><span class="o">.</span><span class="n">num_columns</span><span class="si">}</span><span class="s2"> columns&quot;</span><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 3 rows:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="nb">print</span><span class="p">(</span><span class="n">parquet_table</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
<p>We use the <code>read_parquet</code> method with a glob pattern <code>**/*.parquet</code> to find all Parquet files recursively. The <code>concat=True</code> parameter combines them into a single table.</p>
<h4 id="reading-csv-files">Reading CSV Files<a class="headerlink" href="#reading-csv-files" title="Permanent link">&para;</a></h4>
<p>Next, we'll read all the CSV files into a Polars DataFrame and then convert it to a PyArrow Table.</p>
<p><strong>Reading CSV files:</strong></p>
<ol>
<li>Read CSV files using glob pattern</li>
<li>Display DataFrame information and sample data</li>
<li>Convert to PyArrow Table for consistency</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Reading CSV Files ===&quot;</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">csv_df</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;**/*.csv&quot;</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read CSV files into Polars DataFrame&quot;</span><span class="p">)</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame shape: </span><span class="si">{</span><span class="n">csv_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 3 rows:&quot;</span><span class="p">)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">csv_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">csv_table</span> <span class="o">=</span> <span class="n">csv_df</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Similarly, we use <code>read_csv</code> with the same glob pattern to read all CSV files.</p>
<h4 id="reading-json-files">Reading JSON Files<a class="headerlink" href="#reading-json-files" title="Permanent link">&para;</a></h4>
<p>Finally, let's read all the JSON files.</p>
<p><strong>Reading JSON files:</strong></p>
<ol>
<li>Read JSON files using glob pattern</li>
<li>Display DataFrame information and sample data</li>
<li>Convert to PyArrow Table for consistency</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Reading JSON Files ===&quot;</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">json_df</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">&quot;**/*.json&quot;</span><span class="p">,</span> <span class="n">as_dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">concat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read JSON files into Polars DataFrame&quot;</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame shape: </span><span class="si">{</span><span class="n">json_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First 3 rows:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="nb">print</span><span class="p">(</span><span class="n">json_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">json_table</span> <span class="o">=</span> <span class="n">json_df</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <code>read_json</code> method is used to read all JSON files. We set <code>as_dataframe=True</code> to get a Polars DataFrame.</p>
<h4 id="verification">Verification<a class="headerlink" href="#verification" title="Permanent link">&para;</a></h4>
<p>Let's verify that all the tables have the same number of rows.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Verification ===&quot;</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All tables have the same number of rows: </span><span class="si">{</span><span class="n">parquet_table</span><span class="o">.</span><span class="n">num_rows</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">csv_table</span><span class="o">.</span><span class="n">num_rows</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">json_table</span><span class="o">.</span><span class="n">num_rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cleaned up temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>This final step confirms that our data reading and concatenation were successful.</p>
<p>This example shows how to read various file formats from a directory, including subdirectories, into a unified PyArrow Table or Polars DataFrame. It highlights the flexibility of <code>fsspec-utils</code> in handling different data sources and formats.</p>
<p><code>fsspec-utils</code> enables efficient batch processing of large datasets by reading files in smaller, manageable chunks. This is particularly useful for memory-constrained environments or when processing streaming data.</p>
<p><strong>Batch processing</strong> is a technique for handling large datasets by dividing them into smaller, manageable chunks. This is particularly important for:</p>
<ol>
<li><strong>Memory-constrained environments</strong>: When working with datasets that are too large to fit in memory, batch processing allows you to process the data incrementally.</li>
<li><strong>Streaming data</strong>: When data is continuously generated (e.g., from IoT devices or real-time applications), batch processing enables you to process data as it arrives.</li>
<li><strong>Distributed processing</strong>: In distributed computing environments, batch processing allows different nodes to work on different chunks of data simultaneously.</li>
</ol>
<p><strong>The <code>batch_size</code> parameter</strong> controls how many files or records are processed together in each batch. A smaller batch size reduces memory usage but may increase processing overhead, while a larger batch size improves throughput but requires more memory.</p>
<p><strong>Step-by-step walkthrough:</strong></p>
<ol>
<li>
<p><strong>Creating sample batched data</strong>: We generate sample data and distribute it across multiple files in each format (Parquet, CSV, JSON). Each file contains a subset of the total data, simulating a real-world scenario where data is split across multiple files.</p>
</li>
<li>
<p><strong>Reading Parquet files in batches</strong>: Using <code>fs.read_parquet(parquet_path, batch_size=2)</code>, we read all Parquet files in batches of 2 files at a time. Each iteration of the loop processes a batch of files, and the <code>batch</code> variable contains the combined data from those files.</p>
</li>
<li>
<p><strong>Reading CSV files in batches</strong>: Similarly, we use <code>fs.read_csv(csv_path, batch_size=2)</code> to read CSV files in batches. The result is a Polars DataFrame for each batch, which we can process individually.</p>
</li>
<li>
<p><strong>Reading JSON files in batches</strong>: Finally, we use <code>fs.read_json(json_path, batch_size=2)</code> to read JSON files in batches. The JSON data is automatically converted to Polars DataFrames for easy processing.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a>```python
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>print(&quot;\n=== JSON Batch Reading ===&quot;)
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>json_path = os.path.join(temp_dir, &quot;*.json&quot;)
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>print(&quot;\nReading JSON files in batches (batch_size=2):&quot;)
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>for i, batch in enumerate(fs.read_json(json_path, batch_size=2)):
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>    print(f&quot;   Batch {i+1}: shape={batch.shape}&quot;)
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>    print(f&quot;   - Data preview: {batch.head(1).to_dicts()}&quot;)
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>shutil.rmtree(temp_dir)
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>print(f&quot;\nCleaned up temporary directory: {temp_dir}&quot;)
</code></pre></div></td></tr></table></div></p>
</li>
</ol>
<p>The <code>read_json</code> method is also used with <code>batch_size=2</code> to process JSON files in batches.</p>
<p>This example illustrates how to read Parquet, CSV, and JSON files in batches using the <code>batch_size</code> parameter. This approach allows for processing of large datasets without loading the entire dataset into memory at once.</p>
<h3 id="advanced-parquet-handling-and-delta-lake-integration">Advanced Parquet Handling and Delta Lake Integration<a class="headerlink" href="#advanced-parquet-handling-and-delta-lake-integration" title="Permanent link">&para;</a></h3>
<p><code>fsspec-utils</code> enhances Parquet operations with deep integration with PyArrow and Pydala, enabling efficient dataset management, partitioning, and delta lake capabilities.</p>
<ul>
<li><strong><code>pyarrow_dataset</code></strong>: Create PyArrow datasets for optimized querying, partitioning, and predicate pushdown.</li>
<li><strong><code>pyarrow_parquet_dataset</code></strong>: Specialized for Parquet, handling <code>_metadata</code> files for overall dataset schemas.</li>
<li><strong><code>pydala_dataset</code></strong>: Integrates with <code>pydala</code> for advanced features like Delta Lake operations (upserts, schema evolution).</li>
</ul>
<p><strong>Example: Writing to a PyArrow Dataset with Partitioning</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="n">base_path</span> <span class="o">=</span> <span class="s2">&quot;output/my_partitioned_data&quot;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="c1"># Sample data</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="mi">2024</span><span class="p">,</span> <span class="mi">2024</span><span class="p">],</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="p">})</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="c1"># Write data as a partitioned PyArrow dataset</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="n">fs</span><span class="o">.</span><span class="n">write_pyarrow_dataset</span><span class="p">(</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>    <span class="n">path</span><span class="o">=</span><span class="n">base_path</span><span class="p">,</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>    <span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">],</span> <span class="c1"># Partition by year and month</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;parquet&quot;</span><span class="p">,</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>    <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;zstd&quot;</span><span class="p">,</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span> <span class="c1"># Overwrite if path exists</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="p">)</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data written to </span><span class="si">{</span><span class="n">base_path</span><span class="si">}</span><span class="s2"> partitioned by year/month.&quot;</span><span class="p">)</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="c1"># Expected structure: output/my_partitioned_data/year=2023/month=10/data-*.parquet</span>
</code></pre></div></td></tr></table></div>
<p><strong>Example: Delta Lake Operations with Pydala Dataset</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">fs</span> <span class="o">=</span> <span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">delta_path</span> <span class="o">=</span> <span class="s2">&quot;output/my_delta_table&quot;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="c1"># Initial data</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="n">initial_data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">],</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="p">})</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="c1"># Write initial data to a Pydala dataset</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="n">fs</span><span class="o">.</span><span class="n">write_pydala_dataset</span><span class="p">(</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="n">data</span><span class="o">=</span><span class="n">initial_data</span><span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>    <span class="n">path</span><span class="o">=</span><span class="n">delta_path</span><span class="p">,</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial Delta table created.&quot;</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="c1"># New data for an upsert: update Alice, add Charlie</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="n">new_data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Alicia&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">],</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="p">})</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="c1"># Perform a delta merge (upsert)</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="n">fs</span><span class="o">.</span><span class="n">write_pydala_dataset</span><span class="p">(</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>    <span class="n">data</span><span class="o">=</span><span class="n">new_data</span><span class="p">,</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>    <span class="n">path</span><span class="o">=</span><span class="n">delta_path</span><span class="p">,</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a>    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a>    <span class="n">delta_subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="c1"># Column(s) to use for merging</span>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a><span class="p">)</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Delta merge completed.&quot;</span><span class="p">)</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a><span class="c1"># Read the updated table</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a><span class="n">updated_df</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">pydala_dataset</span><span class="p">(</span><span class="n">delta_path</span><span class="p">)</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updated Delta table:&quot;</span><span class="p">)</span>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="nb">print</span><span class="p">(</span><span class="n">updated_df</span><span class="p">)</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a><span class="c1"># Expected: id=1 Alicia version=2, id=2 Bob version=1, id=3 Charlie version=1</span>
</code></pre></div></td></tr></table></div>
<p><code>fsspec-utils</code> facilitates integration with Delta Lake by providing <code>StorageOptions</code> that can be used to configure <code>deltalake</code>'s <code>DeltaTable</code> for various storage backends.</p>
<p>This example demonstrates how to use <code>LocalStorageOptions</code> with <code>deltalake</code>'s <code>DeltaTable</code>. It shows how to initialize a <code>DeltaTable</code> instance by passing the <code>fsspec-utils</code> storage options, enabling seamless interaction with Delta Lake tables across different storage types.</p>
<p><strong>Step-by-step walkthrough:</strong></p>
<ol>
<li>Create a temporary directory for our example</li>
<li>Create a simple Polars DataFrame</li>
<li>Write initial data to create the Delta table</li>
<li>Create a LocalStorageOptions object for the temporary directory</li>
<li>Create a DeltaTable instance, passing storage options</li>
<li>Note: deltalake expects storage_options as a dict, which to_object_store_kwargs provides</li>
<li>Read data from the DeltaTable</li>
<li>Clean up the temporary directory</li>
</ol>
<p><strong>Delta Lake</strong> is an open-source storage layer that brings ACID transactions to Apache Spark and big data workloads. It provides a reliable, scalable, and performant way to work with data lakes, combining the benefits of data lakes (low cost, flexibility) with data warehouses (reliability, performance).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">deltalake</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeltaTable</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalStorageOptions</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="n">delta_table_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;my_delta_table&quot;</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating a dummy Delta table at: </span><span class="si">{</span><span class="n">delta_table_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="n">data</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">]</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="p">})</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="n">data</span><span class="o">.</span><span class="n">write_delta</span><span class="p">(</span><span class="n">delta_table_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;overwrite&quot;</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initial data written to Delta table.&quot;</span><span class="p">)</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="n">local_options</span> <span class="o">=</span> <span class="n">LocalStorageOptions</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="n">dt</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="p">(</span><span class="n">delta_table_path</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">local_options</span><span class="o">.</span><span class="n">to_object_store_kwargs</span><span class="p">())</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Successfully created DeltaTable instance from: </span><span class="si">{</span><span class="n">delta_table_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DeltaTable version: </span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">version</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DeltaTable files: </span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">files</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="n">table_data</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">to_pyarrow_table</span><span class="p">()</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data read from DeltaTable:&quot;</span><span class="p">)</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="nb">print</span><span class="p">(</span><span class="n">table_data</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Key features of Delta Lake:</strong></p>
<ul>
<li>ACID transactions: Ensures data integrity even with concurrent operations</li>
<li>Time travel: Allows querying data as it existed at any point in time</li>
<li>Schema enforcement: Maintains data consistency with schema validation</li>
<li>Scalable metadata: Handles billions of files efficiently</li>
<li>Unified analytics: Supports both batch and streaming workloads</li>
</ul>
<p><strong>Integrating fsspec-utils with Delta Lake:</strong></p>
<p>The <code>fsspec-utils</code> <code>StorageOptions</code> classes can be used to configure <code>deltalake</code>'s <code>DeltaTable</code> for various storage backends. This integration allows you to:</p>
<ol>
<li>Use consistent configuration patterns across different storage systems</li>
<li>Leverage the benefits of fsspec's unified filesystem interface</li>
<li>Seamlessly switch between local and cloud storage without changing your Delta Lake code</li>
</ol>
<p><strong>The <code>to_object_store_kwargs()</code> method</strong> converts <code>fsspec-utils</code> storage options into a dictionary format that <code>deltalake</code> expects for its <code>storage_options</code> parameter. This is necessary because <code>deltalake</code> requires storage options as a dictionary, while <code>fsspec-utils</code> provides them as structured objects.</p>
<p><strong>Step-by-step walkthrough:</strong></p>
<ol>
<li>
<p><strong>Creating a temporary directory</strong>: We create a temporary directory to store our Delta table, ensuring the example is self-contained and doesn't leave artifacts on your system.</p>
</li>
<li>
<p><strong>Creating sample data</strong>: We create a simple Polars DataFrame with sample data that will be written to our Delta table.</p>
</li>
<li>
<p><strong>Writing to Delta table</strong>: Using the <code>write_delta</code> method, we convert our DataFrame into a Delta table. This creates the necessary Delta Lake metadata alongside the data files.</p>
</li>
<li>
<p><strong>Configuring storage options</strong>: We create a <code>LocalStorageOptions</code> object that points to our temporary directory. This object contains all the information needed to access the Delta table.</p>
</li>
<li>
<p><strong>Initializing DeltaTable</strong>: We create a <code>DeltaTable</code> instance by passing the table path and the storage options converted to a dictionary via <code>to_object_store_kwargs()</code>. This allows <code>deltalake</code> to locate and access the Delta table files.</p>
</li>
<li>
<p><strong>Verifying the DeltaTable</strong>: We check the version and files of our Delta table to confirm it was created correctly. Delta tables maintain version history, allowing you to track changes over time.</p>
</li>
<li>
<p><strong>Reading data</strong>: Finally, we read the data from our Delta table back into a PyArrow Table, demonstrating that we can successfully interact with the Delta Lake table using the fsspec-utils configuration.</p>
</li>
</ol>
<p>This integration is particularly valuable when working with Delta Lake in cloud environments, as it allows you to use the same configuration approach for local development and production deployments across different cloud providers.</p>
<h2 id="storage-options-management">Storage Options Management<a class="headerlink" href="#storage-options-management" title="Permanent link">&para;</a></h2>
<p><code>fsspec-utils</code> provides a robust system for managing storage configurations, simplifying credential handling and environment setup.</p>
<h3 id="loading-from-environment-variables">Loading from Environment Variables<a class="headerlink" href="#loading-from-environment-variables" title="Permanent link">&para;</a></h3>
<p>Instead of hardcoding credentials, you can load storage options directly from environment variables.</p>
<p><strong>Example: Loading AWS S3 Configuration from Environment</strong></p>
<p>Set these environment variables before running your script:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">&quot;YOUR_ACCESS_KEY&quot;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">&quot;YOUR_SECRET_KEY&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="s2">&quot;us-west-2&quot;</span>
</code></pre></div></td></tr></table></div></p>
<p>Then in Python:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span>
<span class="normal"><a href="#__codelineno-16-7">7</a></span>
<span class="normal"><a href="#__codelineno-16-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">AwsStorageOptions</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="c1"># Load AWS options directly from environment variables</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">aws_opts</span> <span class="o">=</span> <span class="n">AwsStorageOptions</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded AWS region: </span><span class="si">{</span><span class="n">aws_opts</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="c1"># Use it to create a filesystem</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="c1"># fs = aws_opts.to_filesystem()</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="merging-storage-options">Merging Storage Options<a class="headerlink" href="#merging-storage-options" title="Permanent link">&para;</a></h3>
<p>Combine multiple storage option configurations, useful for layering default settings with user-specific overrides.</p>
<p><strong>Example: Merging S3 Options</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">AwsStorageOptions</span><span class="p">,</span> <span class="n">merge_storage_options</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="c1"># Base configuration</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">base_opts</span> <span class="o">=</span> <span class="n">AwsStorageOptions</span><span class="p">(</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span><span class="p">,</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="n">access_key_id</span><span class="o">=</span><span class="s2">&quot;DEFAULT_KEY&quot;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="p">)</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="c1"># User-provided overrides</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="n">user_overrides</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="s2">&quot;access_key_id&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_KEY&quot;</span><span class="p">,</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>    <span class="s2">&quot;allow_http&quot;</span><span class="p">:</span> <span class="kc">True</span> <span class="c1"># New setting</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="p">}</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="c1"># Merge, with user_overrides taking precedence</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="n">merged_opts</span> <span class="o">=</span> <span class="n">merge_storage_options</span><span class="p">(</span><span class="n">base_opts</span><span class="p">,</span> <span class="n">user_overrides</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged Access Key ID: </span><span class="si">{</span><span class="n">merged_opts</span><span class="o">.</span><span class="n">access_key_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># USER_KEY</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged Region: </span><span class="si">{</span><span class="n">merged_opts</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># us-east-1</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allow HTTP: </span><span class="si">{</span><span class="n">merged_opts</span><span class="o">.</span><span class="n">allow_http</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># True</span>
</code></pre></div></td></tr></table></div>
<h3 id="note-on-github-examples">Note on GitHub Examples<a class="headerlink" href="#note-on-github-examples" title="Permanent link">&para;</a></h3>
<p>For a comprehensive collection of executable examples demonstrating various functionalities and advanced patterns of <code>fsspec-utils</code>, including those discussed in this document, please refer to the <a href="https://github.com/legout/fsspec-utils/tree/main/examples">examples directory on GitHub</a>. Each example is designed to be runnable and provides detailed insights into practical usage.</p>
<h2 id="performance-tips">Performance Tips<a class="headerlink" href="#performance-tips" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Caching</strong>: Always consider using <code>cached=True</code> with the <code>filesystem</code> function, especially for remote filesystems, to minimize repeated downloads.</li>
<li><strong>Parallel Reading</strong>: For multiple files, set <code>use_threads=True</code> in <code>read_json</code>, <code>read_csv</code>, and <code>read_parquet</code> to leverage concurrent I/O.</li>
<li><strong>Batch Processing</strong>: When dealing with a very large number of files or extremely large individual files, use the <code>batch_size</code> parameter in reading functions to process data in chunks, reducing memory footprint.</li>
<li><strong><code>opt_dtypes</code></strong>: Utilize <code>opt_dtypes=True</code> in reading functions when converting to Polars or PyArrow to automatically optimize column data types, leading to more efficient memory usage and faster subsequent operations.</li>
<li><strong>Parquet Datasets</strong>: For large, partitioned Parquet datasets, use <code>pyarrow_dataset</code> or <code>pydala_dataset</code>. These leverage PyArrow's dataset API for efficient metadata handling, partition pruning, and predicate pushdown, reading only the necessary data.</li>
<li><strong>Compression</strong>: When writing Parquet files, choose an appropriate compression codec (e.g., <code>zstd</code>, <code>snappy</code>) to reduce file size and improve I/O performance. <code>zstd</code> often provides a good balance of compression ratio and speed.</li>
</ul>
<h2 id="flexible-storage-configuration">Flexible Storage Configuration<a class="headerlink" href="#flexible-storage-configuration" title="Permanent link">&para;</a></h2>
<p><code>fsspec-utils</code> simplifies configuring connections to various storage systems, including local filesystems, AWS S3, Azure Storage, and Google Cloud Storage, using <code>StorageOptions</code> classes. These options can then be converted into <code>fsspec</code> filesystems.</p>
<h3 id="local-storage-example">Local Storage Example<a class="headerlink" href="#local-storage-example" title="Permanent link">&para;</a></h3>
<p>This example demonstrates how to initialize <code>LocalStorageOptions</code> and use it to interact with the local filesystem.</p>
<p><strong>Step-by-step walkthrough:</strong></p>
<ol>
<li>Create a temporary directory for our test</li>
<li>Create a test file and write content to it</li>
<li>List files in the directory to verify our file was created</li>
<li>Read the content back to verify it was written correctly</li>
<li>Clean up the temporary directory</li>
</ol>
<p><strong>StorageOptions classes</strong> simplify configuration for different storage systems and provide a consistent interface for creating fsspec filesystem objects.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalStorageOptions</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== LocalStorageOptions Example ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="n">local_options</span> <span class="o">=</span> <span class="n">LocalStorageOptions</span><span class="p">(</span><span class="n">auto_mkdir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="n">local_fs</span> <span class="o">=</span> <span class="n">local_options</span><span class="o">.</span><span class="n">to_filesystem</span><span class="p">()</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working in temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="n">temp_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;test_file.txt&quot;</span><span class="p">)</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="k">with</span> <span class="n">local_fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, LocalStorageOptions!&quot;</span><span class="p">)</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created test file: </span><span class="si">{</span><span class="n">temp_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="n">files</span> <span class="o">=</span> <span class="n">local_fs</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files in </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">files</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="k">with</span> <span class="n">local_fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File content: &#39;</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up temporary directory: </span><span class="si">{</span><span class="n">temp_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Local storage example completed.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="conceptual-aws-s3-configuration">Conceptual AWS S3 Configuration<a class="headerlink" href="#conceptual-aws-s3-configuration" title="Permanent link">&para;</a></h3>
<p>This example demonstrates the configuration pattern for <code>AwsStorageOptions</code>. It is expected to fail when attempting to connect to actual cloud services because it uses dummy credentials.</p>
<p><strong>Note:</strong> The <code>to_filesystem()</code> method converts StorageOptions into fsspec-compatible objects, allowing seamless integration with any fsspec-compatible library.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">AwsStorageOptions</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Conceptual AwsStorageOptions Example (using a dummy endpoint) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">aws_options</span> <span class="o">=</span> <span class="n">AwsStorageOptions</span><span class="p">(</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="n">endpoint_url</span><span class="o">=</span><span class="s2">&quot;http://s3.dummy-endpoint.com&quot;</span><span class="p">,</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">access_key_id</span><span class="o">=</span><span class="s2">&quot;DUMMY_KEY&quot;</span><span class="p">,</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="n">secret_access_key</span><span class="o">=</span><span class="s2">&quot;DUMMY_SECRET&quot;</span><span class="p">,</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="n">allow_http</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="p">)</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="n">aws_fs</span> <span class="o">=</span> <span class="n">aws_options</span><span class="o">.</span><span class="n">to_filesystem</span><span class="p">()</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created fsspec filesystem for S3: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">aws_fs</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AWS storage example completed.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="conceptual-azure-configuration">Conceptual Azure Configuration<a class="headerlink" href="#conceptual-azure-configuration" title="Permanent link">&para;</a></h3>
<p>This example shows how to configure <code>AzureStorageOptions</code>.  It is expected to fail when attempting to connect to actual cloud services because it uses dummy credentials.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fsspec_utils.storage_options</span><span class="w"> </span><span class="kn">import</span> <span class="n">AzureStorageOptions</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Conceptual AzureStorageOptions Example (using a dummy connection string) ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="n">azure_options</span> <span class="o">=</span> <span class="n">AzureStorageOptions</span><span class="p">(</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>    <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;az&quot;</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>    <span class="n">account_name</span><span class="o">=</span><span class="s2">&quot;demoaccount&quot;</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>    <span class="n">connection_string</span><span class="o">=</span><span class="s2">&quot;DefaultEndpointsProtocol=https;AccountName=demoaccount;AccountKey=demokey==;EndpointSuffix=core.windows.net&quot;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="n">azure_fs</span> <span class="o">=</span> <span class="n">azure_options</span><span class="o">.</span><span class="n">to_filesystem</span><span class="p">()</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created fsspec filesystem for Azure: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">azure_fs</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Azure storage example completed.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="conceptual-gcs-configuration">Conceptual GCS Configuration<a class="headerlink" href="#conceptual-gcs-configuration" title="Permanent link">&para;</a></h3>
<p>This example shows how to configure <code>GcsStorageOptions</code>.  It is expected to fail when attempting to connect to actual cloud services because it uses dummy credentials.</p>
<p><strong>StorageOptions classes</strong> provide a simplified, consistent interface for configuring connections to various storage systems. They abstract away the complexity of different storage backends and provide a unified way to create fsspec filesystem objects.</p>
<p>The <code>to_filesystem()</code> method converts these options into <code>fsspec</code> compatible objects, enabling seamless integration with any fsspec-compatible library or tool.</p>
<p><strong>Important Note</strong>: The AWS, Azure, and GCS examples use dummy credentials and are for illustrative purposes only. These examples are expected to fail when attempting to connect to actual cloud services because:</p>
<ol>
<li>The endpoint URLs are not real service endpoints</li>
<li>The credentials are placeholder values that don't correspond to actual accounts</li>
<li>The connection strings and tokens are examples, not valid credentials</li>
</ol>
<p>This approach allows you to understand the configuration pattern without needing actual cloud credentials. When using these examples in production, you would replace the dummy values with your real credentials and service endpoints.</p>
<p>```python
from fsspec_utils.storage_options import GcsStorageOptions</p>
<p>print("=== Conceptual GcsStorageOptions Example (using a dummy token path) ===\n")
gcs_options = GcsStorageOptions(
    protocol="gs",
    project="demo-project",
    token="path/to/dummy-service-account.json"
)</p>
<p>gcs_fs = gcs_options.to_filesystem()
print(f"Created fsspec filesystem for GCS: {type(gcs_fs).<strong>name</strong>}")
print("GCS storage example completed.\n")</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "search.suggest", "search.highlight", "toc.integrate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.4.0/dist/mermaid.min.js"></script>
      
        <script src="../javascripts/mermaid.js"></script>
      
    
  </body>
</html>