<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="569pt" height="848pt"
 viewBox="0.00 0.00 569.00 848.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 844)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-844 565,-844 565,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_openstack_controller</title>
<polygon fill="none" stroke="black" points="40,-754 40,-832 426,-832 426,-754 40,-754"/>
<text text-anchor="middle" x="233" y="-816.8" font-family="Times,serif" font-size="14.00">openstack controller node</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_openstack_network</title>
<polygon fill="none" stroke="black" points="8,-147 8,-662 444,-662 444,-147 8,-147"/>
<text text-anchor="middle" x="226" y="-646.8" font-family="Times,serif" font-size="14.00">openstack network node</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_neutron_router_namespace</title>
<polygon fill="none" stroke="black" points="16,-155 16,-429 436,-429 436,-155 16,-155"/>
<text text-anchor="middle" x="226" y="-413.8" font-family="Times,serif" font-size="14.00">neutron router namespace</text>
<text text-anchor="middle" x="226" y="-398.8" font-family="Times,serif" font-size="14.00">(for tenant router)</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_tenant_net_with_gateway</title>
<polygon fill="none" stroke="black" points="68,-8 68,-101 392,-101 392,-8 68,-8"/>
<text text-anchor="middle" x="230" y="-85.8" font-family="Times,serif" font-size="14.00">tenant net with gateway</text>
</g>
<!-- nova_metadata -->
<g id="node1" class="node">
<title>nova_metadata</title>
<polygon fill="none" stroke="black" points="48,-763.5 48,-799.5 226,-799.5 226,-763.5 48,-763.5"/>
<text text-anchor="middle" x="137" y="-777.8" font-family="Times,serif" font-size="14.00">nova metadata service</text>
</g>
<!-- neutron_metadata_agent -->
<g id="node4" class="node">
<title>neutron_metadata_agent</title>
<polygon fill="none" stroke="black" points="42.5,-485.5 42.5,-630.5 269.5,-630.5 269.5,-485.5 42.5,-485.5"/>
<text text-anchor="middle" x="156" y="-615.3" font-family="Times,serif" font-size="14.00">neutron&#45;metadata&#45;agent</text>
<text text-anchor="middle" x="156" y="-584.3" font-family="Times,serif" font-size="14.00">adds HTTP headers:</text>
<text text-anchor="middle" x="156" y="-569.3" font-family="Times,serif" font-size="14.00">X&#45;Tenant&#45;ID: project&#45;UUID</text>
<text text-anchor="middle" x="156" y="-554.3" font-family="Times,serif" font-size="14.00">X&#45;Instance&#45;ID: instance&#45;UUID</text>
<text text-anchor="middle" x="156" y="-539.3" font-family="Times,serif" font-size="14.00">X&#45;Instance&#45;ID&#45;Signature: ...</text>
<text text-anchor="middle" x="156" y="-508.3" font-family="Times,serif" font-size="14.00">removes HTTP header:</text>
<text text-anchor="middle" x="156" y="-493.3" font-family="Times,serif" font-size="14.00"> X&#45;Neutron&#45;Router&#45;ID</text>
</g>
<!-- nova_metadata&#45;&gt;neutron_metadata_agent -->
<g id="edge8" class="edge">
<title>nova_metadata&#45;&gt;neutron_metadata_agent</title>
<path fill="none" stroke="black" d="M49.59,-759.3C33.16,-751.26 18.01,-740.21 8,-725 -0.8,-711.64 1.4,-703.58 8,-689 17.87,-667.19 33.41,-647.59 50.78,-630.62"/>
<polygon fill="black" stroke="black" points="48.27,-762.54 58.83,-763.46 51.15,-756.16 48.27,-762.54"/>
</g>
<!-- response_omitted -->
<g id="node9" class="node">
<title>response_omitted</title>
<text text-anchor="middle" x="156" y="-703.3" font-family="Times,serif" font-size="14.00">the response is omitted for brevity...</text>
</g>
<!-- nova_metadata&#45;&gt;response_omitted -->
<g id="edge10" class="edge">
<title>nova_metadata&#45;&gt;response_omitted</title>
<path fill="none" stroke="black" d="M141.5,-763.32C143.73,-754.83 146.46,-744.39 148.96,-734.88"/>
<polygon fill="black" stroke="black" points="152.38,-735.62 151.53,-725.06 145.61,-733.84 152.38,-735.62"/>
</g>
<!-- public_openstack_api -->
<g id="node2" class="node">
<title>public_openstack_api</title>
<polygon fill="none" stroke="black" points="244.5,-762.5 244.5,-800.5 417.5,-800.5 417.5,-762.5 244.5,-762.5"/>
<text text-anchor="middle" x="331" y="-785.3" font-family="Times,serif" font-size="14.00">public openstack APIs</text>
<text text-anchor="middle" x="331" y="-770.3" font-family="Times,serif" font-size="14.00">(nova, neutron)</text>
</g>
<!-- public_openstack_api&#45;&gt;neutron_metadata_agent -->
<g id="edge9" class="edge">
<title>public_openstack_api&#45;&gt;neutron_metadata_agent</title>
<path fill="none" stroke="black" d="M326.95,-752.53C323.23,-733.48 316.34,-708.31 304,-689 298.98,-681.15 271.41,-656.41 241.39,-630.6"/>
<polygon fill="black" stroke="black" points="323.51,-753.18 328.71,-762.41 330.4,-751.95 323.51,-753.18"/>
<text text-anchor="middle" x="403.5" y="-703.3" font-family="Times,serif" font-size="14.00">looks up instance UUID</text>
</g>
<!-- neutron_l3_agent -->
<g id="node3" class="node">
<title>neutron_l3_agent</title>
<polygon fill="none" stroke="black" points="289,-540 289,-576 425,-576 425,-540 289,-540"/>
<text text-anchor="middle" x="357" y="-554.3" font-family="Times,serif" font-size="14.00">neutron&#45;l3&#45;agent</text>
</g>
<!-- neutron_l3_ns_metadata_proxy -->
<g id="node5" class="node">
<title>neutron_l3_ns_metadata_proxy</title>
<polygon fill="none" stroke="black" points="24.5,-298.5 24.5,-382.5 287.5,-382.5 287.5,-298.5 24.5,-298.5"/>
<text text-anchor="middle" x="156" y="-367.3" font-family="Times,serif" font-size="14.00">neutron ns&#45;metadata&#45;proxy</text>
<text text-anchor="middle" x="156" y="-336.3" font-family="Times,serif" font-size="14.00">adds HTTP headers:</text>
<text text-anchor="middle" x="156" y="-321.3" font-family="Times,serif" font-size="14.00">X&#45;Forwarded&#45;For: instance&#45;IP</text>
<text text-anchor="middle" x="156" y="-306.3" font-family="Times,serif" font-size="14.00">X&#45;Neutron&#45;Router&#45;ID: router&#45;UUID</text>
</g>
<!-- neutron_l3_agent&#45;&gt;neutron_l3_ns_metadata_proxy -->
<g id="edge7" class="edge">
<title>neutron_l3_agent&#45;&gt;neutron_l3_ns_metadata_proxy</title>
<path fill="none" stroke="black" d="M340.89,-539.73C310.91,-507.59 245.59,-437.55 201.18,-389.94"/>
<polygon fill="black" stroke="black" points="203.63,-387.43 194.25,-382.5 198.51,-392.2 203.63,-387.43"/>
<text text-anchor="middle" x="289.5" y="-448.3" font-family="Times,serif" font-size="14.00">starts</text>
</g>
<!-- neutron_router -->
<g id="node7" class="node">
<title>neutron_router</title>
<polygon fill="none" stroke="black" points="306,-322.5 306,-358.5 428,-358.5 428,-322.5 306,-322.5"/>
<text text-anchor="middle" x="367" y="-336.8" font-family="Times,serif" font-size="14.00">neutron router</text>
</g>
<!-- neutron_l3_agent&#45;&gt;neutron_router -->
<g id="edge6" class="edge">
<title>neutron_l3_agent&#45;&gt;neutron_router</title>
<path fill="none" stroke="black" d="M357.8,-539.73C359.54,-502.36 363.65,-413.75 365.74,-368.74"/>
<polygon fill="black" stroke="black" points="369.24,-368.71 366.21,-358.55 362.25,-368.38 369.24,-368.71"/>
<text text-anchor="middle" x="400" y="-455.8" font-family="Times,serif" font-size="14.00">configures</text>
<text text-anchor="middle" x="400" y="-440.8" font-family="Times,serif" font-size="14.00">routes</text>
</g>
<!-- neutron_metadata_agent&#45;&gt;neutron_l3_ns_metadata_proxy -->
<g id="edge5" class="edge">
<title>neutron_metadata_agent&#45;&gt;neutron_l3_ns_metadata_proxy</title>
<path fill="none" stroke="black" d="M156,-475.13C156,-443.6 156,-408.92 156,-382.8"/>
<polygon fill="black" stroke="black" points="152.5,-475.24 156,-485.24 159.5,-475.24 152.5,-475.24"/>
<text text-anchor="middle" x="197" y="-448.3" font-family="Times,serif" font-size="14.00">unix socket</text>
</g>
<!-- neutron_iptables -->
<g id="node6" class="node">
<title>neutron_iptables</title>
<polygon fill="none" stroke="black" points="36,-163.5 36,-231.5 318,-231.5 318,-163.5 36,-163.5"/>
<text text-anchor="middle" x="177" y="-216.3" font-family="Times,serif" font-size="14.00">iptables</text>
<text text-anchor="middle" x="177" y="-201.3" font-family="Times,serif" font-size="14.00">nat table, PREROUTING chain</text>
<text text-anchor="middle" x="177" y="-186.3" font-family="Times,serif" font-size="14.00">rule dst=169.254.169.254:80</text>
<text text-anchor="middle" x="177" y="-171.3" font-family="Times,serif" font-size="14.00">target REDIRECT to=127.0.0.1:9697</text>
</g>
<!-- neutron_l3_ns_metadata_proxy&#45;&gt;neutron_iptables -->
<g id="edge4" class="edge">
<title>neutron_l3_ns_metadata_proxy&#45;&gt;neutron_iptables</title>
<path fill="none" stroke="black" d="M163.61,-288.42C166.41,-269.59 169.51,-248.76 172.03,-231.89"/>
<polygon fill="black" stroke="black" points="160.14,-287.93 162.13,-298.34 167.07,-288.96 160.14,-287.93"/>
<text text-anchor="middle" x="202" y="-268.8" font-family="Times,serif" font-size="14.00">metadata</text>
<text text-anchor="middle" x="202" y="-253.8" font-family="Times,serif" font-size="14.00">traffic</text>
</g>
<!-- instance -->
<g id="node8" class="node">
<title>instance</title>
<polygon fill="none" stroke="black" points="75.5,-16.5 75.5,-69.5 384.5,-69.5 384.5,-16.5 75.5,-16.5"/>
<text text-anchor="middle" x="230" y="-54.3" font-family="Times,serif" font-size="14.00">openstack instance</text>
<text text-anchor="middle" x="230" y="-39.3" font-family="Times,serif" font-size="14.00">no 169.254 IP configured locally</text>
<text text-anchor="middle" x="230" y="-24.3" font-family="Times,serif" font-size="14.00">route: 169.254.169.254 via subnet&#45;gw&#45;IP</text>
</g>
<!-- neutron_iptables&#45;&gt;instance -->
<g id="edge3" class="edge">
<title>neutron_iptables&#45;&gt;instance</title>
<path fill="none" stroke="black" d="M187.46,-153.26C191.28,-139.02 195.92,-123.2 201,-109 205.75,-95.74 212.02,-81.4 217.51,-69.57"/>
<polygon fill="black" stroke="black" points="183.98,-152.75 184.84,-163.31 190.75,-154.52 183.98,-152.75"/>
<text text-anchor="middle" x="273.5" y="-127.8" font-family="Times,serif" font-size="14.00">HTTP GET</text>
<text text-anchor="middle" x="273.5" y="-112.8" font-family="Times,serif" font-size="14.00">169.254.169.254:80</text>
</g>
<!-- neutron_router&#45;&gt;instance -->
<g id="edge2" class="edge">
<title>neutron_router&#45;&gt;instance</title>
<path fill="none" stroke="black" d="M372.1,-312.38C379.21,-266.45 387,-172.2 346,-109 335.07,-92.15 318.17,-79.25 300.62,-69.55"/>
<polygon fill="black" stroke="black" points="368.62,-312.01 370.43,-322.45 375.52,-313.16 368.62,-312.01"/>
<text text-anchor="middle" x="402.5" y="-201.3" font-family="Times,serif" font-size="14.00">normal</text>
<text text-anchor="middle" x="402.5" y="-186.3" font-family="Times,serif" font-size="14.00">traffic</text>
</g>
<!-- response_omitted&#45;&gt;neutron_metadata_agent -->
<!-- traffic_omitted -->
<g id="node10" class="node">
<title>traffic_omitted</title>
<text text-anchor="middle" x="495" y="-554.3" font-family="Times,serif" font-size="14.00">omitted...</text>
</g>
<!-- traffic_omitted&#45;&gt;neutron_router -->
<g id="edge1" class="edge">
<title>traffic_omitted&#45;&gt;neutron_router</title>
<path fill="none" stroke="black" d="M487.35,-530.31C479.51,-505.19 465.95,-467.05 448,-437 430.05,-406.95 402.64,-376.92 384.77,-358.78"/>
<polygon fill="black" stroke="black" points="484,-531.34 490.26,-539.89 490.7,-529.31 484,-531.34"/>
<text text-anchor="middle" x="511.5" y="-448.3" font-family="Times,serif" font-size="14.00">normal traffic</text>
</g>
</g>
</svg>
