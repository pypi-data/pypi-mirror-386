"""Define tests for the Vaughan model."""

from typing import Any

import numpy as np
import pandas as pd
import pytest
from eemilib.emission_data.data_matrix import DataMatrix
from eemilib.emission_data.emission_yield import EmissionYield
from eemilib.model.vaughan import Vaughan, VaughanImplementation
from numpy.testing import assert_array_almost_equal
from numpy.typing import NDArray
from pytest import approx


@pytest.fixture
def vaughan_model() -> Vaughan:
    """Create a default instance of :class:`.Vaughan` model."""
    return Vaughan()


class MockDataMatrix(DataMatrix):
    """Mock a data matrix with only a TEEY."""

    def __init__(self, emission_data):
        """Set emission yield for 'all' population."""
        self.data_matrix = [
            [None, None, None],
            [None, None, None],
            [None, None, None],
            [emission_data, None, None],
        ]

    def has_all_mandatory_files(self, *args, **kwargs) -> bool:
        """Skip this check."""
        return True


def test_initial_parameters(vaughan_model: Vaughan) -> None:
    """Check that the mandatory parameters are defined."""
    expected_parameters = {
        "E_0",
        "E_max",
        "delta_E_transition",
        "teey_low",
        "teey_max",
        "k_s",
        "k_se",
        "E_c1",
    }
    assert set(vaughan_model.initial_parameters.keys()) == expected_parameters


def test_teey_output_shape(vaughan_model: Vaughan) -> None:
    """Check that TEEY array has proper shape."""
    energy = np.linspace(0, 100, 5, dtype=np.float64)
    theta = np.linspace(0, 90, 3, dtype=np.float64)
    result = vaughan_model.teey(energy, theta)
    assert isinstance(result, pd.DataFrame)
    assert result.shape == (5, 4)  # 3 theta columns + 1 energy column


@pytest.mark.parametrize(
    "emission_yield,expected",
    [
        pytest.param(
            EmissionYield(
                population="all",
                data=pd.DataFrame(
                    {
                        # fmt: off
                "Energy [eV]": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500, 510, 520, 530, 540, 550, 560, 570, 580, 590, 600, 610, 620, 630, 640, 650, 660, 670, 680, 690, 700, 710, 720, 730, 740, 750, 760, 770, 780, 790, 800, 810, 820, 830, 840, 850, 860, 870, 880, 890, 900, 910, 920, 930, 940, 950, 960, 970, 980, 990, 1000],
                "0.0 [deg]": [0.814, 0.574, 0.632, 0.677, 0.722, 0.768, 0.825, 0.879, 0.922, 0.98, 1.019, 1.068, 1.122, 1.151, 1.187, 1.224, 1.254, 1.281, 1.304, 1.326, 1.343, 1.365, 1.379, 1.39, 1.405, 1.415, 1.426, 1.435, 1.441, 1.449, 1.458, 1.464, 1.47, 1.476, 1.485, 1.484, 1.485, 1.493, 1.494, 1.502, 1.502, 1.506, 1.508, 1.511, 1.51, 1.513, 1.518, 1.52, 1.522, 1.521, 1.52, 1.523, 1.522, 1.521, 1.521, 1.526, 1.525, 1.523, 1.524, 1.521, 1.523, 1.52, 1.518, 1.515, 1.519, 1.52, 1.516, 1.514, 1.509, 1.511, 1.508, 1.504, 1.501, 1.502, 1.504, 1.506, 1.499, 1.497, 1.495, 1.496, 1.494, 1.489, 1.489, 1.484, 1.482, 1.477, 1.479, 1.473, 1.475, 1.469, 1.469, 1.467, 1.464, 1.461, 1.459, 1.457, 1.45, 1.451, 1.451, 1.443, 1.43,],
                "20.0 [deg]": [0.781, 0.553, 0.594, 0.628, 0.673, 0.72, 0.771, 0.823, 0.872, 0.92, 0.972, 1.011, 1.054, 1.09, 1.119, 1.155, 1.189, 1.21, 1.232, 1.259, 1.277, 1.294, 1.311, 1.325, 1.342, 1.355, 1.361, 1.367, 1.377, 1.381, 1.394, 1.402, 1.409, 1.417, 1.423, 1.424, 1.428, 1.435, 1.442, 1.448, 1.446, 1.454, 1.457, 1.463, 1.465, 1.465, 1.47, 1.473, 1.473, 1.474, 1.476, 1.478, 1.477, 1.479, 1.481, 1.483, 1.484, 1.485, 1.482, 1.484, 1.484, 1.484, 1.486, 1.487, 1.49, 1.485, 1.482, 1.484, 1.484, 1.481, 1.485, 1.479, 1.479, 1.479, 1.482, 1.48, 1.477, 1.476, 1.475, 1.47, 1.468, 1.467, 1.469, 1.462, 1.463, 1.463, 1.46, 1.46, 1.457, 1.455, 1.455, 1.451, 1.448, 1.45, 1.447, 1.442, 1.442, 1.44, 1.441, 1.436, 1.435],
                "40.0 [deg]": [0.866, 0.637, 0.671, 0.715, 0.76, 0.808, 0.868, 0.924, 0.979, 1.03, 1.086, 1.131, 1.176, 1.213, 1.254, 1.293, 1.317, 1.342, 1.372, 1.389, 1.411, 1.424, 1.445, 1.461, 1.48, 1.488, 1.502, 1.513, 1.524, 1.534, 1.546, 1.553, 1.564, 1.569, 1.574, 1.583, 1.59, 1.594, 1.602, 1.604, 1.612, 1.614, 1.621, 1.628, 1.629, 1.635, 1.637, 1.642, 1.64, 1.643, 1.647, 1.65, 1.654, 1.654, 1.655, 1.657, 1.655, 1.656, 1.657, 1.661, 1.661, 1.66, 1.659, 1.661, 1.665, 1.665, 1.663, 1.658, 1.659, 1.66, 1.659, 1.66, 1.655, 1.656, 1.656, 1.654, 1.652, 1.653, 1.65, 1.65, 1.648, 1.65, 1.648, 1.646, 1.644, 1.643, 1.646, 1.641, 1.638, 1.639, 1.633, 1.635, 1.631, 1.627, 1.627, 1.624, 1.621, 1.622, 1.621, 1.618, 1.616],
                "60.0 [deg]": [0.918, 0.803, 0.817, 0.859, 0.926, 0.995, 1.061, 1.127, 1.195, 1.257, 1.32, 1.375, 1.428, 1.466, 1.51, 1.552, 1.584, 1.616, 1.644, 1.67, 1.694, 1.718, 1.738, 1.759, 1.781, 1.797, 1.817, 1.824, 1.836, 1.852, 1.87, 1.881, 1.893, 1.896, 1.905, 1.917, 1.92, 1.937, 1.94, 1.952, 1.956, 1.966, 1.97, 1.971, 1.976, 1.981, 1.99, 1.993, 1.993, 1.996, 2.001, 2.005, 2.009, 2.008, 2.013, 2.012, 2.016, 2.018, 2.023, 2.024, 2.018, 2.027, 2.019, 2.028, 2.025, 2.027, 2.034, 2.035, 2.027, 2.028, 2.035, 2.033, 2.034, 2.031, 2.031, 2.025, 2.025, 2.033, 2.03, 2.022, 2.023, 2.025, 2.022, 2.019, 2.02, 2.012, 2.018, 2.017, 2.009, 2.018, 2.018, 2.009, 2.008, 2.013, 2.003, 2.009, 2.001, 2.005, 2.002, 1.997, 2.001],
                        # fmt: on
                    }
                ),
            ),
            {
                "E_0": 12.5,
                "E_max": 550.5505505505506,
                "delta_E_transition": 1.0,
                "teey_low": 0.5,
                "teey_max": 1.525944944944945,
                "k_s": 1.0,
                "k_se": 1.0,
                "E_c1": 95.0950950950951,
            },
            id="Cu 1 eroded",
        ),
        pytest.param(
            EmissionYield(
                population="all",
                data=pd.DataFrame(
                    {
                        # fmt: off
                "Energy [eV]": [10, 30, 50, 70, 90, 110, 130, 150, 170, 190, 210, 230, 250, 270, 290, 310, 330, 350, 370, 390, 410, 430, 450, 470, 490, 510, 530, 550, 570, 590, 610, 630, 650, 670, 690, 710, 730, 750, 770, 790, 810, 830, 850, 870, 890, 910, 930, 950, 970, 990],
                "0.0 [deg]": [0.696, 1.1, 1.364, 1.605, 1.754, 1.895, 1.979, 2.021, 2.115, 2.153, 2.185, 2.221, 2.237, 2.234, 2.221, 2.208, 2.201, 2.193, 2.17, 2.199, 2.181, 2.182, 2.145, 2.15, 2.121, 2.097, 2.102, 2.077, 2.075, 2.039, 2.047, 2.032, 2.027, 2.007, 1.998, 2.001, 1.982, 1.969, 1.936, 1.94, 1.931, 1.918, 1.921, 1.909, 1.89, 1.884, 1.88, 1.856, 1.875, 1.838],
                "20.0 [deg]": [0.704, 1.075, 1.357, 1.58, 1.716, 1.876, 1.988, 2.092, 2.17, 2.217, 2.207, 2.274, 2.281, 2.326, 2.3, 2.298, 2.288, 2.281, 2.262, 2.27, 2.271, 2.235, 2.227, 2.199, 2.201, 2.156, 2.188, 2.165, 2.136, 2.107, 2.13, 2.109, 2.114, 2.121, 2.078, 2.044, 2.064, 2.033, 2.022, 2.009, 2.023, 2.018, 1.972, 1.978, 1.994, 1.974, 1.941, 1.951, 1.915, 1.91],
                "40.0 [deg]": [0.784, 1.086, 1.37, 1.609, 1.777, 1.957, 2.082, 2.141, 2.235, 2.301, 2.328, 2.372, 2.373, 2.386, 2.363, 2.388, 2.402, 2.399, 2.389, 2.378, 2.373, 2.396, 2.404, 2.358, 2.374, 2.383, 2.344, 2.38, 2.334, 2.324, 2.289, 2.274, 2.268, 2.236, 2.263, 2.225, 2.235, 2.228, 2.219, 2.191, 2.179, 2.163, 2.155, 2.149, 2.18, 2.153, 2.13, 2.12, 2.104, 2.099],
                "60.0 [deg]": [0.744, 1.063, 1.334, 1.597, 1.739, 1.928, 2.169, 2.183, 2.331, 2.375, 2.374, 2.519, 2.519, 2.506, 2.528, 2.558, 2.583, 2.586, 2.616, 2.605, 2.576, 2.56, 2.582, 2.608, 2.606, 2.582, 2.618, 2.585, 2.546, 2.542, 2.534, 2.556, 2.543, 2.53, 2.509, 2.578, 2.488, 2.511, 2.479, 2.475, 2.541, 2.459, 2.46, 2.503, 2.441, 2.478, 2.444, 2.427, 2.433, 2.411],
                        # fmt: on
                    }
                ),
            ),
            {
                "E_0": 12.5,
                "E_max": 250.34034034034033,
                "delta_E_transition": 1.0,
                "teey_low": 0.5,
                "teey_max": 2.236948948948949,
                "k_s": 1.0,
                "k_se": 1.0,
                "E_c1": 24.714714714714717,
            },
            marks=pytest.mark.smoke,
            id="Cu 2 as received",
        ),
        pytest.param(
            EmissionYield(
                population="all",
                data=pd.DataFrame(
                    {
                        # fmt: off
                "Energy [eV]": [10, 30, 50, 70, 90, 110, 130, 150, 170, 190, 210, 230, 250, 270, 290, 310, 330, 350, 370, 390, 410, 430, 450, 470, 490, 510, 530, 550, 570, 590, 610, 630, 650, 670, 690, 710, 730, 750, 770, 790, 810, 830, 850, 870, 890, 910, 930, 950, 970, 990],
                "0.0 [deg]": [0.569, 0.871, 1.039, 1.189, 1.303, 1.388, 1.465, 1.528, 1.574, 1.601, 1.644, 1.659, 1.677, 1.688, 1.674, 1.675, 1.675, 1.68, 1.689, 1.696, 1.68, 1.665, 1.659, 1.652, 1.642, 1.642, 1.623, 1.614, 1.622, 1.599, 1.614, 1.568, 1.583, 1.567, 1.557, 1.548, 1.549, 1.54, 1.525, 1.517, 1.518, 1.51, 1.486, 1.477, 1.471, 1.467, 1.465, 1.442, 1.45, 1.436],
                "20.0 [deg]": [0.584, 0.851, 1.063, 1.202, 1.355, 1.433, 1.526, 1.57, 1.612, 1.666, 1.694, 1.711, 1.717, 1.735, 1.75, 1.734, 1.744, 1.743, 1.745, 1.739, 1.724, 1.72, 1.712, 1.709, 1.698, 1.699, 1.681, 1.655, 1.66, 1.659, 1.642, 1.644, 1.644, 1.62, 1.615, 1.614, 1.616, 1.599, 1.586, 1.579, 1.568, 1.549, 1.548, 1.535, 1.536, 1.516, 1.514, 1.496, 1.509, 1.493],
                "40.0 [deg]": [0.688, 0.861, 1.146, 1.304, 1.459, 1.582, 1.632, 1.74, 1.779, 1.807, 1.852, 1.885, 1.887, 1.915, 1.942, 1.937, 1.965, 1.961, 1.971, 1.951, 1.947, 1.944, 1.918, 1.919, 1.943, 1.914, 1.9, 1.905, 1.891, 1.89, 1.86, 1.878, 1.848, 1.865, 1.842, 1.827, 1.823, 1.825, 1.789, 1.808, 1.798, 1.767, 1.769, 1.758, 1.751, 1.725, 1.738, 1.721, 1.715, 1.704],
                "60.0 [deg]": [0.777, 0.867, 1.058, 1.208, 1.347, 1.464, 1.557, 1.611, 1.694, 1.737, 1.798, 1.822, 1.847, 1.853, 1.876, 1.87, 1.886, 1.918, 1.919, 1.923, 1.91, 1.909, 1.895, 1.926, 1.904, 1.914, 1.924, 1.906, 1.904, 1.897, 1.898, 1.916, 1.917, 1.905, 1.905, 1.886, 1.879, 1.886, 1.881, 1.878, 1.867, 1.851, 1.854, 1.852, 1.855, 1.868, 1.844, 1.839, 1.851, 1.842],
                        # fmt: on
                    }
                ),
            ),
            {
                "E_0": 12.5,
                "E_max": 389.63963963963965,
                "delta_E_transition": 1.0,
                "teey_low": 0.5,
                "teey_max": 1.695873873873874,
                "k_s": 1.0,
                "k_se": 1.0,
                "E_c1": 45.31531531531532,
            },
            id="Cu 2 heated",
        ),
    ],
)
def test_find_optimal_parameters(
    vaughan_model: Vaughan,
    emission_yield: Any,
    expected: dict[str, float],
) -> None:
    """Test on several samples that the fit gives expected results."""
    mock_data_matrix = MockDataMatrix(emission_yield)
    vaughan_model.find_optimal_parameters(mock_data_matrix)
    found_parameters = {
        name: val.value for name, val in vaughan_model.parameters.items()
    }
    assert expected == approx(found_parameters)


@pytest.mark.parametrize(
    "vaughan_parameters,vaughan_implementation,energy,theta,expected",
    [
        pytest.param(
            {
                "E_c1": 17,
                "E_max": 276,
                "teey_low": 0.8,
                "teey_max": 2.92,
                "E_0": 8,
            },
            "SPARK3D",
            np.linspace(0, 1000, 501),
            np.zeros(1),
            # fmt: off
            np.array([[0, 0, 0, 0, 0, 0.729686, 0.815298, 0.893233, 0.965107, 1.03202, 1.09475, 1.15389, 1.20991, 1.26315, 1.31392, 1.36245, 1.40895, 1.45358, 1.49649, 1.53782, 1.57767, 1.61614, 1.65331, 1.68927, 1.72408, 1.7578, 1.7905, 1.82222, 1.85301, 1.88291, 1.91196, 1.9402, 1.96767, 1.99439, 2.02039, 2.0457, 2.07035, 2.09436, 2.11775, 2.14055, 2.16276, 2.18442, 2.20554, 2.22614, 2.24622, 2.26581, 2.28493, 2.30358, 2.32177, 2.33953, 2.35686, 2.37377, 2.39028, 2.40639, 2.42211, 2.43746, 2.45244, 2.46706, 2.48133, 2.49526, 2.50886, 2.52213, 2.53508, 2.54772, 2.56005, 2.57208, 2.58383, 2.59528, 2.60646, 2.61736, 2.62799, 2.63835, 2.64846, 2.65832, 2.66792, 2.67729, 2.68641, 2.6953, 2.70396, 2.71239, 2.7206, 2.7286, 2.73638, 2.74395, 2.75131, 2.75847, 2.76544, 2.7722, 2.77878, 2.78517, 2.79137, 2.79739, 2.80323, 2.80889, 2.81438, 2.8197, 2.82485, 2.82984, 2.83467, 2.83934, 2.84385, 2.8482, 2.8524, 2.85646, 2.86037, 2.86413, 2.86775, 2.87123, 2.87457, 2.87777, 2.88085, 2.88379, 2.8866, 2.88928, 2.89184, 2.89427, 2.89658, 2.89877, 2.90085, 2.9028, 2.90465, 2.90637, 2.90799, 2.9095, 2.9109, 2.91219, 2.91338, 2.91447, 2.91545, 2.91633, 2.91712, 2.9178, 2.91839, 2.91889, 2.91929, 2.9196, 2.91983, 2.91996, 2.92, 2.91998, 2.91992, 2.91983, 2.9197, 2.91953, 2.91932, 2.91908, 2.91881, 2.9185, 2.91816, 2.91778, 2.91737, 2.91693, 2.91645, 2.91594, 2.91541, 2.91484, 2.91424, 2.91361, 2.91295, 2.91226, 2.91155, 2.9108, 2.91003, 2.90923, 2.9084, 2.90754, 2.90666, 2.90575, 2.90482, 2.90386, 2.90287, 2.90186, 2.90082, 2.89977, 2.89868, 2.89758, 2.89644, 2.89529, 2.89412, 2.89292, 2.8917, 2.89045, 2.88919, 2.8879, 2.88659, 2.88527, 2.88392, 2.88255, 2.88116, 2.87975, 2.87832, 2.87688, 2.87541, 2.87392, 2.87242, 2.8709, 2.86935, 2.8678, 2.86622, 2.86463, 2.86301, 2.86139, 2.85974, 2.85808, 2.8564, 2.8547, 2.85299, 2.85127, 2.84952, 2.84777, 2.84599, 2.8442, 2.8424, 2.84058, 2.83875, 2.8369, 2.83504, 2.83317, 2.83128, 2.82938, 2.82746, 2.82553, 2.82359, 2.82163, 2.81966, 2.81768, 2.81569, 2.81368, 2.81166, 2.80963, 2.80759, 2.80553, 2.80346, 2.80139, 2.7993, 2.7972, 2.79508, 2.79296, 2.79083, 2.78868, 2.78653, 2.78436, 2.78218, 2.78, 2.7778, 2.7756, 2.77338, 2.77115, 2.76892, 2.76667, 2.76442, 2.76215, 2.75988, 2.7576, 2.75531, 2.75301, 2.7507, 2.74838, 2.74606, 2.74372, 2.74138, 2.73903, 2.73667, 2.73431, 2.73193, 2.72955, 2.72716, 2.72476, 2.72236, 2.71995, 2.71753, 2.7151, 2.71267, 2.71023, 2.70778, 2.70532, 2.70286, 2.70039, 2.69792, 2.69544, 2.69295, 2.69046, 2.68796, 2.68545, 2.68294, 2.68042, 2.6779, 2.67537, 2.67283, 2.67029, 2.66774, 2.66519, 2.66263, 2.66007, 2.6575, 2.65493, 2.65235, 2.64976, 2.64717, 2.64458, 2.64198, 2.63938, 2.63677, 2.63415, 2.63154, 2.62891, 2.62629, 2.62366, 2.62102, 2.61838, 2.61574, 2.61309, 2.61044, 2.60778, 2.60512, 2.60245, 2.59979, 2.59711, 2.59444, 2.59176, 2.58908, 2.58639, 2.5837, 2.58101, 2.57831, 2.57561, 2.57291, 2.5702, 2.56749, 2.56478, 2.56206, 2.55934, 2.55662, 2.55389, 2.55117, 2.54844, 2.5457, 2.54297, 2.54023, 2.53749, 2.53474, 2.532, 2.52925, 2.5265, 2.52374, 2.52099, 2.51823, 2.51547, 2.5127, 2.50994, 2.50717, 2.5044, 2.50163, 2.49886, 2.49608, 2.4933, 2.49053, 2.48774, 2.48496, 2.48218, 2.47939, 2.4766, 2.47381, 2.47102, 2.46823, 2.46544, 2.46264, 2.45984, 2.45705, 2.45425, 2.45144, 2.44864, 2.44584, 2.44303, 2.44023, 2.43742, 2.43461, 2.4318, 2.42899, 2.42618, 2.42337, 2.42056, 2.41774, 2.41493, 2.41211, 2.40929, 2.40648, 2.40366, 2.40084, 2.39802, 2.3952, 2.39238, 2.38956, 2.38673, 2.38391, 2.38109, 2.37826, 2.37544, 2.37261, 2.36979, 2.36696, 2.36414, 2.36131, 2.35849, 2.35566, 2.35283, 2.35001, 2.34718, 2.34435, 2.34152, 2.3387, 2.33587, 2.33304, 2.33021, 2.32739, 2.32456, 2.32173, 2.3189, 2.31608, 2.31325, 2.31042, 2.3076, 2.30477, 2.30194, 2.29912, 2.29629, 2.29346, 2.29064, 2.28781, 2.28499, 2.28216, 2.27934, 2.27652, 2.27369, 2.27087, 2.26805, 2.26523, 2.26241, 2.25959, 2.25677, 2.25395, 2.25113, 2.24831, 2.24549, 2.24268, 2.23986, 2.23704, 2.23423, 2.23142, 2.2286, 2.22579, 2.22298, 2.22017, 2.21736, 2.21455, 2.21174, 2.20893, 2.20613, 2.20332, 2.20052, 2.19771, 2.19491, 2.19211, 2.18931, 2.18651, 2.18371, 2.18091, 2.17812, 2.17532, 2.17253, 2.16973, 2.16694, 2.16415, 2.16136, 2.15857, 2.15578, 2.153, 2.15021, 2.14743, 2.14465, 2.14187, 2.13909, 2.13631, 2.13353, 2.13075, 2.12798, 2.12521, 2.12243, 2.11966, 2.11689, 2.11413, 2.11136, 2.1086, 2.10583, 2.10307, 2.10031, 2.09693, 2.09546, 2.09398, 2.09251, 2.09104]]),
            # fmt: on
            id="Compare EEmiLib with manual SPARK3D export on Aluminium (ECSS-2020)",
        ),
        pytest.param(
            {"E_c1": 19, "E_max": 232, "teey_low": 0.8, "teey_max": 2.48},
            "SPARK3D",
            np.linspace(0, 1000, 501),
            np.zeros(1),
            # fmt: off
            np.array([[0, 0, 0, 0, 0, 0.696006, 0.773736, 0.844535, 0.909806, 0.970519, 1.02737, 1.0809, 1.1315, 1.17952, 1.22521, 1.26881, 1.31048, 1.3504, 1.38869, 1.42547, 1.46086, 1.49493, 1.52778, 1.55946, 1.59006, 1.61962, 1.64819, 1.67584, 1.7026, 1.72851, 1.75361, 1.77794, 1.80152, 1.82439, 1.84658, 1.8681, 1.889, 1.90928, 1.92897, 1.94809, 1.96666, 1.9847, 2.00222, 2.01924, 2.03577, 2.05184, 2.06745, 2.08262, 2.09735, 2.11167, 2.12558, 2.1391, 2.15223, 2.16498, 2.17737, 2.18941, 2.20109, 2.21244, 2.22345, 2.23415, 2.24452, 2.25459, 2.26436, 2.27384, 2.28303, 2.29194, 2.30057, 2.30894, 2.31704, 2.32489, 2.33249, 2.33984, 2.34695, 2.35382, 2.36046, 2.36688, 2.37308, 2.37905, 2.38482, 2.39038, 2.39573, 2.40088, 2.40584, 2.4106, 2.41517, 2.41956, 2.42377, 2.4278, 2.43165, 2.43533, 2.43885, 2.44219, 2.44538, 2.44841, 2.45127, 2.45399, 2.45656, 2.45897, 2.46125, 2.46337, 2.46536, 2.46721, 2.46893, 2.47051, 2.47196, 2.47329, 2.47449, 2.47556, 2.47651, 2.47735, 2.47806, 2.47866, 2.47915, 2.47952, 2.47979, 2.47995, 2.48, 2.47998, 2.47991, 2.47979, 2.47964, 2.47944, 2.47919, 2.47891, 2.47858, 2.47821, 2.47781, 2.47736, 2.47687, 2.47635, 2.47579, 2.47519, 2.47456, 2.47389, 2.47319, 2.47245, 2.47168, 2.47087, 2.47004, 2.46917, 2.46826, 2.46733, 2.46637, 2.46537, 2.46435, 2.46329, 2.46221, 2.4611, 2.45996, 2.45879, 2.45759, 2.45637, 2.45512, 2.45385, 2.45255, 2.45122, 2.44987, 2.4485, 2.4471, 2.44568, 2.44423, 2.44276, 2.44127, 2.43976, 2.43822, 2.43666, 2.43508, 2.43348, 2.43186, 2.43021, 2.42855, 2.42687, 2.42517, 2.42344, 2.4217, 2.41994, 2.41817, 2.41637, 2.41455, 2.41272, 2.41087, 2.409, 2.40712, 2.40522, 2.4033, 2.40137, 2.39942, 2.39745, 2.39547, 2.39347, 2.39146, 2.38944, 2.38739, 2.38534, 2.38327, 2.38118, 2.37909, 2.37697, 2.37485, 2.37271, 2.37056, 2.36839, 2.36622, 2.36403, 2.36182, 2.35961, 2.35738, 2.35514, 2.35289, 2.35063, 2.34836, 2.34608, 2.34378, 2.34148, 2.33916, 2.33683, 2.33449, 2.33215, 2.32979, 2.32742, 2.32504, 2.32266, 2.32026, 2.31786, 2.31544, 2.31302, 2.31058, 2.30814, 2.30569, 2.30323, 2.30077, 2.29829, 2.29581, 2.29332, 2.29082, 2.28831, 2.28579, 2.28327, 2.28074, 2.2782, 2.27566, 2.27311, 2.27055, 2.26799, 2.26541, 2.26284, 2.26025, 2.25766, 2.25506, 2.25246, 2.24985, 2.24723, 2.24461, 2.24198, 2.23935, 2.23671, 2.23407, 2.23142, 2.22876, 2.2261, 2.22343, 2.22076, 2.21809, 2.21541, 2.21272, 2.21003, 2.20734, 2.20464, 2.20194, 2.19923, 2.19652, 2.1938, 2.19108, 2.18835, 2.18563, 2.18289, 2.18016, 2.17742, 2.17467, 2.17193, 2.16918, 2.16642, 2.16366, 2.1609, 2.15814, 2.15537, 2.1526, 2.14983, 2.14705, 2.14427, 2.14149, 2.13871, 2.13592, 2.13313, 2.13034, 2.12754, 2.12474, 2.12194, 2.11914, 2.11633, 2.11353, 2.11072, 2.10791, 2.10509, 2.10228, 2.09946, 2.09664, 2.09382, 2.091, 2.08818, 2.08535, 2.08252, 2.07969, 2.07686, 2.07403, 2.0712, 2.06836, 2.06553, 2.06269, 2.05985, 2.05701, 2.05417, 2.05133, 2.04848, 2.04564, 2.04279, 2.03995, 2.0371, 2.03425, 2.03141, 2.02856, 2.02571, 2.02286, 2.02001, 2.01716, 2.0143, 2.01145, 2.0086, 2.00575, 2.00289, 2.00004, 1.99719, 1.99433, 1.99148, 1.98862, 1.98577, 1.98291, 1.98006, 1.9772, 1.97435, 1.97149, 1.96864, 1.96578, 1.96293, 1.96008, 1.95722, 1.95437, 1.95152, 1.94866, 1.94581, 1.94296, 1.94011, 1.93725, 1.9344, 1.93155, 1.9287, 1.92586, 1.92301, 1.92016, 1.91731, 1.91446, 1.91162, 1.90877, 1.90593, 1.90309, 1.90024, 1.8974, 1.89456, 1.89172, 1.88888, 1.88604, 1.88321, 1.88037, 1.87754, 1.8747, 1.87187, 1.86904, 1.86621, 1.86338, 1.86055, 1.85772, 1.8549, 1.85207, 1.84925, 1.84643, 1.84361, 1.84079, 1.83797, 1.83515, 1.83234, 1.82953, 1.82671, 1.8239, 1.82109, 1.81829, 1.81548, 1.81268, 1.80987, 1.80707, 1.80427, 1.80147, 1.79868, 1.79588, 1.79309, 1.7903, 1.78751, 1.78472, 1.7812, 1.77971, 1.77822, 1.77673, 1.77526, 1.77378, 1.77231, 1.77084, 1.76938, 1.76793, 1.76648, 1.76503, 1.76359, 1.76215, 1.76071, 1.75929, 1.75786, 1.75644, 1.75502, 1.75361, 1.75221, 1.7508, 1.74941, 1.74801, 1.74662, 1.74524, 1.74386, 1.74248, 1.74111, 1.73974, 1.73837, 1.73701, 1.73566, 1.7343, 1.73296, 1.73161, 1.73027, 1.72894, 1.7276, 1.72627, 1.72495, 1.72363, 1.72231, 1.721, 1.71969, 1.71839, 1.71709, 1.71579, 1.7145, 1.71321, 1.71192, 1.71064, 1.70936, 1.70808, 1.70681, 1.70554, 1.70428, 1.70302, 1.70176, 1.70051, 1.69926, 1.69801, 1.69677, 1.69553, 1.6943, 1.69306, 1.69184, 1.69061, 1.68939, 1.68817, 1.68695, 1.68574, 1.68453, 1.68333, 1.68213, 1.68093, 1.67973, 1.67854, 1.67735, 1.67617, 1.67499, 1.67381, 1.67263, 1.67146]]),
            # fmt: on
            id="Compare EEmiLib with manual SPARK3D export on Copper (ECSS-2020)",
        ),
        pytest.param(
            {"E_c1": 20, "E_max": 315, "teey_low": 0.8, "teey_max": 2.34},
            "SPARK3D",
            np.linspace(0, 1000, 501),
            np.zeros(1),
            # fmt: off
            np.array([[0, 0, 0, 0, 0, 0.798212, 0.842623, 0.884734, 0.924818, 0.963093, 0.999738, 1.0349, 1.06872, 1.10129, 1.13271, 1.16306, 1.19242, 1.22084, 1.24839, 1.27511, 1.30105, 1.32626, 1.35076, 1.37459, 1.39779, 1.42038, 1.44239, 1.46384, 1.48475, 1.50516, 1.52507, 1.5445, 1.56348, 1.58201, 1.60012, 1.61782, 1.63511, 1.65202, 1.66855, 1.68472, 1.70054, 1.71601, 1.73115, 1.74597, 1.76047, 1.77466, 1.78855, 1.80216, 1.81547, 1.82852, 1.84129, 1.8538, 1.86604, 1.87804, 1.88979, 1.90131, 1.91258, 1.92363, 1.93445, 1.94505, 1.95543, 1.96561, 1.97557, 1.98534, 1.9949, 2.00427, 2.01345, 2.02244, 2.03124, 2.03987, 2.04832, 2.05659, 2.06469, 2.07263, 2.0804, 2.08801, 2.09546, 2.10275, 2.10989, 2.11688, 2.12372, 2.13041, 2.13696, 2.14337, 2.14964, 2.15577, 2.16177, 2.16763, 2.17337, 2.17898, 2.18446, 2.18981, 2.19505, 2.20016, 2.20515, 2.21003, 2.2148, 2.21944, 2.22398, 2.22841, 2.23273, 2.23694, 2.24105, 2.24505, 2.24895, 2.25275, 2.25645, 2.26005, 2.26355, 2.26696, 2.27028, 2.2735, 2.27663, 2.27967, 2.28263, 2.28549, 2.28827, 2.29096, 2.29357, 2.29609, 2.29854, 2.3009, 2.30318, 2.30538, 2.30751, 2.30956, 2.31153, 2.31343, 2.31526, 2.31701, 2.31869, 2.3203, 2.32184, 2.32331, 2.32471, 2.32605, 2.32731, 2.32852, 2.32966, 2.33073, 2.33174, 2.33269, 2.33358, 2.3344, 2.33517, 2.33588, 2.33652, 2.33711, 2.33765, 2.33812, 2.33855, 2.33891, 2.33922, 2.33948, 2.33969, 2.33984, 2.33994, 2.33999, 2.34, 2.33997, 2.33993, 2.33986, 2.33978, 2.33967, 2.33954, 2.33939, 2.33922, 2.33903, 2.33882, 2.33859, 2.33834, 2.33807, 2.33778, 2.33747, 2.33715, 2.33681, 2.33644, 2.33606, 2.33567, 2.33525, 2.33482, 2.33437, 2.3339, 2.33342, 2.33292, 2.33241, 2.33187, 2.33133, 2.33076, 2.33018, 2.32959, 2.32898, 2.32835, 2.32771, 2.32706, 2.32639, 2.3257, 2.32501, 2.32429, 2.32357, 2.32283, 2.32207, 2.3213, 2.32052, 2.31973, 2.31892, 2.3181, 2.31727, 2.31642, 2.31556, 2.31469, 2.31381, 2.31292, 2.31201, 2.31109, 2.31016, 2.30922, 2.30826, 2.3073, 2.30632, 2.30533, 2.30433, 2.30332, 2.3023, 2.30127, 2.30023, 2.29918, 2.29812, 2.29704, 2.29596, 2.29487, 2.29376, 2.29265, 2.29153, 2.2904, 2.28926, 2.2881, 2.28694, 2.28577, 2.2846, 2.28341, 2.28221, 2.28101, 2.27979, 2.27857, 2.27734, 2.2761, 2.27485, 2.27359, 2.27233, 2.27105, 2.26977, 2.26848, 2.26718, 2.26588, 2.26457, 2.26325, 2.26192, 2.26058, 2.25924, 2.25789, 2.25653, 2.25517, 2.2538, 2.25242, 2.25103, 2.24964, 2.24824, 2.24683, 2.24542, 2.244, 2.24257, 2.24114, 2.2397, 2.23825, 2.2368, 2.23535, 2.23388, 2.23241, 2.23093, 2.22945, 2.22796, 2.22647, 2.22497, 2.22346, 2.22195, 2.22044, 2.21891, 2.21739, 2.21585, 2.21431, 2.21277, 2.21122, 2.20967, 2.20811, 2.20654, 2.20497, 2.2034, 2.20182, 2.20023, 2.19864, 2.19705, 2.19545, 2.19385, 2.19224, 2.19062, 2.18901, 2.18738, 2.18576, 2.18413, 2.18249, 2.18085, 2.17921, 2.17756, 2.17591, 2.17425, 2.17259, 2.17093, 2.16926, 2.16759, 2.16591, 2.16423, 2.16255, 2.16086, 2.15917, 2.15747, 2.15578, 2.15407, 2.15237, 2.15066, 2.14895, 2.14723, 2.14551, 2.14379, 2.14206, 2.14033, 2.1386, 2.13686, 2.13512, 2.13338, 2.13164, 2.12989, 2.12814, 2.12638, 2.12462, 2.12286, 2.1211, 2.11933, 2.11757, 2.11579, 2.11402, 2.11224, 2.11046, 2.10868, 2.10689, 2.10511, 2.10332, 2.10152, 2.09973, 2.09793, 2.09613, 2.09433, 2.09252, 2.09072, 2.08891, 2.08709, 2.08528, 2.08346, 2.08164, 2.07982, 2.078, 2.07618, 2.07435, 2.07252, 2.07069, 2.06886, 2.06702, 2.06518, 2.06334, 2.0615, 2.05966, 2.05782, 2.05597, 2.05412, 2.05227, 2.05042, 2.04857, 2.04671, 2.04485, 2.043, 2.04114, 2.03927, 2.03741, 2.03555, 2.03368, 2.03181, 2.02994, 2.02807, 2.0262, 2.02433, 2.02245, 2.02058, 2.0187, 2.01682, 2.01494, 2.01306, 2.01118, 2.00929, 2.00741, 2.00552, 2.00363, 2.00175, 1.99986, 1.99796, 1.99607, 1.99418, 1.99229, 1.99039, 1.9885, 1.9866, 1.9847, 1.9828, 1.9809, 1.979, 1.9771, 1.9752, 1.97329, 1.97139, 1.96949, 1.96758, 1.96567, 1.96377, 1.96186, 1.95995, 1.95804, 1.95613, 1.95422, 1.95231, 1.9504, 1.94848, 1.94657, 1.94466, 1.94274, 1.94083, 1.93891, 1.937, 1.93508, 1.93316, 1.93124, 1.92933, 1.92741, 1.92549, 1.92357, 1.92165, 1.91973, 1.91781, 1.91589, 1.91397, 1.91205, 1.91013, 1.9082, 1.90628, 1.90436, 1.90244, 1.90051, 1.89859, 1.89667, 1.89474, 1.89282, 1.8909, 1.88897, 1.88705, 1.88512, 1.8832, 1.88127, 1.87935, 1.87742, 1.8755, 1.87358, 1.87165, 1.86973, 1.8678, 1.86588, 1.86395, 1.86203, 1.8601, 1.85818, 1.85625, 1.85433, 1.8524, 1.85048, 1.84855, 1.84663, 1.84471, 1.84278, 1.84086, 1.83893, 1.83701, 1.83509, 1.83316, 1.83124]]),
            # fmt: on
            id="Compare EEmiLib with manual SPARK3D export on Silver (ECSS-2020)",
        ),
        pytest.param(
            {
                "E_max": 150,
                "teey_max": 2.1,
                "E_0": 0.0,
                "k_s": 1.0,
                "k_se": 1.0,
            },
            "CST",
            np.linspace(0, 1000, 1001),
            np.zeros(1),
            # fmt: off
            np.array([[0.0000000000000, 0.22140718996525, 0.32519748806953, 0.40657147765160, 0.47586223483086, 0.53719192743301, 0.59272003173828, 0.64375180006027, 0.69115042686462, 0.73552358150482, 0.77731925249100, 0.81687945127487, 0.85447269678116, 0.89031487703323, 0.92458254098892, 0.95742267370224, 0.98895931243896, 1.0192981958389, 1.0485305786133, 1.0767358541489, 1.1039835214615, 1.1303350925446, 1.1558454036713, 1.1805633306503, 1.2045327425003, 1.2277935743332, 1.2503818273544, 1.2723304033279, 1.2936695814133, 1.3144266605377, 1.3346273899078, 1.3542951345444, 1.3734515905380, 1.3921172618866, 1.4103108644485, 1.4280499219894, 1.4453510046005, 1.4622293710709, 1.4786998033524, 1.4947756528854, 1.5104697942734, 1.5257945060730, 1.5407612323761, 1.5553807020187, 1.5696632862091, 1.5836187601089, 1.5972564220428, 1.6105852127075, 1.6236133575439, 1.6363490819931, 1.6488001346588, 1.6609735488892, 1.6728767156601, 1.6845161914825, 1.6958984136581, 1.7070297002792, 1.7179158926010, 1.7285627126694, 1.7389758825302, 1.7491604089737, 1.7591215372086, 1.7688641548157, 1.7783930301666, 1.7877128124237, 1.7968277931213, 1.8057423830032, 1.8144606351852, 1.8229864835739, 1.8313241004944, 1.8394768238068, 1.8474487066269, 1.8552429676056, 1.8628630638123, 1.8703124523163, 1.8775943517685, 1.8847118616104, 1.8916678428650, 1.8984655141830, 1.9051076173782, 1.9115970134735, 1.9179364442825, 1.9241284132004, 1.9301756620407, 1.9360806941986, 1.9418458938599, 1.9474736452103, 1.9529663324356, 1.9583262205124, 1.9635554552078, 1.9686564207077, 1.9736310243607, 1.9784814119339, 1.9832094907761, 1.9878175258636, 1.9923070669174, 1.9966803789139, 2.0009388923645, 2.0050849914551, 2.0091197490692, 2.0130453109741, 2.0168633460999, 2.0205755233765, 2.0241832733154, 2.0276885032654, 2.0310924053192, 2.0343968868256, 2.0376031398773, 2.0407125949860, 2.0437269210815, 2.0466475486755, 2.0494754314423, 2.0522124767303, 2.0548598766327, 2.0574185848236, 2.0598902702332, 2.0622761249542, 2.0645771026611, 2.0667948722839, 2.0689301490784, 2.0709843635559, 2.0729587078094, 2.0748543739319, 2.0766720771790, 2.0784134864807, 2.0800790786743, 2.0816702842712, 2.0831880569458, 2.0846333503723, 2.0860073566437, 2.0873107910156, 2.0885448455811, 2.0897102355957, 2.0908081531525, 2.0918393135071, 2.0928049087524, 2.0937054157257, 2.0945420265198, 2.0953156948090, 2.0960268974304, 2.0966768264771, 2.0972661972046, 2.0977957248688, 2.0982661247253, 2.0986785888672, 2.0990335941315, 2.0993318557739, 2.0995743274689, 2.0997617244720, 2.0998945236206, 2.0999736785889, 2.0999999046326, 2.0999884605408, 2.0999536514282, 2.0998964309692, 2.0998165607452, 2.0997147560120, 2.0995910167694, 2.0994455814362, 2.0992789268494, 2.0990912914276, 2.0988829135895, 2.0986542701721, 2.0984051227570, 2.0981361865997, 2.0978474617004, 2.0975391864777, 2.0972118377686, 2.0968656539917, 2.0965003967285, 2.0961167812347, 2.0957150459290, 2.0952951908112, 2.0948574542999, 2.0944020748138, 2.0939292907715, 2.0934393405914, 2.0929324626923, 2.0924088954926, 2.0918686389923, 2.0913119316101, 2.0907392501831, 2.0901505947113, 2.0895462036133, 2.0889260768890, 2.0882904529572, 2.0876398086548, 2.0869741439819, 2.0862934589386, 2.0855982303619, 2.0848882198334, 2.0841641426086, 2.0834257602692, 2.0826733112335, 2.0819072723389, 2.0811274051666, 2.0803339481354, 2.0795271396637, 2.0787072181702, 2.0778739452362, 2.0770280361176, 2.0761692523956, 2.0752980709076, 2.0744142532349, 2.0735180377960, 2.0726096630096, 2.0716893672943, 2.0707569122314, 2.0698130130768, 2.0688571929932, 2.0678899288177, 2.0669114589691, 2.0659215450287, 2.0649206638336, 2.0639085769653, 2.0628857612610, 2.0618522167206, 2.0608079433441, 2.0597531795502, 2.0586881637573, 2.0576126575470, 2.0565271377563, 2.0554316043854, 2.0543260574341, 2.0532107353210, 2.0520856380463, 2.0509510040283, 2.0498068332672, 2.0486533641815, 2.0474905967712, 2.0463185310364, 2.0451374053955, 2.0439474582672, 2.0427484512329, 2.0415408611298, 2.0403244495392, 2.0390994548798, 2.0378658771515, 2.0366239547729, 2.0353739261627, 2.0341155529022, 2.0328490734100, 2.0315744876862, 2.0302920341492, 2.0290017127991, 2.0277035236359, 2.0263977050781, 2.0250844955444, 2.0237636566162, 2.0224351882935, 2.0210995674133, 2.0197567939758, 2.0184066295624, 2.0170495510101, 2.0156853199005, 2.0143141746521, 2.0129361152649, 2.0115513801575, 2.0101597309113, 2.0087616443634, 2.0073568820953, 2.0059456825256, 2.0045280456543, 2.0031039714813, 2.0016736984253, 2.0002372264862, 1.9987946748734, 1.9973459243774, 1.9958912134171, 1.9944306612015, 1.9929641485214, 1.9914917945862, 1.9900137186050, 1.9885300397873, 1.9870407581329, 1.9855458736420, 1.9840455055237, 1.9825397729874, 1.9810286760330, 1.9795122146606, 1.9779906272888, 1.9764636754990, 1.9749318361282, 1.9733947515488, 1.9718527793884, 1.9703058004379, 1.9687539339066, 1.9671971797943, 1.9656357765198, 1.9640696048737, 1.9624987840652, 1.9609233140945, 1.9593431949615, 1.9577586650848, 1.9561697244644, 1.9545763731003, 1.9529786109924, 1.9513765573502, 1.9497702121735, 1.9481598138809, 1.9465451240540, 1.9449263811111, 1.9433035850525, 1.9416768550873, 1.9400460720062, 1.9384114742279, 1.9367729425430, 1.9351305961609, 1.9334844350815, 1.9318345785141, 1.9301811456680, 1.9285240173340, 1.9268631935120, 1.9251989126205, 1.9235311746597, 1.9218599796295, 1.9201853275299, 1.9185072183609, 1.9168258905411, 1.9151412248611, 1.9134533405304, 1.9117622375488, 1.9100679159164, 1.9083704948425, 1.9066699743271, 1.9049664735794, 1.9032598733902, 1.9015504121780, 1.8998378515244, 1.8981225490570, 1.8964042663574, 1.8946832418442, 1.8929594755173, 1.8912328481674, 1.8895035982132, 1.8877716064453, 1.8860369920731, 1.8842998743057, 1.8825600147247, 1.8808177709579, 1.8790729045868, 1.8773256540298, 1.8755760192871, 1.8738238811493, 1.8720694780350, 1.8703126907349, 1.8685535192490, 1.8667922019958, 1.8650286197662, 1.8632627725601, 1.8614947795868, 1.8597247600555, 1.8579524755478, 1.8561781644821, 1.8544018268585, 1.8526234626770, 1.8508431911469, 1.8490608930588, 1.8472766876221, 1.8454904556274, 1.8437025547028, 1.8419126272202, 1.8401210308075, 1.8383276462555, 1.8365323543549, 1.8347355127335, 1.8329368829727, 1.8311365842819, 1.8293346166611, 1.8275310993195, 1.8257259130478, 1.8239191770554, 1.8221110105515, 1.8203011751175, 1.8184899091721, 1.8166772127151, 1.8148630857468, 1.8130475282669, 1.8112305402756, 1.8094122409821, 1.8075926303864, 1.8057715892792, 1.8039493560791, 1.8021258115768, 1.8003010749817, 1.7984751462936, 1.7966480255127, 1.7948195934296, 1.7929900884628, 1.7911595106125, 1.7893278598785, 1.7874950170517, 1.7856611013412, 1.7838262319565, 1.7819904088974, 1.7801535129547, 1.7783156633377, 1.7764767408371, 1.7746371030807, 1.7727963924408, 1.7709548473358, 1.7691124677658, 1.7672692537308, 1.7654252052307, 1.7635803222656, 1.7617346048355, 1.7598881721497, 1.7580410242081, 1.7561931610107, 1.7543445825577, 1.7524952888489, 1.7506452798843, 1.7487946748734, 1.7469434738159, 1.7450916767120, 1.7432392835617, 1.7413862943649, 1.7395327091217, 1.7376785278320, 1.7358239889145, 1.7339688539505, 1.7321132421494, 1.7302571535110, 1.7284007072449, 1.7265437841415, 1.7246863842010, 1.7228286266327, 1.7209705114365, 1.7191119194031, 1.7172530889511, 1.7153939008713, 1.7135344743729, 1.7116746902466, 1.7098145484924, 1.7079541683197, 1.7060936689377, 1.7042328119278, 1.7023717164993, 1.7005105018616, 1.6986490488052, 1.6967873573303, 1.6949256658554, 1.6930637359619, 1.6912016868591, 1.6893395185471, 1.6874772310257, 1.6856149435043, 1.6837525367737, 1.6818900108337, 1.6800274848938, 1.6781649589539, 1.6763024330139, 1.6744397878647, 1.6725772619247, 1.6707147359848, 1.6688523292542, 1.6669899225235, 1.6651275157928, 1.6632652282715, 1.6614030599594, 1.6595410108566, 1.6576790809631, 1.6558172702789, 1.6539555788040, 1.6520941257477, 1.6502326726913, 1.6483715772629, 1.6465106010437, 1.6446498632431, 1.6427893638611, 1.6409289836884, 1.6390689611435, 1.6372091770172, 1.6353496313095, 1.6334903240204, 1.6316313743591, 1.6297726631165, 1.6279143095016, 1.6260563135147, 1.6241986751556, 1.6223412752151, 1.6204842329025, 1.6186276674271, 1.6167714595795, 1.6149156093597, 1.6130601167679, 1.6112051010132, 1.6093504428864, 1.6074962615967, 1.6056425571442, 1.6037893295288, 1.6019364595413, 1.6000841856003, 1.5982322692871, 1.5963809490204, 1.5945301055908, 1.5926797389984, 1.5908299684525, 1.5889806747437, 1.5871318578720, 1.5852836370468, 1.5834360122681, 1.5815889835358, 1.5797425508499, 1.5778967142105, 1.5760513544083, 1.5742067098618, 1.5723626613617, 1.5705192089081, 1.5686764717102, 1.5668342113495, 1.5649927854538, 1.5631519556046, 1.5613117218018, 1.5594723224640, 1.5576335191727, 1.5557954311371, 1.5539579391479, 1.5521212816238, 1.5502853393555, 1.5484501123428, 1.5466156005859, 1.5447818040848, 1.5429488420486, 1.5411165952682, 1.5392851829529, 1.5374544858932, 1.5356245040894, 1.5337953567505, 1.5319670438766, 1.5301395654678, 1.5283129215240, 1.5264869928360, 1.5246620178223, 1.5228377580643, 1.5210144519806, 1.5191918611526, 1.5173702239990, 1.5155494213104, 1.5137295722961, 1.5119104385376, 1.5100923776627, 1.5079423189163, 1.5069679021835, 1.5059959888458, 1.5050264596939, 1.5040594339371, 1.5030946731567, 1.5021322965622, 1.5011724233627, 1.5002148151398, 1.4992594718933, 1.4983066320419, 1.4973560571671, 1.4964077472687, 1.4954618215561, 1.4945181608200, 1.4935768842697, 1.4926378726959, 1.4917010068893, 1.4907665252686, 1.4898341894150, 1.4889042377472, 1.4879764318466, 1.4870508909225, 1.4861274957657, 1.4852063655853, 1.4842873811722, 1.4833706617355, 1.4824560880661, 1.4815436601639, 1.4806334972382, 1.4797253608704, 1.4788193702698, 1.4779156446457, 1.4770139455795, 1.4761143922806, 1.4752169847488, 1.4743216037750, 1.4734283685684, 1.4725371599197, 1.4716480970383, 1.4707610607147, 1.4698760509491, 1.4689930677414, 1.4681122303009, 1.4672334194183, 1.4663566350937, 1.4654817581177, 1.4646090269089, 1.4637382030487, 1.4628694057465, 1.4620026350021, 1.4611377716064, 1.4602749347687, 1.4594140052795, 1.4585549831390, 1.4576979875565, 1.4568430185318, 1.4559898376465, 1.4551386833191, 1.4542893171310, 1.4534419775009, 1.4525964260101, 1.4517529010773, 1.4509111642838, 1.4500713348389, 1.4492334127426, 1.4483972787857, 1.4475630521774, 1.4467307329178, 1.4459002017975, 1.4450714588165, 1.4442446231842, 1.4434195756912, 1.4425963163376, 1.4417749643326, 1.4409552812576, 1.4401375055313, 1.4393213987350, 1.4385071992874, 1.4376946687698, 1.4368839263916, 1.4360749721527, 1.4352678060532, 1.4344623088837, 1.4336585998535, 1.4328566789627, 1.4320564270020, 1.4312578439713, 1.4304610490799, 1.4296659231186, 1.4288724660873, 1.4280807971954, 1.4272907972336, 1.4265024662018, 1.4257158041000, 1.4249308109283, 1.4241474866867, 1.4233658313751, 1.4225857257843, 1.4218074083328, 1.4210306406021, 1.4202555418015, 1.4194821119308, 1.4187102317810, 1.4179400205612, 1.4171713590622, 1.4164043664932, 1.4156389236450, 1.4148751497269, 1.4141129255295, 1.4133522510529, 1.4125931262970, 1.4118356704712, 1.4110797643661, 1.4103252887726, 1.4095724821091, 1.4088212251663, 1.4080713987350, 1.4073232412338, 1.4065766334534, 1.4058314561844, 1.4050878286362, 1.4043456315994, 1.4036051034927, 1.4028660058975, 1.4021283388138, 1.4013922214508, 1.4006576538086, 1.3999245166779, 1.3991928100586, 1.3984626531601, 1.3977339267731, 1.3970066308975, 1.3962808847427, 1.3955565690994, 1.3948336839676, 1.3941122293472, 1.3933922052383, 1.3926736116409, 1.3919564485550, 1.3912407159805, 1.3905264139175, 1.3898134231567, 1.3891019821167, 1.3883918523788, 1.3876831531525, 1.3869758844376, 1.3862699270248, 1.3855654001236, 1.3848623037338, 1.3841605186462, 1.3834600448608, 1.3827610015869, 1.3820632696152, 1.3813669681549, 1.3806719779968, 1.3799784183502, 1.3792860507965, 1.3785951137543, 1.3779054880142, 1.3772172927856, 1.3765302896500, 1.3758445978165, 1.3751603364944, 1.3744772672653, 1.3737956285477, 1.3731151819229, 1.3724360466003, 1.3717582225800, 1.3710817098618, 1.3704065084457, 1.3697324991226, 1.3690598011017, 1.3683884143829, 1.3677182197571, 1.3670493364334, 1.3663817644119, 1.3657153844833, 1.3650503158569, 1.3643864393234, 1.3637237548828, 1.3630623817444, 1.3624022006989, 1.3617433309555, 1.3610856533051, 1.3604291677475, 1.3597739934921, 1.3591198921204, 1.3584671020508, 1.3578155040741, 1.3571650981903, 1.3565158843994, 1.3558678627014, 1.3552210330963, 1.3545753955841, 1.3539309501648, 1.3532876968384, 1.3526456356049, 1.3520047664642, 1.3513649702072, 1.3507263660431, 1.3500889539719, 1.3494527339935, 1.3488175868988, 1.3481836318970, 1.3475508689880, 1.3469191789627, 1.3462886810303, 1.3456592559814, 1.3450310230255, 1.3444039821625, 1.3437780141830, 1.3431531190872, 1.3425292968750, 1.3419066667557, 1.3412852287292, 1.3406647443771, 1.3400454521179, 1.3394272327423, 1.3388102054596, 1.3381941318512, 1.3375792503357, 1.3369654417038, 1.3363527059555, 1.3357410430908, 1.3351304531097, 1.3345209360123, 1.3339124917984, 1.3333051204681, 1.3326988220215, 1.3320935964584, 1.3314893245697, 1.3308862447739, 1.3302841186523, 1.3296831846237, 1.3290832042694, 1.3284841775894, 1.3278863430023, 1.3272894620895, 1.3266936540604, 1.3260987997055, 1.3255050182343, 1.3249123096466, 1.3243205547333, 1.3237298727036, 1.3231402635574, 1.3225514888763, 1.3219639062881, 1.3213771581650, 1.3207914829254, 1.3202068805695, 1.3196232318878, 1.3190405368805, 1.3184589147568, 1.3178781270981, 1.3172984123230, 1.3167197704315, 1.3161419630051, 1.3155652284622, 1.3149894475937, 1.3144146203995, 1.3138407468796, 1.3132678270340, 1.3126959800720, 1.3121249675751, 1.3115549087524, 1.3109859228134, 1.3104177713394, 1.3098506927490, 1.3092844486237, 1.3087191581726, 1.3081548213959, 1.3075914382935, 1.3070290088654, 1.3064674139023, 1.3059068918228, 1.3053472042084, 1.3047884702682, 1.3042305707932, 1.3036737442017, 1.3031177520752, 1.3025625944138, 1.3020085096359, 1.3014552593231, 1.3009028434753, 1.3003513813019, 1.2998008728027, 1.2992511987686, 1.2987024784088, 1.2981545925140, 1.2976076602936, 1.2970615625381, 1.2965164184570, 1.2959721088409, 1.2954286336899, 1.2948861122131, 1.2943444252014, 1.2938035726547, 1.2932636737823, 1.2927246093750, 1.2921863794327, 1.2916489839554, 1.2911125421524, 1.2905769348145, 1.2900421619415, 1.2895082235336, 1.2889752388000, 1.2884429693222, 1.2879116535187, 1.2873811721802, 1.2868514060974, 1.2863225936890, 1.2857946157455, 1.2852674722672, 1.2847410440445, 1.2842155694962, 1.2836909294128, 1.2831671237946, 1.2826440334320, 1.2821218967438, 1.2816004753113, 1.2810798883438, 1.2805601358414, 1.2800412178040, 1.2795230150223, 1.2790057659149, 1.2784892320633, 1.2779735326767, 1.2774585485458, 1.2769445180893, 1.2764312028885, 1.2759186029434, 1.2754069566727, 1.2748960256577, 1.2743858098984, 1.2738764286041, 1.2733678817749, 1.2728601694107, 1.2723530530930, 1.2718468904495, 1.2713414430618, 1.2708367109299, 1.2703328132629, 1.2698296308517, 1.2693272829056, 1.2688256502151, 1.2683248519897, 1.2678247690201, 1.2673254013062, 1.2668268680573, 1.2663290500641, 1.2658319473267, 1.2653356790543, 1.2648401260376, 1.2643452882767, 1.2638512849808, 1.2633578777313, 1.2628653049469, 1.2623734474182, 1.2618824243546, 1.2613919973373, 1.2609024047852, 1.2604135274887, 1.2599253654480, 1.2594379186630, 1.2589511871338, 1.2584651708603, 1.2579798698425, 1.2574954032898, 1.2570115327835, 1.2565284967422, 1.2560460567474, 1.2555643320084, 1.2550834417343, 1.2546031475067, 1.2541235685349, 1.2536447048187, 1.2531666755676, 1.2526892423630, 1.2522124052048, 1.2517364025116, 1.2512611150742, 1.2507864236832, 1.2503124475479, 1.2498391866684, 1.2493666410446, 1.2488948106766, 1.2484235763550, 1.2479530572891, 1.2474832534790, 1.2470141649246, 1.2465456724167, 1.2460778951645, 1.2456107139587, 1.2451443672180, 1.2446786165237, 1.2442134618759, 1.2437490224838, 1.2432852983475, 1.2428221702576, 1.2423597574234, 1.2418980598450, 1.2414369583130, 1.2409764528275, 1.2405167818069, 1.2400575876236, 1.2395991086960, 1.2391413450241, 1.2386841773987, 1.2382276058197, 1.2377717494965, 1.2373166084290, 1.2368619441986, 1.2364081144333, 1.2359547615051, 1.2355021238327, 1.2350500822067, 1.2345987558365, 1.2341480255127, 1.2336978912354, 1.2332484722137, 1.2327996492386, 1.2323514223099, 1.2319037914276, 1.2314568758011, 1.2310105562210, 1.2305648326874, 1.2301197052002, 1.2296752929688, 1.2292313575745, 1.2287881374359, 1.2283456325531, 1.2279036045074, 1.2274621725082, 1.2270214557648, 1.2265812158585, 1.2261416912079, 1.2257027626038, 1.2252644300461, 1.2248266935349, 1.2243895530701, 1.2239530086517, 1.2235170602798, 1.2230817079544, 1.2226469516754, 1.2222127914429, 1.2217792272568, 1.2213462591171, 1.2209140062332, 1.2204822301865, 1.2200509309769, 1.2196203470230, 1.2191903591156, 1.2187609672546, 1.2183320522308, 1.2179038524628, 1.2174761295319, 1.2170490026474, 1.2166224718094, 1.2161965370178]]),
            # fmt: on
            id="Compare EEmiLib with manual CST export with dummy data #1",
        ),
        pytest.param(
            {
                "E_max": 300,
                "teey_max": 2.5,
                "E_0": 10.0,
                "k_s": 1.5,
                "k_se": 1.5,
            },
            "CST",
            np.linspace(0, 1000, 1001),
            np.zeros(1),
            # fmt: off
            np.array([[0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.0000000000000, 0.18254224956036, 0.26859724521637, 0.33641397953033, 0.39445829391479, 0.44609981775284, 0.49309989809990, 0.53652071952820, 0.57706314325333, 0.61521953344345, 0.65135186910629, 0.68573594093323, 0.71858787536621, 0.75008076429367, 0.78035604953766, 0.80953115224838, 0.83770483732224, 0.86496114730835, 0.89137238264084, 0.91700130701065, 0.94190281629562, 0.96612530946732, 0.98971170186996, 1.0127003192902, 1.0351256132126, 1.0570182800293, 1.0784065723419, 1.0993160009384, 1.1197695732117, 1.1397888660431, 1.1593934297562, 1.1786010265350, 1.1974285840988, 1.2158914804459, 1.2340040206909, 1.2517794370651, 1.2692304849625, 1.2863686084747, 1.3032046556473, 1.3197489976883, 1.3360112905502, 1.3520004749298, 1.3677252531052, 1.3831936120987, 1.3984130620956, 1.4133911132812, 1.4281344413757, 1.4426496028900, 1.4569429159164, 1.4710201025009, 1.4848868846893, 1.4985485076904, 1.5120103359222, 1.5252770185471, 1.5383534431458, 1.5512439012527, 1.5639528036118, 1.5764842033386, 1.5888420343399, 1.6010302305222, 1.6130523681641, 1.6249120235443, 1.6366124153137, 1.6481570005417, 1.6595487594604, 1.6707907915115, 1.6818860769272, 1.6928372383118, 1.7036472558975, 1.7143186330795, 1.7248538732529, 1.7352555990219, 1.7455260753632, 1.7556675672531, 1.7656825780869, 1.7755730152130, 1.7853410243988, 1.7949888706207, 1.8045182228088, 1.8139313459396, 1.8232299089432, 1.8324156999588, 1.8414906263351, 1.8504563570023, 1.8593145608902, 1.8680669069290, 1.8767150640488, 1.8852604627609, 1.8937045335770, 1.9020489454269, 1.9102951288223, 1.9184442758560, 1.9264980554581, 1.9344575405121, 1.9423241615295, 1.9500991106033, 1.9577836990356, 1.9653792381287, 1.9728868007660, 1.9803074598312, 1.9876425266266, 1.9948929548264, 2.0020599365234, 2.0091447830200, 2.0161478519440, 2.0230708122253, 2.0299143791199, 2.0366797447205, 2.0433673858643, 2.0499787330627, 2.0565147399902, 2.0629758834839, 2.0693631172180, 2.0756776332855, 2.0819201469421, 2.0880913734436, 2.0941922664642, 2.1002235412598, 2.1061859130859, 2.1120805740356, 2.1179077625275, 2.1236684322357, 2.1293632984161, 2.1349930763245, 2.1405584812164, 2.1460604667664, 2.1514992713928, 2.1568758487701, 2.1621906757355, 2.1674447059631, 2.1726381778717, 2.1777720451355, 2.1828467845917, 2.1878631114960, 2.1928215026855, 2.1977226734161, 2.2025668621063, 2.2073550224304, 2.2120876312256, 2.2167651653290, 2.2213883399963, 2.2259573936462, 2.2304730415344, 2.2349357604980, 2.2393460273743, 2.2437045574188, 2.2480115890503, 2.2522678375244, 2.2564735412598, 2.2606291770935, 2.2647354602814, 2.2687928676605, 2.2728016376495, 2.2767622470856, 2.2806751728058, 2.2845411300659, 2.2883598804474, 2.2921326160431, 2.2958593368530, 2.2995405197144, 2.3031764030457, 2.3067677021027, 2.3103146553040, 2.3138177394867, 2.3172774314880, 2.3206937313080, 2.3240673542023, 2.3273987770081, 2.3306877613068, 2.3339354991913, 2.3371417522430, 2.3403069972992, 2.3434317111969, 2.3465161323547, 2.3495607376099, 2.3525657653809, 2.3555314540863, 2.3584582805634, 2.3613467216492, 2.3641967773438, 2.3670086860657, 2.3697834014893, 2.3725204467773, 2.3752207756042, 2.3778841495514, 2.3805112838745, 2.3831024169922, 2.3856575489044, 2.3881773948669, 2.3906617164612, 2.3931114673615, 2.3955261707306, 2.3979067802429, 2.4002532958984, 2.4025659561157, 2.4048449993134, 2.4070906639099, 2.4093034267426, 2.4114835262299, 2.4136309623718, 2.4157462120056, 2.4178295135498, 2.4198811054230, 2.4219009876251, 2.4238896369934, 2.4258475303650, 2.4277744293213, 2.4296708106995, 2.4315369129181, 2.4333729743958, 2.4351792335510, 2.4369559288025, 2.4387032985687, 2.4404213428497, 2.4421105384827, 2.4437708854675, 2.4454028606415, 2.4470064640045, 2.4485821723938, 2.4501299858093, 2.4516499042511, 2.4531426429749, 2.4546079635620, 2.4560463428497, 2.4574580192566, 2.4588429927826, 2.4602015018463, 2.4615337848663, 2.4628398418427, 2.4641201496124, 2.4653749465942, 2.4666042327881, 2.4678080081940, 2.4689869880676, 2.4701409339905, 2.4712700843811, 2.4723746776581, 2.4734549522400, 2.4745109081268, 2.4755430221558, 2.4765510559082, 2.4775357246399, 2.4784967899323, 2.4794342517853, 2.4803488254547, 2.4812402725220, 2.4821090698242, 2.4829549789429, 2.4837784767151, 2.4845795631409, 2.4853584766388, 2.4861154556274, 2.4868505001068, 2.4875636100769, 2.4882555007935, 2.4889256954193, 2.4895749092102, 2.4902029037476, 2.4908099174500, 2.4913959503174, 2.4919614791870, 2.4925065040588, 2.4930312633514, 2.4935355186462, 2.4940197467804, 2.4944841861725, 2.4949288368225, 2.4953536987305, 2.4957590103149, 2.4961450099945, 2.4965116977692, 2.4968590736389, 2.4971878528595, 2.4974975585938, 2.4977884292603, 2.4980607032776, 2.4983146190643, 2.4985501766205, 2.4987676143646, 2.4989669322968, 2.4991481304169, 2.4993116855621, 2.4994573593140, 2.4995853900909, 2.4996962547302, 2.4997894763947, 2.4998655319214, 2.4999246597290, 2.4999666213989, 2.4999916553497, 2.5000000000000, 2.4999961853027, 2.4999852180481, 2.4999668598175, 2.4999411106110, 2.4999082088470, 2.4998681545258, 2.4998207092285, 2.4997665882111, 2.4997050762177, 2.4996368885040, 2.4995615482330, 2.4994792938232, 2.4993903636932, 2.4992945194244, 2.4991917610168, 2.4990825653076, 2.4989664554596, 2.4988439083099, 2.4987146854401, 2.4985790252686, 2.4984369277954, 2.4982881546021, 2.4981331825256, 2.4979717731476, 2.4978039264679, 2.4976298809052, 2.4974496364594, 2.4972631931305, 2.4970705509186, 2.4968719482422, 2.4966669082642, 2.4964561462402, 2.4962391853333, 2.4960165023804, 2.4957876205444, 2.4955530166626, 2.4953124523163, 2.4950661659241, 2.4948141574860, 2.4945564270020, 2.4942929744720, 2.4940237998962, 2.4937489032745, 2.4934685230255, 2.4931826591492, 2.4928910732269, 2.4925942420959, 2.4922916889191, 2.4919838905334, 2.4916706085205, 2.4913520812988, 2.4910283088684, 2.4906990528107, 2.4903647899628, 2.4900250434875, 2.4896802902222, 2.4893305301666, 2.4889752864838, 2.4886152744293, 2.4882500171661, 2.4878797531128, 2.4875044822693, 2.4871244430542, 2.4867391586304, 2.4863493442535, 2.4859542846680, 2.4855546951294, 2.4851500988007, 2.4847407341003, 2.4843266010284, 2.4839079380035, 2.4834845066071, 2.4830563068390, 2.4826235771179, 2.4821860790253, 2.4817440509796, 2.4812974929810, 2.4808466434479, 2.4803910255432, 2.4799308776855, 2.4794664382935, 2.4789977073669, 2.4785244464874, 2.4780466556549, 2.4775648117065, 2.4770784378052, 2.4765880107880, 2.4760930538177, 2.4755940437317, 2.4750909805298, 2.4745833873749, 2.4740717411041, 2.4735560417175, 2.4730362892151, 2.4725122451782, 2.4719843864441, 2.4714524745941, 2.4709162712097, 2.4703762531281, 2.4698324203491, 2.4692845344543, 2.4687325954437, 2.4681768417358, 2.4676172733307, 2.4670538902283, 2.4664866924286, 2.4659156799316, 2.4653408527374, 2.4647622108459, 2.4641799926758, 2.4635939598083, 2.4630041122437, 2.4624106884003, 2.4618136882782, 2.4612131118774, 2.4606087207794, 2.4600009918213, 2.4593894481659, 2.4587745666504, 2.4581561088562, 2.4575340747833, 2.4569087028503, 2.4562797546387, 2.4556474685669, 2.4550116062164, 2.4543724060059, 2.4537298679352, 2.4530839920044, 2.4524347782135, 2.4517822265625, 2.4511263370514, 2.4504673480988, 2.4498047828674, 2.4491391181946, 2.4484703540802, 2.4477982521057, 2.4471230506897, 2.4464445114136, 2.4457631111145, 2.4450783729553, 2.4443905353546, 2.4436995983124, 2.4430055618286, 2.4423084259033, 2.4416084289551, 2.4409053325653, 2.4401991367340, 2.4394900798798, 2.4387779235840, 2.4380629062653, 2.4373450279236, 2.4366240501404, 2.4359002113342, 2.4351735115051, 2.4344439506531, 2.4337115287781, 2.4329762458801, 2.4322383403778, 2.4314973354340, 2.4307537078857, 2.4300072193146, 2.4292581081390, 2.4285061359406, 2.4277515411377, 2.4269940853119, 2.4262340068817, 2.4254713058472, 2.4247057437897, 2.4239377975464, 2.4231669902802, 2.4223937988281, 2.4216179847717, 2.4208393096924, 2.4200582504272, 2.4192748069763, 2.4184885025024, 2.4176998138428, 2.4169087409973, 2.4161150455475, 2.4153187274933, 2.4145200252533, 2.4137189388275, 2.4129154682159, 2.4121093750000, 2.4113011360168, 2.4104902744293, 2.4096770286560, 2.4088613986969, 2.4080436229706, 2.4072232246399, 2.4064006805420, 2.4055757522583, 2.4047486782074, 2.4039189815521, 2.4030873775482, 2.4022531509399, 2.4014170169830, 2.4005782604218, 2.3997375965118, 2.3988945484161, 2.3980493545532, 2.3972020149231, 2.3963525295258, 2.3955008983612, 2.3946468830109, 2.3937909603119, 2.3929328918457, 2.3920726776123, 2.3912103176117, 2.3903458118439, 2.3894793987274, 2.3886108398438, 2.3877401351929, 2.3868675231934, 2.3859927654266, 2.3851161003113, 2.3842372894287, 2.3833565711975, 2.3824739456177, 2.3815891742706, 2.3807024955750, 2.3798141479492, 2.3789234161377, 2.3780310153961, 2.3771367073059, 2.3762404918671, 2.3753423690796, 2.3744423389435, 2.3735404014587, 2.3726365566254, 2.3717310428619, 2.3708236217499, 2.3699142932892, 2.3690032958984, 2.3680903911591, 2.3671755790710, 2.3662590980530, 2.3653409481049, 2.3644208908081, 2.3634991645813, 2.3625755310059, 2.3616504669189, 2.3607234954834, 2.3597946166992, 2.3588643074036, 2.3579323291779, 2.3569984436035, 2.3560631275177, 2.3551259040833, 2.3541872501373, 2.3532469272614, 2.3523049354553, 2.3513612747192, 2.3504159450531, 2.3494689464569, 2.3485205173492, 2.3475704193115, 2.3466188907623, 2.3456656932831, 2.3447110652924, 2.3437547683716, 2.3427968025208, 2.3418374061584, 2.3408765792847, 2.3399140834808, 2.3389503955841, 2.3379848003387, 2.3370180130005, 2.3360495567322, 2.3350799083710, 2.3341085910797, 2.3331358432770, 2.3321616649628, 2.3311860561371, 2.3302090167999, 2.3292305469513, 2.3282506465912, 2.3272695541382, 2.3262867927551, 2.3253028392792, 2.3243174552917, 2.3233306407928, 2.3223426342010, 2.3213531970978, 2.3203623294830, 2.3193702697754, 2.3183767795563, 2.3173820972443, 2.3163859844208, 2.3153886795044, 2.3143899440765, 2.3133900165558, 2.3123886585236, 2.3113863468170, 2.3103826045990, 2.3093776702881, 2.3083713054657, 2.3073637485504, 2.3063552379608, 2.3053452968597, 2.3043341636658, 2.3033218383789, 2.3023083209991, 2.3012936115265, 2.3002777099609, 2.2992606163025, 2.2982423305511, 2.2972228527069, 2.2962024211884, 2.2951805591583, 2.2941577434540, 2.2931337356567, 2.2921087741852, 2.2910823822021, 2.2900550365448, 2.2890267372131, 2.2879972457886, 2.2869665622711, 2.2859349250793, 2.2849020957947, 2.2838683128357, 2.2828333377838, 2.2817974090576, 2.2807602882385, 2.2797224521637, 2.2786831855774, 2.2776432037354, 2.2766020298004, 2.2755599021912, 2.2745168209076, 2.2734725475311, 2.2724275588989, 2.2713813781738, 2.2703342437744, 2.2692861557007, 2.2682371139526, 2.2671871185303, 2.2661361694336, 2.2650842666626, 2.2640314102173, 2.2629776000977, 2.2619228363037, 2.2608671188354, 2.2598106861115, 2.2587530612946, 2.2576947212219, 2.2566354274750, 2.2555754184723, 2.2545142173767, 2.2534523010254, 2.2523894309998, 2.2513258457184, 2.2502613067627, 2.2491958141327, 2.2481296062469, 2.2470624446869, 2.2459945678711, 2.2449257373810, 2.2438561916351, 2.2427859306335, 2.2417144775391, 2.2406425476074, 2.2395696640015, 2.2384960651398, 2.2374215126038, 2.2363464832306, 2.2352702617645, 2.2341935634613, 2.2331161499023, 2.2320377826691, 2.2309587001801, 2.2298789024353, 2.2287981510162, 2.2277169227600, 2.2266347408295, 2.2255520820618, 2.2244684696198, 2.2233841419220, 2.2222993373871, 2.2212135791779, 2.2201273441315, 2.2190401554108, 2.2179524898529, 2.2168638706207, 2.2157747745514, 2.2146849632263, 2.2135944366455, 2.2125031948090, 2.2114114761353, 2.2103188037872, 2.2092256546021, 2.2081320285797, 2.2070374488831, 2.2059423923492, 2.2048466205597, 2.2037503719330, 2.2026534080505, 2.2015557289124, 2.2004575729370, 2.1993587017059, 2.1982593536377, 2.1971592903137, 2.1960585117340, 2.1949574947357, 2.1938555240631, 2.1927530765533, 2.1916501522064, 2.1905467510223, 2.1894426345825, 2.1883378028870, 2.1872327327728, 2.1861269474030, 2.1850206851959, 2.1839137077332, 2.1828062534332, 2.1816983222961, 2.1805899143219, 2.1794807910919, 2.1783711910248, 2.1772613525391, 2.1761507987976, 2.1750395298004, 2.1739280223846, 2.1728160381317, 2.1717033386230, 2.1705904006958, 2.1694767475128, 2.1683626174927, 2.1672482490540, 2.1661331653595, 2.1650178432465, 2.1639018058777, 2.1627855300903, 2.1616685390472, 2.1605513095856, 2.1594336032867, 2.1583154201508, 2.1571967601776, 2.1560776233673, 2.1549580097198, 2.1538381576538, 2.1527178287506, 2.1515970230103, 2.1504757404327, 2.1493542194366, 2.1482322216034, 2.1471097469330, 2.1459870338440, 2.1448636054993, 2.1437401771545, 2.1426160335541, 2.1414916515350, 2.1403670310974, 2.1392416954041, 2.1381161212921, 2.1369903087616, 2.1358640193939, 2.1347374916077, 2.1336104869843, 2.1324830055237, 2.1313555240631, 2.1302273273468, 2.1290988922119, 2.1279702186584, 2.1268413066864, 2.1257116794586, 2.1245820522308, 2.1234519481659, 2.1223216056824, 2.1211910247803, 2.1200599670410, 2.1189286708832, 2.1177968978882, 2.1166651248932, 2.1155328750610, 2.1144003868103, 2.1132674217224, 2.1121342182159, 2.1110010147095, 2.1098673343658, 2.1087331771851, 2.1075990200043, 2.1064646244049, 2.1053297519684, 2.1041946411133, 2.1030592918396, 2.1019237041473, 2.1007878780365, 2.0996518135071, 2.0985155105591, 2.0973789691925, 2.0962421894073, 2.0951049327850, 2.0939676761627, 2.0928301811218, 2.0916924476624, 2.0905544757843, 2.0894162654877, 2.0882778167725, 2.0871391296387, 2.0860002040863, 2.0848610401154, 2.0837218761444, 2.0825822353363, 2.0814425945282, 2.0803027153015, 2.0791625976562, 2.0780222415924, 2.0768818855286, 2.0757410526276, 2.0746002197266, 2.0734591484070, 2.0723180770874, 2.0711765289307, 2.0700349807739, 2.0688934326172, 2.0677514076233, 2.0666093826294, 2.0654671192169, 2.0643248558044, 2.0631823539734, 2.0620396137238, 2.0608968734741, 2.0597538948059, 2.0586106777191, 2.0574674606323, 2.0563240051270, 2.0551805496216, 2.0540368556976, 2.0528929233551, 2.0517492294312, 2.0506050586700, 2.0494608879089, 2.0483167171478, 2.0471723079681, 2.0460276603699, 2.0448832511902, 2.0437383651733, 2.0425934791565, 2.0414485931396, 2.0403037071228, 2.0391585826874, 2.0380132198334, 2.0368680953979, 2.0357224941254, 2.0345771312714, 2.0334315299988, 2.0322859287262, 2.0311403274536, 2.0299944877625, 2.0288486480713, 2.0277025699615, 2.0265567302704, 2.0254106521606, 2.0242643356323, 2.0231182575226, 2.0219719409943, 2.0208256244659, 2.0196793079376, 2.0185329914093, 2.0173864364624, 2.0162398815155, 2.0150933265686, 2.0139467716217, 2.0128002166748, 2.0116536617279, 2.0105068683624, 2.0093600749969, 2.0082135200500, 2.0070667266846, 2.0059199333191, 2.0047731399536, 2.0036263465881, 2.0024793148041, 2.0013325214386, 2.0001857280731, 1.9990388154984, 1.9978919029236, 1.9967449903488, 1.9955980777740, 1.9944511651993, 1.9933042526245, 1.9921574592590, 1.9910105466843, 1.9898636341095, 1.9887168407440, 1.9875699281693, 1.9864231348038, 1.9852763414383, 1.9841295480728, 1.9829827547073, 1.9818359613419, 1.9806892871857, 1.9795426130295, 1.9783959388733, 1.9772492647171, 1.9761027097702, 1.9749561548233, 1.9738095998764, 1.9726631641388, 1.9715167284012, 1.9703702926636, 1.9692239761353, 1.9680777788162, 1.9669314622879, 1.9657852649689, 1.9646391868591, 1.9634931087494, 1.9623471498489, 1.9612011909485, 1.9600552320480, 1.9589095115662, 1.9577636718750, 1.9566180706024, 1.9554724693298, 1.9543268680573, 1.9531815052032, 1.9520361423492, 1.9508907794952, 1.9497455358505, 1.9486004114151, 1.9474554061890, 1.9463104009628, 1.9451656341553, 1.9440208673477, 1.9428761005402, 1.9417315721512, 1.9405870437622, 1.9394426345825, 1.9382983446121, 1.9371541738510, 1.9360101222992, 1.9348661899567, 1.9337222576141, 1.9325785636902, 1.9314348697662, 1.9302914142609, 1.9291479587555, 1.9280046224594, 1.9268615245819, 1.9257184267044, 1.9245755672455, 1.9234327077866, 1.9222899675369, 1.9211474657059, 1.9200050830841, 1.9188628196716, 1.9177205562592, 1.9165785312653, 1.9154367446899, 1.9142949581146, 1.9131534099579, 1.9120118618011, 1.9108705520630, 1.9097293615341, 1.9085884094238, 1.9074474573135, 1.9063067436218, 1.9051661491394, 1.9040257930756, 1.9028855562210, 1.9017454385757, 1.9006054401398, 1.8994656801224, 1.8983260393143, 1.8971866369247, 1.8960473537445, 1.8949081897736, 1.8937692642212, 1.8926304578781, 1.8914917707443, 1.8903533220291, 1.8892151117325, 1.8880770206451, 1.8869390487671, 1.8858013153076, 1.8846638202667, 1.8835264444351, 1.8823891878128, 1.8812521696091, 1.8801153898239, 1.8789787292480, 1.8778423070908, 1.8767061233521, 1.8755700588226, 1.8744341135025, 1.8732985258102, 1.8721630573273, 1.8710278272629, 1.8698927164078, 1.8687578439713, 1.8676232099533, 1.8664886951447, 1.8653545379639, 1.8642204999924, 1.8630865812302, 1.8619530200958, 1.8608195781708, 1.8596863746643, 1.8585534095764]]),
            # fmt: on
            id="Compare EEmiLib with manual CST export with dummy data #2",
        ),
    ],
)
def test_implementations(
    vaughan_parameters: dict[str, float],
    vaughan_implementation: VaughanImplementation,
    energy: NDArray[np.float64],
    theta: NDArray[np.float64],
    expected: NDArray[np.float64],
) -> None:
    """Compare built-ins implementations with 3DS softwares exports.

    1. Give in the parameters defined in CST/SPARK3D.
    2. Recompute TEEY with the models, compare to TEEY from CST/SPARK3D.

    """
    model = Vaughan(
        implementation=vaughan_implementation,
        parameters_values=vaughan_parameters,
    )

    calculated = model.teey(energy, theta).to_numpy().transpose()[:-1]
    assert_array_almost_equal(calculated, expected, decimal=3)


@pytest.fixture
def fil_technical_ag() -> MockDataMatrix:
    """Instantiate technical Ag from :cite:`Fil2016a,Fil2020`."""
    emission_yield = EmissionYield(
        population="all",
        data=pd.DataFrame(
            {
                # fmt: off
        "Energy [eV]": [0, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 30, 36, 49, 70, 75, 90, 100, 150, 200, 250, 300, 350, 400, 450, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600, 1800, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 10000, 12000, 14000, 16000, 18000, 20000, 22000],
        "0.0 [deg]": [0, 0.75, 0.78, 0.79, 0.82, 0.83, 0.85, 0.87, 0.9, 0.94, 0.97, 1, 1.03, 1.1, 1.17, 1.31, 1.55, 1.61, 1.725, 1.77, 1.975, 2.119, 2.173, 2.17, 2.16, 2.152, 2.137, 2.106, 2.041, 1.975, 1.907, 1.847, 1.777, 1.67, 1.582, 1.5, 1.42, 1.34, 1.07, 0.95, 0.87, 0.795, 0.75, 0.72, 0.68, 0.635, 0.62, 0.6, 0.58, 0.57, 0.56],
                # fmt: on
            }
        ),
    )
    data_matrix = MockDataMatrix(emission_yield)
    return data_matrix


@pytest.mark.xfail
def test_error_ec1(
    vaughan_model: Vaughan, fil_technical_ag: MockDataMatrix
) -> None:
    """Check that we retrieve N. Fil results :cite:`Fil2016a,Fil2020`.

    We use the same technical Ag as he did.

    """
    vaughan_model.find_optimal_parameters(fil_technical_ag)
    returned = vaughan_model._error_ec1(fil_technical_ag.teey)
    expected = 23.4
    assert returned == approx(expected)


@pytest.mark.xfail
def test_error_teey(
    vaughan_model: Vaughan, fil_technical_ag: MockDataMatrix
) -> None:
    """Check that we retrieve N. Fil results :cite:`Fil2016a,Fil2020`.

    We use the same technical Ag as he did.

    """
    vaughan_model.find_optimal_parameters(fil_technical_ag)
    returned = vaughan_model._error_teey(fil_technical_ag.teey)
    expected = 3.1
    assert returned == approx(expected)
