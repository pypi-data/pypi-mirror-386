{% extends 'django_cfg_ipc/layout/base.html' %}
{% load static %}

{% block title %}RPC Monitor Dashboard{% endblock %}

{% block content %}
<!-- Statistics Cards -->
{% include 'django_cfg_ipc/components/stat_cards.html' %}

<!-- System Status -->
{% include 'django_cfg_ipc/components/system_status.html' %}

<!-- Tab Navigation -->
{% include 'django_cfg_ipc/components/tab_navigation.html' %}

<!-- Tab Content -->
<div class="tab-content">
    {% include 'django_cfg_ipc/components/overview_content.html' %}
    {% include 'django_cfg_ipc/components/requests_content.html' %}
    {% include 'django_cfg_ipc/components/notifications_content.html' %}
    {% include 'django_cfg_ipc/components/methods_content.html' %}
    {% include 'django_cfg_ipc/components/testing_tools.html' %}
</div>
{% endblock %}

{% block extra_js %}
{% load i18n %}
{% now "U" as current_timestamp %}

<!-- Load and initialize IPC API -->
<script type="module">
try {
    console.log('üîÑ Starting IpcAPI module import...');
    const { loadAPI, showNotification } = await import('/static/js/api-loader.mjs');

    // Load ipc API
    const ipcAPI = await loadAPI('ipc');
    console.log('‚úÖ IpcAPI module imported successfully:', ipcAPI);

    // Make it available globally as ipcAPI
    window.ipcAPI = ipcAPI;
    window.showNotification = showNotification;

    console.log('‚úÖ IpcAPI loaded from generated MJS client');
} catch (error) {
    console.error('‚ùå Failed to load IpcAPI module:', error);
    console.error('Error stack:', error.stack);
    window.ipcAPI = null;
}
</script>

<!-- Dashboard Modules -->
<script type="module" src="{% static 'django_cfg_ipc/js/dashboard/overview.mjs' %}?v={{ current_timestamp }}"></script>
<script type="module" src="{% static 'django_cfg_ipc/js/dashboard/testing.mjs' %}?v={{ current_timestamp }}"></script>
<script type="module" src="{% static 'django_cfg_ipc/js/dashboard/main.mjs' %}?v={{ current_timestamp }}"></script>
{% endblock %}
