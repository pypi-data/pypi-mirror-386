{% extends 'tasks/layout/base.html' %}
{% load static %}

{% block extra_css %}
<style>
    /* Tab styling - –≤–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–∞–±–æ–≤ */
    .tab-button.active {
        border-color: #3b82f6 !important;
        color: #3b82f6 !important;
    }
    
    .tab-panel {
        display: none !important;
    }
    
    .tab-panel.active {
        display: block !important;
    }
    
    /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±—ã –∫—Ä–æ–º–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ */
    #queues-tab,
    #workers-tab, 
    #tasks-tab {
        display: none;
    }
    
    #overview-tab {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
{% csrf_token %}

<!-- Management Actions -->
{% include 'tasks/components/management_actions.html' %}

<!-- Tab Navigation -->
{% include 'tasks/components/tab_navigation.html' %}

<!-- Tab Content -->
<div class="tab-content mt-6">
    <!-- Overview Tab -->
    <div id="overview-tab" class="tab-panel active">
        {% include 'tasks/components/overview_content.html' %}
    </div>
    
    <!-- Queues Tab -->
    <div id="queues-tab" class="tab-panel">
        {% include 'tasks/components/queues_content.html' %}
    </div>
    
    <!-- Workers Tab -->
    <div id="workers-tab" class="tab-panel">
        {% include 'tasks/components/workers_content.html' %}
    </div>
    
    <!-- Tasks Tab -->
    <div id="tasks-tab" class="tab-panel">
        {% include 'tasks/components/tasks_content.html' %}
    </div>
</div>

<!-- Templates for JavaScript -->
{% include 'tasks/partials/task_row_template.html' %}

{% endblock %}

{% block extra_js %}
<!-- Load and initialize Tasks API -->
<script type="module">
try {
    console.log('üîÑ Starting TasksAPI module import...');
    const { loadAPI, showNotification } = await import('/static/js/api-loader.mjs');

    // Load tasks API
    const tasksAPI = await loadAPI('tasks');
    console.log('‚úÖ TasksAPI module imported successfully:', tasksAPI);

    // Make it available globally as tasksAPI
    window.tasksAPI = tasksAPI;
    window.showNotification = showNotification;

    console.log('‚úÖ TasksAPI loaded from generated MJS client');
} catch (error) {
    console.error('‚ùå Failed to load TasksAPI module:', error);
    console.error('Error stack:', error.stack);
    window.tasksAPI = null;
}
</script>

<!-- Dashboard Modules -->
<script type="module" src="{% static 'tasks/js/dashboard/overview.mjs' %}"></script>
<script type="module" src="{% static 'tasks/js/dashboard/queues.mjs' %}"></script>
<script type="module" src="{% static 'tasks/js/dashboard/workers.mjs' %}"></script>
<script type="module" src="{% static 'tasks/js/dashboard/tasks.mjs' %}"></script>

<!-- Main Dashboard Controller -->
<script type="module" src="{% static 'tasks/js/dashboard/main.mjs' %}"></script>
{% endblock %}
