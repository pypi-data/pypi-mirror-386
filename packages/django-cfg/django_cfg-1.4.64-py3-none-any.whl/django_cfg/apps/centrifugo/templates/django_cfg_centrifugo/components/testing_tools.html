<!-- Live Testing Tab -->
<div id="usage-guide-tab" class="tab-panel hidden">
    <!-- Include Centrifuge.js Library -->
    <script src="https://unpkg.com/centrifuge@^5/dist/centrifuge.js"></script>

    <!-- Introduction Card -->
    <div class="bg-gradient-to-r from-purple-500 to-purple-700 rounded-lg p-6 mb-6 text-white">
        <h3 class="text-2xl font-bold mb-2 flex items-center">
            <span class="material-icons mr-2">science</span>
            Live Testing Client
        </h3>
        <p class="text-purple-100">
            Interactive WebSocket client for testing Centrifugo integration. Connect, subscribe to channels, publish messages, and monitor real-time events.
        </p>
    </div>

    <!-- Quick Test Scenarios Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <span class="material-icons mr-2 text-yellow-500">bolt</span>
            Quick Test Scenarios
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
            One-click test scenarios that automatically connect, subscribe, and publish test messages.
        </p>

        <!-- Scenarios Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Scenario 1: Simple Notification -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1 flex items-center gap-2">
                            <span class="material-icons text-blue-500 text-sm">notifications</span>
                            Simple Notification
                        </h4>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Fire-and-forget notification to user#test-123</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-700 rounded p-2 mb-3">
                    <code class="text-xs text-gray-700 dark:text-gray-300">
                        → Connect<br>
                        → Subscribe to user#test-123<br>
                        → Publish simple message<br>
                        → Receive immediately
                    </code>
                </div>
                <button onclick="window.centrifugoDashboard.liveTestingModule.runQuickScenario('simple-notification')"
                        class="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-medium text-sm flex items-center justify-center gap-2">
                    <span class="material-icons text-base">play_arrow</span>
                    Run Scenario
                </button>
            </div>

            <!-- Scenario 2: ACK Notification -->
            <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1 flex items-center gap-2">
                            <span class="material-icons text-green-500 text-sm">check_circle</span>
                            ACK Required Notification
                        </h4>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Message with acknowledgment tracking</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-700 rounded p-2 mb-3">
                    <code class="text-xs text-gray-700 dark:text-gray-300">
                        → Connect<br>
                        → Subscribe to user#test-123<br>
                        → Publish with wait_for_ack=true<br>
                        → Auto-send ACK (10s timeout)
                    </code>
                </div>
                <button onclick="window.centrifugoDashboard.liveTestingModule.runQuickScenario('ack-notification')"
                        class="w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded font-medium text-sm flex items-center justify-center gap-2">
                    <span class="material-icons text-base">play_arrow</span>
                    Run Scenario
                </button>
            </div>

            <!-- Scenario 3: Broadcast -->
            <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1 flex items-center gap-2">
                            <span class="material-icons text-orange-500 text-sm">campaign</span>
                            Team Broadcast
                        </h4>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Broadcast to team#developers channel</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-700 rounded p-2 mb-3">
                    <code class="text-xs text-gray-700 dark:text-gray-300">
                        → Connect<br>
                        → Subscribe to team#developers<br>
                        → Broadcast announcement<br>
                        → No ACK tracking
                    </code>
                </div>
                <button onclick="window.centrifugoDashboard.liveTestingModule.runQuickScenario('broadcast')"
                        class="w-full px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded font-medium text-sm flex items-center justify-center gap-2">
                    <span class="material-icons text-base">play_arrow</span>
                    Run Scenario
                </button>
            </div>

            <!-- Scenario 4: Complete ACK Flow -->
            <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                <div class="flex items-start justify-between mb-3">
                    <div>
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-1 flex items-center gap-2">
                            <span class="material-icons text-purple-500 text-sm">sync_alt</span>
                            Complete ACK Flow
                        </h4>
                        <p class="text-xs text-gray-600 dark:text-gray-400">Full publish → receive → ACK cycle test</p>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-700 rounded p-2 mb-3">
                    <code class="text-xs text-gray-700 dark:text-gray-300">
                        → Connect<br>
                        → Subscribe to test#ack-flow<br>
                        → Publish with ACK tracking<br>
                        → Verify full flow (15s timeout)
                    </code>
                </div>
                <button onclick="window.centrifugoDashboard.liveTestingModule.runQuickScenario('ack-flow')"
                        class="w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded font-medium text-sm flex items-center justify-center gap-2">
                    <span class="material-icons text-base">play_arrow</span>
                    Run Scenario
                </button>
            </div>
        </div>
    </div>

    <!-- WebSocket Connection Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <span class="material-icons mr-2 text-green-500">link</span>
            WebSocket Connection
        </h3>

        <!-- Connection Status Bar -->
        <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
            <div class="flex items-center gap-3">
                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Status:</span>
                <span id="ws-connection-status" class="px-3 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded-full text-sm font-medium">
                    Disconnected
                </span>
            </div>
            <div class="flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400">
                <span>Client ID:</span>
                <code id="ws-client-id" class="bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">-</code>
            </div>
        </div>

        <!-- Connection Form -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    User ID
                </label>
                <input type="text"
                       id="ws-user-id"
                       value="test-user-123"
                       placeholder="Enter user ID"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-purple-500 focus:border-purple-500">
            </div>
        </div>

        <!-- Connection Buttons -->
        <div class="flex gap-3">
            <button id="ws-connect-btn"
                    onclick="window.centrifugoDashboard.liveTestingModule.connectToCentrifugo(document.getElementById('ws-user-id').value)"
                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-medium flex items-center gap-2 transition-colors">
                <span class="material-icons text-sm">power</span>
                Connect
            </button>
            <button id="ws-disconnect-btn"
                    onclick="window.centrifugoDashboard.liveTestingModule.disconnect()"
                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium flex items-center gap-2 transition-colors"
                    disabled>
                <span class="material-icons text-sm">power_off</span>
                Disconnect
            </button>
        </div>
    </div>

    <!-- Channel Subscription Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <span class="material-icons mr-2 text-blue-500">subscriptions</span>
            Channel Subscriptions
            <span id="ws-subscriptions-count" class="ml-auto px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs font-medium">0</span>
        </h3>

        <!-- Subscribe Form -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Channel Name
            </label>
            <div class="flex gap-2">
                <input type="text"
                       id="ws-channel-name"
                       value="user#test-123"
                       placeholder="e.g., user#123, team#developers"
                       class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-purple-500 focus:border-purple-500">
                <button id="ws-subscribe-btn"
                        onclick="window.centrifugoDashboard.liveTestingModule.subscribeToChannel(document.getElementById('ws-channel-name').value)"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium flex items-center gap-2"
                        disabled>
                    <span class="material-icons text-sm">add</span>
                    Subscribe
                </button>
            </div>
        </div>

        <!-- Active Subscriptions List -->
        <div id="ws-subscriptions-list" class="border border-gray-200 dark:border-gray-600 rounded-lg p-4">
            <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                No active subscriptions
            </div>
        </div>
    </div>

    <!-- Message Publisher Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
            <span class="material-icons mr-2 text-orange-500">send</span>
            Publish Test Message
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <!-- Target Channel -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    Target Channel
                </label>
                <input type="text"
                       id="pub-channel"
                       value="user#test-123"
                       placeholder="Channel to publish to"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-purple-500 focus:border-purple-500">
            </div>

            <!-- ACK Settings -->
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                    ACK Mode
                </label>
                <div class="flex gap-2">
                    <select id="pub-ack-mode"
                            class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-purple-500 focus:border-purple-500">
                        <option value="false">Simple (No ACK)</option>
                        <option value="true">With ACK Tracking</option>
                    </select>
                    <input type="number"
                           id="pub-ack-timeout"
                           value="10"
                           min="1"
                           max="60"
                           placeholder="Timeout (s)"
                           class="w-20 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-purple-500 focus:border-purple-500">
                </div>
            </div>
        </div>

        <!-- Message Data -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Message Data (JSON)
            </label>
            <textarea id="pub-message-data"
                      rows="6"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white font-mono text-sm focus:ring-purple-500 focus:border-purple-500">{
  "type": "notification",
  "title": "Test Message",
  "message": "This is a test message from the dashboard",
  "timestamp": "{% now 'c' %}"
}</textarea>
        </div>

        <!-- Publish Button -->
        <div class="flex gap-3">
            <button id="pub-send-btn"
                    onclick="window.centrifugoDashboard.liveTestingModule.publishTestMessage(
                        document.getElementById('pub-channel').value,
                        JSON.parse(document.getElementById('pub-message-data').value),
                        document.getElementById('pub-ack-mode').value === 'true',
                        parseInt(document.getElementById('pub-ack-timeout').value)
                    ).then(result => {
                        if (result.success) {
                            alert('Message published successfully!\\nMessage ID: ' + result.message_id + '\\nDelivered: ' + result.delivered + '\\nACKs: ' + result.acks_received);
                        } else {
                            alert('Failed to publish message: ' + result.error);
                        }
                    })"
                    class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-md font-medium flex items-center gap-2 transition-colors">
                <span class="material-icons text-sm">send</span>
                Publish Message
            </button>
        </div>
    </div>

    <!-- Received Messages Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                <span class="material-icons mr-2 text-purple-500">inbox</span>
                Received Messages
                <span id="ws-messages-count" class="ml-2 px-2 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 rounded-full text-xs font-medium">0</span>
            </h3>
            <div class="flex items-center gap-2">
                <!-- Auto ACK Toggle -->
                <label class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300">
                    <input type="checkbox"
                           id="auto-ack-toggle"
                           checked
                           onchange="window.centrifugoDashboard.liveTestingModule.toggleAutoAck(this.checked)"
                           class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                    Auto ACK
                </label>
                <button onclick="window.centrifugoDashboard.liveTestingModule.clearReceivedMessages()"
                        class="px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded text-sm font-medium">
                    Clear
                </button>
            </div>
        </div>

        <!-- Messages Container -->
        <div id="ws-received-messages" class="max-h-96 overflow-y-auto space-y-3">
            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                No messages received yet...
            </div>
        </div>
    </div>

    <!-- ACK History Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 mb-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                <span class="material-icons mr-2 text-green-500">check_circle</span>
                ACK History
            </h3>
            <button onclick="window.centrifugoDashboard.liveTestingModule.clearAckHistory()"
                    class="px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded text-sm font-medium">
                Clear
            </button>
        </div>

        <!-- ACK History Container -->
        <div id="ws-ack-history">
            <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                No ACKs sent yet
            </div>
        </div>
    </div>

    <!-- WebSocket Events Log Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex items-center">
                <span class="material-icons mr-2 text-blue-500">event_note</span>
                WebSocket Events Log
                <span id="ws-events-count" class="ml-2 px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs font-medium">0</span>
            </h3>
            <div class="flex items-center gap-2">
                <button onclick="window.centrifugoDashboard.liveTestingModule.exportEventsLog()"
                        class="px-3 py-1 bg-indigo-500 hover:bg-indigo-600 text-white rounded text-sm font-medium flex items-center gap-1">
                    <span class="material-icons text-sm">download</span>
                    Export JSON
                </button>
                <button onclick="window.centrifugoDashboard.liveTestingModule.clearEventsLog()"
                        class="px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded text-sm font-medium">
                    Clear
                </button>
            </div>
        </div>

        <!-- Events Description -->
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 mb-4 border border-blue-200 dark:border-blue-800">
            <p class="text-sm text-gray-700 dark:text-gray-300">
                Real-time log of all WebSocket events including connections, subscriptions, publications, ACKs, and errors. Events are color-coded by type.
            </p>
            <div class="flex flex-wrap gap-3 mt-2 text-xs">
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-green-500"></span>
                    <span class="text-gray-600 dark:text-gray-400">Connection</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-blue-500"></span>
                    <span class="text-gray-600 dark:text-gray-400">Subscription</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-purple-500"></span>
                    <span class="text-gray-600 dark:text-gray-400">Publication</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-indigo-500"></span>
                    <span class="text-gray-600 dark:text-gray-400">ACK</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-red-500"></span>
                    <span class="text-gray-600 dark:text-gray-400">Error</span>
                </div>
            </div>
        </div>

        <!-- Events Log Container -->
        <div id="ws-events-log">
            <div class="text-center py-4 text-gray-500 dark:text-gray-400 text-sm">
                No events logged yet
            </div>
        </div>
    </div>
</div>
