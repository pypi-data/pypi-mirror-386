[project]
name = "libggml-python"
dynamic = ["version"]
description = "Prebuilt ggml libraries"
authors = [
  { name = "benniekiss" }
]
readme = "README.md"
license = "MIT"
requires-python = ">=3.10"

[project.urls]
Source = "https://github.com/benniekiss/libggml-python"
Tracker = "https://github.com/benniekiss/libggml-python/issues"
Upstream = "https://github.com/ggml-org/ggml"

[build-system]
requires = [
  "scikit-build-core>=0.11.5",
  "setuptools-scm>=8",
]
build-backend = "scikit_build_core.build"

[tool.scikit-build]
minimum-version = "build-system.requires"
cmake.build-type = "Release"
metadata.version.provider = "scikit_build_core.metadata.setuptools_scm"
wheel.packages = ["src/libggml"]
wheel.install-dir = "libggml"
sdist.include = ["ggml/", "src/libggml/_version.py"]

[tool.scikit-build.cmake.define]
CMAKE_RUNTIME_OUTPUT_DIRECTORY = "build"

[project.entry-points."cmake.root"]
ggml = "libggml"

[project.entry-points."cmake.prefix"]
ggml = "libggml"

[tool.setuptools_scm]
write_to = "src/libggml/_version.py"

[tool.cibuildwheel]
# skip 32bit builds
skip = ["*-win32", "*-manylinux_i686"]

[tool.cibuildwheel.linux]
repair-wheel-command = "auditwheel repair --exclude libggml* -w {dest_dir} {wheel}"

[tool.cibuildwheel.macos]
repair-wheel-command = "delocate-wheel --exclude libggml* --require-archs {delocate_archs} -w {dest_dir} -v {wheel}"

[tool.cibuildwheel.windows]
before-build = "pip install delvewheel"
repair-wheel-command = "delvewheel repair --ignore-existing -w {dest_dir} {wheel}"
