{
    "name" : "emap_fetch",
    "label": "Fetch EMAP collection",

    "dag": {
        "nodes": {
            "fetch"    : "fetch.download.FTP_EM",
            "group"     : "fetch.common.GroupByMask",
            "extract"  : "fetch.extract.em.Applicants",
            "load"     : "fetch.common.Load",
            "clean"    : "fetch.extract.em.CleanupAP"
        },
        "edges": [
            {
                "from"     : "fetch",
                "to"       : "group",
                "bindings" : { "group.input_files" : "fetch.output_files" }
            },
            {
                "from"     : "group",
                "to"       : "extract",
                "bindings" : { "extract.archives" : "group.output_files" }
            },
            {
                "from"     : "extract",
                "to"       : "load",
                "bindings" : { "load.manifest"  : "extract.manifest"}
            },
            {
                "from"     : "fetch",
                "to"       : "clean",
                "bindings" : { "clean.processed_list" : "fetch.output_files" }
            },
            {
                "from"     : "load",
                "to"       : "clean",
                "bindings" : { "clean.manifest_list" : "load.manifest" }
            }
        ]
    },
    "config" : {
	    "steps": {
            "fetch": {
                "file_regex": "DIFF_APPLICANTS_\\d{8}(_\\d{8})?\\.zip",
                "sleep_secs": 2
            },
            "group": {
                "mask_input"  : "DIFF_APPLICANTS_(\\d{4})(\\d{2})(\\d{2})",
                "mask_output" : "\\1-\\2-\\3"
            }
        }
    }
}

