{
    "name" : "frtm_fetch",
    "label": "Fetch FRTM collection",

    "dag": {
         "nodes": {
            "fxml"   : "fetch.download.FTP",
            "fimg"    : "fetch.download.FTP",
            "gxml"    : "fetch.common.GroupByMask",
            "gimg"    : "fetch.common.GroupByMask",
            "join"    : "fetch.common.Join",
            "extract"  : "fetch.extract.fr.Trademarks",
            "img"      : "fetch.common.DownloadIMG",
            "organize" : "fetch.common.Organize",
            "clean"    : "fetch.common.Cleanup"
        },
        "edges": [
            {
                "from"     : "fxml",
                "to"       : "gxml",
                "bindings" : { "gxml.input_files" : "fxml.output_files" }
            },
            {
                "from"     : "fimg",
                "to"       : "gimg",
                "bindings" : { "gimg.input_files" : "fimg.output_files" }
            },
            {
                "from"     : "gxml",
                "to"       : "join",
                "bindings" : { "join.archives" : "gxml.output_files" }
            },
            {
                "from"     : "gimg",
                "to"       : "join",
                "bindings" : { "join.archives" : "gimg.output_files" }
            },
            {
                "from"     : "join",
                "to"       : "extract",
                "bindings" : { "extract.archives" : "join.archives" }
            },
            {
                "from"     : "extract",
                "to"       : "img",
                "bindings" : { "img.manifest" : "extract.manifest"}
            },
            {
                "from"     : "img",
                "to"       : "organize",
                "bindings" : { "organize.manifest"  : "img.manifest" }
            },
            {
                "from"     : "fxml",
                "to"       : "clean",
                "bindings" : { "clean.processed_list" : "fetch.output_files" }
            },
            {
                "from"     : "fimg",
                "to"       : "clean",
                "bindings" : { "clean.processed_list" : "fetch.output_files" }
            },
            {
                "from": "organize",
                "to": "clean",
                "bindings": {
                    "clean.manifest_list": "organize.manifest"
                }
            }
        ]
    },
    "config" : {
	    "steps": {
            "fxml": {
                "file_regex": "FR_FRST66_\\d{4}\\-\\d{2}.zip",
                 "no_sub_dirs": 1
            },
            "gxml": {
                "mask_input"  : "FR_FRST66_(\\d{4})\\-(\\d{2})",
                "mask_output" : "\\1-\\2"
            },
            "fimg": {
                "file_regex": "fmark_image_\\d{4}.[tar|zip]",
                "no_sub_dirs": 1
            },
            "gimg": {
                "mask_input"  : "fmark_image_(\\d{2})(\\d{2})",
                "mask_output" : "20\\1-\\2"
            },
            "join": {
                "mask_input"  : "(FR_FRST66_(\\d{4})\\-(\\d{2}))|(fmark_image_(\\d{2})(\\d{2}))",
                "mask_output" : "FR-\\1-\\2"
            }
        }
    }
}

