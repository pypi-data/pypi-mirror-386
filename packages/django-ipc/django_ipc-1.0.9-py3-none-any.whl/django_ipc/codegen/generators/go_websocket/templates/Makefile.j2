.PHONY: help deps build test clean fmt lint

help: ## Show this help message
	@echo 'Usage: make [target]'
	@echo ''
	@echo 'Available targets:'
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  %-15s %s\n", $$1, $$2}' $(MAKEFILE_LIST)

deps: ## Download dependencies
	go mod download
	go mod verify

build: ## Build example (if exists)
	@if [ -f "example/main.go" ]; then \
		go build -o bin/example example/main.go; \
	else \
		echo "No example to build"; \
	fi

test: ## Run tests
	go test -v -race -cover ./...

clean: ## Clean build artifacts
	rm -rf bin/
	go clean

fmt: ## Format code
	go fmt ./...

lint: ## Run linter
	@command -v golangci-lint >/dev/null 2>&1 || { \
		echo "golangci-lint not installed. Install with:"; \
		echo "  go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"; \
		exit 1; \
	}
	golangci-lint run

tidy: ## Tidy go.mod
	go mod tidy

all: deps fmt lint test build ## Run all checks and build
