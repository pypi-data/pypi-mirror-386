{% include "export/_base_export.jinja2" %}
SELECT  -- images
    media_context.image_or_object_id as media_id,
    image_issues.id as issue_id,
    issue_type.name as issue_type_name,
    issue_type.severity as issue_severity,
    image_issues.confidence as issue_confidence,
    image_issues.description as issues_description,
    image_issues.issue_subject_id
FROM
    media_context
    JOIN image_issues ON media_context.image_id = image_issues.image_id
    JOIN issue_type on image_issues.type_id = issue_type.id
WHERE
    image_issues.dataset_id = :dataset_id
    AND image_issues.cause IS NULL
    AND media_context.cluster_type = 'IMAGES'
UNION ALL
SELECT  -- objects
    media_context.image_or_object_id as media_id,
    image_issues.id as issue_id,
    issue_type.name as issue_type_name,
    issue_type.severity as issue_severity,
    image_issues.confidence as issue_confidence,
    image_issues.description as issues_description,
    image_issues.issue_subject_id
FROM
    media_context
    JOIN image_issues ON media_context.image_id = image_issues.image_id
        AND image_issues.cause = media_context.image_or_object_id
    JOIN issue_type on image_issues.type_id = issue_type.id
WHERE
    image_issues.dataset_id = :dataset_id
    AND media_context.cluster_type = 'OBJECTS'
