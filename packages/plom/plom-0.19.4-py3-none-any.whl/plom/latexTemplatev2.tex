% SPDX-License-Identifier: AGPL-3.0-or-later
% Copyright (C) 2019-2024 Andrew Rechnitzer
% Copyright (C) 2022-2024 Colin B. Macdonald

\documentclass[12pt]{exam}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This template uses latex exam class.
%%
%% This template is for letter-paper, not a4 paper.
%% The margins have been set so as to work nicely
%% with the QR-codes etc needed by Plom.
%%
%% It has also been designed to use the latex exam class
%% which auto-computes totals etc and also makes it easy
%% for the instructor to include solutions in their .tex
%% We recommend that you use this.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% To print answers/soln and remove the extra spacing
%% just comment out the line below
%% vvvvv
%% vvv
%% v

% \printanswers%

%% ^
%% ^^^
%% ^^^^^
%% Try running this with and without the line above
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Add "draft" to show mock-up QR codes
%\usepackage{mockplom}
%\usepackage[draft]{mockplom}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\boxedpoints        % puts boxes around the score for each question
\marksnotpoints     % call scores 'marks' not 'points'
\addpoints          % total up the marks for each question 
\extrawidth{-20mm}  % control margins for plom-qr-code positioning.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% A simple warning for your Do-Not-Mark pages
\newcommand{\dnm}{\noindent%
\emph{Please do not write on this page --- it will not be marked.}%
}

% Here are some handy commands for adding spacing / blank pages / answerboxes
% when printing with or without solns.

% Use the command below to put a vfill between things when printing
% without answers/solutions. No space when printing with answers/solns
\newcommand{\blank}{ \ifprintanswers{}\else{\vfill}\fi }

% Use the command below to put a blankpage when printing without answers/solutions.
% No page when printing with answers/solns
% This takes an optional argument of a question-number: \blankpage[X]
% and prints a message telling the student that this blank space is for
% question X. If no arg given then it prints the same message but for
% the current question. Thanks to PDL for improving this.
\newcommand{\blankpage}[1][\thequestion]{%
\ifprintanswers{}\else{\par\vfill\newpage%
\noindent \emph{This blank page is for your solution to \textbf{Question~{#1}} if you need more space.}%
\par\vfill\newpage}\fi%
}

% Use this to make a nice answerbox which will display the correct answer
% when solutions are printed and is otherwise blank for the students
% to write their stuff.
\newcommand{\answerbox}[1]{%
\begin{flushright}\fbox{\parbox[l]{60mm}{Answer: \ifprintanswers{#1}\else{\vspace{10mm}}\fi}}\end{flushright}%
}
% A slightly larger answerbox
\newcommand{\Answerbox}[1]{%
\begin{flushright}\fbox{\parbox[l]{80mm}{Answer: \ifprintanswers{#1}\else{\vspace{10mm}}\fi}}\end{flushright}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Load packages and things here
\usepackage{amsmath,amsthm,amsfonts,amssymb}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage{tikz}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Use tikz to put a big "Solutions" watermark on the first page 
% if compiled with solutions
% the command takes an optional argument to print a version-number
\newcommand{\watermarkPageIfSolutions}[1][\empty]{
\ifprintanswers%
\begin{tikzpicture}[remember picture, overlay]%
\node [text=red, rotate=55, scale=10, opacity=.25] at (current page.center){%
\ifx\empty{\textsf{SOLUTIONS}}\else{\begin{tabular}{c} \textsf{SOLUTIONS}\\ \textsf{VERSION~#1} \end{tabular}}\fi
};%
\end{tikzpicture}%
\fi%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Make the header blank, but put page info in the footer.
\chead{}
\cfoot{Page \thepage\ of \numpages}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Your macros should go here
%% for example
\newcommand{\dee}[1]{{\mathrm{d}#1}}
\newcommand{\diff}[2]{\dfrac{\dee{#1}}{\dee{#2}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Time to start the actual test

\begin{document}
\watermarkPageIfSolutions[2]

\section*{Mathematics ABC --- Midterm --- 45 minutes}
\subsection*{October 43th 2318}
\begin{itemize}
  \item The test consists of \numpages\ pages and \numquestions\ questions worth a total of \numpoints\ marks.
  \item This is a closed-book examination. \textbf{None of the following are allowed}: documents, cheat sheets or electronic devices of any kind (including calculators, \underline{cell phones}, etc.)
  \item No work on this page will be marked.
  \item Fill in the information below before turning to the questions.
\end{itemize}

\begin{center}
  \includegraphics{idBox4}
\end{center}


\vfill
\newpage
\dnm
\subsection*{Additional instructions}
\begin{itemize}
  \item Please use the spaces indicated.
  \item If you require extra paper then put up your hand and ask your instructor.
  \begin{itemize}
    \item You must put your name and student number on any extra pages.
    \item You must indicate the test-number and question-number.
    \item Please do this \textbf{on both sides} of any extra pages.
  \end{itemize}
  \item Please do not dismember your test. You must submit all pages.
  \item Smoking is strictly prohibited during the test.
\end{itemize}

\vfill
\subsection*{Formula sheet}
You may find the following formulas useful in the questions that follow.
\begin{align*}
  a^2 + b^2 &= c^2 \\
  e^{i\pi}+1 &= 0 \\
  \sum_{i=1}^n i &= \frac{n(n+1)}{2} \\
  \diff{}{x}(f+g) &= \diff{f}{x}+\diff{g}{x} \\
  \int (f+g)\dee{x} &= \int f \dee{x} + \int g \dee{x} \\
  \cos(a+b) &= \cos a \cos b - \sin a \sin b \\
  \sin(a+b) &= \sin a \cos b + \cos a \sin b \\
  A \cup (B \cap C) &= (A\cup B) \cap (A \cup C) \\
  A \cap (B \cup C) &= (A\cap B) \cup (A \cap C) \\
  \overline{A \cap B} &= \overline{A} \cup \overline{B} \\
  \overline{A \cup B} &= \overline{A} \cap \overline{B}
\end{align*}
\vfill

\newpage

\begin{questions}
\question[5] Please place your answers in the boxes provided.
\begin{parts}
  \part Find the derivative of $\cos(x^2 y^3)$ with respect to $y$.
  \textbf{(note this is ver2)}
  \answerbox{$-3 x^2 y^2 \sin(x^2 y^3)$}
  \begin{solution}
    We calculate the partial derivative.
    We also need the chain rule.
  \end{solution}
  \blank
  % Use \blank to space out the question parts nicely.

  \part Another little thing here, \textbf{but this is ver2}
  \answerbox{\(\sin(x)\)}
  \begin{solution}
    Putting in your solutions ahead of time really helps calibrate your test. \textbf{but this is ver2}
  \end{solution}
  \blank

  \part A third thing, \textbf{but this is ver2}
  \answerbox{\(\int \sin(x) dx\)}
  \begin{solution}
    Yet another solution goes here. \textbf{but this is ver2}
  \end{solution}
  \blank
\end{parts}
\newpage

%% Next question

\question[5]
Please place your answers in the boxes provided.
[Note if mark this question as ``fix'' in the spec it will always be chosen
from version 1; version 2 will never be used.]
\begin{parts}
  \part Answer something not quite so simple, \textbf{but this is ver2}
  \answerbox{ABC}
  \begin{solution}
    Some working will go here. \textbf{but this is ver2 and less simple}
  \end{solution}
  \blank
  % Use \blank to space out the question parts nicely.

  \part Another less simple thing here, \textbf{but this is ver2}
  \answerbox{\(\sin(x)\)}
  \begin{solution}
    Putting in your solutions ahead of time really helps calibrate your test.

    \textbf{but this is ver2}
  \end{solution}
  \blank

  \part A third thing unsimple thing here, \textbf{but this is ver2}
  \answerbox{\(\int \sin(x) dx\)}
  \begin{solution}
    Yet another solution goes here. \textbf{but this is ver2}
  \end{solution}
  \blank
\end{parts}
\newpage

%% Next question

\question[10] A long question goes here. In fact it is sufficiently long that we make sure you have a whole extra blank page for your work.

[But this is ver2 which is the same question but some details have been changed slightly.]

\begin{solution}
  A long solution here. Maybe it even contains a diagram? \textbf{but this is ver2 of the diagram}
\end{solution}

\blankpage

\end{questions}
\end{document}
