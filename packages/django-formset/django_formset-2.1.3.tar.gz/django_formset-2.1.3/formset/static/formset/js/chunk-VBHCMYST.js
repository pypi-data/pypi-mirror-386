import{b as c}from"./chunk-74KQCU7Q.js";import{a as m}from"./chunk-ULT7T2WM.js";import{b as f}from"./chunk-JC2BH436.js";var d=f(m());var p=class extends c{constructor(a){super(a);this.getValue=()=>[];this.filterByValues=new Map;this.touch=()=>{this.fieldGroup.classList.remove("dj-untouched","dj-validated"),this.fieldGroup.classList.add("dj-touched")};this.initialIncomplete=this.isIncomplete=a.hasAttribute("incomplete")}setupFilters(a){var s;(((s=a.getAttribute("filter-by"))==null?void 0:s.split(","))??[]).forEach(i=>{var r;let e=(r=a.form)==null?void 0:r.elements.namedItem(i);if(e instanceof HTMLInputElement){this.filterByValues.set(i,e.value);let n=!1;e.addEventListener("change",async o=>{let l=o.target;!n&&l instanceof HTMLInputElement&&(this.filterByValues.set(i,l.value),this.isIncomplete=this.initialIncomplete,n=!0,await this.reloadOptions(!0),n=!1)})}else if(e instanceof HTMLSelectElement){this.filterByValues.set(i,Array.from(e.selectedOptions).map(o=>o.value));let n=!1;e.addEventListener("change",async o=>{!n&&o.target===e&&(this.filterByValues.set(i,Array.from(e.selectedOptions).map(l=>l.value)),this.isIncomplete=this.initialIncomplete,n=!0,await this.reloadOptions(!0),n=!1)})}})}mustReloadOptions(){return Array.from(this.filterByValues.values()).some(a=>a.some(t=>t))}buildFetchQuery(a,t){let s=new URLSearchParams;s.set("offset",String(a)),t!=null&&t.pk?s.set("pk",t.pk):t!=null&&t.search&&s.set("search",encodeURIComponent(t.search));for(let[i,e]of this.filterByValues)(0,d.default)(e)?s.set(`filter-${i}`,encodeURIComponent(e)):Array.isArray(e)&&(e.length===0?s.append(`filter-${i}`,""):e.forEach(r=>s.append(`filter-${i}`,encodeURIComponent(r))));return s}async loadOptions(a,t){let s=new Headers;s.append("Accept","application/json"),a.set("field",this.fieldName);let i=await fetch(`${this.endpoint}?${a.toString()}`,{method:"GET",headers:s});if(i.status===200){let e=await i.json();typeof e.incomplete=="boolean"&&(this.isIncomplete=e.incomplete),t(e.options)}else console.error(`Failed to fetch from ${this.endpoint} (status=${i.status})`)}};export{p as a};
