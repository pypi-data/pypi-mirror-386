var n=class{constructor(e){this.messages=new Map;var i,a;this.fieldElement=e;let t=e.closest('[role="group"]'),r=Array.from((t==null?void 0:t.querySelectorAll('[role="alert"]'))??[]).find(o=>o.closest('[role="group"]')===t)??null,s=r==null?void 0:r.querySelector('meta[name="error-messages"]');if(s)for(let o of s.getAttributeNames()){let f=o.replace(/([_][a-z])/g,p=>p.toUpperCase().replace("_","")),d=s.getAttribute(o);d&&this.messages.set(f,d)}this.groupClassList=(t==null?void 0:t.classList)??new DOMTokenList;let l=r==null?void 0:r.querySelector(".dj-errorlist > .dj-placeholder");if(!l)throw new Error(`${e} requires a sibling element with role="alert" and an error placeholder`);this.placeholder=l,this.showFeedback=!((a=(i=e.closest("django-formset"))==null?void 0:i.getAttribute("withhold-feedback"))!=null&&a.split(" ").map(o=>o.toLowerCase()).includes("messages"))}get showMessage(){return this.showFeedback&&(this.groupClassList.contains("dj-submitted")||this.groupClassList.contains("dj-touched"))}get showsError(){return this.placeholder.innerHTML.length!==0}reportValidationError(){if(!this.fieldElement.validity.valid){if(this.showMessage){for(let[e,t]of this.messages.entries())if(e==="tooShort"&&(this.fieldElement.type==="text"||this.fieldElement instanceof HTMLTextAreaElement)){if(this.fieldElement.minLength>0&&this.fieldElement.value.length<this.fieldElement.minLength){this.placeholder.innerHTML=t??gettext("Entered text is too short.");break}}else if(e==="tooLong"&&(this.fieldElement.type==="text"||this.fieldElement instanceof HTMLTextAreaElement)){if(this.fieldElement.maxLength>0&&this.fieldElement.value.length>this.fieldElement.maxLength){this.placeholder.innerHTML=t??gettext("Entered text is too long.");break}}else if(this.fieldElement.validity[e]){this.placeholder.innerHTML=t;break}}else this.placeholder.innerHTML="";return!1}return this.placeholder.innerHTML="",this.fieldElement.setCustomValidity(""),!0}reportCustomError(e){return e=this.messages.get("customError")??e,this.fieldElement.setCustomValidity(e),this.showMessage&&(this.placeholder.innerHTML=e),!1}clearError(){this.placeholder.innerHTML="",this.fieldElement.setCustomValidity("")}getMessage(e){return this.messages.get(e)}},h=class{constructor(e){let t=e.closest('[role="group"]'),r=e.form,s=e.closest("django-formset");if(!t||!r||!s)throw new Error(`Attempt to initialize ${e} outside <django-formset>`);let l=r.getAttribute("name")??"__default__";this.fieldGroup=t,this.errorPlaceholder=new n(e),this.endpoint=s.getAttribute("endpoint"),this.fieldName=`${l}.${e.getAttribute("name")}`,r.addEventListener("reset",i=>this.formResetted(i)),r.addEventListener("submitted",i=>this.formSubmitted(i))}};export{n as a,h as b};
