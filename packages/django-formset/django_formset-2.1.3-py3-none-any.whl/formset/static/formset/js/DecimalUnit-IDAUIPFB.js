import{b}from"./chunk-74KQCU7Q.js";import{a as o}from"./chunk-362Q4FKW.js";import"./chunk-JC2BH436.js";var x="[is^=django-decimal-unit]{--dummy-style: none}[is^=django-decimal-unit]::-webkit-outer-spin-button,[is^=django-decimal-unit]::-webkit-inner-spin-button{-webkit-appearance:none}[is^=django-decimal-unit]+[role=textbox]{display:flex !important;align-items:center;flex-wrap:nowrap;justify-content:flex-start;border:var(--border-width) var(--border-style) var(--border-color);border-radius:var(--border-radius)}[is^=django-decimal-unit]+[role=textbox].focus{--dummy-style: none}[is^=django-decimal-unit]+[role=textbox] .decimal-unit-edit{display:flex;flex-wrap:nowrap;width:calc(100% - 2.5em)}[is^=django-decimal-unit]+[role=textbox] .decimal-unit-edit [contenteditable=true]{cursor:text;overflow-x:hidden;text-wrap:nowrap;min-width:2em;flex-grow:1}[is^=django-decimal-unit]+[role=textbox] .decimal-unit-edit [contenteditable=true]:focus-visible{outline:none}[is^=django-decimal-unit]+[role=textbox] .decimal-unit-edit .prefix{color:color-mix(in srgb, currentcolor, var(--django-formset-background-color) 30%);margin-right:.5rem}[is^=django-decimal-unit]+[role=textbox] .decimal-unit-edit .suffix{color:color-mix(in srgb, currentcolor, var(--django-formset-background-color) 30%);margin-left:.5rem}";var u=class u extends b{constructor(e){super(e);this.baseSelector='[is^="django-decimal-unit"]';this.hasFocus=!1;this.separator="\u205F";this.handleMousedown=e=>{e.target instanceof HTMLElement&&e.target.closest('[role="textbox"]')===this.textBox?e.target===this.editField?this.hasFocus=!0:requestIdleCallback(()=>{let t=this.hasFocus;this.hasFocus=!1,this.editField.focus(),this.setCaretPosition(Number.MAX_SAFE_INTEGER),this.hasFocus=!0,t||this.editField.dispatchEvent(new Event("focus"))}):this.hasFocus=!1};this.handleFocus=e=>{this.hasFocus&&(this.textBox.classList.add("focus"),this.inputElement.dispatchEvent(new Event("focus")),this.hasFocus=!0,e.preventDefault())};this.handleBlur=e=>{this.hasFocus||(this.padDecimalPart(),this.updateInputValue(),this.inputElement.checkValidity(),this.textBox.classList.remove("focus"),requestIdleCallback(()=>{this.inputElement.dispatchEvent(new Event("blur"))}),this.hasFocus=!1)};this.handleCopy=e=>{var t;(t=e.clipboardData)==null||t.setData("text/plain",this.inputElement.value),e.preventDefault()};this.handleCut=e=>{var t;(t=e.clipboardData)==null||t.setData("text/plain",this.inputElement.value),this.inputElement.value=this.editField.innerText="",this.inputted(),e.preventDefault()};this.handlePaste=e=>{requestIdleCallback(()=>{this.updateInputValue(!0),this.setCaretPosition(Number.MAX_SAFE_INTEGER),this.inputted()})};this.handleKeypress=e=>{let t=!1;if(this.hasFocus){let i=this.getCaretPosition(),s=this.getReversePosition();if(["ArrowUp","ArrowDown"].includes(e.key)){if(this.inputElement.value.length&&this.canStep){let n=i===this.editField.innerText.length;e.key==="ArrowUp"?this.inputElement.stepUp():this.inputElement.stepDown();let l=parseFloat(this.inputElement.value);this.editField.innerText=String(Math.min(Math.max(l,this.minValue),this.maxValue)),this.padDecimalPart(),this.updateInputValue(),this.setCaretPosition(n?Number.MAX_SAFE_INTEGER:i),this.inputted()}t=!0}else if(e.key==="ArrowRight")!e.shiftKey&&s>1&&s%(this.blockLength+1)===1&&this.setCaretPosition(i+1);else if(e.key==="ArrowLeft")!e.shiftKey&&s%(this.blockLength+1)===this.blockLength&&this.setCaretPosition(i-1);else if(e.key==="Backspace"){s%(this.blockLength+1)===this.blockLength&&this.setCaretPosition(i-1);let n=this.editField.innerText.replace(",",".").endsWith(".");requestIdleCallback(()=>{this.updateInputValue(n?void 0:!0),this.inputted()})}else e.key==="Delete"?requestIdleCallback(()=>{this.updateInputValue(!1),this.inputted()}):e.key>="0"&&e.key<="9"||this.decimalPlaces>0&&[".",","].includes(e.key)?requestIdleCallback(()=>{this.updateInputValue(!0),this.inputted()}):e.key==="-"?this.minValue<0&&i===0?requestIdleCallback(()=>{this.updateInputValue(!0),this.inputted()}):t=!0:["c","v","x","z"].includes(e.key)?!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&(t=!0):(e.key==="Unidentified"&&requestIdleCallback(()=>this.inputted()),t=!0)}t&&e.preventDefault()};this.inputElement=e,this.textBox=this.createTextBox(),this.editField=this.textBox.querySelector('span[contenteditable="true"]'),this.maxDigits=parseInt(e.getAttribute("max-digits")??""),this.decimalPlaces=parseInt(e.getAttribute("decimal-places")??"0"),this.canStep=parseFloat(e.step)>0,this.minValue=e.min?parseFloat(e.min):Number.MIN_SAFE_INTEGER,this.maxValue=e.max?parseFloat(e.max):Number.MAX_SAFE_INTEGER,this.fixedDecimalPlaces=e.hasAttribute("fixed-decimal-places"),this.blockLength=parseInt(e.getAttribute("block-length")??"3"),this.styleSheet=o.stylesAreInstalled(this.baseSelector)??this.transferStyles();let t=new Intl.NumberFormat(navigator.language);this.decSep=t.format(1.1)[1]}createTextBox(){let e=this.inputElement.getAttribute("prefix"),t=this.inputElement.getAttribute("suffix"),i=['<div role="textbox">','<div class="decimal-unit-edit">'];return e&&i.push(`<span class="prefix">${e}</span>`),i.push('<span contenteditable="true"></span>'),t&&i.push(`<span class="suffix">${t}</span>`),i.push("</div>"),i.push("</div>"),this.inputElement.insertAdjacentHTML("afterend",i.join("")),this.inputElement.nextElementSibling}getCaretPosition(){let e=window.getSelection();return e&&e.rangeCount===1?e.getRangeAt(0).startOffset:0}getReversePosition(){let e=this.getCaretPosition(),[t]=this.editField.innerText.replace(",",".").split(".");return Math.max(t.length-e,0)}setCaretPosition(e){let t=document.createRange(),i=window.getSelection();if(!this.editField.childNodes.length||!i)return;let s=this.editField.childNodes[0];e=Math.max(0,Math.min(e,s.length)),t.setStart(s,e),i.removeAllRanges(),i.addRange(t)}padDecimalPart(){if(!this.fixedDecimalPlaces||this.editField.innerText.length===0)return;let[e,t]=this.editField.innerText.replace(",",".").split("."),i=t?t.slice(0,this.decimalPlaces).padEnd(this.decimalPlaces,"0"):"0".repeat(this.decimalPlaces);this.editField.innerText=`${e}${this.decSep}${i}`}updateInputValue(e){let t=this.getCaretPosition(),i=this.editField.innerText.startsWith("-")?"-":"",[s,n]=this.editField.innerText.replace(",",".").split(".").map(a=>a.replace(u.numberRegex,"")),l=isFinite(this.maxDigits)?Math.min(this.maxDigits-this.decimalPlaces,s.length):s.length,d=Array();for(let a=l;a>=0;a-=this.blockLength){let f=s.slice(Math.max(0,a-this.blockLength),a);f.length>0&&d.unshift(f)}let c=d.join(this.separator),r=(()=>{if(n===void 0)return null;if(n.length===0)return"";if(this.fixedDecimalPlaces&&n.length>this.decimalPlaces)return n.slice(0,this.decimalPlaces);let a=Math.min(this.decimalPlaces,n.length);return parseFloat(`.${n}`).toFixed(this.decimalPlaces).slice(2,2+a)})();this.editField.innerText=`${i}${c}${r!==null?`${this.decSep}${r}`:""}`;let m=this.inputElement.value.indexOf(".");if(e!==void 0&&t<=c.length&&(m===-1&&r===null||m>=0&&r!==null)){e===!0&&t>this.blockLength&&d[0].length===1?t++:e===!1&&d.length&&d[0].length===3&&t--;let a=c.length+(i?1:0);t<a&&(a-t)%(this.blockLength+1)===0&&t++}this.hasFocus&&this.setCaretPosition(t),this.inputElement.value=`${i}${s}${r?`.${r}`:""}`}inputted(){this.inputElement.dispatchEvent(new Event("input"))}transferStyles(){let e=document.createElement("style");e.innerText=x,document.head.appendChild(e),this.inputElement.style.transition="none";let t=!1;for(let i=0;e.sheet&&i<e.sheet.cssRules.length;i++){let n=e.sheet.cssRules.item(i).selectorText.trim(),l="";switch(n){case this.baseSelector:t=!0;break;case`${this.baseSelector} + [role="textbox"]`:l=o.extractStyles(this.inputElement,["height","line-height","padding"]).concat(o.extractStyles(this.inputElement,{"--border-style":"border-style","--border-width":"border-width","--border-radius":"border-radius"}));break;default:break}l&&e.sheet.insertRule(`${n}{${l}}`,++i)}if(this.inputElement.style.transition="",!t)throw new Error(`Could not load styles for ${this.baseSelector}`);return e.sheet}formResetted(e){this.inputElement.value=this.inputElement.defaultValue,this.editField.innerText=this.inputElement.value,this.padDecimalPart(),this.updateInputValue()}formSubmitted(e){}connect(){o.pushMediaQueryStyles(this.styleSheet,`${this.baseSelector} + [role="textbox"]`,{"--border-color":"border-color","--outline":"outline"},this.inputElement),o.pushMediaQueryStyles(this.styleSheet,`${this.baseSelector} + [role="textbox"].focus`,{"border-color":"border-color","box-shadow":"box-shadow",outline:"outline"},this.inputElement,"\u205Dfocus"),this.inputElement.hidden=!0,this.inputElement.addEventListener("reset",this.formResetted),this.editField.addEventListener("focus",this.handleFocus),this.editField.addEventListener("blur",this.handleBlur),this.editField.addEventListener("copy",this.handleCopy),this.editField.addEventListener("cut",this.handleCut),this.editField.addEventListener("paste",this.handlePaste),document.addEventListener("mousedown",this.handleMousedown),document.addEventListener("keydown",this.handleKeypress),this.editField.innerText=this.inputElement.value,this.padDecimalPart(),this.updateInputValue()}disconnect(){this.inputElement.removeEventListener("reset",this.formResetted),this.editField.removeEventListener("focus",this.handleFocus),this.editField.removeEventListener("blur",this.handleBlur),this.editField.removeEventListener("copy",this.handleCopy),this.editField.removeEventListener("cut",this.handleCut),this.editField.removeEventListener("paste",this.handlePaste),document.removeEventListener("mousedown",this.handleMousedown),document.removeEventListener("keydown",this.handleKeypress)}};u.numberRegex=new RegExp("[^0-9]","g");var p=u,h=Symbol("DecimalUnit"),v,g=class extends(v=HTMLInputElement,h,v){constructor(){if(super(),!this.closest('[role="group"]'))throw new Error(`Attempt to initialize ${this} outside <django-formset>`);this[h]=new p(this)}connectedCallback(){this[h].connect()}disconnectedCallback(){this[h].disconnect()}checkValidity(){return!!super.checkValidity()}};export{g as DecimalUnitElement};
