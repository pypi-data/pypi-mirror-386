import{_ as P,u as U,r as u,s as N,l as _,h as a,w as d,b as l,f as t,A as X,E as Y,e as C,t as g,M as Z,c as y,F as L,y as S,x as I,ax as ee,az as V,g as M,o as ae,P as z,L as le,I as te,aA as se}from"./index-EAoLIsub.js";import{E as oe}from"./row-DpybHHLA.js";import{E as ne}from"./col-nJhYxTwp.js";import{E as re,a as F,b as R}from"./pagination-CmCi1k6m.js";import"./select-BGUbeR3r.js";import{E as ue}from"./empty-SBsui6Nw.js";import{E as T}from"./card-DLg-oC7z.js";import{E as de,a as ie}from"./collapse-item-BMOAqRlj.js";import"./raf-DxFQnGI-.js";const ce={class:"button-toolbar"},pe={class:"editor-area"},_e={class:"history"},ve=["onClick"],me={class:"pagination-wrapper"},fe={class:"result-area"},be={key:0,class:"error"},ge={key:1,class:"affected-rows"},ye={key:3},he={class:"table-wrapper"},we={class:"pagination-wrapper"},Ee={__name:"SQLConsole",setup(q){const{t:c}=U(),i=u(""),f=u(!1),s=u([]),p=u(""),n=u(null),o=u([]),b=u(1),w=u(1),E=u(5),k=u(10),h=u(!1),v=N(()=>{const e=(w.value-1)*k.value;return s.value.slice(e,e+k.value)}),D=N(()=>{const e=(b.value-1)*E.value;return o.value.slice(e,e+E.value)}),A=async()=>{if(i.value){s.value=[],p.value="",n.value=null,f.value=!1,o.value.unshift(i.value),h.value=!0;try{const e=await V.post("/api/database/exec",{sql:i.value});f.value=!0,e.data.success?(e.data.affected_rows!==void 0?n.value=e.data.affected_rows:s.value=e.data.data||[],p.value=""):(s.value=[],p.value=e.data.error)}catch(e){M.error(c("message.error.fetch")+e.message)}finally{h.value=!1}}},H=()=>{i.value="",s.value=[],p.value="",f.value=!1,w.value=1},J=e=>{i.value=e};return(e,r)=>{const B=Y,K=Z,Q=re,$=T,O=ue,j=R,G=F,W=ee;return a(),_($,{class:"sql-console",shadow:"never"},{default:d(()=>[l("div",ce,[t(B,{type:"primary",size:"small",disabled:h.value,onClick:A},{default:d(()=>[r[3]||(r[3]=l("i",{class:"mdi mdi-console-line"},null,-1)),C(" "+g(e.$t("database.button.execute")),1)]),_:1},8,["disabled"]),t(B,{size:"small",disabled:h.value,onClick:H},{default:d(()=>[r[4]||(r[4]=l("i",{class:"mdi mdi-restart"},null,-1)),C(" "+g(e.$t("database.button.clear")),1)]),_:1},8,["disabled"])]),t($,{class:"editor-card",shadow:"never"},{default:d(()=>[l("div",pe,[t(K,{type:"textarea",modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=m=>i.value=m),placeholder:e.$t("database.input.sql"),resize:"none",rows:"9",class:"sql-input"},null,8,["modelValue","placeholder"]),t($,{class:"history-area",shadow:"never"},{default:d(()=>[l("span",null,[r[5]||(r[5]=l("i",{class:"mdi mdi-history"},null,-1)),C(" "+g(e.$t("database.sql.history.title")),1)]),l("div",_e,[(a(!0),y(L,null,S(D.value,(m,x)=>(a(),y("div",{key:x,class:"history-item",onClick:Le=>J(m)},g(m),9,ve))),128))]),l("div",me,[o.value.length>E.value?(a(),_(Q,{key:0,layout:"prev, pager, next","page-size":E.value,total:o.value.length,"current-page":b.value,"onUpdate:currentPage":r[1]||(r[1]=m=>b.value=m)},null,8,["page-size","total","current-page"])):I("",!0)])]),_:1})])]),_:1}),X((a(),_($,{class:"result-card",shadow:"never"},{default:d(()=>[l("h3",null,[r[6]||(r[6]=l("i",{class:"mdi mdi-console-line"},null,-1)),C(" "+g(e.$t("database.sql.result.title")),1)]),l("div",fe,[p.value?(a(),y("div",be,g(p.value),1)):n.value!==null?(a(),y("div",ge," ("+g(n.value)+" row(s) affected) ",1)):f.value&&!s.value.length?(a(),_(O,{key:2})):(a(),y("div",ye,[l("div",he,[s.value.length?(a(),_(G,{key:0,data:v.value,stripe:"",width:"100%"},{default:d(()=>[(a(!0),y(L,null,S(s.value[0],(m,x)=>(a(),_(j,{key:x,prop:x,label:x},null,8,["prop","label"]))),128))]),_:1},8,["data"])):I("",!0)]),l("div",we,[s.value.length>k.value?(a(),_(Q,{key:0,background:"",layout:"prev, pager, next","page-size":k.value,total:s.value.length,style:{"margin-top":"20px"},"current-page":w.value,"onUpdate:currentPage":r[2]||(r[2]=m=>w.value=m)},null,8,["page-size","total","current-page"])):I("",!0)])]))])]),_:1})),[[W,h.value]])]),_:1})}}},ke=P(Ee,[["__scopeId","data-v-885d018a"]]),xe={class:"models"},Ce={__name:"DataModels",setup(q){const{t:c}=U(),i=u([]),f=u([]),s=async()=>{try{const n=await V.get("/api/database/list");i.value=n.data.model_list.map(o=>({model:o,fields:[]}))}catch(n){M.error(c("message.error.fetch")+n.message)}},p=async n=>{if(!n.fields.length)try{const o=await V.get(`/api/database/field/${n.model}`);n.fields=o.data.model_fields}catch(o){M.error(c("message.error.fetch")+o.message)}};return ae(()=>{s()}),(n,o)=>{const b=R,w=F,E=ie,k=de,h=T;return a(),_(h,{class:"data-models",shadow:"never"},{default:d(()=>[l("h3",null,[o[1]||(o[1]=l("i",{class:"mdi mdi-database"},null,-1)),C(" "+g(n.$t("database.models.title")),1)]),l("div",xe,[t(k,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=v=>f.value=v),accordion:"",style:{width:"100%"}},{default:d(()=>[(a(!0),y(L,null,S(i.value,v=>(a(),_(E,{key:v.model,title:v.model,name:v.model,onClick:D=>p(v)},{default:d(()=>[t(w,{data:v.fields,size:"small",style:{width:"100%"}},{default:d(()=>[t(b,{prop:"name",label:z(c)("database.models.label.name")},null,8,["label"]),t(b,{prop:"type",label:z(c)("database.models.label.type")},null,8,["label"]),t(b,{prop:"max_length",label:z(c)("database.models.label.max_length")},null,8,["label"]),t(b,{prop:"nullable",label:z(c)("database.models.label.nullable")},null,8,["label"])]),_:1},8,["data"])]),_:2},1032,["title","name","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1})}}},$e=P(Ce,[["__scopeId","data-v-dfadf935"]]),ze={key:0},Ie={__name:"database",setup(q){const c=u(le.getItem("isDevelopMode")==="true"&&!te);return(i,f)=>{const s=ne,p=oe;return c.value?(a(),y("div",ze,[t(p,{gutter:"24"},{default:d(()=>[t(s,{span:6,xs:24},{default:d(()=>[t($e)]),_:1}),t(s,{span:18,xs:24},{default:d(()=>[t(ke)]),_:1})]),_:1})])):(a(),_(se,{key:1}))}}},Ue=P(Ie,[["__scopeId","data-v-c9596b30"]]);export{Ue as default};
