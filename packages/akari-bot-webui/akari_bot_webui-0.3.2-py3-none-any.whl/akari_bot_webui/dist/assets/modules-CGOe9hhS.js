import{_ as pe,u as fe,r as i,s as T,z as ge,o as ve,a as be,c as v,f as d,w as s,N as ye,L as Q,az as _,g as m,h as u,b as o,A as he,e as p,t as n,E as _e,M as $e,n as X,l as f,F as I,y as U,x as b,ax as Ce}from"./index-EAoLIsub.js";import{E as ke}from"./empty-SBsui6Nw.js";import{E as Ee,a as we}from"./collapse-item-BMOAqRlj.js";import{E as ze}from"./card-DLg-oC7z.js";import{a as Ve,b as Me,E as Be}from"./pagination-CmCi1k6m.js";import{d as De}from"./select-BGUbeR3r.js";import{E as Le}from"./col-nJhYxTwp.js";import{V as Te}from"./VisibleEditor-6nyK2fdW.js";import{E as Ie}from"./index-DNZuyxz9.js";import"./raf-DxFQnGI-.js";import"./form-item-CJs4ndtB.js";import"./index-He1HhYNy.js";import"./index-Pqe8Fa-j.js";import"./validator-WRUlNgZM.js";const Ue={class:"header-container"},Ne={class:"filter-container"},je={class:"filter-item"},Oe={style:{"margin-bottom":"15px"}},Se={class:"pagination-wrapper"},We={key:0},Pe={class:"help-code"},Fe={key:0},Re={class:"help-code"},Ae={key:0},He={class:"help-code"},qe={key:0},xe={__name:"modules",setup(Je){const{t:r}=fe(),F=i([]),V=i(""),M=i(!1),k=i(!1),B=i(!1),c=i(null),R=i(["commands","options","regexp"]),N=i(1),j=i(10),O=i("90%"),A=i(null),h=i(!1),E=i(""),$=i(""),D=i(""),w=i(!1),L=i(!1),H=T(()=>{let l=F.value;return V.value&&(l=l.filter(e=>e.bind_prefix.toLowerCase().includes(V.value.toLowerCase()))),k.value||(l=l.filter(e=>!e.base)),l}),Y=T(()=>{const l=(N.value-1)*j.value,e=l+j.value;return H.value.slice(l,e)}),q=T(()=>H.value.length),Z=T(()=>c.value?.desc||c.value?.commands?.args?.length>0||c.value?.commands?.options?.length>0||c.value?.regexp?.length>0);ge($,l=>{w.value=l!==D.value});const y=async()=>{M.value=!0;try{const l=Q.getItem("language")||"zh_cn",e=await _.get("/api/modules",{params:{locale:l}});e.status===200&&e.data.modules&&(F.value=Object.entries(e.data.modules).map(([t,g])=>{const W=g?._db_load!==!1;return{name:t,bind_prefix:g?.bind_prefix||t,desc:g?.desc||"",developers:g?.developers||[],loaded:W,base:g?.base===!0,...g}}).sort((t,g)=>t.name.localeCompare(g.name)))}catch(l){m.error(r("message.error.fetch")+l.message)}finally{M.value=!1}},ee=()=>{clearTimeout(A.value),A.value=setTimeout(()=>y(),300)},le=async l=>{try{return(await _.get(`/api/module/${l}/related`)).data.modules||[]}catch(e){return m.error(r("message.error.fetch")+e.message),[]}},ae=async l=>{try{const e=Q.getItem("language")||"zh_cn",t=await _.get(`/api/module/${l.name}/helpdoc`,{params:{locale:e}});t.status===200&&(c.value=t.data,B.value=!0)}catch(e){m.error(r("message.error.fetch")+e.message)}},se=async l=>{let e="";if(l.base)e=r("modules.confirm.message.reload.base");else{const t=await le(l.name);t.length===0?e=r("modules.confirm.message.reload"):e=r("modules.confirm.message.reload.extra",{modules:t.map(g=>r("format.quote",{msg:g})).join(r("format.delimiter"))})}try{await Ie.confirm(e,r("confirm.warning"),{confirmButtonText:r("button.confirm"),cancelButtonText:r("button.cancel"),type:"warning"}),(await _.post(`/api/module/${l.name}/reload`)).status===204&&(m.success(r("modules.message.reload.success")),y())}catch(t){if(t==="cancel"||t?.message==="cancel")return;t.response?.status===422?(m.error(r("modules.message.reload.error.failed")),y()):m.error(r("message.error.fetch")+t.message)}},te=async l=>{try{(await _.post(`/api/module/${l.name}/unload`)).status===204&&(m.success(r("modules.message.unload.success")),y())}catch(e){e.response?.status===422?(m.error(r("modules.message.unload.error.failed")),y()):m.error(r("message.error.fetch")+e.message)}},oe=async l=>{try{(await _.post(`/api/module/${l.name}/load`)).status===204&&(m.success(r("modules.message.load.success")),y())}catch(e){e.response?.status===422?(m.error(r("modules.message.load.error.failed")),y()):m.error(r("message.error.fetch")+e.message)}},S=()=>{const l=window.innerWidth;if(l<1024)O.value="90%";else{const e=l*.9-400;O.value=`${e}px`}},ne=async l=>{E.value=l._py_module_name,h.value=!0,w.value=!1,L.value=!1;try{const e=await _.get(`/api/config/module_${E.value}.toml`);$.value=e.data.content,D.value=e.data.content}catch(e){e.response?.status===404?L.value=!0:(m.error(r("message.error.fetch")+e.message),h.value=!1)}},ue=async()=>{try{await _.put(`/api/config/module_${E.value}.toml`,{content:$.value}),m.success(r("config.message.save.success")),D.value=$.value,w.value=!1,h.value=!1}catch(l){m.error(r("message.error.fetch")+l.message)}},re=()=>{h.value=!1,E.value="",$.value="",D.value="",w.value=!1,L.value=!1};return ve(()=>{y(),window.addEventListener("resize",S),S()}),be(()=>{window.removeEventListener("resize",S)}),(l,e)=>{const t=_e,g=$e,W=Le,z=Me,x=De,de=Ve,ie=Be,J=ze,P=we,me=Ee,K=ke,G=ye,ce=Ce;return u(),v("div",null,[d(J,{class:"module-card",shadow:"never"},{default:s(()=>[o("div",Ue,[o("h3",null,[e[9]||(e[9]=o("i",{class:"mdi mdi-puzzle"},null,-1)),p(" "+n(l.$t("modules.title")),1)]),d(t,{onClick:y,type:"primary",size:"small",disabled:M.value,style:{float:"right","margin-left":"10px"}},{default:s(()=>[e[10]||(e[10]=o("i",{class:"mdi mdi-refresh"},null,-1)),p(" "+n(l.$t("button.refresh")),1)]),_:1},8,["disabled"])]),o("div",Ne,[d(W,{span:6},{default:s(()=>[o("div",je,[d(g,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),placeholder:l.$t("modules.input.module_name"),clearable:"",onInput:ee,"prefix-icon":l.Search},{prefix:s(()=>[...e[11]||(e[11]=[o("i",{class:"mdi mdi-magnify"},null,-1)])]),_:1},8,["modelValue","placeholder","prefix-icon"])])]),_:1})]),o("div",Oe,[d(t,{type:"info",size:"small",onClick:e[1]||(e[1]=a=>k.value=!k.value)},{default:s(()=>[o("i",{class:X(k.value?"mdi mdi-eye-off-outline":"mdi mdi-eye-outline")},null,2),p(" "+n(k.value?l.$t("modules.button.hide_base"):l.$t("modules.button.show_base")),1)]),_:1})]),he((u(),f(de,{data:Y.value,style:{width:"100%"},stripe:""},{default:s(()=>[d(z,{label:l.$t("modules.table.name"),"min-width":"140"},{default:s(({row:a})=>[o("span",{class:X({unloaded:!a.loaded})},n(a.bind_prefix),3)]),_:1},8,["label"]),d(z,{label:l.$t("modules.table.desc"),"min-width":"800"},{default:s(({row:a})=>[p(n(a.desc||"-"),1)]),_:1},8,["label"]),d(z,{label:l.$t("modules.table.developers"),"min-width":"400"},{default:s(({row:a})=>[(u(!0),v(I,null,U(a.developers,C=>(u(),f(x,{key:C,type:"info",style:{margin:"2px"}},{default:s(()=>[p(n(C),1)]),_:2},1024))),128))]),_:1},8,["label"]),d(z,{label:l.$t("session.table.status"),"min-width":"100"},{default:s(({row:a})=>[d(x,{type:a.base?"warning":a.loaded?"success":"danger"},{default:s(()=>[p(n(a.base?l.$t("modules.tag.base"):a.loaded?l.$t("modules.tag.loaded"):l.$t("modules.tag.unloaded")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),d(z,{label:l.$t("table.operation"),"min-width":"420"},{default:s(({row:a})=>[d(t,{size:"small",type:"info",onClick:C=>ae(a)},{default:s(()=>[e[12]||(e[12]=o("i",{class:"mdi mdi-help-circle-outline"},null,-1)),p(" "+n(l.$t("modules.button.helpdoc")),1)]),_:1},8,["onClick"]),a.base?b("",!0):(u(),f(t,{key:0,size:"small",type:"primary",onClick:C=>ne(a)},{default:s(()=>[e[13]||(e[13]=o("i",{class:"mdi mdi-cog"},null,-1)),p(" "+n(l.$t("modules.button.config")),1)]),_:1},8,["onClick"])),!a.base&&a.loaded?(u(),f(t,{key:1,size:"small",type:"warning",onClick:C=>te(a)},{default:s(()=>[e[14]||(e[14]=o("i",{class:"mdi mdi-puzzle-remove"},null,-1)),p(" "+n(l.$t("modules.button.unload")),1)]),_:1},8,["onClick"])):b("",!0),!a.base&&!a.loaded?(u(),f(t,{key:2,size:"small",type:"success",onClick:C=>oe(a)},{default:s(()=>[e[15]||(e[15]=o("i",{class:"mdi mdi-puzzle-plus"},null,-1)),p(" "+n(l.$t("modules.button.load")),1)]),_:1},8,["onClick"])):b("",!0),d(t,{size:"small",type:"danger",onClick:C=>se(a)},{default:s(()=>[e[16]||(e[16]=o("i",{class:"mdi mdi-reload"},null,-1)),p(" "+n(l.$t("modules.button.reload")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ce,M.value]]),o("div",Se,[q.value>0?(u(),f(ie,{key:0,background:"",layout:"prev, pager, next","current-page":N.value,"onUpdate:currentPage":e[2]||(e[2]=a=>N.value=a),"page-size":j.value,total:q.value,style:{"margin-top":"20px"},onCurrentChange:l.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])):b("",!0)])]),_:1}),d(G,{modelValue:B.value,"onUpdate:modelValue":e[5]||(e[5]=a=>B.value=a),title:l.$t("modules.helpdoc.title",{module:c.value?.module_name}),width:"600px"},{footer:s(()=>[d(t,{onClick:e[4]||(e[4]=a=>B.value=!1)},{default:s(()=>[p(n(l.$t("button.close")),1)]),_:1})]),default:s(()=>[c.value?(u(),v("div",We,[Z.value?(u(),f(me,{key:0,modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=a=>R.value=a)},{title:s(()=>[o("b",null,n(l.$t("modules.helpdoc.subtitle.desc")),1)]),default:s(()=>[o("p",null,n(c.value.desc),1),c.value.commands?.args?.length?(u(),f(P,{key:0,name:"commands"},{title:s(()=>[o("b",null,n(l.$t("modules.helpdoc.subtitle.command")),1)]),default:s(()=>[o("ul",null,[(u(!0),v(I,null,U(c.value.commands.args,a=>(u(),v("li",{key:a.args},[o("code",Pe,n(a.args),1),a.desc?(u(),v("span",Fe," - "+n(a.desc),1)):b("",!0)]))),128))])]),_:1})):b("",!0),c.value.commands?.options?.length?(u(),f(P,{key:1,name:"options"},{title:s(()=>[o("b",null,n(l.$t("modules.helpdoc.subtitle.option")),1)]),default:s(()=>[o("ul",null,[(u(!0),v(I,null,U(c.value.commands.options,a=>(u(),v("li",{key:Object.keys(a)[0]},[o("code",Re,n(Object.keys(a)[0]),1),Object.values(a)[0]?(u(),v("span",Ae," - "+n(Object.values(a)[0]),1)):b("",!0)]))),128))])]),_:1})):b("",!0),c.value.regexp?.length?(u(),f(P,{key:2,name:"regexp"},{title:s(()=>[o("b",null,n(l.$t("modules.helpdoc.subtitle.regex")),1)]),default:s(()=>[o("ul",null,[(u(!0),v(I,null,U(c.value.regexp,a=>(u(),v("li",{key:a.pattern},[o("code",He,n(a.pattern),1),a.desc?(u(),v("span",qe," - "+n(a.desc),1)):b("",!0)]))),128))])]),_:1})):b("",!0)]),_:1},8,["modelValue"])):(u(),f(K,{key:1,description:l.$t("modules.helpdoc.none")},null,8,["description"]))])):b("",!0)]),_:1},8,["modelValue","title"]),d(G,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),title:l.$t("modules.config.title",{module:E.value}),width:O.value,"close-on-press-escape":!1,"close-on-click-modal":!1,onClose:re},{footer:s(()=>[d(t,{onClick:e[7]||(e[7]=a=>h.value=!1)},{default:s(()=>[p(n(l.$t("button.cancel")),1)]),_:1}),d(t,{type:"primary",onClick:ue,disabled:!w.value},{default:s(()=>[p(n(l.$t("button.apply")),1)]),_:1},8,["disabled"])]),default:s(()=>[L.value?(u(),f(J,{key:0,shadow:"never"},{default:s(()=>[d(K,{description:l.$t("modules.config.none")},null,8,["description"])]),_:1})):h.value?(u(),f(Te,{key:1,modelValue:$.value,"onUpdate:modelValue":e[6]||(e[6]=a=>$.value=a),ref:"visibleEditor"},null,8,["modelValue"])):b("",!0)]),_:1},8,["modelValue","title","width"])])}}},rl=pe(xe,[["__scopeId","data-v-32964697"]]);export{rl as default};
