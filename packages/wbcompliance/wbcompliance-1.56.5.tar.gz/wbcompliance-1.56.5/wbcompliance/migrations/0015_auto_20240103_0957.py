# Generated by Django 4.2.8 on 2024-01-03 08:57

from contextlib import suppress

from django.apps import apps
from django.contrib.contenttypes.models import ContentType
from django.db import migrations


def migrate_content_type(apps, schema_editor):
    RiskIncident = apps.get_model("wbcompliance", "RiskIncident")

    for model_name in [
        "Classification",
        "Instrument",
        "ClassificationGroup",
        "Deal",
        "Exchange",
        "InstrumentClassificationRelatedInstrument",
        "InstrumentClassificationThroughModel",
        "InstrumentFavoriteGroup",
        "InstrumentList",
        "InstrumentListThroughModel",
        "InstrumentRequest",
        "RelatedInstrumentThroughModel",
        "InstrumentPrice",
    ]:
        with suppress(ContentType.DoesNotExist):
            old_ct = ContentType.objects.get(app_label="wbportfolio", model=model_name.lower())
            new_ct = ContentType.objects.get(app_label="wbfdm", model=model_name.lower())
            RiskIncident.objects.filter(breached_content_type_id=old_ct.id).update(breached_content_type_id=new_ct.id)


class Migration(migrations.Migration):
    dependencies = (
        [
            ("wbcompliance", "0014_alter_reviewcompliancetask_year"),
            ("wbfdm", "0012_instrumentprice_created_instrumentprice_modified"),
        ]
        if apps.is_installed("wbfdm")
        else [("wbcompliance", "0014_alter_reviewcompliancetask_year")]
    )
    operations = [migrations.RunPython(migrate_content_type)]
