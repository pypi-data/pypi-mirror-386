import{_ as k,j as e,b as P,c as z,r as g,M as A,F as G,K as L,w as E}from"./index-G4l7qcMm.js";import{B as F,s as O}from"./browse-Ypk-yEjt.js";import{f as T,u as w,s as U,c as W,g as $,T as H,v as I,a as j,b as v,d as V,e as R,h as B,G as D,i as K,j as Z,k as q,l as J,D as Q}from"./DataGrid-DyFuY0s8.js";import"./toPropertyKey-DCwh5dYN.js";import"./FormControlLabel-Ckn-i3Sp.js";import"./Input-BJwdycW3.js";import"./Stack-Cwu0vGSf.js";import"./Tooltip-DDkR3tcv.js";import"./Checkbox-vyYUPBbX.js";const X=["className","children"],Y=s=>{const{classes:m}=s;return W({root:["toolbarContainer"]},$,m)},ee=U(H,{name:"MuiDataGrid",slot:"ToolbarContainer",shouldForwardProp:s=>s!=="ownerState"})({display:"flex",alignItems:"center",flexWrap:"wrap",gap:I.spacing(1),padding:I.spacing(.5),minHeight:"auto"}),te=T(function(m,f){const{className:c,children:o}=m,u=k(m,X),a=w(),t=Y(a);return o?e.jsx(ee,P({className:z(t.root,c),ownerState:a},u,{ref:f,children:o})):null}),se=T(function(m,f){const{slotProps:c={}}=m,o=c.button||{},u=c.tooltip||{},a=j(),t=j(),d=v(),p=w(),{columnsPanelTriggerRef:l}=V(),r=R(d,K),i=B(f,l),b=n=>{r.open&&r.openedPanelValue===D.columns?d.current.hidePreferences():d.current.showPreferences(D.columns,t,a),o.onClick?.(n)};if(p.disableColumnSelector)return null;const x=r.open&&r.panelId===t;return e.jsx(p.slots.baseTooltip,P({title:d.current.getLocaleText("toolbarColumnsLabel"),enterDelay:1e3},p.slotProps?.baseTooltip,u,{children:e.jsx(p.slots.baseButton,P({id:a,size:"small","aria-label":d.current.getLocaleText("toolbarColumnsLabel"),"aria-haspopup":"menu","aria-expanded":x,"aria-controls":x?t:void 0,startIcon:e.jsx(p.slots.columnSelectorIcon,{})},p.slotProps?.baseButton,o,{onPointerUp:n=>{r.open&&n.stopPropagation(),o.onPointerUp?.(n)},onClick:b,ref:i,children:d.current.getLocaleText("toolbarColumns")}))}))}),oe=T(function(m,f){const{slotProps:c={}}=m,o=c.button||{},u=c.tooltip||{},a=v(),t=w(),d=R(a,J),p=j(),l=j(),[r,i]=g.useState(!1),b=g.useRef(null),x=B(f,b),n=[{icon:e.jsx(t.slots.densityCompactIcon,{}),label:a.current.getLocaleText("toolbarDensityCompact"),value:"compact"},{icon:e.jsx(t.slots.densityStandardIcon,{}),label:a.current.getLocaleText("toolbarDensityStandard"),value:"standard"},{icon:e.jsx(t.slots.densityComfortableIcon,{}),label:a.current.getLocaleText("toolbarDensityComfortable"),value:"comfortable"}],y=g.useMemo(()=>{switch(d){case"compact":return e.jsx(t.slots.densityCompactIcon,{});case"comfortable":return e.jsx(t.slots.densityComfortableIcon,{});default:return e.jsx(t.slots.densityStandardIcon,{})}},[d,t]),h=C=>{i(S=>!S),o.onClick?.(C)},M=()=>{i(!1)},N=C=>{a.current.setDensity(C),i(!1)};if(t.disableDensitySelector)return null;const _=n.map((C,S)=>e.jsx(t.slots.baseMenuItem,{onClick:()=>N(C.value),selected:C.value===d,iconStart:C.icon,children:C.label},S));return e.jsxs(g.Fragment,{children:[e.jsx(t.slots.baseTooltip,P({title:a.current.getLocaleText("toolbarDensityLabel"),enterDelay:1e3},t.slotProps?.baseTooltip,u,{children:e.jsx(t.slots.baseButton,P({size:"small",startIcon:y,"aria-label":a.current.getLocaleText("toolbarDensityLabel"),"aria-haspopup":"menu","aria-expanded":r,"aria-controls":r?l:void 0,id:p},t.slotProps?.baseButton,o,{onClick:h,ref:x,children:a.current.getLocaleText("toolbarDensity")}))})),e.jsx(Z,{open:r,target:b.current,onClose:M,position:"bottom-end",children:e.jsx(t.slots.baseMenuList,{id:l,className:q.menuList,"aria-labelledby":p,autoFocusItem:r,children:_})})]})});function ne(){return e.jsxs(te,{children:[e.jsx(se,{}),e.jsx(oe,{})]})}const ae=10,le=s=>{let m=A();const f=[{field:"id",headerName:"ID",flex:1,hide:!s.defaultColumns.includes("id")}];s.columns.map(l=>f.push({field:l.field,headerName:l.header,flex:1,hide:!s.defaultColumns.includes(l.field)}));const c=g.useContext(G),[o,u]=g.useState({page:0,pageSize:ae,rows:[],loading:!1}),[a,t]=g.useState({}),[d,p]=g.useState(0);return g.useEffect(()=>{let l=!0;async function r(){let i,b;const x=new AbortController;s.columns.length===0?(b=[],i=null):(b=["metadata"],i="{"+s.columns.map(h=>`${h.field}:${h.select_metadata}`).join(",")+"}");const n=await O(c.api_url,s.segments,x.signal,b,i,o.pageSize*o.page,o.pageSize);return p(n.meta.count),n.data}return(async()=>{u(n=>({...n,loading:!0}));const i=await r(),b={};i.map(n=>(b[n.id]=n.attributes.ancestors,null));const x=i.map(n=>{const y={};return y.id=n.id,s.columns.map(h=>(y[h.field]=n.attributes.metadata[h.field],null)),y});l&&(t(b),u(n=>({...n,loading:!1,rows:x})))})(),()=>{l=!1}},[o.page,o.pageSize,s.columns,s.segments]),e.jsx(F,{sx:{my:4},children:e.jsx(L,{maxWidth:"lg",children:e.jsx(Q,{columns:f,pagination:!0,rowCount:d,...o,paginationMode:"server",pageSizeOptions:[10,30,100],onPaginationModelChange:({page:l,pageSize:r})=>{u(i=>({...i,page:l,pageSize:r}))},onRowClick:l=>{m(`/browse${a[l.id].map(function(r){return"/"+r}).join("")}/${l.id}`)},slots:{toolbar:ne},disableColumnFilter:!0,autoHeight:!0})})})},ge=s=>{const c=(g.useContext(G).specs||[]).find(a=>s.item.data.attributes.specs.includes(a.spec));let o,u;return c===void 0?(o=[],u=["id"]):(o=c.columns,u=c.default_columns),e.jsxs(L,{maxWidth:"lg",children:[e.jsx(E,{id:"table-title",variant:"h6",component:"h2",children:"Contents"}),e.jsx(le,{segments:s.segments,specs:s.item.data.attributes.specs,columns:o,defaultColumns:u})]})};export{ge as default};
