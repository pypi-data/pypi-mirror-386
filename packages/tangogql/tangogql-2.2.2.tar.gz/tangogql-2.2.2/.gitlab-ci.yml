---
stages:
  - check
  - build
  - test
  - release
  - deploy

include:
  - project: 'tango-controls/gitlab-ci-templates'
    file: 'PythonPublic.gitlab-ci.yml'
  - project: 'MaxIV/gitlab-ci-templates'
    file: 'Taranta.gitlab-ci.yml'

run-pytest:
    parallel:
      matrix:
        - PYTHON_VERSION: ["3.10", "3.11", "3.12"]

variables:
  DEPLOY_BACKEND: 'true'
  IMAGE_REPOSITORY_VAR: 'TANGOQL_ARIADNE_IMAGE_REPOSITORY'
  IMAGE_TAG_VAR: 'TANGOQL_ARIADNE_IMAGE_TAG'
  TRUSTED_PUBLISHER_ENABLED: "true"

build-image:
  stage: build
  when: manual
