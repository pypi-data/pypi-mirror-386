# AI 代理（Agent）协作指南

本文档为与本项目协作的 AI 代理提供核心准则和上下文。请在开始任何工作前仔细阅读并遵循这些指南。

## 1. 核心架构原则

**本项目采用 `客户端-守护进程` (Client-Daemon) 架构。这是绝对的技术事实，优先级高于任何过时的文档或代码注释。**

- **守护进程 (Daemon)**: 是系统的核心。它负责文件监听、解析、持久化存储（通过 SQLite）、验证和 IPC 通信。所有核心逻辑均在此处。
- **命令行工具 (CLI)**: 是一个“瘦客户端”。它仅负责将用户命令发送给守护进程并展示返回结果。CLI 本身不包含任何业务逻辑。

## 2. 真实来源 (Source of Truth)

1.  **用户是最终的真实来源**: 如果用户的陈述与代码库中的任何信息（包括代码、注释、文档）相矛盾，**必须以用户的陈述为准**。
2.  **核心设计文档**: 在没有用户直接指令的情况下，以下新规约文档是第二真实来源，它们反映了 v0.2 的最新设计：
    - `docs/spec_system.md` (系统架构)
    - `docs/terminology.md` (术语和验证框架)
    - `docs/syntax_specification.md` (语法规约)

## 3. 关键语法和约定

**这是最容易出错的地方，请务必遵守。**

- **实体声明 (Entity Declaration)**:
    - **位置**: Markdown (`.md`) 文件的 **尾部**。
    - **格式**: 一个语言类型为 `entity` 的代码块。**不是 YAML Front Matter**。
    - **示例**:
      ```
      ```entity
      id: my-entity
      type: my-type
      name: My Entity
      ```
      ```

- **文档文件命名**:
    - **通用规则**: 所有新的或被修改的文档文件名应使用 `小写字母_带下划线` 的风格 (e.g., `product_plan.md`)。
    - **特殊例外**: 本文件 (`AGENTS.md`) 具有特殊的命名模式，应予以保留，**请勿重命名**。

## 4. 工作流程

- **迭代与修正**: 与用户的协作是迭代式的。当用户指出错误时，应立即承认并修正。不要重复同样的错误。
- **文档驱动**: 在进行代码修改前，优先确保相关的设计和规约文档已经更新并与用户的意图保持一致。

---
**总结**: 你的任务是作为一名了解最新架构和约定的开发者。在行动前，请始终参考本指南以避免陷入基于过时信息的“幻觉”。