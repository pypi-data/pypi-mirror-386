(()=>{"use strict";if("function"!=typeof gettext){const e={catalog:{}};window.gettext=function(t){const s=e.catalog[t];return void 0===s?t:"string"==typeof s?s:s[0]},window.ngettext=function(t,s,a){const n=e.catalog[t];return void 0===n?1==a?t:s:n.constructor===Array?n[e.pluralidx(a)]:n},window.interpolate=function(e,t,s){return s?e.replace(/%\(\w+\)s/g,(function(e){return String(t[e.slice(2,-2)])})):e.replace(/%s/g,(function(e){return String(t.shift())}))}}function e(e){const t=e.querySelectorAll("input[required], select[required], textarea[required], input[type=file]"),s=()=>{const s=Array.from(t).every((e=>e.checkValidity()));if(e.dataset.toggle_submit)e.dataset.toggle_submit(s);else for(const t of e.querySelectorAll('[type="submit"]'))t.disabled=!s};if(t.forEach((e=>{e.addEventListener("input",s),e.addEventListener("change",s)})),e.dataset.toggle_submit)e.dataset.toggle_submit(!1);else for(const t of e.querySelectorAll('[type="submit"]'))t.disabled=!0}function t(e){const t=e.target.closest("form");if(t){for(const e of t.querySelectorAll(".aldryn-forms-required-msg, .aldryn-forms-submit-msg"))e.parentNode.removeChild(e);for(const e of t.querySelectorAll("[type=submit]"))e.disabled=!1,e.readOnly=!1}}function s(e,t){e.target.blur();for(const s of e.target.querySelectorAll("[type=submit]"))if(s.disabled=!0,s.readOnly=!0,t){const t=e.target.closest("form"),a=t&&t.dataset.message_wait?t.dataset.message_wait:gettext("Please wait. Submitting form...");s.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+a+"</div>")}}function a(e){let t=!0;for(const e of this.getElementsByClassName("form-required")){const s=e.querySelectorAll("input[type=checkbox]:checked").length;s<parseInt(e.dataset.required_min)&&(t=!1,e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-required-msg">'+interpolate(ngettext("You have to choose at least %(value)s option (chosen %(chosen)s).","You have to choose at least %(value)s options (chosen %(chosen)s)."),{value:e.dataset.required_min,chosen:s},!0)+"</div>"))}if(t)for(const e of this.querySelectorAll("[type=submit]"))e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+gettext("Please wait. Submitting form...")+"</div>");else{e.preventDefault();for(const e of this.querySelectorAll("[type=submit]"))e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+gettext("Correct the errors first, please.")+"</div>")}}function n(e,t,s){e.insertAdjacentHTML("afterend",`<ul class="messages aldryn-forms-post-message"><li class="${s}">`+t.join(`</li><li class="${s}">`)+"</ul>")}function o(e,t,s){for(const a of e.querySelectorAll("[type=submit]"))a.insertAdjacentHTML("afterend",`<ul class="messages aldryn-forms-post-message">\n                <li class="${s}">${t}</li>\n            </ul>`)}function l(e){var t=0==e?0:Math.floor(Math.log(e)/Math.log(1024));return 1*+(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}function i(e){return e.closest("."+d).querySelector("ul.upload-file-names")}function r(e){let t;try{t=e.target.closest("ul").closest("."+d).querySelector("input[type=file]")}catch(e){return void console.error(e)}e.target.closest("li").remove();const s=i(t);let a=0,n=0;for(const e of s.querySelectorAll("li"))e.classList.contains("files-limit")&&null!==t.dataset.max_files&&n<t.dataset.max_files?c(e,"files-limit"):n+=1,a+=e.file.size,e.classList.contains("file-size")&&null!==t.dataset.max_size&&a<t.dataset.max_size&&(a-=e.file.size,c(e,"file-size"));s.querySelectorAll("li.error").length||(t.setCustomValidity(""),t.value=null,t.dispatchEvent(new Event("change")))}function c(e,t){for(const s of e.querySelectorAll(".content > .error > div."+t))s.remove();if(e.classList.remove(t),!e.querySelectorAll(".content > .error > div").length){e.classList.remove("error");for(const t of e.querySelectorAll(".status img"))t.src="/static/aldryn_forms/img/attach-file.svg"}}const d="upload-files-frame";function f(e){e.classList.add("check-validity");const t=document.createElement("div");t.classList.add(d),e.classList.contains("drag-and-drop")&&t.classList.add("drag-and-drop");const s=document.createElement("div");s.classList.add("drag-and-drop"),t.appendChild(s);const a=e.closest("form");if(e.classList.contains("drag-and-drop")){const t=document.createElement("div");t.classList.add("label");const n=document.createElement("img");if(n.src=a.dataset.icon_upload?a.dataset.icon_upload:"/static/aldryn_forms/img/upload-one.svg",t.appendChild(n),e.placeholder){const s=document.createElement("h4");s.appendChild(document.createTextNode(e.placeholder)),t.appendChild(s)}let o;if(e.dataset.max_size&&e.dataset.max_files?o=interpolate(ngettext("Max. %s file with a total size of max. %s","Max. %s files with a total size of max. %s"),[e.dataset.max_files,l(e.dataset.max_size)]):e.dataset.max_size&&(o=gettext("Max. size")+" "+l(e.dataset.max_size)),o){const e=document.createElement("div");e.appendChild(document.createTextNode(o)),t.appendChild(e)}s.appendChild(t)}let n;e.nextElementSibling.classList.contains("help-text")&&(n=e.nextElementSibling,n.parentElement.removeChild(n)),e.parentNode.insertBefore(t,e),e.parentElement.removeChild(e),s.appendChild(e),n&&t.appendChild(n);const o=document.createElement("ul");o.classList.add("upload-file-names"),t.appendChild(o),a.classList.add("adjust-uploads"),e.addEventListener("change",(e=>function(e){const t=i(e),s=e.closest("form"),a=s.classList.contains("submit-by-fetch");let n=0,o=0;if(a&&e.multiple)for(const e of t.querySelectorAll("li"))n+=1,o+=e.file.size;else t.innerHTML="";const c=e.accept.length?e.accept.split(","):[],d=[],f=[],u=[],m=(t,s,a,n)=>{const o=document.createElement("div");o.classList.add(a),o.appendChild(document.createTextNode(n)),s.appendChild(o),t.classList.add("error"),t.classList.add(a),e.setCustomValidity(n)};if(e.accept.length)for(let e=0;e<c.length;e++)if("."===c[e][0])d.push(c[e]);else{const t=c[e].split("/");"*"===t[1]?u.push(t[0]):f.push(c[e])}console.log("extensions:",d),console.log("mimetypes:",f);let p=!1;for(let i=0;i<e.files.length;i++){n+=1;const g=document.createElement("li");g.file=e.files[i];const h=e.files[i].name,y=document.createElement("div");y.classList.add("status"),g.appendChild(y);const v=document.createElement("div");v.classList.add("content"),g.appendChild(v);const x=document.createElement("div");if(x.classList.add("file-name"),x.title=gettext("File size")+" "+l(e.files[i].size),x.appendChild(document.createTextNode(h)),v.appendChild(x),a){const e=document.createElement("div");e.classList.add("remove");const t=document.createElement("img");t.src=s.dataset.icon_trash?s.dataset.icon_trash:"/static/aldryn_forms/img/trash.svg",t.classList.add("trash"),t.style.cursor="pointer",t.alt=t.title=gettext("Remove file."),e.appendChild(t),g.appendChild(e),t.addEventListener("click",r)}const b=document.createElement("div");b.classList.add("error"),v.appendChild(b);let L=!0;null!==e.dataset.max_files&&n>e.dataset.max_files&&(L=!1,m(g,b,"files-limit",gettext("This file exceeds the uploaded files limit.")),p=!0);let _=!c.length;if(!_&&d){const e=h.toLowerCase().match(/\.\w+$/);null!==e&&d.includes(e[0])&&(_=!0)}if(!_&&f&&f.includes(e.files[i].type)&&(_=!0),!_&&u){const t=e.files[i].type.split("/");u.includes(t[0])&&(_=!0)}_||(L=!1,m(g,b,"file-type",gettext("The file type is not among the accpeted types."))),o+=e.files[i].size,null!==e.dataset.max_size&&o>e.dataset.max_size&&(L=!1,m(g,b,"file-size",gettext("The total size of all files has exceeded the specified limit.")));const q=document.createElement("img");if(q.src=L?s.dataset.icon_attach?s.dataset.icon_attach:"/static/aldryn_forms/img/attach-file.svg":s.dataset.icon_error?s.dataset.icon_error:"/static/aldryn_forms/img/exclamation-mark.svg",y.appendChild(q),t.appendChild(g),p)break}}(e.target)),!1)}async function u(e){!function(e){for(const t of e.querySelectorAll(".aldryn-forms-post-message"))t.remove()}(e);const t=e.classList.contains("adjust-uploads")?function(e){const t=new FormData(e),s=[];for(const e of t.entries())e[1]instanceof File&&!s.includes(e[0])&&s.push(e[0]);for(const e of s)t.delete(e);for(const a of s){const s=e.querySelector(`input[name=${a}]`);if(!s)continue;const n=s.closest("."+d);if(n)for(const e of n.querySelectorAll(".upload-file-names li"))t.append(a,e.file)}return t}(e):new FormData(e);try{const s=await fetch(e.action,{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}}),a=await s.json();if(console.log(a),"ERROR"===a.status)for(const t in a.form)if("__all__"===t){const s=e.querySelector("[type=submit]");s?n(s,a.form[t],"error"):o(e,a.form[t],"error")}else{const s=e.querySelector(`input[name="${t}"]`);s&&n(s,a.form[t],"error")}else e.dataset.run_next?document[e.dataset.run_next](e,a):o(e,a.message,"success")}catch(t){o(e,t,"error")}finally{!function(e){for(const t of e.querySelectorAll("[type=submit]"))t.disabled=!1,t.readOnly=!1;for(const t of e.querySelectorAll(".aldryn-forms-submit-msg"))t.remove()}(e)}}document.addEventListener("DOMContentLoaded",(()=>{!function(){for(const e of document.querySelectorAll("input[type=file]"))void 0!==e.dataset.enable_js&&f(e)}(),function(){for(const e of document.querySelectorAll("form.submit-by-fetch"))e.addEventListener("submit",(t=>{t.preventDefault(),u(e)}))}();for(const n of document.getElementsByTagName("form")){if(n.classList.contains("skip-disable-submit")||n.addEventListener("submit",(e=>s(e,!1))),!n.getAttribute("novalidate-checkbox-groups")){n.addEventListener("submit",a);for(const e of n.querySelectorAll(".form-required input[type=checkbox]"))e.addEventListener("click",t)}n.classList.contains("toggle-submit")&&e(n)}})),document.AldrynFormsSendData=u})();
//# sourceMappingURL=main.js.map