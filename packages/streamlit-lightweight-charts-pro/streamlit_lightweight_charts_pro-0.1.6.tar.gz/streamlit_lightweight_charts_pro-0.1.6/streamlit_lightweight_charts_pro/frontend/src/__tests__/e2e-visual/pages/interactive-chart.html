<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Chart - E2E Visual Test</title>
    <script src="https://unpkg.com/lightweight-charts@5.0.8/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; }
        #controls { margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px; }
        .control-group { margin-bottom: 10px; }
        .control-group label { display: inline-block; width: 120px; font-size: 13px; font-weight: 500; }
        button { padding: 6px 12px; margin-right: 8px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        button:hover { background: #1976D2; }
        #chart-container { width: 800px; height: 400px; }
    </style>
</head>
<body>
    <div id="controls">
        <div class="control-group">
            <label>Series Actions:</label>
            <button data-action="add-series">Add Series</button>
            <button data-action="add-series-2">Add Series 2</button>
            <button data-action="toggle-series">Toggle Visibility</button>
            <button data-action="remove-series">Remove Series</button>
        </div>
        <div class="control-group">
            <label>Zoom Actions:</label>
            <button data-action="zoom-in">Zoom In</button>
            <button data-action="zoom-out">Zoom Out</button>
            <button data-action="reset-zoom">Reset</button>
        </div>
        <div class="control-group">
            <label>Series Type:</label>
            <button data-type="line">Line</button>
            <button data-type="area">Area</button>
            <button data-type="histogram">Histogram</button>
        </div>
        <div class="control-group">
            <label>Options:</label>
            <button data-action="change-color">Change Color</button>
            <button data-action="revert-options">Revert</button>
        </div>
    </div>
    <div id="chart-container"></div>

    <script>
function runTestCase(container) {
    const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
                width: 800,
                height: 400,
                layout: { background: { color: '#FFFFFF' }, textColor: '#000000' },
                grid: { vertLines: { visible: false }, horzLines: { color: '#f0f0f0' } },
            });

            // Generate data
            const data = [];
            for (let i = 0; i < 50; i++) {
                data.push({
                    time: '2024-01-' + String(i + 1).padStart(2, '0'),
                    value: 100 + i * 0.8 + Math.sin(i / 5) * 15
                });
            }

            let currentSeries = null;
            let secondSeries = null;
            let currentType = 'line';
            let originalColor = '#2196F3';

            // Add series
            document.querySelector('[data-action="add-series"]').addEventListener('click', () => {
                if (!currentSeries) {
                    currentSeries = chart.addSeries(LightweightCharts.LineSeries);
                    currentSeries.applyOptions({ color: originalColor, lineWidth: 2 });
                    currentSeries.setData(data);
                    currentType = 'line';
                    chart.timeScale().fitContent();
                }
            });

            // Add second series
            document.querySelector('[data-action="add-series-2"]').addEventListener('click', () => {
                if (!secondSeries) {
                    const data2 = data.map(d => ({ time: d.time, value: d.value - 10 }));
                    secondSeries = chart.addSeries(LightweightCharts.LineSeries);
                    secondSeries.applyOptions({ color: '#4CAF50', lineWidth: 2 });
                    secondSeries.setData(data2);
                }
            });

            // Toggle visibility
            document.querySelector('[data-action="toggle-series"]').addEventListener('click', () => {
                if (currentSeries) {
                    const options = currentSeries.options();
                    currentSeries.applyOptions({ visible: !options.visible });
                }
            });

            // Remove series
            document.querySelector('[data-action="remove-series"]').addEventListener('click', () => {
                if (currentSeries) {
                    chart.removeSeries(currentSeries);
                    currentSeries = null;
                }
            });

            // Zoom in
            document.querySelector('[data-action="zoom-in"]').addEventListener('click', () => {
                const range = chart.timeScale().getVisibleRange();
                if (range) {
                    const mid = (range.from + range.to) / 2;
                    const span = (range.to - range.from) / 4;
                    chart.timeScale().setVisibleRange({ from: mid - span, to: mid + span });
                }
            });

            // Zoom out
            document.querySelector('[data-action="zoom-out"]').addEventListener('click', () => {
                const range = chart.timeScale().getVisibleRange();
                if (range) {
                    const mid = (range.from + range.to) / 2;
                    const span = (range.to - range.from);
                    chart.timeScale().setVisibleRange({ from: mid - span, to: mid + span });
                }
            });

            // Reset zoom
            document.querySelector('[data-action="reset-zoom"]').addEventListener('click', () => {
                chart.timeScale().fitContent();
            });

            // Switch to line
            document.querySelector('[data-type="line"]').addEventListener('click', () => {
                if (currentSeries && currentType !== 'line') {
                    chart.removeSeries(currentSeries);
                    currentSeries = chart.addSeries(LightweightCharts.LineSeries);
                    currentSeries.applyOptions({ color: originalColor, lineWidth: 2 });
                    currentSeries.setData(data);
                    currentType = 'line';
                }
            });

            // Switch to area
            document.querySelector('[data-type="area"]').addEventListener('click', () => {
                if (currentSeries && currentType !== 'area') {
                    chart.removeSeries(currentSeries);
                    currentSeries = chart.addSeries(LightweightCharts.AreaSeries);
                    currentSeries.applyOptions({
                        topColor: 'rgba(33, 150, 243, 0.5)',
                        bottomColor: 'rgba(33, 150, 243, 0.1)',
                        lineColor: originalColor,
                        lineWidth: 2
                    });
                    currentSeries.setData(data);
                    currentType = 'area';
                }
            });

            // Switch to histogram
            document.querySelector('[data-type="histogram"]').addEventListener('click', () => {
                if (currentSeries && currentType !== 'histogram') {
                    chart.removeSeries(currentSeries);
                    currentSeries = chart.addSeries(LightweightCharts.HistogramSeries);
                    currentSeries.applyOptions({ color: originalColor });
                    currentSeries.setData(data);
                    currentType = 'histogram';
                }
            });

            // Change color
            document.querySelector('[data-action="change-color"]').addEventListener('click', () => {
                if (currentSeries) {
                    currentSeries.applyOptions({ color: '#FF9800' });
                }
            });

            // Revert options
            document.querySelector('[data-action="revert-options"]').addEventListener('click', () => {
                if (currentSeries) {
                    currentSeries.applyOptions({ color: originalColor });
                }
            });

            // Start with line series
            currentSeries = chart.addSeries(LightweightCharts.LineSeries);
            currentSeries.applyOptions({ color: originalColor, lineWidth: 2 });
            currentSeries.setData(data);
            chart.timeScale().fitContent();
}
window.testCaseReady = Promise.resolve(runTestCase(document.getElementById('chart-container')));
</script>
</body>
</html>
