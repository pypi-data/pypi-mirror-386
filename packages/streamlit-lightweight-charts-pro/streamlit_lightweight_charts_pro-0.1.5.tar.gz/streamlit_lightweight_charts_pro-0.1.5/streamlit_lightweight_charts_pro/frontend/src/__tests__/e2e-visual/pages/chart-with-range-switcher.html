<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart with Range Switcher - E2E Visual Test</title>
    <script src="https://unpkg.com/lightweight-charts@5.0.8/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #ffffff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        #container { width: 840px; margin: 20px; }
        #range-controls {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 10px;
            align-items: center;
        }
        .range-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .range-btn:hover { background: #e3f2fd; border-color: #2196F3; }
        .range-btn.active { background: #2196F3; color: white; border-color: #2196F3; }
        .custom-range {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-left: auto;
        }
        .custom-range input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        .apply-btn {
            padding: 6px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .apply-btn:hover { background: #45a049; }
        #chart-container { width: 800px; height: 400px; }
    </style>
</head>
<body>
    <div id="container">
        <div id="range-controls">
            <button class="range-btn" data-range="1D">1D</button>
            <button class="range-btn active" data-range="1W">1W</button>
            <button class="range-btn" data-range="1M">1M</button>
            <button class="range-btn" data-range="3M">3M</button>
            <button class="range-btn" data-range="ALL">ALL</button>
            <div class="custom-range">
                <input type="date" data-testid="range-start" value="2024-01-01">
                <span>to</span>
                <input type="date" data-testid="range-end" value="2024-01-31">
                <button class="apply-btn" data-testid="apply-range">Apply</button>
            </div>
        </div>
        <div id="chart-container"></div>
    </div>

    <script>
function runTestCase(container) {
    const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
                width: 800,
                height: 400,
                layout: { background: { color: '#FFFFFF' }, textColor: '#000000' },
                grid: { vertLines: { visible: false }, horzLines: { color: '#f0f0f0' } },
            });

            const lineSeries = chart.addSeries(LightweightCharts.LineSeries);
            lineSeries.applyOptions({ color: '#2196F3', lineWidth: 2 });

            // Generate 90 days of data
            const allData = [];
            const startDate = new Date('2024-01-01');
            for (let i = 0; i < 90; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                allData.push({
                    time: `2024-${month}-${day}`,
                    value: 100 + i * 0.5 + Math.sin(i / 7) * 20
                });
            }

            lineSeries.setData(allData);
            chart.timeScale().fitContent();

            // Range button handlers
            const rangeButtons = document.querySelectorAll('.range-btn');
            rangeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Update active state
                    rangeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const range = btn.getAttribute('data-range');
                    let fromIndex = 0;

                    switch (range) {
                        case '1D':
                            fromIndex = allData.length - 1;
                            break;
                        case '1W':
                            fromIndex = allData.length - 7;
                            break;
                        case '1M':
                            fromIndex = allData.length - 30;
                            break;
                        case '3M':
                            fromIndex = allData.length - 90;
                            break;
                        case 'ALL':
                            fromIndex = 0;
                            break;
                    }

                    if (fromIndex < 0) fromIndex = 0;

                    chart.timeScale().setVisibleRange({
                        from: allData[fromIndex].time,
                        to: allData[allData.length - 1].time,
                    });
                });
            });

            // Custom range handler
            document.querySelector('[data-testid="apply-range"]').addEventListener('click', () => {
                const startInput = document.querySelector('[data-testid="range-start"]');
                const endInput = document.querySelector('[data-testid="range-end"]');

                const start = startInput.value;
                const end = endInput.value;

                // Find data indices
                const startData = allData.find(d => d.time >= start);
                const endData = allData.find(d => d.time >= end) || allData[allData.length - 1];

                if (startData && endData) {
                    chart.timeScale().setVisibleRange({
                        from: startData.time,
                        to: endData.time,
                    });

                    // Clear active state from buttons
                    rangeButtons.forEach(b => b.classList.remove('active'));
                }
            });

            // Set initial range to 1W
            chart.timeScale().setVisibleRange({
                from: allData[allData.length - 7].time,
                to: allData[allData.length - 1].time,
            });
}
window.testCaseReady = Promise.resolve(runTestCase(document.getElementById('chart-container')));
</script>
</body>
</html>
