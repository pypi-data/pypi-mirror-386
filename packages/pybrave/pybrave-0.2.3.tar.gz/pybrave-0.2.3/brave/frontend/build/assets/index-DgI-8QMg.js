const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-C630CivB.js","./main-CH82g4dw.js","./main-PWR3lu3V.css","./index-DqMpSPzc.js","./index-BDU4gvFg.js","./usePagination-CNS7-0k1.js","./Table-Rz-gL0vt.js","./addEventListener-DrXUXNAy.js","./index-BL_XwOQI.js","./Dropdown-B4TP4OlU.js","./index-C0dVCwMu.js","./index-B_L60N4-.js","./index-CweiUdAw.js","./UpOutlined-MKfWXv9S.js","./DeleteOutlined-CIV_DNOf.js","./index-ZaXfouA1.js","./index-BcI8WOZ3.js","./index-DOFo5PXu.js","./index-Pwpmen_B.js","./createForOfIteratorHelper-BSFJLzX3.js","./DeploymentUnitOutlined-WBguncE1.js","./UserSwitchOutlined-D2V22kEV.js","./AudioOutlined-Cdmej0V0.js","./ClearOutlined-CzC8yyS0.js","./TableOutlined-CZ_BS3k3.js","./NodeIndexOutlined-Cav4TyHH.js","./index-DTJd4Z3p.js","./RedoOutlined-DNpCn5kL.js","./UndoOutlined-BfseYVP6.js","./react-window-Bmvezp4W.js","./index-BKAfqOdf.js","./index-DjVVbTOk.js","./index-BEOOoW84.js","./index-B6FNwvkQ.js","./index-BCx1q_2Y.css","./index-DH4f004y.js","./index-6IaXHF5K.js","./index-L_EWe7Ii.js","./index-B1-7HnQ_.js","./index-BtlAu1CQ.js","./index-BXUynQ4Q.js","./index-D4N7VkC-.js","./study-page-CyTzU1IC.js","./index-Cem7jUqj.js","./callSuper-wDHXj85E.js","./index-DGWw7hz7.js","./Paired-CYeW8vca.js","./rgb-DmU_BU0N.js"])))=>i.map(i=>d[i]);
import{j as e,r as i,S as W,U as V,s as k,b as ee,v as se,c as ae,V as te,u as N,F as B,I as ne,t as y,l as x,p as ie,B as m,P as j,a as f,Q as le,k as re,d as F,M as oe,e as ce}from"./main-CH82g4dw.js";import{P as de}from"./index-egZsYIid.js";import{s as ue,r as pe}from"./index-DH4f004y.js";import{E as me}from"./index-BtlAu1CQ.js";import{I as je}from"./index-BDU4gvFg.js";import{u as ye}from"./usePagination-CNS7-0k1.js";import{A as xe}from"./panel-DJNmOhc6.js";import{C as _e}from"./index-ZaXfouA1.js";import{F as he,S as O,D as fe}from"./Table-Rz-gL0vt.js";import{P as ge}from"./index-C0dVCwMu.js";import{R as be}from"./RedoOutlined-DNpCn5kL.js";import{d as ke}from"./index-BcI8WOZ3.js";const ve=i.lazy(()=>V(()=>import("./index-C630CivB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]),import.meta.url)),Pe=({params:o,visible:l,onClose:d,callback:u})=>l?e.jsx(i.Suspense,{fallback:e.jsx(W,{active:!0}),children:e.jsx(ve,{onClose:d,...o,callback:u})}):null,Ce=i.lazy(()=>V(()=>import("./index-DjVVbTOk.js"),__vite__mapDeps([31,1,2,32,30,15,11,9,33,18,7,34,35,36,16,6,8,10,17,12,13,14,19,20,21,22,23,24,25,26,27,28,29,37,38,39,40,41,42,5,3,4,43,44,45,46,47]),import.meta.url)),we=({params:o,visible:l,onClose:d,callback:u})=>l?e.jsx(i.Suspense,{fallback:e.jsx(W,{active:!0}),children:e.jsx(Ce,{onClose:d,...o,callback:u})}):null,Ve=i.forwardRef(({project:o,component_id:l,component_ids:d},u)=>{const{data:r,pageNumber:v,totalPage:_,loading:g,reload:n,pageSize:P,setPageNumber:C}=ye({url:"/list-analysis",params:{component_id:l,component_ids:d,project:o},initialPageSize:10});i.useImperativeHandle(u,()=>({reload:n}));const[w,S]=i.useState(),[h,J]=k.useMessage(),{modal:t,openModal:p,closeModal:c}=ee(),{modals:I,openModals:R,closeModals:U}=se(["inspectPanel"]),[Ae,Fe]=i.useState(!1),z=ae(),H=te(),D=i.useRef([]),A=i.useRef(null),[Ie,G]=i.useState(),{containerURL:E}=N(a=>a.user);i.useEffect(()=>{if(r&&Array.isArray(r)&&r.length>0&&t.visible&&t.params){const a=r.find(s=>s.analysis_id==t.params.analysis_id);a&&G(a)}},[r,t.params]);const $=N(a=>a.global.sseData);i.useEffect(()=>{var s;const a=$;D.current.includes(a.analysis_id)?(a.event=="analysis_complete"||a.event=="analysis_failed"||a.event=="analysis_started")&&(n(),A.current&&((s=A.current)==null||s.relaod())):a.run_type=="retry"&&a.event=="container_pulled"&&n()},[$]);const K=a=>{S(a)};i.useEffect(()=>{if(r&&r.length>0){const a=r.map(s=>s.analysis_id);D.current=a}},[r]);const Q=async a=>{await f.delete(`/fast-api/analysis/${a}`),k.success("successfully delete!"),n()},M=(a,s)=>t.params?a.analysis_id==t.params.analysis_id&&s.includes(t.key):!1,T=async(a,s)=>{await pe(a.analysis_id,s),k.success("run successfully"),n()},L=async(a,s)=>{await ue(a.analysis_id,s),k.success("Stop Success"),n()};let q=[{title:"Project Name",dataIndex:"project_name",key:"project_name",ellipsis:!0,render:(a,s)=>e.jsx(y,{title:s.project,children:e.jsx("span",{style:{cursor:"pointer"},children:a})})},{title:"Job Status",dataIndex:"job_status",key:"job_status",ellipsis:!0,render:a=>e.jsx(x,{color:a==="success"?"green":a==="failed"?"red":"blue",children:a})},{title:"Server Status",dataIndex:"server_status",key:"server_status",ellipsis:!0,render:a=>e.jsx(x,{color:a==="success"?"green":a==="failed"?"red":"blue",children:a})},{title:"Component Name",dataIndex:"component_name",key:"component_name",ellipsis:!0,render:(a,s)=>e.jsx(y,{title:s.component_id,children:e.jsx("span",{style:{cursor:"pointer"},children:a})})},{title:"Analysis Name",dataIndex:"analysis_name",key:"analysis_name",ellipsis:!0},{title:"Report",dataIndex:"is_report",key:"is_report",ellipsis:!0,render:(a,s)=>e.jsx(x,{color:a?"green":"blue",children:a?"Report":"NonReport"})},{title:"Analysis Id",dataIndex:"analysis_id",key:"analysis_id",ellipsis:!0,render:(a,s)=>e.jsx(ie,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsxs("li",{children:["analysis_id:",s.analysis_id]}),e.jsxs("li",{children:["analysis_name:",s.analysis_name]}),e.jsxs("li",{children:["pipeline_script:",s.pipeline_script]}),e.jsxs("li",{children:["work_dir:",s.work_dir]}),e.jsxs("li",{children:["output_dir:",s.output_dir]}),e.jsxs("li",{children:["command_log_path:",s.command_log_path]}),e.jsxs("li",{children:["trace_file:",s.trace_file]}),e.jsxs("li",{children:["executor_log_file:",s.executor_log_file]}),e.jsxs("li",{children:["workflow_log_file:",s.workflow_log_file]})]})}),children:e.jsxs("span",{style:{cursor:"pointer"},children:[" ",e.jsx("span",{style:{cursor:"pointer"},children:String(a).slice(0,8)})]})})},{title:"Container Name",dataIndex:"container_name",key:"container_name",ellipsis:!0,render:(a,s)=>e.jsxs(y,{title:e.jsx(e.Fragment,{children:e.jsxs("ul",{children:[e.jsx("li",{children:s.container_image}),s.sub_container_image&&e.jsx("li",{children:s.sub_container_image})]})}),children:[e.jsx(x,{style:{cursor:"pointer"},children:a}),s.sub_container_name&&e.jsx(x,{style:{cursor:"pointer"},children:s.sub_container_name})]})},{title:"Image Status",dataIndex:"image_status",key:"image_status",ellipsis:!0,render:(a,s)=>e.jsx(y,{title:s.image_id,children:e.jsx(x,{color:"green",children:a})})},{title:"Created At",dataIndex:"created_at",key:"created_at",ellipsis:!0},{title:"Updated At",dataIndex:"updated_at",key:"updated_at",ellipsis:!0},{title:"Action",key:"action",fixed:"right",ellipsis:!0,width:200,render:(a,s)=>e.jsxs(O,{size:"small",children:[e.jsx(m,{size:"small",color:"primary",variant:"solid",onClick:()=>z(`/analysis-report?key=${s==null?void 0:s.analysis_id}&project=${o}`),children:"Go Report"}),s.image_status=="exist"?e.jsx(e.Fragment,{children:s.job_status=="running"?e.jsx(e.Fragment,{children:e.jsx(j,{title:"Whether or not to stop?",onConfirm:()=>{L(s,"job")},children:e.jsx(m,{size:"small",color:"red",variant:"solid",children:"Stop Job"})})}):e.jsx(e.Fragment,{children:e.jsx(j,{title:"Whether or not to run?",onConfirm:()=>{T(s,"job"),s.component_type=="software"?p("resultParsePanel",{analysis_id:s.analysis_id}):s.component_type=="script"&&p("modalA",s),K(s)},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:s.job_status=="created"?"Run":"Re-Run"})})})}):e.jsx(e.Fragment,{children:e.jsx(j,{title:"Pull?",onConfirm:async()=>{await f.post(`/container/pull-image/${s.container_id}`),n()},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:s.image_status=="pulling"?"pulling":"Pull"})})}),e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>p("editParams",s.analysis_id),children:"Edit Parameters"}),M(s,["modalA","resultParsePanel"])?e.jsx(m,{size:"small",color:"red",variant:"solid",onClick:()=>{c()},children:"Close"}):e.jsx(y,{title:s.component_type,children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{s.component_type=="software"?p("resultParsePanel",{analysis_id:s.analysis_id}):s.component_type=="script"&&p("modalA",s)},children:"View Results"})}),e.jsx(fe,{menu:{items:[{key:"server",label:e.jsx(e.Fragment,{children:s.image_status=="exist"&&e.jsx(e.Fragment,{children:s.server_status=="running"?e.jsx(e.Fragment,{children:e.jsx(j,{title:"Whether or not to stop?",onConfirm:()=>{L(s,"server")},children:e.jsx("a",{style:{color:"red"},children:"Stop Server"})})}):e.jsx(e.Fragment,{children:e.jsx(j,{title:"Whether to start the server?",onConfirm:()=>{T(s,"server")},children:e.jsx("a",{children:"Run Server"})})})})})},{key:"open_url",disabled:s.server_status!="running",label:e.jsx(e.Fragment,{children:e.jsx(y,{title:e.jsx(e.Fragment,{children:`${E}/container/${s.analysis_id}/`}),children:e.jsx("a",{onClick:()=>{window.open(`${E}/container/${s.analysis_id}/`,"_blank")},children:"Open URL"})})})},{key:"1",label:e.jsx(e.Fragment,{children:M(s,["modalB"])?e.jsx("a",{onClick:()=>{c()},children:"Close"}):e.jsx("a",{onClick:()=>{p("modalB",s)},children:"Details"})})},{key:"inspect_job",disabled:s.job_status!="running",label:e.jsx(e.Fragment,{children:e.jsx("a",{onClick:async()=>{R("inspectPanel",{inspect:"inspect",id:s.analysis_id,run_type:"job"})},children:"Inspect Job"})})},{key:"inspect_server",disabled:s.server_status!="running",label:e.jsx(e.Fragment,{children:e.jsx("a",{onClick:async()=>{R("inspectPanel",{inspect:"inspect",id:s.analysis_id,run_type:"server"})},children:"Inspect Server"})})},{key:"3",label:e.jsx(e.Fragment,{children:e.jsx("a",{onClick:()=>{z(`/software-analysis-editor/${s.analysis_id}`,{state:{location:H.pathname}})},children:"Edit"})})},{key:"4",label:e.jsxs(e.Fragment,{children:[" ",e.jsx(j,{title:"Delete or not?",onConfirm:async()=>{await Q(s.analysis_id),n()},children:e.jsx("a",{style:{color:"red"},children:"Delete"})})]})},{key:"5",label:e.jsxs(e.Fragment,{children:[" ",e.jsx(j,{title:s.is_report?"Whether to cancel the report?":"Whether to the report?",onConfirm:async()=>{await f.post(`/analysis/update-report/${s.analysis_id}`),n()},children:s.is_report?"Cancel Report":"Report"})]})},{key:"analysisTaskDrawer",label:e.jsx(e.Fragment,{children:e.jsx("a",{onClick:()=>{p("analysisTaskDrawer",{analysis_id:s.analysis_id})},children:"Analysis Task"})})},{key:"6",label:e.jsx(e.Fragment,{children:e.jsx("a",{onClick:()=>{p("addProject",s)},children:"Add Project"})})}]},children:e.jsx("a",{onClick:Z=>Z.preventDefault(),children:e.jsxs(O,{children:["More",e.jsx(le,{})]})})})]})}];i.useEffect(()=>{c()},[o]),i.useEffect(()=>{n()},[o]);const[b,X]=i.useState(""),Y=i.useMemo(()=>b?r.filter(a=>Object.values(a).some(s=>String(s).toLowerCase().includes(b.toLowerCase()))):r,[r,b]);return e.jsxs(e.Fragment,{children:[J,e.jsx(_e,{size:"small",variant:"borderless",style:{boxShadow:"none"},styles:{body:{padding:"0.5rem 0 0 0 "}},title:e.jsxs(e.Fragment,{children:[e.jsx(ke,{}),"  Analysis Record"]}),extra:e.jsxs(B,{gap:"small",wrap:!0,children:[e.jsx(ne.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:b,onChange:a=>X(a.target.value),style:{width:300}}),e.jsx(be,{style:{cursor:"pointer"},onClick:n})]}),children:e.jsx(he,{rowKey:"analysis_id",size:"small",pagination:!1,loading:g,scroll:{x:"max-content",y:55*5},columns:q,footer:()=>e.jsx(e.Fragment,{children:_!=0&&e.jsxs(B,{style:{marginTop:"1rem"},align:"center",children:["A total of ",_," records   ",e.jsx(ge,{current:v,pageSize:P,total:_,onChange:a=>C(a),showSizeChanger:!1})]})}),dataSource:Y})}),e.jsx("div",{style:{marginBottom:"1rem"}}),e.jsx(xe,{visible:t.key=="modalA"&&t.visible,params:t.params,onClose:c}),e.jsx(Pe,{visible:t.key=="resultParsePanel"&&t.visible,onClose:c,callback:n,params:t.params}),e.jsx(we,{visible:t.key=="analysisTaskDrawer"&&t.visible,onClose:c,callback:n,params:t.params}),e.jsx(de,{ref:A,visible:t.key=="modalB"&&t.visible,params:t.params,onClose:c,callback:n}),e.jsx(me,{callback:n,visible:t.key=="editParams"&&t.visible,params:t.params,onClose:c}),e.jsx(Se,{callback:n,visible:t.key=="addProject"&&t.visible,params:t.params,onClose:c}),e.jsx(je,{callback:n,visible:I.inspectPanel.visible,params:I.inspectPanel.params,onClose:()=>U("inspectPanel")})]})}),Se=({visible:o,params:l,onClose:d,callback:u})=>{const[r,v]=i.useState([]),{messageApi:_,project:g}=re(),[n]=F.useForm(),P=async()=>{const S=(await f.get("/project/list-project")).data.map(h=>({label:`${h.project_name}`,value:h.project_id}));v(S.filter(h=>h.value!=g))};i.useEffect(()=>{P(),n.resetFields(),l!=null&&l.extra_project_ids&&n.setFieldValue("project",JSON.parse(l==null?void 0:l.extra_project_ids))},[g]);const C=async()=>{const w=await n.validateFields();await f.post(`/analysis/update-extra-project/${l==null?void 0:l.analysis_id}`,w),_.success("添加成功!"),u&&u()};return e.jsx(oe,{onOk:C,title:`添加项目(${l==null?void 0:l.analysis_name})`,open:o,onCancel:d,onClose:d,children:e.jsx(F,{form:n,children:e.jsx(F.Item,{name:"project",label:"项目",children:e.jsx(ce,{options:r,mode:"multiple"})})})})};export{Ve as A};
