import{r as a,$ as L,a0 as Z,L as M,Q as ue,a1 as pe,a2 as fe,a3 as ge,a4 as q,a5 as he,a6 as V,a7 as xe,j as r,I as je,i as be,B as C,a as _e,k as Ce,Y as ye,t as O,F as Se,l as ee,P as W}from"./main-CH82g4dw.js";import{L as k,r as Oe}from"./index-BKAfqOdf.js";import{s as ve,r as Pe,f as Ie,C as we}from"./index-DH4f004y.js";import{C as D}from"./index-ZaXfouA1.js";import{a as Re,S as Ee}from"./Table-Rz-gL0vt.js";import{L as A}from"./index-BkCTNNpG.js";import{a as $e,R as ke}from"./index-BL_XwOQI.js";import{R as Fe}from"./index-CweiUdAw.js";import{P as Be}from"./index-C0dVCwMu.js";import{e as J}from"./index-BcI8WOZ3.js";import{T as Ne}from"./index-B_L60N4-.js";const F=e=>{let{children:n}=e;const{getPrefixCls:l}=a.useContext(L),t=l("breadcrumb");return a.createElement("li",{className:`${t}-separator`,"aria-hidden":"true"},n===""?n:n||"/")};F.__ANT_BREADCRUMB_SEPARATOR=!0;var ze=function(e,n){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(l[t[o]]=e[t[o]]);return l};function Te(e,n){if(e.title===void 0||e.title===null)return null;const l=Object.keys(n).join("|");return typeof e.title=="object"?e.title:String(e.title).replace(new RegExp(`:(${l})`,"g"),(t,o)=>n[o]||t)}function te(e,n,l,t){if(l==null)return null;const{className:o,onClick:i}=n,c=ze(n,["className","onClick"]),u=Object.assign(Object.assign({},Z(c,{data:!0,aria:!0})),{onClick:i});return t!==void 0?a.createElement("a",Object.assign({},u,{className:M(`${e}-link`,o),href:t}),l):a.createElement("span",Object.assign({},u,{className:M(`${e}-link`,o)}),l)}function Ae(e,n){return(t,o,i,c,u)=>{if(n)return n(t,o,i,c);const d=Te(t,o);return te(e,t,d,u)}}var X=function(e,n){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(l[t[o]]=e[t[o]]);return l};const re=e=>{const{prefixCls:n,separator:l="/",children:t,menu:o,overlay:i,dropdownProps:c,href:u}=e,f=(h=>{if(o||i){const j=Object.assign({},c);if(o){const m=o||{},{items:p}=m,x=X(m,["items"]);j.menu=Object.assign(Object.assign({},x),{items:p==null?void 0:p.map((y,_)=>{var{key:S,title:s,label:b,path:g}=y,P=X(y,["key","title","label","path"]);let w=b??s;return g&&(w=a.createElement("a",{href:`${u}${g}`},w)),Object.assign(Object.assign({},P),{key:S??_,label:w})})})}else i&&(j.overlay=i);return a.createElement(Re,Object.assign({placement:"bottom"},j),a.createElement("span",{className:`${n}-overlay-link`},h,a.createElement(ue,null)))}return h})(t);return f!=null?a.createElement(a.Fragment,null,a.createElement("li",null,f),l&&a.createElement(F,null,l)):null},ne=e=>{const{prefixCls:n,children:l,href:t}=e,o=X(e,["prefixCls","children","href"]),{getPrefixCls:i}=a.useContext(L),c=i("breadcrumb",n);return a.createElement(re,Object.assign({},o,{prefixCls:c}),te(c,o,l,t))};ne.__ANT_BREADCRUMB_ITEM=!0;const Me=e=>{const{componentCls:n,iconCls:l,calc:t}=e;return{[n]:Object.assign(Object.assign({},ge(e)),{color:e.itemColor,fontSize:e.fontSize,[l]:{fontSize:e.iconFontSize},ol:{display:"flex",flexWrap:"wrap",margin:0,padding:0,listStyle:"none"},a:Object.assign({color:e.linkColor,transition:`color ${e.motionDurationMid}`,padding:`0 ${q(e.paddingXXS)}`,borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",marginInline:t(e.marginXXS).mul(-1).equal(),"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover}},he(e)),"li:last-child":{color:e.lastItemColor},[`${n}-separator`]:{marginInline:e.separatorMargin,color:e.separatorColor},[`${n}-link`]:{[`
          > ${l} + span,
          > ${l} + a
        `]:{marginInlineStart:e.marginXXS}},[`${n}-overlay-link`]:{borderRadius:e.borderRadiusSM,height:e.fontHeight,display:"inline-block",padding:`0 ${q(e.paddingXXS)}`,marginInline:t(e.marginXXS).mul(-1).equal(),[`> ${l}`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSizeIcon},"&:hover":{color:e.linkHoverColor,backgroundColor:e.colorBgTextHover,a:{color:e.linkHoverColor}},a:{"&:hover":{backgroundColor:"transparent"}}},[`&${e.componentCls}-rtl`]:{direction:"rtl"}})}},Xe=e=>({itemColor:e.colorTextDescription,lastItemColor:e.colorText,iconFontSize:e.fontSize,linkColor:e.colorTextDescription,linkHoverColor:e.colorText,separatorColor:e.colorTextDescription,separatorMargin:e.marginXS}),Le=pe("Breadcrumb",e=>{const n=fe(e,{});return Me(n)},Xe);var Q=function(e,n){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(l[t[o]]=e[t[o]]);return l};function De(e){const{breadcrumbName:n,children:l}=e,t=Q(e,["breadcrumbName","children"]),o=Object.assign({title:n},t);return l&&(o.menu={items:l.map(i=>{var{breadcrumbName:c}=i,u=Q(i,["breadcrumbName"]);return Object.assign(Object.assign({},u),{title:c})})}),o}function He(e,n){return a.useMemo(()=>e||(n?n.map(De):null),[e,n])}var Ke=function(e,n){var l={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(l[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(l[t[o]]=e[t[o]]);return l};const Ue=(e,n)=>{if(n===void 0)return n;let l=(n||"").replace(/^\//,"");return Object.keys(e).forEach(t=>{l=l.replace(`:${t}`,e[t])}),l},E=e=>{const{prefixCls:n,separator:l="/",style:t,className:o,rootClassName:i,routes:c,items:u,children:d,itemRender:f,params:h={}}=e,j=Ke(e,["prefixCls","separator","style","className","rootClassName","routes","items","children","itemRender","params"]),{getPrefixCls:m,direction:p,breadcrumb:x}=a.useContext(L);let y;const _=m("breadcrumb",n),[S,s,b]=Le(_),g=He(u,c),P=Ae(_,f);if(g&&g.length>0){const I=[],R=u||c;y=g.map((v,$)=>{const{path:le,key:B,type:ae,menu:H,overlay:K,onClick:se,className:ce,separator:ie,dropdownProps:me}=v,N=Ue(h,le);N!==void 0&&I.push(N);const U=B??$;if(ae==="separator")return a.createElement(F,{key:U},ie);const z={},de=$===g.length-1;H?z.menu=H:K&&(z.overlay=K);let{href:T}=v;return I.length&&N!==void 0&&(T=`#/${I.join("/")}`),a.createElement(re,Object.assign({key:U},z,Z(v,{data:!0,aria:!0}),{className:ce,dropdownProps:me,href:T,separator:de?"":l,onClick:se,prefixCls:_}),P(v,h,R,I,T))})}else if(d){const I=V(d).length;y=V(d).map((R,v)=>{if(!R)return R;const $=v===I-1;return xe(R,{separator:$?"":l,key:v})})}const w=M(_,x==null?void 0:x.className,{[`${_}-rtl`]:p==="rtl"},o,i,s,b),oe=Object.assign(Object.assign({},x==null?void 0:x.style),t);return S(a.createElement("nav",Object.assign({className:w,style:oe},j),a.createElement("ol",null,y)))};E.Item=ne;E.Separator=F;const{Search:qe}=je,{Text:Y}=be,Ve=({path:e,onSelectFile:n})=>{const[l,t]=a.useState([]),[o,i]=a.useState(e),[c,u]=a.useState(""),[d,f]=a.useState(1),[h,j]=a.useState(0),m=10,p=async(s=o,b=c,g=d)=>{const P=await _e.get("/file-operation/list-dir-v2",{params:{path:s,keyword:b,page:g,limit:m}});t(P.data.items),j(P.data.total),i(s),f(g)};a.useEffect(()=>{p(e)},[e]);const x=s=>{p(`${o}/${s}`,"",1)},y=s=>{p(o,s,1)},_=s=>{n({path:o+"/"+s.name,file:s.name})},S=o.split("/").filter(Boolean);return r.jsxs(D,{title:"文件浏览器",extra:r.jsxs(Ee,{children:[r.jsx(C,{icon:r.jsx(J,{}),onClick:()=>p(e),size:"small",children:"重置"}),r.jsx(C,{icon:r.jsx(J,{}),onClick:()=>p(o),size:"small",children:"刷新"})]}),children:[r.jsxs(E,{style:{marginBottom:"1rem"},children:[r.jsx(E.Item,{children:r.jsx("a",{onClick:()=>p("/"),children:"根目录"})}),S.map((s,b)=>r.jsx(E.Item,{children:r.jsx("a",{onClick:()=>{const g="/"+S.slice(0,b+1).join("/");p(g)},children:s})},b))]}),r.jsx(qe,{placeholder:"搜索文件名",enterButton:"搜索",value:c,onChange:s=>u(s.target.value),onSearch:y,style:{marginBottom:16}}),r.jsx(A,{size:"small",bordered:!0,dataSource:l,locale:{emptyText:"暂无文件"},renderItem:s=>r.jsx(A.Item,{actions:s.is_dir?[r.jsx(C,{size:"small",onClick:()=>x(s.name),children:"进入"})]:[r.jsx(C,{type:"link",size:"small",icon:r.jsx(Fe,{}),href:`/brave-api/file-operation/download?path=${encodeURIComponent(o+"/"+s.name)}`,target:"_blank",children:"下载"}),r.jsx(C,{type:"link",size:"small",onClick:()=>_(s),children:"选择"})],children:r.jsx(A.Item.Meta,{avatar:s.is_dir?r.jsx($e,{}):r.jsx(ke,{}),title:r.jsx(Y,{strong:!0,style:{cursor:s.is_dir?"pointer":"default"},onClick:()=>s.is_dir&&x(s.name),children:s.name}),description:!s.is_dir&&r.jsxs(Y,{type:"secondary",children:[(s.size/1024).toFixed(1)," KB"]})})})}),r.jsx(Be,{style:{marginTop:"1rem",textAlign:"center"},current:d,total:h,pageSize:m,onChange:s=>p(o,c,s),showSizeChanger:!1})]})},G=({file_path:e})=>{a.useEffect(()=>{e&&t(e)},[e]);const[n,l]=a.useState([]),t=async(o,i=!1)=>{const c=await Oe(o);l(c.data)};return r.jsx(r.Fragment,{children:r.jsx(D,{title:r.jsxs(ee,{color:"blue",children:["文件: ",e]}),extra:r.jsx(C,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t(e)},children:"刷新日志"}),bodyStyle:{padding:0},children:r.jsx(we,{...n})})})},We=({output_dir:e,...n})=>(JSON.stringify(n),r.jsx(Ve,{path:e})),Je={output_dir:We,workflow_log_file:k,executor_log_file:k,trace_file:k,command_log_path:k,params_path:G,command_path:G},Qe=({analysis:e,file:n,fileKey:l})=>{const t=Je[l];return t?r.jsx(t,{...e,file_path:n,file:n,fileKey:l}):r.jsx(r.Fragment,{children:"no component"})},Ye=a.memo(({analysis:e,callback:n})=>{const[l,t]=a.useState("command_log_path"),{messageApi:o}=Ce(),{eventSourceRef:i,status:c,reconnect:u}=ye(),d=a.useRef(l);if(!e)return null;const f={workflow_log_file:e.workflow_log_file,executor_log_file:e.executor_log_file,trace_file:e.trace_file,params_path:e.params_path,command_path:e.command_path,command_log_path:e.command_log_path},h=async()=>{await Pe(e==null?void 0:e.analysis_id,"job"),o.success("运行成功"),n&&n()},j=[{key:"command_log_path",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.command_log_path})}),children:"Run Log"})},{key:"trace_file",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.trace_file})}),children:"Progress"})},{key:"workflow_log_file",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.workflow_log_file})}),children:"Workflow Log"})},{key:"executor_log_file",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.executor_log_file})}),children:"Executor Log"})},{key:"params_path",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.params_path})}),children:"Parameters"})},{key:"command_path",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.command_path})}),children:"Command"})},{key:"output_dir",label:r.jsx(O,{title:r.jsx("ul",{children:r.jsx("li",{children:e==null?void 0:e.output_dir})}),children:"Output File"})}];return r.jsx(r.Fragment,{children:r.jsx(Ne,{tabBarExtraContent:r.jsxs(Se,{gap:"small",align:"center",children:[r.jsx(ee,{color:"cyan",children:e==null?void 0:e.job_status}),r.jsx(O,{title:r.jsx(r.Fragment,{children:f[l]})}),e.job_status=="running"?r.jsx(r.Fragment,{children:r.jsx(W,{title:"Stop the job?",onConfirm:async()=>{await ve(e.analysis_id,"job"),o.success("Stopped successfully")},children:r.jsx(C,{size:"small",color:"cyan",variant:"solid",children:"Stop"})})}):r.jsx(r.Fragment,{children:r.jsx(W,{title:"Run the job?",onConfirm:h,children:r.jsx(C,{size:"small",color:"cyan",variant:"solid",children:e.analysis_status=="created"?"Run":"Re-Run"})})})]}),activeKey:l,onChange:m=>{t(m),d.current=m},size:"small",items:j.map(m=>({key:m.key,label:m.label,children:r.jsx(Qe,{file:f[m.key],fileKey:m.key,analysis:e})}))})})}),it=a.forwardRef(({visible:e,params:n,onClose:l,callback:t},o)=>{console.log("loading PipelineInfo...");const i=async()=>{d(),t&&t()},{analysis_id:c,...u}=n||{},d=async()=>{if(c){const m=(await Ie(c)).data;h(m)}},[f,h]=a.useState();return a.useImperativeHandle(o,()=>({relaod:d})),a.useEffect(()=>{e&&d()},[e&&(n==null?void 0:n.analysis_id)]),e?r.jsx(r.Fragment,{children:r.jsx(D,{size:"small",title:`Process Monitoring ${c}`,extra:r.jsx(r.Fragment,{children:r.jsx(C,{size:"small",onClick:l,color:"cyan",variant:"solid",children:"关闭"})}),children:r.jsx(Ye,{analysis:f,callback:i,loadAnalysis:d})})}):r.jsx(r.Fragment,{})});export{Ye as F,it as P};
