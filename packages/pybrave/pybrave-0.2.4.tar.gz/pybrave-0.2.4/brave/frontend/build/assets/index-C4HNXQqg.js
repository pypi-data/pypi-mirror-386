import{a as j,d as s,r,j as e,M as q,m as E,i as P,u as U,D as M,I as _,e as F,B as V,V as k,T as B,b as L}from"./main-D6qHus43.js";import{a as D}from"./index-ChzQGd2Q.js";import{T as G,R as z}from"./index-gg_8jVgT.js";import{T as K,U as H}from"./index-CqzThpCE.js";import{C as Q}from"./index-D7dvcYwa.js";const me=async t=>await j.post("/page-pipeline-components",t),W=async t=>await j.post("/list-pipeline-components",t),de=async t=>await j.delete(`/delete-pipeline-relation/${t}`),ue=async t=>await j.delete(`/delete-component/${t}`),fe=async t=>await j.post("/save-component-relation-order",t),ge=async t=>await j.post("/save-pipeline-components-edges",t),X={script_type:"nextflow",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/nextflow:25.06.0",databases:[{name:"metaphlan_database",dataKey:"metaphlan_database",label:"metaphlan_database",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}],upstreamFormJson:[{name:"stat_q",data:[{label:"0.2",value:.2},{label:"0",value:0}],initialValue:.2,label:" Quantile value for the robust average(--stat_q)",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}]},Y={name:"丰度矩阵",script_type:"python",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/datascience-notebook:x86_64-ubuntu-22.04",sampleGroupJSON:!0,saveAnalysisMethod:"metaphlan_sam_abundance_matrix",moduleName:"abundance_matrix",formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},{name:"metaphlan_sam_abundance",label:"丰度文件",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupSelectSampleButton",group:"group_field"}],tableDesc:""},Z={name:"raw_reads",label:"下机原始reads",mode:"multiple",type:"GroupSelectSampleButton",group:"group_field",rules:[{required:!0,message:"该字段不能为空!"}],dir:"metaphlan",fileFormat:{profile:"*/*_profile.txt"},inputForm:[{name:["content","fastq1"],initialValue:"/data/wangyang/NGS_TEST/*_1.fastq.gz",label:"fastq1",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]},{name:["content","fastq2"],initialValue:"/data/wangyang/NGS_TEST/*_2.fastq.gz",label:"fastq2",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]}]},xe=({visible:t,onClose:o,params:a,callback:p})=>{if(!t)return null;const{data:l,pipelineStructure:n,namespace:u}=a,[m]=s.useForm(),[S,y]=r.useState(),[w,C]=r.useState(),[T,N]=r.useState([]),[O,b]=r.useState(!1),R={pipeline_software:I,software_input_file:I,software_output_file:I,file_script:I,parent_file_script:te},$=({relation_type:h,data:c,form:g})=>{const x=R[h]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(c)]}));return e.jsx(x,{data:c,form:g,components:T})},f=async h=>{const c=await W({component_type:h,namespace:u}),g=c.data.map(x=>(JSON.parse(x.content),n.relation_type=="pipeline_software"?{label:`${x.component_name}(${x.component_id})`,value:x.component_id}:n.relation_type=="file_script"?{label:`${x.component_name}(${x.component_id})`,value:x.component_id}:{label:`${x.component_name}(${x.component_id})`,value:x.component_id}));console.log(g),N(g),console.log(c)},i=async h=>{const g=(await j.post(`/find-pipeline-relation/${h}`)).data;C(g),m.setFieldsValue(g)};r.useEffect(()=>{t&&(n.relation_type=="pipeline_software"?f("software"):n.relation_type=="software_input_file"||n.relation_type=="parent_file_script"||n.relation_type=="software_output_file"?f("file"):n.relation_type=="file_script"&&f("script"),l?i(l.relation_id):m.resetFields())},[t]);const d=h=>{const c={...h,...n};return c.relation_type=="parent_file_script"&&(c.relation_type="file_script"),l&&(c.relation_id=w.relation_id),c},J=async()=>{b(!0);const h=await m.validateFields(),c=d(h);typeof c.content!="string"&&(c.content=JSON.stringify(c.content)),console.log(c);try{const g=await j.post("/save-pipeline-relation",c);console.log(g),b(!1),o(),p&&p()}catch{b(!1)}};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:O,title:`${l?"Update":"Add"} (${n==null?void 0:n.relation_type})`,okText:l?"Update":"Add",onOk:J,open:t,footer:(h,{OkBtn:c,CancelBtn:g})=>e.jsxs(e.Fragment,{children:[e.jsx(g,{}),e.jsx(c,{})]}),onClose:()=>o(),onCancel:()=>o(),children:e.jsxs(s,{form:m,children:[w&&e.jsx(e.Fragment,{}),e.jsx($,{...n,data:S,form:m}),e.jsx(E,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(P,{children:e.jsx("pre",{children:JSON.stringify(d(m.getFieldsValue()),null,2)})})})})}]})]})})})},he=({visible:t,onClose:o,params:a,callback:p})=>{if(!t)return null;const{data:l,structure:n}=a,[u]=s.useForm(),[m,S]=r.useState(),{namespace:y}=U(f=>f.user),[w,C]=r.useState(!1),T={pipeline:ae,software:ne,file:oe,script:se},N=({component_type:f,data:i,form:d})=>{const J=T[f]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(i)]}));return e.jsx(J,{data:i,form:d,structure:n})},O=async f=>{const d=(await j.post("/find-pipeline",{component_id:f})).data;d.tags&&(d.tags=JSON.parse(d.tags)),S(d),console.log(d),n.component_type=="pipeline"&&(d.content=JSON.parse(d.content)),u.setFieldsValue(d)};r.useEffect(()=>{t&&(l?O(l.component_id):u.resetFields())},[t]);const b=f=>{const i={...f,...n};return l&&(i.component_id=m.component_id),i},R=f=>{const i=b(f);return typeof i.content=="string"&&(i.content=JSON.parse(i.content)),i},$=async()=>{C(!0);const f=await u.validateFields(),i=b(f);typeof i.content!="string"&&(i.content=JSON.stringify(i.content)),typeof i.tags!="string"&&(i.tags=JSON.stringify(i.tags)),console.log(i);try{const d=await j.post("/save-pipeline",i);console.log(d),C(!1),p&&p(),o()}catch{C(!1)}};return r.useEffect(()=>{u.setFieldValue("namespace",y)},[y]),e.jsx(e.Fragment,{children:e.jsx(M,{loading:w,title:`${l?"Update":"Create"} Component(${n==null?void 0:n.component_type})`,forceRender:!0,open:t,width:"80%",extra:e.jsx(e.Fragment,{children:e.jsx(V,{size:"small",color:"cyan",variant:"solid",onClick:$,children:l?"Update":"Create"})}),onClose:()=>o(),children:e.jsxs(s,{form:u,children:[e.jsx(G,{items:[{label:"Component Info",key:"1",children:e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"component_name",label:"Component Name",children:e.jsx(_,{})}),e.jsx(N,{...n,data:m,form:u})]})},{label:"Component Description",key:"2",children:e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"tags",label:"Tags",children:e.jsx(F,{mode:"tags",style:{width:"100%"}})}),e.jsx(s.Item,{name:"category",label:"Category",children:e.jsx(_,{})}),(l==null?void 0:l.component_id)&&e.jsx(s.Item,{label:"Upload",name:"img",children:e.jsx(ee,{component_id:l==null?void 0:l.component_id})}),e.jsx(s.Item,{label:"Order",name:"order_index",initialValue:0,children:e.jsx(K,{})}),e.jsx(s.Item,{name:"description",label:"Description",children:e.jsx(v,{templete:""})})]})}]}),e.jsx(E,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(P,{children:e.jsx("pre",{children:JSON.stringify(R(u.getFieldsValue()),null,2)})})})})}]})]})})})},ee=({value:t,onChange:o,component_id:a})=>{const[p,l]=r.useState([]),{baseURL:n}=U(m=>m.user),u=({file:m,fileList:S})=>{l([m]),m.status==="done"&&(console.log(m),o(`${m.response.url}`))};return r.useEffect(()=>{t&&l([{uid:"-1",name:"image.png",status:"done",url:`${n}${t}`}])},[t]),e.jsx(e.Fragment,{children:e.jsx(H,{onChange:u,fileList:p,action:`${n}/brave-api/component/upload/${a}`,listType:"picture-card",children:e.jsxs("button",{style:{color:"inherit",cursor:"inherit",border:0,background:"none"},type:"button",children:[e.jsx(z,{}),e.jsx("div",{style:{marginTop:8},children:"Upload"})]})})})},te=({data:t,form:o,components:a})=>e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:"parent_component_id",label:"File Component",children:e.jsx(F,{showSearch:!0,options:a})})}),I=({data:t,form:o,components:a})=>e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:"component_id",label:"Component",children:e.jsx(F,{showSearch:!0,options:a})})}),ne=({data:t,form:o})=>{const[a,p]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(X,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"container_id",label:"Container",children:e.jsx(A,{container:t==null?void 0:t.container})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(v,{templete:a})})]})},se=({data:t,form:o})=>{const[a,p]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||p(JSON.stringify(Y,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:"container_id",label:"Container",children:e.jsx(A,{container:t==null?void 0:t.container})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(v,{templete:a})})]})},oe=({data:t,form:o,structure:a})=>{const[p,l]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||l(JSON.stringify(Z,null,2))},[]),e.jsxs(e.Fragment,{children:[(a==null?void 0:a.files)&&e.jsx(Q,{style:{maxHeight:"20rem",overflow:"auto",marginBottom:"1rem"},children:e.jsx(P,{children:e.jsx("pre",{children:JSON.stringify(a==null?void 0:a.files,null,2)})})}),e.jsx(s.Item,{name:"file_type",label:"File Type",children:e.jsx(F,{options:[{label:"collected",value:"collected"},{label:"individual",value:"individual"}]})}),e.jsx(s.Item,{name:"content",label:"content",children:e.jsx(v,{templete:p})})]})},A=({value:t,onChange:o,container:a})=>{const{modal:p,openModal:l,closeModal:n}=L(),[u,m]=r.useState(a);return e.jsxs(e.Fragment,{children:[e.jsx(_,{value:u==null?void 0:u.name,style:{cursor:"pointer"},onClick:()=>l("modalA")}),e.jsx(q,{footer:!1,width:"50%",title:"Select container",open:p.visible&&p.key=="modalA",onClose:n,onCancel:n,children:e.jsx(D,{rowSelection:{type:"radio",onChange:(S,y)=>{y.length>0&&(m(y[0]),o(y[0].container_id),n())}}})})]})},v=({value:t,onChange:o,templete:a})=>{const p=r.useRef(null);return r.useEffect(()=>{a&&o(a)},[]),e.jsx(e.Fragment,{children:e.jsx(k,{value:t,onChange:o,editorRef:p,defaultLanguage:"json"})})},ae=({data:t,form:o})=>e.jsxs(e.Fragment,{children:[e.jsx(s.Item,{name:["content","name"],label:"name",children:e.jsx(_,{})}),e.jsx(s.Item,{name:["content","script_type"],label:"Script Type",children:e.jsx(F,{options:[{label:"python",value:"python"},{label:"nextflow",value:"nextflow"},{label:"shell",value:"shell"},{label:"R",value:"R"}]})}),e.jsx(s.Item,{name:["content","image"],label:"Image",children:e.jsx(_,{})}),e.jsx(s.Item,{name:["content","img"],label:"img",children:e.jsx(_,{})}),e.jsx(s.Item,{name:["content","category"],label:"category",children:e.jsx(_,{})}),e.jsx(s.Item,{name:["content","description"],label:"description",children:e.jsx(B,{})})]});export{xe as C,fe as a,he as b,ue as c,de as d,me as p,ge as s};
