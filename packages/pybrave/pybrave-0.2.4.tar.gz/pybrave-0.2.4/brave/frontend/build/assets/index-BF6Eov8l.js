import{a as u,r as m,k as D,j as a,M as E,b as T,I as $,B as S,P as K,F as O}from"./main-D6qHus43.js";import{b as q}from"./index-CoiYZhLe.js";import{S as J,F as G}from"./Table-Pcm8h2F_.js";const H=e=>u.delete(`/sample/delete-sample-by-sample-id/${e}`),ee=e=>u.post("/sample/add-sample-metadata",e),ae=e=>u.post("/sample/update-sample-metadata",e),te=e=>u.get(`/sample/find-sample-metadata-by-id/${e}`),Q=e=>u.post("/sample/update-sample-metadata-list",e),R=e=>u.get(`/list-by-project?project=${e}`),A=({operatePipeline:e,rowSelection:r})=>{const[d,o]=m.useState([]),[h,b]=m.useState([]),[_,k]=m.useState(!1),{project:p,messageApi:c,projectObj:i}=D(),I=m.useRef(null),w=()=>{var t;return!(i!=null&&i.metadata_form)||!Array.isArray(i==null?void 0:i.metadata_form)?[]:(t=i==null?void 0:i.metadata_form)==null?void 0:t.map(l=>({title:l.label,dataIndex:l.name,key:l.name,ellipsis:!0}))};T();const{Search:W}=$,f=async()=>{k(!0);const t=await R(p);console.log(t),o(t.data),I.current=t.data,b(t.data),k(!1)},C=[{title:"ID",dataIndex:"sample_id",key:"sample_id",ellipsis:!0,width:100},{title:"Project",dataIndex:"project",key:"project",ellipsis:!0,width:100},{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",ellipsis:!0,width:100},...w(),{title:"Action",key:"action",fixed:"right",width:200,render:(t,l)=>a.jsxs(J,{size:"middle",children:[a.jsx(S,{size:"small",color:"cyan",variant:"solid",onClick:()=>{e.openModal("metadataForm",{analysis_key:l.analysis_key,sample_id:l.sample_id,callback:f})},children:"Edit"}),a.jsx(K,{title:"Are you sure about the deletion?",onConfirm:async()=>{await H(l.sample_id),f()},children:a.jsx(S,{size:"small",color:"danger",variant:"solid",children:"Delete"})})]})}];m.useEffect(()=>{const t=l=>{var B;const n=((B=l.clipboardData)==null?void 0:B.getData("Text"))||"";if(!n)return;const y=n.includes("	")?"	":",",x=n.split(/\r?\n/).filter(s=>s.trim()!=="").map(s=>s.split(y).map(g=>g.trim())),v=[{title:"Sample Name",dataIndex:"sample_name",key:"sample_name",render:s=>a.jsx("span",{children:s})},...w()].map(s=>s.dataIndex),L=Object.fromEntries(x.map(s=>[s[0],s])),N=I.current.map(s=>{const g=L[s.sample_name];if(console.log(g),!g)return s;const z={};for(let j=1;j<v.length;j++)z[v[j]]=g[j];return{...s,...z}});o(N),c.success("Paste was successful!")};return document.addEventListener("paste",t),()=>{document.removeEventListener("paste",t)}},[]);const F=async()=>{const t=w().map(n=>n.dataIndex),l=d.map(n=>{const y={};t.forEach((x,P)=>{x in n&&(y[x]=n[x])});let M=null;return Object.keys(y).length!=0&&(M=JSON.stringify(y)),{sample_id:n.sample_id,metadata:M}}).filter(n=>n.metadata!=null);if(l.length==0){c.error("No Data!");return}console.log(l),await Q(l),c.success("update successfully!")};return m.useEffect(()=>{f()},[]),a.jsxs(a.Fragment,{children:[a.jsxs(O,{justify:"end",align:"center",gap:"small",style:{marginBottom:"1rem"},children:[a.jsx(S,{size:"small",color:"cyan",variant:"solid",onClick:F,children:"Batch Save"}),a.jsx(S,{size:"small",color:"cyan",variant:"solid",onClick:()=>{e.openModal("metadataForm",{callback:f})},children:"Add Sample"}),a.jsx(S,{size:"small",color:"primary",variant:"solid",onClick:f,children:"Refresh"})]}),a.jsx(G,{rowSelection:r,rowKey:t=>t.sample_id,size:"small",bordered:!0,pagination:{pageSize:30},loading:_,scroll:{x:"max-content",y:55*5},columns:C,footer:()=>`A total of ${d.length} records`,dataSource:d})]})},U=({visible:e,onClose:r,operatePipeline:d,params:o})=>{const[h,b]=m.useState(),{messageApi:_}=D(),k=async()=>{var c;if(!h){_.error("Please select a sample");return}const p={analysis_result_id:o.analysis_result_id,sample_id:h[0]};console.log(p),await q(p),_.success("Bind successfully"),(c=o.callback)==null||c.call(o),r()};return a.jsx(E,{title:"Binding Sample",open:e,onClose:r,onCancel:r,width:"80%",onOk:k,children:a.jsx(A,{rowSelection:{type:"radio",onChange:(p,c)=>{b(p)}},operatePipeline:d})})},V=({visible:e,onClose:r,params:d})=>{if(!e)return null;const{operatePipeline:o,...h}=d;return a.jsx(E,{title:"metadata",open:e,onClose:r,onCancel:r,width:"80%",footer:null,children:a.jsx(A,{operatePipeline:o})})},se=Object.freeze(Object.defineProperty({__proto__:null,BindSample:U,MetadataModal:V,default:A,getSamples:R},Symbol.toStringTag,{value:"Module"}));export{U as B,V as M,ee as a,te as f,R as g,se as i,ae as u};
