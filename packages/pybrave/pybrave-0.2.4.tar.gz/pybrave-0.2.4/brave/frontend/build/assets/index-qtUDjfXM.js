import{j as e,f as b,t as C,I as y,r as a,F as j,s as k,cB as _,E as v,P as w,a as h,av as R,l as S}from"./main-D6qHus43.js";import{C as m}from"./index-D7dvcYwa.js";import{F}from"./Table-Pcm8h2F_.js";import{a as T,R as $}from"./DeploymentUnitOutlined-Bm7mxWYi.js";import{R as I}from"./RedoOutlined-DIIHLGCK.js";import{R as E}from"./DeleteOutlined-5gHEV1Sl.js";import"./index-gg_8jVgT.js";import"./Dropdown-CMUlroR_.js";import"./addEventListener-TTc5ki3v.js";import"./index-CScjzpru.js";const L=({data:t})=>e.jsx("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:4},children:Array.isArray(t)&&t.map((n,l)=>e.jsxs(b.Fragment,{children:[e.jsx(C,{title:`${n.rank} (tax_id: ${n.tax_id})`,children:e.jsx("span",{style:{padding:"2px 6px",borderRadius:4,backgroundColor:"#f0f2f5",cursor:"pointer",transition:"background 0.3s"},onMouseEnter:o=>o.currentTarget.style.backgroundColor="#e6f7ff",onMouseLeave:o=>o.currentTarget.style.backgroundColor="#f0f2f5",children:n.entity_name})}),l<t.length-1&&e.jsx("span",{style:{margin:"0 4px"},children:"→"})]},n.tax_id))}),M=({data:t})=>{var n;return e.jsx(e.Fragment,{children:e.jsxs(m,{title:"Lineage",style:{marginTop:"1rem"},styles:{body:{padding:"0.5rem"}},size:"small",children:[e.jsx(L,{data:t.lineage}),e.jsx(A,{data:(n=t==null?void 0:t.graph_table)==null?void 0:n.studies})]})})},A=({data:t})=>{const{Search:n}=y,[l,o]=a.useState([]),d=i=>i?Object.keys(i).map(r=>({title:r,dataIndex:r,key:r,ellipsis:!0,width:150})):[];a.useEffect(()=>{if(t){const i=t.map((r,u)=>({...r,key:u}));o(i)}},[t]);const[x,s]=a.useState(""),c=a.useMemo(()=>x?t.filter(i=>Object.values(i).some(r=>String(r).toLowerCase().includes(x.toLowerCase()))):t,[t,x]);return e.jsx(e.Fragment,{children:Array.isArray(l)&&e.jsx(e.Fragment,{children:e.jsx(F,{size:"small",title:()=>e.jsx(j,{gap:"small",children:e.jsx(y.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:x,onChange:i=>s(i.target.value),style:{width:300}})}),scroll:{x:"max-content"},dataSource:c,pagination:!1,columns:d(t[0]),footer:()=>`A total of ${c==null?void 0:c.length} records`})})})},D=[{key:"Microbe",label:"taxonomy",component:M}],z=({data:t,view:n})=>{if(!n)return e.jsxs("div",{children:["未知类型",n]});const l=D.find(s=>s.key===n);if(!l)return e.jsxs("div",{children:["未知类型",n]});const{component:o,key:d,...x}=l;return e.jsx(o,{data:t,...x})},Y=({data:t,close:n,height:l,graphOpt:o,queryParams:d,...x})=>{const[s,c]=a.useState(),[i,r]=a.useState(!1),[u,p]=k.useMessage(),g=async()=>{if(t!=null&&t.id){try{r(!0);const f=await h.post(`/entity/details/mesh/${t==null?void 0:t.id}`,{nodes:d.nodes});c(f.data)}catch(f){c(null),console.log(f),u.error("数据加载失败!")}r(!1)}else c(null)};return a.useEffect(()=>{g()},[JSON.stringify(t)]),e.jsxs("div",{children:[p,e.jsx(m,{loading:i,title:e.jsxs(e.Fragment,{children:[s==null?void 0:s.entity_name,e.jsx(S,{style:{marginLeft:"0.5rem"},children:s==null?void 0:s.entity_type})]}),styles:{body:{padding:0,height:"100%"}},size:"small",extra:e.jsx(e.Fragment,{children:e.jsxs(j,{gap:"small",children:[d!=null&&d.entity_id?e.jsx(T,{onClick:()=>{o.updateQueryParam("entity_id",void 0)}}):e.jsx($,{onClick:()=>{o.updateQueryParam("entity_id",t==null?void 0:t.id)}}),e.jsx(I,{onClick:g}),e.jsx(w,{title:`删除${t==null?void 0:t.entity_name} (${t==null?void 0:t.node_id})?`,onConfirm:async()=>{await h.delete(`/entity/node-id/${t==null?void 0:t.node_id}`),u.success("删除成功"),n(),o.loadGraph()},children:e.jsx(E,{})}),e.jsx(R,{onClick:n})]})}),style:{borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",padding:"0.5rem",overflow:"hidden",height:l},children:e.jsx("div",{style:{height:"100%",overflowY:"auto"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(z,{data:s,view:s==null?void 0:s.entity_type}),e.jsx(_,{})]}):e.jsx(v,{description:JSON.stringify(t)})})})]})};export{z as ComponentsRender,Y as default,D as viewMapping};
