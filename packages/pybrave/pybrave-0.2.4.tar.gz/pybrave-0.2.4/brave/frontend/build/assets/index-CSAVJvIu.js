const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./graph-view-d4nj6dBI.js","./main-D6qHus43.js","./main-PWR3lu3V.css","./index-D7dvcYwa.js","./index-gg_8jVgT.js","./Dropdown-CMUlroR_.js","./index-CScjzpru.js","./TableOutlined-CS-DfnXV.js","./index-BLl0dAbY.js","./RedoOutlined-DIIHLGCK.js","./Table-Pcm8h2F_.js","./addEventListener-TTc5ki3v.js","./NodeIndexOutlined-GDqggOsJ.js"])))=>i.map(i=>d[i]);
import{r as l,d as _,v as A,j as e,I as C,e as k,D as P,k as W,a as D,M as V,m as q,i as J,S as B,t as f,l as $,B as v,P as O,dB as Q}from"./main-D6qHus43.js";import{S as X,D as Y}from"./study-page-CTl0wbzh.js";import{T as H,S as z}from"./Table-Pcm8h2F_.js";import{S as Z}from"./index-CScjzpru.js";import{T as ee}from"./index-gg_8jVgT.js";import{S as te}from"./index-DOQLu3Xz.js";import{S as ne}from"./index-BLl0dAbY.js";const{Option:Ie}=k,ae=({})=>{const[s,t]=l.useState("study"),[n,a]=l.useState("disease"),i=_.useFormInstance(),[m,d]=l.useState([]),[c,h]=l.useState([]),{modals:y,openModals:o,closeModals:r}=A(["entityDrawer","studyDrawer"]),[b,g]=l.useState();return e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{label:"Study",name:"study_id",children:e.jsx(C,{placeholder:"which study or reference provides evidence",style:{cursor:"pointer"},onClick:()=>o("studyDrawer",{name:"study_id"})})}),e.jsx(_.Item,{label:"Subject",name:"subject_id",children:e.jsx(C,{placeholder:"who does something",style:{cursor:"pointer"},onClick:()=>o("entityDrawer",{name:"subject_id"})})}),e.jsx(_.Item,{label:"Object",name:"object_id",children:e.jsx(C,{placeholder:"who receives the effect",style:{cursor:"pointer"},onClick:()=>o("entityDrawer",{name:"object_id"})})}),e.jsx(_.Item,{label:"Predicate",name:"predicate",children:e.jsx(k,{allowClear:!0,options:[{value:"CORRELATED_WITH",label:"CORRELATED_WITH"},{value:"PRODUCES",label:"PRODUCES"},{value:"MODULATES",label:"MODULATES"},{value:"ACTIVATES",label:"ACTIVATES"},{value:"INHIBITS",label:"INHIBITS"}]})}),e.jsx(_.Item,{label:"effect",name:"effect",children:e.jsx(k,{allowClear:!0,options:[{value:"Up",label:"Up"},{value:"Down",label:"Down"}]})}),e.jsx(_.Item,{label:"Observed",name:"observed_id",children:e.jsx(C,{placeholder:"where the phenomenon is observed (e.g., patient group, tissue, condition)",style:{cursor:"pointer"},onClick:()=>o("entityDrawer",{name:"observed_id"})})}),e.jsx(ie,{form:i,setRecord:g,visible:y.entityDrawer.visible,params:y.entityDrawer.params,onClose:()=>r("entityDrawer")}),e.jsx(se,{form:i,setRecord:g,visible:y.studyDrawer.visible,params:y.studyDrawer.params,onClose:()=>r("studyDrawer")})]})},se=({visible:s,setRecord:t,form:n,params:a,onClose:i,callback:m})=>e.jsx(e.Fragment,{children:e.jsx(P,{open:s,onClose:i,width:"80%",children:s&&e.jsx(X,{rowSelection:{onChange:(d,c)=>{n.setFieldValue(a.name,c[0].entity_id),i()},type:"radio"}})})}),ie=({visible:s,setRecord:t,form:n,params:a,onClose:i,callback:m})=>e.jsx(e.Fragment,{children:e.jsx(P,{open:s,onClose:i,width:"80%",children:s&&e.jsx(G,{disableWidth:!0,rowSelection:{onChange:(d,c)=>{n.setFieldValue(a.name,c[0].entity_id),i()},type:"radio"}})})}),re=()=>e.jsxs(e.Fragment,{children:[e.jsx(_.Item,{label:"entity_name_zh",name:"entity_name_zh",children:e.jsx(C,{})}),e.jsx(_.Item,{label:"entity_type",name:"entity_type",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(k,{allowClear:!0,options:[{value:"Microbe",label:"Microbe"},{value:"Disease",label:"Disease"},{value:"Pathway",label:"Pathway"},{value:"Pathway",label:"Pathway"},{value:"Compound",label:"compound"},{value:"evidence",label:"Evidence"}]})}),e.jsx(_.Item,{name:"tags",label:"tags",children:e.jsx(k,{mode:"tags",style:{width:"100%"}})}),e.jsx(_.Item,{name:"short_name",label:"short_name",children:e.jsx(k,{mode:"tags",style:{width:"100%"}})})]}),K=({visible:s,params:t,onClose:n,record:a,callback:i,children:m,entityType:d="mesh"})=>{const[c]=_.useForm(),{messageApi:h}=W(),[y,o]=l.useState(!1);l.useEffect(()=>{s&&(t!=null&&t.entityId)?r():c.resetFields()},[s]);const r=async()=>{o(!0);const g=await D.get(`/entity/get/${d}/${t.entityId}`);c.setFieldsValue(g.data),o(!1)},b=async()=>{const g=await c.validateFields();o(!0);try{t!=null&&t.entityId?await D.put(`/entity/update/${t.entityType}/${t.entityId}`,g):await D.post(`/entity/add/${t.entityType}`,g)}catch{o(!1),h.error("error!")}o(!1),n(),i&&i(),h.success("操作成功!")};return e.jsx(V,{loading:y,title:t!=null&&t.entityId?"update entity":"create entity",onOk:b,width:"50%",open:s,onClose:n,onCancel:n,children:e.jsxs(_,{form:c,children:[m,e.jsx(q,{ghost:!0,items:[{key:"1",label:"more",children:e.jsx(e.Fragment,{children:e.jsx(_.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(J,{children:e.jsx("pre",{children:JSON.stringify(c.getFieldsValue(),null,2)})})})})}]})]})})},le={mesh:re},de=({type:s,record:t})=>{const n=le[s]||(()=>e.jsxs("div",{children:["no ",s," component!"]}));return e.jsx(n,{record:t})},oe=({...s})=>{const{params:t,record:n}=s,[a,i]=l.useState([]);return l.useEffect(()=>{if(i([]),t!=null&&t.category&&Array.isArray(t==null?void 0:t.category)){const m=t==null?void 0:t.category.map(d=>({label:d,value:d}));i(m)}},[t]),e.jsx(e.Fragment,{children:e.jsxs(K,{...s,children:[!(t!=null&&t.entityId)&&e.jsx(_.Item,{label:"category",name:"category",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(k,{options:a})}),e.jsx(_.Item,{label:"is_research",name:"is_research",children:e.jsx(ne,{})}),e.jsx(_.Item,{label:"entity_name",name:"entity_name",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(C,{})}),e.jsx(de,{type:t==null?void 0:t.entityType,record:n})]})})},De=({...s})=>e.jsx(e.Fragment,{children:e.jsx(K,{...s,entityType:"association",children:e.jsx(ae,{})})}),N=(s,t,n)=>s.map(a=>a.key===t?{...a,children:n}:a.children?{...a,children:N(a.children,t,n)}:a),ce=l.forwardRef(({entityType:s,params:t},n)=>{const[a,i]=l.useState(),[m,d]=l.useState(new Set),[c,h]=l.useState(),[y,o]=l.useState("default"),r=async(j,E,u,p="")=>{const S=await D.post(`/entity/page/${s}`,{page_number:E,page_size:u,parent_id:String(j),keyword:p,...t}),{items:M,total:T}=S.data;if(s=="taxonomy"){const I=M.map(x=>({title:e.jsx(e.Fragment,{children:e.jsxs(f,{title:`${x.entity_name}(${x.rank})(${x.tax_id})`,children:[x.entity_name," (",x.rank,")"]})}),key:x.tax_id,isLeaf:!x.has_children}));return h(I),{children:I,total:T}}else if(s=="mesh"){const I=M.map(x=>({title:e.jsx(e.Fragment,{children:e.jsxs(f,{title:`${x.entity_name}`,children:[x.entity_name,"(",x.entity_id,")"]})}),key:x.tree_number,isLeaf:!x.has_children}));return h(I),{children:I,total:T}}else{const I=M.map(x=>({title:e.jsx(e.Fragment,{children:e.jsx(f,{title:`${x.entity_name}`,children:x.entity_name})}),key:x.entity_id,isLeaf:!x.has_children}));return h(I),{children:I,total:T}}},b=async()=>{const{children:j}=await r(y,1,-1);i(j)};l.useImperativeHandle(n,()=>({reload:b})),l.useEffect(()=>{b()},[s,JSON.stringify(t)]);const g=async({key:j,children:E})=>{if(E)return;d(p=>new Set(p).add(j));const{children:u}=await r(j,1,-1);i(p=>N(p,j,[...u])),d(p=>{const S=new Set(p);return S.delete(j),S})},w=l.useRef(null),[R,L]=l.useState(null),F=()=>{if(w.current){const j=w.current.getBoundingClientRect().top;L(window.innerHeight-j)}};return l.useEffect(()=>(F(),window.addEventListener("resize",F),()=>{window.removeEventListener("resize",F)}),[]),e.jsx("div",{ref:w,children:a?e.jsx(e.Fragment,{children:e.jsx(H,{height:R,loadData:g,treeData:a,showLine:!0,titleRender:j=>m.has(Number(j.key))?e.jsx(Z,{size:"small"}):j.title})}):e.jsx(B,{active:!0})})}),he=s=>{let t=[];switch(s){case"organisms":t=[...t,{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id",render:(n,a)=>e.jsx("a",{href:`https://meshb.nlm.nih.gov/record/ui?ui=${n}`,target:"_blank",children:n})},{title:"entity_name",dataIndex:"entity_name",key:"entity_name",render:(n,a)=>e.jsx(e.Fragment,{children:a!=null&&a.entity_name_en?e.jsx(f,{title:a==null?void 0:a.entity_name_en,children:n}):e.jsx(e.Fragment,{children:n})})},{title:"taxonomy_name",dataIndex:"taxonomy_name",key:"taxonomy_name"},{title:"rank",dataIndex:"rank",key:"rank"},{title:"tax_id",dataIndex:"tax_id",key:"tax_id"},{title:"entity_type",dataIndex:"entity_type",key:"entity_type"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,a)=>n?"exist":"non-existent"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,a)=>n?"exist":"non-existent"}];break;case"mesh":t=[...t,{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id",render:(n,a)=>e.jsx("a",{href:`https://meshb.nlm.nih.gov/record/ui?ui=${n}`,target:"_blank",children:n})},{title:"entity_name",dataIndex:"entity_name",key:"entity_name",render:(n,a)=>e.jsx(e.Fragment,{children:a!=null&&a.entity_name_en?e.jsx(f,{title:a==null?void 0:a.entity_name_en,children:n}):e.jsx(e.Fragment,{children:n})})},{title:"short_name",dataIndex:"short_name",key:"short_name",render:(n,a)=>e.jsx(e.Fragment,{children:n&&Array.isArray(n)&&n.map((i,m)=>e.jsx($,{children:i},m))})},{title:"entity_type",dataIndex:"entity_type",key:"entity_type"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,a)=>n?"exist":"non-existent"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,a)=>n?"exist":"non-existent"},{title:"is_research",dataIndex:"is_research",key:"is_research",render:(n,a)=>n?"research":"non-research"},{title:"tags",dataIndex:"tags",key:"tags",render:(n,a)=>e.jsx(e.Fragment,{children:n&&Array.isArray(n)&&n.map((i,m)=>e.jsx($,{children:i},m))})}];break;case"association":t=[{title:"entity_id",dataIndex:"entity_id",key:"entity_id"},{title:"subject_name",dataIndex:"subject_name",key:"subject_name",render:(n,a)=>e.jsx(e.Fragment,{children:e.jsx(f,{title:a==null?void 0:a.subject_id,children:n})})},{title:"predicate",dataIndex:"predicate",key:"predicate"},{title:"object_name",dataIndex:"object_name",key:"object_name",render:(n,a)=>e.jsx(e.Fragment,{children:e.jsx(f,{title:a==null?void 0:a.object_id,children:n})})},{title:"effect",dataIndex:"effect",key:"effect"},{title:"study_name",dataIndex:"study_name",key:"study_name",render:(n,a)=>e.jsx(e.Fragment,{children:e.jsx(f,{title:a==null?void 0:a.study_id,children:n})})},{title:"observed_name",dataIndex:"observed_name",key:"observed_name",render:(n,a)=>e.jsx(e.Fragment,{children:e.jsx(f,{title:a==null?void 0:a.observed_id,children:n})})},{title:"created_at",dataIndex:"created_at",key:"created_at"}];break;default:t=[{title:"entity_id",dataIndex:"entity_id",key:"taxonomy_id"},{title:"entity_name",dataIndex:"entity_name",key:"entity_name"},{title:"has_children",dataIndex:"has_children",key:"has_children",render:(n,a)=>n?"exist":"non-existent"},{title:"is_exist_graph",dataIndex:"is_exist_graph",key:"is_exist_graph",render:(n,a)=>n?"exist":"non-existent"},{title:"is_research",dataIndex:"is_research",key:"is_research",render:(n,a)=>n?"research":"non-research"}]}return t},ye=(s,t,n,a)=>{let i=[];switch(s){case"association":i=[{title:"操作",key:"action",fixed:"right",width:200,render:(m,d)=>e.jsx(z,{size:"middle",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",color:"cyan",variant:"solid",onClick:()=>{console.log("update:",d),t("optModal",{entityType:s,entityId:d.entity_id})},children:"update"}),e.jsx(O,{title:"Confirm deletion?",onConfirm:async()=>{var c,h,y,o;try{await D.delete(`/entity-relation/delete-association/${d.entity_id}`),a.success("Delete successfully!"),n()}catch(r){console.log((h=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:h.detail),a.error((o=(y=r==null?void 0:r.response)==null?void 0:y.data)==null?void 0:o.detail)}},children:e.jsx(v,{size:"small",danger:!0,variant:"solid",children:"delete"})})]})})}];break;case"mesh":i=[{title:"操作",key:"action",fixed:"right",width:200,render:(m,d)=>e.jsx(z,{size:"middle",children:t&&e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t("entityDetailsModal",{entityType:s,entityId:d.entity_id})},children:"details"}),e.jsx(v,{size:"small",color:"cyan",variant:"solid",onClick:()=>{console.log("update:",d),t("optModal",{entityType:s,entityId:d.entity_id})},children:"update"}),d.is_exist_graph?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"small",color:"cyan",variant:"solid",onClick:()=>{t("graphView",{entityType:s,entityId:d.entity_id,entityName:d.entity_name})},children:"network"}),e.jsx(O,{title:"确认删除节点?",onConfirm:async()=>{var c,h,y,o;try{await D.delete(`/entity/delete-node/${s}/${d.entity_id}`),a.success("删除成功!"),n()}catch(r){console.log((h=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:h.detail),a.error((o=(y=r==null?void 0:r.response)==null?void 0:y.data)==null?void 0:o.detail)}},children:e.jsx(v,{size:"small",danger:!0,variant:"solid",children:"delete"})})]}):e.jsx(O,{title:"Confirm deletion?",onConfirm:async()=>{var c,h,y,o;try{await D.delete(`/entity/delete/${s}/${d.entity_id}`),a.success("Delete successfully!"),n()}catch(r){console.log((h=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:h.detail),a.error((o=(y=r==null?void 0:r.response)==null?void 0:y.data)==null?void 0:o.detail)}},children:e.jsx(v,{size:"small",danger:!0,variant:"solid",children:"delete"})})]})})}];break}return i},ue=l.lazy(()=>Q(()=>import("./graph-view-d4nj6dBI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url)),U=l.forwardRef(({openModals:s,rowSelection:t,disableWidth:n=!1,tabKey:a,params:i,hiddenSwitch:m=!0},d)=>{const[c,h]=l.useState("mesh"),[y,o]=l.useState(i||{category:["F03","C10","F01"]}),[r,b]=l.useState(a||"mental_disorders"),g=l.useRef(null),[w,R]=l.useState("table"),L=()=>{var u;(u=g.current)==null||u.reload()},F=u=>{var p;g.current&&((p=g.current)==null||p.setPageNumber(u))},j=[{key:"mental_disorders",label:"Mental Disorders"},{key:"organisms",label:"Microbe"},{key:"mesh-KEGG",label:"KEGG"},{key:"chemicals_and_drugs",label:"Chemicals and Drugs"}],E=u=>{if(u.startsWith("mesh")){const p=u.split("-")[1];o({category:[p]}),h("mesh")}else u=="organisms"?(h("organisms"),o({category:["B02","B03","B04"],registry_join:"taxonomy"})):u=="mental_disorders"?(o({category:["F03","C10","F01"]}),h("mesh")):u=="chemicals_and_drugs"?(o({category:["D01","D02","D03","D04","D05","D06","D08","D09","D10","D12","D13","D20","D23","D25","D26","D27"]}),h("mesh")):u=="evidence"&&(o({category:["evidence"],registry_join:"study"}),h("mesh"))};return l.useImperativeHandle(d,()=>({reload:L})),e.jsxs("div",{style:n?{}:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsx("div",{style:{marginBottom:"1rem"},children:" "}),!i&&e.jsx(ee,{size:"small",activeKey:r,onChange:u=>{E(u),b(u),F(1)},tabBarExtraContent:e.jsx(e.Fragment,{children:e.jsx(te,{size:"small",value:w,onChange:u=>R(u),options:[{label:"table",value:"table"},{label:"tree",value:"tree"}]})}),items:j}),w=="table"&&e.jsx(e.Fragment,{children:e.jsx(Y,{columns:({openModal:u,reload:p,messageApi:S})=>{const M=he(c),T=ye("mesh",u,p,S);return[...M,...T]},hiddenSwitch:m,rowSelection:t,ref:g,openModal:s,params:y,api:"/entity/page/mesh"})}),w=="tree"&&e.jsx(e.Fragment,{children:e.jsx(ce,{ref:g,entityType:"mesh",params:y})})]})}),G=({...s})=>{const{modals:t,openModals:n,closeModals:a}=A(["entityPage","optModal","graphView","entityDrawer","entityDetailsModal"]),i=l.useRef(null),m=()=>{var d;(d=i.current)==null||d.reload()};return e.jsxs(e.Fragment,{children:[e.jsx(U,{...s,ref:i,openModals:n}),e.jsx(oe,{openModals:n,callback:m,visible:t.optModal.visible,params:t.optModal.params,onClose:()=>a("optModal")}),e.jsx(me,{callback:m,visible:t.graphView.visible,params:t.graphView.params,onClose:()=>a("graphView")}),e.jsx(xe,{openModals:n,callback:m,visible:t.entityDetailsModal.visible,params:t.entityDetailsModal.params,onClose:()=>a("entityDetailsModal")})]})},me=({visible:s,params:t,onClose:n,callback:a})=>e.jsx(V,{title:t==null?void 0:t.entityName,width:"60%",footer:null,open:s,onClose:n,onCancel:n,children:e.jsx(l.Suspense,{fallback:e.jsx(B,{active:!0}),children:e.jsx(ue,{entity_id:t==null?void 0:t.entityId})})}),xe=({visible:s,params:t,onClose:n})=>{const[a,i]=l.useState(!1),[m,d]=l.useState(),[c,h]=l.useState(),y=r=>r.map(b=>({title:b.entity_name,key:b.entity_id,children:b.children?y(b.children):[]})),o=async()=>{i(!0);const r=await D.get(`/entity/get/${t.entityType}/${t.entityId}`),b=y(r.data.parents);h(b),i(!1)};return l.useEffect(()=>{t!=null&&t.entityId&&o()},[t==null?void 0:t.entityId]),e.jsx(P,{open:s,onClose:n,width:"40%",loading:a,children:c&&e.jsx(e.Fragment,{children:e.jsx(H,{treeData:c,defaultExpandAll:!0,showLine:!0,selectable:!0})})})},ve=Object.freeze(Object.defineProperty({__proto__:null,EntityView:U,default:G},Symbol.toStringTag,{value:"Module"}));export{De as A,G as E,ye as a,he as g,ve as i};
