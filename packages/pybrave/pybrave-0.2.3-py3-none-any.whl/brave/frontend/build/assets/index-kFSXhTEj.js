import{g as M,j as t,c as T,V as P,r as n,k as B,Y as R,b as $,t as p,F as D,l as h,P as I,B as a,a as N,Z as O}from"./main-CH82g4dw.js";import{f as V}from"./index-DH4f004y.js";import{r as J,w as Y}from"./index-BKAfqOdf.js";import{F as Z}from"./index-egZsYIid.js";import{T as q}from"./index-B_L60N4-.js";import"./index-B6FNwvkQ.js";import"./index-Pwpmen_B.js";import"./addEventListener-DrXUXNAy.js";import"./index-6IaXHF5K.js";import"./index-BcI8WOZ3.js";import"./Dropdown-B4TP4OlU.js";import"./Table-Rz-gL0vt.js";import"./index-BL_XwOQI.js";import"./index-C0dVCwMu.js";import"./index-DOFo5PXu.js";import"./index-CweiUdAw.js";import"./UpOutlined-MKfWXv9S.js";import"./DeleteOutlined-CIV_DNOf.js";import"./createForOfIteratorHelper-BSFJLzX3.js";import"./DeploymentUnitOutlined-WBguncE1.js";import"./UserSwitchOutlined-D2V22kEV.js";import"./AudioOutlined-Cdmej0V0.js";import"./ClearOutlined-CzC8yyS0.js";import"./TableOutlined-CZ_BS3k3.js";import"./NodeIndexOutlined-Cav4TyHH.js";import"./index-DTJd4Z3p.js";import"./RedoOutlined-DNpCn5kL.js";import"./UndoOutlined-BfseYVP6.js";import"./react-window-Bmvezp4W.js";import"./index-L_EWe7Ii.js";import"./index-B1-7HnQ_.js";import"./index-BtlAu1CQ.js";import"./index-BXUynQ4Q.js";import"./index-D4N7VkC-.js";import"./study-page-CyTzU1IC.js";import"./usePagination-CNS7-0k1.js";import"./index-ZaXfouA1.js";import"./index-DqMpSPzc.js";import"./index-BDU4gvFg.js";import"./index-Cem7jUqj.js";import"./callSuper-wDHXj85E.js";import"./index-BkCTNNpG.js";const $t=()=>{const{analysisId:m}=M();if(!m)return t.jsx("div",{children:"404"});const g=T(),w=P(),{location:x}=w.state||{},y=n.useRef(null),[e,F]=n.useState(null),{messageApi:d}=B(),[E,C]=n.useState(""),[o,j]=n.useState(null),{eventSourceRef:l,status:G,reconnect:H}=R(),[k,b]=n.useState("pipeline_script"),[S,z]=n.useState({}),[A,v]=n.useState(!1);n.useEffect(()=>{var i;if(l){const s=r=>{const f=JSON.parse(r.data);m==f.analysis_id&&(f.event=="analysis_complete"||f.event=="analysis_failed")&&c()};return(i=l.current)==null||i.addEventListener("message",s),()=>{var r;console.log("removeEventListener"),(r=l.current)==null||r.removeEventListener("message",s)}}},[l.current]);const L=async i=>(await J(i)).data,u=async()=>{o&&(await Y(o,y.current.getValue()),d.success("保存成功"))},c=async()=>{const s=(await V(m)).data;F(s),j(s.pipeline_script),z({pipeline_script:s.pipeline_script,script_config_file:s.script_config_file})};n.useEffect(()=>{o&&_(o)},[o]);const _=async(i,s=!1)=>{i&&L(i).then(r=>{C(r.data),s&&d.success(`脚本加载成功: ${i}`)})};n.useEffect(()=>{const i=s=>{(s.ctrlKey||s.metaKey)&&s.key==="s"&&(s.preventDefault(),typeof u=="function"&&u())};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[]);const{openModal:K}=$();return n.useEffect(()=>{c()},[]),t.jsxs("div",{children:[t.jsx(q,{size:"small",activeKey:k,onChange:i=>{b(i),j(S[i]),v(i==="params_path")},tabBarExtraContent:t.jsxs(D,{gap:"small",align:"center",children:[t.jsx(h,{color:"cyan",children:e==null?void 0:e.container_name}),t.jsx(h,{color:"cyan",children:e==null?void 0:e.analysis_status}),t.jsx(h,{color:"cyan",children:e==null?void 0:e.analysis_name}),t.jsx(I,{title:"是否生成脚本",onConfirm:async()=>{await N.post(`/analysis/convert-ipynb/${e.analysis_id}`),d.success("是否生成脚本成功!")},children:t.jsx(a,{size:"small",color:"cyan",variant:"solid",children:"生成脚本"})}),t.jsx(a,{size:"small",color:"cyan",variant:"solid",onClick:()=>{window.open(`http://10.110.1.11:8888/jupyter/notebooks/${e.jupyter_notebook_path}`,"_blank")},children:"jupyter"}),t.jsx(p,{title:t.jsx(t.Fragment,{children:o}),children:t.jsx(a,{size:"small",color:"cyan",variant:"solid",onClick:u,children:"保存"})}),t.jsx(p,{title:t.jsx(t.Fragment,{children:o}),children:t.jsx(a,{size:"small",color:"cyan",variant:"solid",onClick:()=>{_(o,!0)},children:"刷新脚本"})}),t.jsx(a,{size:"small",color:"cyan",variant:"solid",onClick:c,children:"刷新"}),x&&t.jsx(a,{size:"small",color:"cyan",variant:"solid",onClick:()=>{g(x)},children:"返回"})]}),items:[{key:"pipeline_script",label:t.jsx(p,{title:t.jsx(t.Fragment,{children:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.pipeline_script})})}),children:"脚本"})},{key:"script_config_file",label:t.jsx(p,{title:t.jsx(t.Fragment,{children:t.jsx("ul",{children:t.jsx("li",{children:e==null?void 0:e.script_config_file})})}),children:"脚本配置"})}]}),t.jsx(O,{format:A,value:E,editorRef:y,defaultLanguage:"python",height:"50vh"}),t.jsx(Z,{callback:c,analysis:e,operatePipeline:{openModal:K}})]})};export{$t as default};
