import{a as b,r as d,s as R,j as e,D as ee,Z as N,F as M,P as _,B as m,I as O,l as S,c as te,v as re,u as $,d as z,R as J,C as P,S as se,y as ne,m as ie,i as A,t as oe,b as K,M as Y,p as le}from"./main-CH82g4dw.js";import ae from"./index-B6FNwvkQ.js";import{L as ce}from"./index-BKAfqOdf.js";import de from"./index-6IaXHF5K.js";import{E as me}from"./index-BtlAu1CQ.js";import{KGMLMapSVG as pe}from"./index-BXUynQ4Q.js";import{T as he}from"./index-B_L60N4-.js";import{b as xe}from"./index-DqMpSPzc.js";import{B as ue}from"./index-BcI8WOZ3.js";import{F as je}from"./Table-Rz-gL0vt.js";import{C as ge}from"./index-ZaXfouA1.js";import{S as Z}from"./index-C0dVCwMu.js";import{R as fe}from"./DeleteOutlined-CIV_DNOf.js";import{R as ve}from"./RedoOutlined-DNpCn5kL.js";import{A as Q}from"./index-Cem7jUqj.js";import{R as ye}from"./index-CweiUdAw.js";import{I as we}from"./index-Pwpmen_B.js";const et=async r=>await b.get(`/find-analysis-by-id/${r}`),U=async(r,n)=>await b.post(`/run-analysis-v2/${r}?run_type=${n}`),W=async(r,n)=>await b.post(`/analysis/stop-analysis/${r}?run_type=${n}`),be=({visible:r,onClose:n,params:s,callback:p})=>{if(!r)return null;const[i,l]=d.useState(),[j,t]=R.useMessage(),[a,h]=d.useState("main"),g=d.useRef(null),f=async u=>{try{const x=await b.get(`/get-component-module-content/${u.component_id}?script_name=${a}`);console.log(x),l(x.data)}catch(x){j.error(`${x.response.data.detail}`)}};return d.useEffect(()=>{f(s)},[JSON.stringify(s),a]),e.jsxs(e.Fragment,{children:[t,e.jsxs(ee,{extra:e.jsxs(M,{justify:"flex-end",gap:"small",children:[e.jsx(_,{title:"是否生成脚本",onConfirm:async()=>{await b.post(`/component/convert-ipynb/${s.component_id}`),j.success("是否生成脚本成功!"),f(s)},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:"生成脚本"})}),e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{f(s)},children:"刷新"}),e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{g.current.setValue(i==null?void 0:i.content)},children:"保存"})]}),title:"View File",open:r,onClose:n,width:"50%",children:[e.jsx("ul",{children:e.jsxs("li",{children:["path:",i==null?void 0:i.path]})}),e.jsx("hr",{}),e.jsx(he,{onChange:u=>{h(u)},items:[{label:"main",key:"main"},{label:"input_parse",key:"input_parse"},{label:"output_parse",key:"output_parse"}]}),e.jsx(N,{value:i==null?void 0:i.content,editorRef:g,defaultLanguage:"python"})]})]})},D=({url:r,filename:n,baseURL:s})=>e.jsx(e.Fragment,{children:r&&e.jsx(le,{title:e.jsx("div",{style:{wordBreak:"break-all",maxWidth:"400px"},children:`${s}${r}`}),children:e.jsxs(S,{color:"success",style:{cursor:"pointer",whiteSpace:"normal",wordBreak:"break-all",display:"inline-block"},onClick:()=>{window.open(`${s}${r}?t=${Date.now()}`,"_blank")},children:[e.jsxs("span",{children:[n," "]}),e.jsx(ye,{})]})})}),Ce=({data:r,url:n,filename:s,columns:p,baseURL:i,projectObj:l})=>{const{Search:j}=O,[t,a]=d.useState([]),[h,g]=d.useState(),[f,u]=d.useState();d.useEffect(()=>{if(l!=null&&l.research)try{const c=JSON.parse((l==null?void 0:l.research)||"{}");g(c)}catch{}},[l==null?void 0:l.research]);const x=c=>c?Object.keys(c).map(v=>({title:v,dataIndex:v,key:v,ellipsis:!0,width:150})):[];return d.useEffect(()=>{if(r){const c=r.map((v,C)=>({...v,key:C}));a(c)}},[r]),e.jsxs(e.Fragment,{children:[(h==null?void 0:h.table)&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{marginBottom:"1rem"},children:h==null?void 0:h.table.map(c=>e.jsx(S,{color:"blue",style:{cursor:"pointer"},onClick:()=>{const v=r.filter(C=>Object.values(C).some(k=>typeof k=="string"&&k.includes(c)));a(v),u(c)},children:c},c))})}),Array.isArray(t)&&e.jsx(e.Fragment,{children:e.jsx(je,{style:{border:"1px solid #f0f0f0"},size:"small",title:()=>e.jsxs(M,{gap:"small",children:[e.jsx(j,{value:f,size:"small",onChange:c=>{u(c.target.value)},placeholder:"input search text",allowClear:!0,onSearch:c=>{const v=r.filter(C=>Object.values(C).some(k=>typeof k=="string"&&k.includes(c)));a(v)},style:{width:304}}),e.jsx(D,{url:n,filename:s,baseURL:i})]}),scroll:{x:"max-content",y:55*5},dataSource:t,pagination:!1,virtual:!0,columns:p||x(r[0]),footer:()=>`A total of ${r.length} records`})})]})},L=({data:r,url:n,filename:s,columns:p,baseURL:i,projectObj:l})=>{const[j,t]=d.useState({}),[a,h]=d.useState(""),[g,f]=d.useState([]);d.useEffect(()=>{r&&(t({nrow:r==null?void 0:r.nrow,ncol:r==null?void 0:r.ncol}),f((r==null?void 0:r.tables)||[]))},[r]);let u=d.useMemo(()=>a?g.filter(x=>Object.values(x).some(c=>String(c).toLowerCase().includes(a.toLowerCase()))):g,[g,a]);return e.jsxs(e.Fragment,{children:[e.jsxs(M,{gap:"small",children:[e.jsx(O.Search,{size:"small",placeholder:"搜索结果...",allowClear:!0,enterButton:!0,value:a,onChange:x=>h(x.target.value),style:{width:300}}),e.jsx(D,{url:n,filename:s,baseURL:i})]}),e.jsx("div",{style:{height:"50vh"},children:e.jsx(ue,{shape:j,rows:[...u]})})]})},H=({data:r,url:n,filename:s,baseURL:p})=>e.jsx("div",{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(we,{src:s!=null&&s.endsWith("pdf")?r:`${r}?t=${Date.now()}`,style:{maxWidth:"20rem",marginRight:"0.5rem"}}),e.jsx(D,{url:n,filename:s,baseURL:p})]})}),{Paragraph:tt}=A,ke=({data:r})=>e.jsx(e.Fragment,{children:e.jsx(A,{children:e.jsx("pre",{style:{margin:0},children:r})})}),_e=({data:r})=>e.jsx("div",{children:e.jsx(Q,{closable:!0,message:r,type:"info"})}),Se=({data:r})=>e.jsx(e.Fragment,{children:e.jsx(A,{children:e.jsx("pre",{style:{margin:0},children:r})})}),Fe=({data:r})=>e.jsx(e.Fragment,{children:e.jsx(N,{value:r,defaultLanguage:"json"})}),Ie=({data:r,url:n})=>{const{baseURL:s}=$(l=>l.user),[p,i]=d.useState(!0);return e.jsx(e.Fragment,{children:e.jsxs("div",{style:{position:"relative",width:"100%",height:"80vh"},children:[p&&e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.8)",zIndex:1},children:e.jsx(Z,{size:"large",tip:"Loading..."})}),e.jsx("iframe",{src:`${s}${n}`,width:"100%",style:{height:"100%",border:"none"},onLoad:()=>i(!1),title:"content-frame"})]})})},$e=({url:r,filename:n,baseURL:s})=>e.jsx(e.Fragment,{children:e.jsx(D,{url:r,filename:n,baseURL:s})}),Me=({data:r,...n})=>{var l,j,t,a,h;const{modal:s,openModal:p,closeModal:i}=K();return e.jsxs(e.Fragment,{children:[e.jsx(L,{data:r==null?void 0:r.list,...n,columns:[{title:"ID",dataIndex:"ID",key:"ID",ellipsis:!0,width:150},{title:"Description",dataIndex:"Description",key:"Description",ellipsis:!0,width:400},{title:"GeneRatio",dataIndex:"GeneRatio",key:"GeneRatio",ellipsis:!0,width:150},{title:"geneID",dataIndex:"geneID",key:"geneID",ellipsis:!0,width:150},{title:"Count",dataIndex:"Count",key:"Count",ellipsis:!0,width:150},{title:"pvalue",dataIndex:"pvalue",key:"pvalue",ellipsis:!0,width:150},{title:"p.adjust",dataIndex:"p.adjust",key:"p.adjust",ellipsis:!0,width:150},{title:"qvalue",dataIndex:"qvalue",key:"qvalue",ellipsis:!0,width:150},{title:"organism",dataIndex:"organism",key:"organism",ellipsis:!0,width:150},{title:"pathwayId",dataIndex:"pathwayId",key:"pathwayId",ellipsis:!0,width:150},{title:"操作",key:"action",fixed:"right",ellipsis:!0,width:200,render:(g,f)=>e.jsx(e.Fragment,{children:e.jsx(m,{onClick:()=>{p("KGMLMapSVG",f)},size:"small",color:"cyan",variant:"solid",children:"pathview"})})}]}),s.visible&&e.jsx(Y,{width:"80%",title:`${(l=s.params)==null?void 0:l.Description}(${(j=s.params)==null?void 0:j.ID})`,footer:null,onCancel:i,onClose:i,open:s.visible&&s.key=="KGMLMapSVG",children:e.jsx(pe,{compound:r==null?void 0:r.compound,highlightKeys:(t=s.params)==null?void 0:t.geneID.split("/"),pathwayId:(a=s.params)==null?void 0:a.pathwayId,organisms:(h=s.params)==null?void 0:h.organism})})]})},De=({data:r})=>e.jsxs("div",{children:[e.jsx(Q,{closable:!0,message:r,type:"success",action:e.jsx(e.Fragment,{})}),e.jsx(M,{justify:"end",style:{marginBottom:"0.5rem",marginTop:"0.5rem"},children:e.jsxs(S,{color:"success",children:["A total of ",r==null?void 0:r.split(",").length," features"]})})]}),ze={table:L,string:ke,html:Ie,json:Fe,text:Se,info:_e,kegg_map:Me,download:$e,feature_list:De},X=({type:r,...n})=>{const s=ze[r]||(()=>e.jsxs("div",{children:["未知类型 ",r]}));return e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx(s,{...n})})},q=({analysis_id:r,onClose:n,loadTree:s,openPanel:p,overflowY:i="hidden"})=>{var T,G;const[l,j]=d.useState(!1),[t,a]=d.useState(null),h=te(),g=d.useRef(null),f=d.useRef(null),u=ne(),{modals:x,openModals:c,closeModals:v}=re(["editParams","moduleEdit","createOrUpdatePipelineComponent"]),{containerURL:C,project:k}=$(o=>o.user),[Le,Ee]=d.useState(!1),[I]=z.useForm(),F=async o=>{j(!0);const y=await b.get(`/analysis/visualization-results/${o}`);a(y.data),I.resetFields(),I.setFieldsValue(y.data.request_param),g.current=o,j(!1)};function E(o,y){for(const w in y)y[w]&&typeof y[w]=="object"&&!Array.isArray(y[w])?((!o[w]||typeof o[w]!="object")&&(o[w]={}),E(o[w],y[w])):o[w]=y[w];return o}const V=o=>{const y=E({...t==null?void 0:t.request_param},o);return{analysis_id:r,project:k,...y}};d.useEffect(()=>{F(r)},[r]);const B=$(o=>o.global.sseData);return d.useEffect(()=>{const o=B;f.current=o,g.current==o.analysis_id&&(o.event=="analysis_complete"||o.event=="analysis_failed"||o.event=="analysis_started")&&F(g.current)},[B]),e.jsx(e.Fragment,{children:e.jsxs(ge,{size:"small",style:i=="auto"?{flex:1,display:"flex",flexDirection:"column",height:" 100%",boxShadow:"none"}:{boxShadow:"none"},styles:{body:{flex:1,display:"flex",flexDirection:"column",height:" 100%",overflowY:i}},variant:"borderless",title:e.jsx(e.Fragment,{children:t?e.jsxs(e.Fragment,{children:[e.jsx(S,{style:{cursor:"pointer"},onClick:()=>{h(`/component/${t==null?void 0:t.component_type}/${t==null?void 0:t.component_id}`)},children:t==null?void 0:t.component_name}),e.jsx(S,{children:t==null?void 0:t.analysis_name}),e.jsx(S,{children:String(t==null?void 0:t.analysis_id).slice(0,8)}),e.jsx(S,{children:t==null?void 0:t.job_status}),g.current==((T=f.current)==null?void 0:T.analysis_id)&&e.jsxs(S,{children:[" ",e.jsx(e.Fragment,{children:(G=f.current)==null?void 0:G.event})]})]}):e.jsx(e.Fragment,{})}),extra:e.jsxs(M,{gap:"small",wrap:!0,children:[n&&e.jsx(e.Fragment,{children:e.jsx(m,{size:"small",color:"red",variant:"solid",onClick:()=>n(),children:"Close"})}),p&&e.jsxs(e.Fragment,{children:[t&&e.jsxs(m,{size:"small",color:"primary",variant:"solid",onClick:()=>h(`/component/${t==null?void 0:t.component_type}/${t==null?void 0:t.component_id}`),children:["Go ",t==null?void 0:t.component_type]}),e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{p("note")},children:"Open Note"})]}),t&&e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{c("createOrUpdatePipelineComponent",{data:{component_id:t==null?void 0:t.component_id},structure:{component_type:"script"}})},children:"Edit Script"}),t&&e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{c("moduleEdit",{component_id:t==null?void 0:t.component_id})},children:"Component Code"}),e.jsx(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{c("editParams",t.analysis_id)},children:"Edit Parameters"}),(t==null?void 0:t.job_status)=="running"?e.jsx(e.Fragment,{children:e.jsx(_,{title:"Whether or not to stop?",onConfirm:async()=>{await W(t.analysis_id,"job"),u.success("Stop Success")},children:e.jsx(m,{size:"small",color:"red",variant:"solid",children:"Stop"})})}):e.jsx(e.Fragment,{children:e.jsx(_,{title:"Whether or not to run?",onConfirm:async()=>{await U(t.analysis_id,"job"),u.success("run successfully")},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:t.job_status=="created"?"Run":"Re-Run"})})}),(t==null?void 0:t.server_status)=="running"?e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:e.jsx(e.Fragment,{children:`${C}/container/${t.analysis_id}/`}),children:e.jsx(m,{size:"small",color:"blue",variant:"solid",onClick:()=>{window.open(`${C}/container/${t.analysis_id}/`,"_blank")},children:"Open URL"})}),e.jsx(_,{title:"Whether or not to stop?",onConfirm:async()=>{await W(t.analysis_id,"server")},children:e.jsx(m,{size:"small",color:"red",variant:"solid",children:"Stop Server"})})]}):e.jsx(e.Fragment,{children:e.jsx(_,{title:"Whether to start the server?",onConfirm:async()=>{await U(t.analysis_id,"server")},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:"Run Server"})})}),e.jsx(_,{title:t!=null&&t.is_report?"Whether to cancel the report?":"Reported or not?",onConfirm:async()=>{await b.post(`/analysis/update-report/${t==null?void 0:t.analysis_id}`),u.success("operate successfully!"),F(r),s&&s()},children:e.jsx(m,{size:"small",color:"cyan",variant:"solid",children:t!=null&&t.is_report?"Cancel Report":"Report"})}),n&&e.jsx(m,{size:"small",color:"primary",variant:"solid",onClick:()=>h(`/analysis-report?key=${t==null?void 0:t.analysis_id}&project=${k}`),children:"Go Report"}),e.jsx(_,{title:`Delete ${r}?`,onConfirm:async()=>{await b.delete(`/fast-api/analysis/${r}`),u.success("Deleted Successfully!"),s&&s(),n()},children:e.jsx(fe,{style:{cursor:"pointer",color:"red"}})})]}),e.jsx(ve,{style:{cursor:"pointer"},onClick:()=>F(r)})]}),children:[(t==null?void 0:t.job_status)=="failed"?e.jsx("div",{style:{textAlign:"center"},children:e.jsx("div",{style:{flex:1,overflowY:"auto",marginBottom:"1rem"},children:e.jsx(ce,{file_path:t==null?void 0:t.command_log_path})})}):e.jsx(Z,{spinning:l,tip:"loading...",style:{minHeight:"5rem"},children:e.jsxs(J,{gutter:[8,8],children:[e.jsx(P,{lg:16,sm:16,xs:24,children:(t==null?void 0:t.job_status)=="running"&&(t==null?void 0:t.run_type)!="server"?e.jsx(se,{active:!0}):e.jsx(e.Fragment,{children:r&&e.jsx(Ae,{analsyisResult:t,loading:l})})}),e.jsxs(P,{lg:8,sm:8,xs:24,style:{},children:[e.jsx("div",{style:{border:"1px solid rgba(5,5,5,0.06)",maxHeight:"70vh",overflowY:"auto",padding:"0.5rem",marginBottom:"1rem"},children:e.jsx(z,{form:I,size:"small",layout:"vertical",children:(t==null?void 0:t.form_json)&&e.jsxs(e.Fragment,{children:[e.jsx(de,{formJson:t==null?void 0:t.form_json,dataMap:{}}),e.jsx(z.Item,{children:e.jsx(_,{title:"Whether to submit?",onConfirm:async()=>{if((t==null?void 0:t.job_status)=="running")u.error("Running, please wait!");else{const o=V(await I.validateFields());await b.post("/fast-api/analysis-controller?save=true&is_submit=true",o),console.log(o),u.success("Submit Success!")}},children:e.jsx(m,{disabled:(t==null?void 0:t.job_status)=="running",type:"primary",size:"small",children:"Submit"})})}),e.jsx(ie,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(z.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(A,{children:e.jsx("pre",{children:JSON.stringify(V(I.getFieldsValue()),null,2)})})})})}]})]})})}),e.jsx("div",{style:{border:"1px solid rgba(5,5,5,0.06)",maxHeight:"70vh",overflowY:"auto",padding:"0.5rem",marginBottom:"1rem"},children:e.jsx(ae,{data:t==null?void 0:t.description})})]})]})}),e.jsx(me,{callback:()=>{s(),F(r)},visible:x.editParams.visible,params:x.editParams.params,onClose:()=>v("editParams")}),e.jsx(be,{visible:x.moduleEdit.visible,onClose:()=>v("moduleEdit"),callback:()=>F(r),params:x.moduleEdit.params}),e.jsx(xe,{callback:()=>F(r),visible:x.createOrUpdatePipelineComponent.visible,onClose:()=>v("createOrUpdatePipelineComponent"),params:x.createOrUpdatePipelineComponent.params})]})})},Ae=({analsyisResult:r,loading:n})=>{const{baseURL:s}=$(t=>t.user),{projectObj:p}=$(t=>t.user),{modal:i,openModal:l,closeModal:j}=K();return e.jsxs("div",{children:[r&&e.jsxs(e.Fragment,{children:[r.images&&e.jsx("div",{style:{padding:"1rem"},children:Array.isArray(r.images)?e.jsx(J,{gutter:{xs:8,sm:16,md:24,lg:32},children:r.images.map((t,a)=>e.jsx(P,{span:4,children:e.jsx(H,{...t,baseURL:s})},a))}):e.jsx(e.Fragment,{children:e.jsx(H,{...r.images,baseURL:s})})}),e.jsx("div",{style:{padding:"1rem"},children:r.htmls&&Array.isArray(r.htmls)&&e.jsx(e.Fragment,{children:r.htmls.map((t,a)=>e.jsxs("div",{children:[e.jsxs(m,{size:"small",color:"cyan",variant:"solid",onClick:()=>{l("HtmlPreview",{data:t.url})},children:["Open ",t.filename]})," ",e.jsx(D,{url:t.url,filename:t.filename,baseURL:s})]},a))})}),e.jsx("div",{style:{padding:"1rem"},children:r.tables&&Array.isArray(r.tables)&&e.jsx(e.Fragment,{children:r.tables.map((t,a)=>e.jsx(X,{projectObj:p,...t,baseURL:s},a))})})]}),e.jsx(Pe,{baseURL:s,visible:i.visible&&i.key=="HtmlPreview",onClose:j,params:i.params})]})},Pe=({visible:r,onClose:n,params:s,baseURL:p})=>e.jsx(Y,{open:r,onCancel:n,onClose:n,width:"80%",title:"HTML Preview",footer:null,children:(s==null?void 0:s.data)&&e.jsx(e.Fragment,{children:e.jsx("iframe",{src:`${p}${s==null?void 0:s.data}`,width:"100%",style:{height:"80vh",border:"none"}})})}),rt=Object.freeze(Object.defineProperty({__proto__:null,AnalysisResultViewComp:q,ComponentsRender:X,TableView:L,TableView2:Ce,default:q},Symbol.toStringTag,{value:"Module"}));export{X as C,be as M,et as f,rt as i,U as r,W as s};
