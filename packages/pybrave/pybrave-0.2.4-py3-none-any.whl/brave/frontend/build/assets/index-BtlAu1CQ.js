const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-6IaXHF5K.js","./main-CH82g4dw.js","./main-PWR3lu3V.css","./index-BcI8WOZ3.js","./Dropdown-B4TP4OlU.js","./Table-Rz-gL0vt.js","./addEventListener-DrXUXNAy.js","./index-BL_XwOQI.js","./index-C0dVCwMu.js","./index-B_L60N4-.js","./index-DOFo5PXu.js","./index-CweiUdAw.js","./UpOutlined-MKfWXv9S.js","./DeleteOutlined-CIV_DNOf.js","./index-Pwpmen_B.js","./createForOfIteratorHelper-BSFJLzX3.js","./DeploymentUnitOutlined-WBguncE1.js","./UserSwitchOutlined-D2V22kEV.js","./AudioOutlined-Cdmej0V0.js","./ClearOutlined-CzC8yyS0.js","./TableOutlined-CZ_BS3k3.js","./NodeIndexOutlined-Cav4TyHH.js","./index-DTJd4Z3p.js","./RedoOutlined-DNpCn5kL.js","./UndoOutlined-BfseYVP6.js","./react-window-Bmvezp4W.js","./index-L_EWe7Ii.js","./index-B1-7HnQ_.js"])))=>i.map(i=>d[i]);
import{j as e,M,i as O,r as i,F as A,B as h,a as C,d as g,I,P as R,v as B,k as T,m as P,S as U,D as $,l as J,t as q,U as N}from"./main-CH82g4dw.js";import G from"./index-6IaXHF5K.js";import{T as K}from"./index-B_L60N4-.js";import{F as L}from"./Table-Rz-gL0vt.js";const W=({visible:n,onClose:l,params:c})=>e.jsx(M,{footer:null,title:"参数",width:"50%",open:n,onCancel:l,children:e.jsx(O,{children:e.jsx("pre",{children:JSON.stringify(c,null,2)})})}),H=({formJson:n,openModal:l})=>{if(!n)return null;const[c,m]=i.useState([]),p=async()=>{const j=n.map(r=>r.dataKey),s=((await C.post("/list-bio-database",{type_list:j})).data||[]).reduce((r,d)=>{const y=d.type;r[y]||(r[y]=[]);const{name:b,database_id:f,...x}=d;return r[y].push({label:b,value:f,...x}),r},{});m(s),console.log(s)};return i.useEffect(()=>{p()},[n]),e.jsx(e.Fragment,{children:e.jsxs(A,{gap:"small",children:[e.jsx("div",{style:{flex:1},children:e.jsx(G,{formJson:n,dataMap:c})}),e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:l,children:"配置数据库"}),e.jsx(h,{onClick:p,size:"small",type:"primary",children:"刷新"})]})})},Q=({visible:n,onClose:l,params:c,callback:m})=>{if(!n)return null;const[p,j]=i.useState([]),[D,s]=i.useState(!1),[r]=g.useForm(),[d,y]=i.useState(c[0].dataKey),[b,f]=i.useState(null),x=async a=>{s(!0);const o=await C.post("/list-bio-database",a);j(o.data),s(!1)},V=async()=>({...await r.validateFields(),type:d}),F=async()=>{const a=await V();b?await C.post("/update-bio-database",{...a,database_id:b.database_id}):await C.post("/add-bio-database",a),_(),f(void 0),r.resetFields()},_=()=>{x({type:d})};i.useEffect(()=>{x({type:d})},[c]);const v=a=>{y(a),x({type:a})},S=async a=>{await C.delete(`/delete-bio-database/${a.id}`),_()},u=a=>{r.setFieldsValue(a),f(a)};return e.jsxs(M,{title:"数据库操作",open:n,onCancel:l,width:"50%",footer:null,children:[e.jsx(K,{tabBarExtraContent:e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"small",color:"cyan",variant:"solid",style:{marginRight:"0.5rem"},type:"primary",onClick:_,children:" 刷新"}),e.jsxs(h,{size:"small",color:"cyan",variant:"solid",type:"primary",onClick:()=>{f(void 0),F()},children:[" ",b?"更新":"添加"]})]}),activeKey:d,onChange:v,items:c.map(a=>({key:a.name,label:a.label,children:e.jsx("div",{})}))}),e.jsxs(g,{form:r,style:{maxWidth:600},labelCol:{span:3},children:[e.jsx(g.Item,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"}],children:e.jsx(I,{})}),e.jsx(g.Item,{name:"path",label:"路径",rules:[{required:!0,message:"请输入路径"}],children:e.jsx(I,{})}),e.jsx(g.Item,{name:"db_index",label:"索引",children:e.jsx(I,{})})]}),e.jsx(L,{dataSource:p,columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"数据库ID",dataIndex:"database_id",key:"database_id"},{title:"类型",dataIndex:"type",key:"type"},{title:"路径",dataIndex:"path",key:"path"},{title:"索引",dataIndex:"db_index",key:"db_index"},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,render:(a,o)=>e.jsxs(A,{gap:"small",children:[e.jsx(R,{title:"确定删除吗？",onConfirm:()=>{S(o)},children:e.jsx(h,{size:"small",type:"primary",danger:!0,children:"删除"})}),e.jsx(h,{size:"small",type:"primary",onClick:()=>{u(o)},children:"编辑"})]})}],loading:D,pagination:!1})]})},E=i.lazy(()=>N(()=>import("./index-6IaXHF5K.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]),import.meta.url)),ae=({visible:n,params:l,onClose:c,callback:m})=>{var _,v,S;const[p]=g.useForm(),{messageApi:j,project:D}=T();i.useEffect(()=>{n&&V()},[l]);const[s,r]=i.useState(),[d,y]=i.useState(),b=()=>{c(),m&&m()},[f,x]=i.useState(),V=async()=>{x(!0);const u=await C.post(`/analysis/edit-params/${l}`);r(u.data),y(u.data.analysis_result),p.resetFields(),p.setFieldsValue(u.data.request_param),x(!1)},F=u=>{if(u&&Object.keys(u).length>0)return Object.keys(u)[0]};return e.jsx(e.Fragment,{children:e.jsx($,{extra:e.jsx(e.Fragment,{}),size:"default",loading:f,title:e.jsx(e.Fragment,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx(J,{children:s==null?void 0:s.component_name}),e.jsx(J,{color:"success",children:s==null?void 0:s.analysis_name}),e.jsx(q,{title:s==null?void 0:s.analysis_id,children:e.jsx(J,{children:String(s==null?void 0:s.analysis_id).slice(0,8)})})]})}),width:"50%",open:n,onClose:c,children:s&&e.jsx(e.Fragment,{children:e.jsx(X,{form:p,requestParam:{...s.request_param,analysis_id:s==null?void 0:s.analysis_id},dataMap:{...d,first_data_key:F(d)},formJson:[...((_=s.content)==null?void 0:_.formJson)||[],...((v=s.content)==null?void 0:v.upstreamFormJson)||[],...(s==null?void 0:s.inputFormJson)||[],(s==null?void 0:s.component_type)=="software"?{name:"group_field",label:"Group Field",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"}:{}],databases:(S=s.content)==null?void 0:S.databases,upstreamFormJson:s==null?void 0:s.upstreamFormJson,callback:b})})})})},X=({form:n,requestParam:l,dataMap:c,formJson:m,databases:p,callback:j,analysisResultId:D,showCancal:s=!1})=>{const{modals:r,openModals:d,closeModals:y}=B(["paramsView","bioDatabases"]),[b,f]=i.useState([]),[x,V]=i.useState([]),{messageApi:F}=T();i.useEffect(()=>{_()},[JSON.stringify(m)]);const _=()=>{if(Array.isArray(m)){const a=m.filter(t=>!(t!=null&&t.required)&&!(t!=null&&t.db)&&!t.component_id),o=m.filter(t=>(t==null?void 0:t.required)||(t==null?void 0:t.db)||t.component_id);f(o),V(a)}},v=a=>({...l,...a}),S=async()=>{var t;const a=await n.validateFields(),o=v(a);delete o.analysis_id,console.log(o);try{const w=await C.post("/fast-api/analysis-controller?save=true&is_submit=true&is_report=true",o);console.log(w),F.success("Created Successfully!"),j&&j()}catch(w){console.log(w),(t=w.response)!=null&&t.data&&F.error(w.response.data.detail)}},u=async(a,o=!1)=>{var z;const t=await n.validateFields(),w=v(t);try{const k=await C.post(`/fast-api/analysis-controller?save=${a}&is_submit=${o}`,w);console.log(k),a?(F.success("执行成功!"),j&&j()):d("paramsView",k.data)}catch(k){console.log(k),(z=k.response)!=null&&z.data&&F.error(k.response.data.detail)}};return e.jsxs(i.Suspense,{fallback:e.jsx(U,{active:!0}),children:[e.jsxs(g,{form:n,onValuesChange:(a,o)=>{},children:[e.jsx(K,{items:[{key:"1",label:"Required Parameters",forceRender:!0,children:e.jsxs(e.Fragment,{children:[e.jsx(E,{analysisResultId:D,formJson:[...b],dataMap:c}),p&&e.jsx(H,{openModal:()=>{d("bioDatabases",p)},formJson:p})]})},{key:"2",label:"Optional parameters",forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(E,{formJson:[...x],dataMap:{}})})}]}),e.jsx(g.Item,{label:"Analysyis Name",name:"analysis_name",style:{maxWidth:600},rules:[{required:!0,message:"This field cannot be empty!"}],children:e.jsx(I,{})}),e.jsxs(A,{gap:"small",children:[e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:()=>{u(!1)},children:"View Parameters"}),e.jsx(h,{size:"small",color:"cyan",variant:"solid",onClick:()=>u(!0),children:l!=null&&l.analysis_id?e.jsxs(e.Fragment,{children:["Update Analysis(",l.analysis_name,")(",String(l.analysis_id).slice(0,8),")"]}):e.jsx(e.Fragment,{children:"Save Analysis"})}),(l==null?void 0:l.analysis_id)&&s&&e.jsx(h,{size:"small",color:"cyan",onClick:()=>n.setFieldValue("analysis_id",void 0),children:"Cancel Analysis"}),e.jsx(R,{title:"Are you sure to create a new analysis?",onConfirm:S,children:e.jsx(h,{size:"small",color:"orange",variant:"solid",onClick:()=>n.setFieldValue("analysis_id",void 0),children:"Create Analysis"})})]}),e.jsx(P,{ghost:!0,items:[{key:"1",label:"More",children:e.jsx(e.Fragment,{children:e.jsx(g.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(O,{children:e.jsx("pre",{children:JSON.stringify(v(n.getFieldsValue()),null,2)})})})})}]})]}),e.jsx(W,{visible:r.paramsView.visible,onClose:()=>y("paramsView"),params:r.paramsView.params}),e.jsx(Q,{visible:r.bioDatabases.visible,onClose:()=>y("bioDatabases"),params:r.bioDatabases.params})]})};export{Q as B,X as C,ae as E,W as P,H as a};
