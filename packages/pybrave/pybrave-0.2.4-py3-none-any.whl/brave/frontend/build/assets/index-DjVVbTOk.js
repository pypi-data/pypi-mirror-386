import{r as c,f as k,j as e,F as v,B as u,a as b,b as C,I as F,t as y}from"./main-CH82g4dw.js";import{O as I}from"./index-BEOOoW84.js";import{B as w}from"./index-DGWw7hz7.js";import{T as $}from"./index-B_L60N4-.js";import{F as T}from"./Table-Rz-gL0vt.js";import"./index-BKAfqOdf.js";import"./index-ZaXfouA1.js";import"./index-B6FNwvkQ.js";import"./index-Pwpmen_B.js";import"./addEventListener-DrXUXNAy.js";import"./index-DH4f004y.js";import"./index-6IaXHF5K.js";import"./index-BcI8WOZ3.js";import"./Dropdown-B4TP4OlU.js";import"./index-C0dVCwMu.js";import"./index-BL_XwOQI.js";import"./index-DOFo5PXu.js";import"./index-CweiUdAw.js";import"./UpOutlined-MKfWXv9S.js";import"./DeleteOutlined-CIV_DNOf.js";import"./createForOfIteratorHelper-BSFJLzX3.js";import"./DeploymentUnitOutlined-WBguncE1.js";import"./UserSwitchOutlined-D2V22kEV.js";import"./AudioOutlined-Cdmej0V0.js";import"./ClearOutlined-CzC8yyS0.js";import"./TableOutlined-CZ_BS3k3.js";import"./NodeIndexOutlined-Cav4TyHH.js";import"./index-DTJd4Z3p.js";import"./RedoOutlined-DNpCn5kL.js";import"./UndoOutlined-BfseYVP6.js";import"./react-window-Bmvezp4W.js";import"./index-L_EWe7Ii.js";import"./index-B1-7HnQ_.js";import"./index-BtlAu1CQ.js";import"./index-BXUynQ4Q.js";import"./index-D4N7VkC-.js";import"./study-page-CyTzU1IC.js";import"./usePagination-CNS7-0k1.js";import"./index-DqMpSPzc.js";import"./index-BDU4gvFg.js";import"./index-Cem7jUqj.js";import"./callSuper-wDHXj85E.js";import"./Paired-CYeW8vca.js";import"./rgb-DmU_BU0N.js";var g=function(){return g=Object.assign||function(a){for(var t,r=1,m=arguments.length;r<m;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},g.apply(this,arguments)},_=c.forwardRef(function(a,t){return k.createElement(w,g({},a,{chartType:"Bar",ref:t}))}),j=function(){return j=Object.assign||function(a){for(var t,r=1,m=arguments.length;r<m;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},j.apply(this,arguments)},B=c.forwardRef(function(a,t){return k.createElement(w,j({},a,{chartType:"Column",ref:t}))});const Ce=({analysis_id:a,onClose:t})=>{const[r,m]=c.useState(),[n,i]=c.useState(!1);function h(o){const s=o.match(/(\d+)m/),p=o.match(/(\d+)s/),f=s?parseInt(s[1]):0,l=p?parseInt(p[1]):0;return f*60+l}const d=async()=>{i(!0);const o=await b.get(`/analysis/analysis-progress/${a}`),s={};o.data.forEach(l=>{const x=`${l.process}-${l.status}`;s[x]||(s[x]={process:l.process,status:l.status,count:0}),s[x].count+=1});const p=Object.values(s),f=o.data.map(l=>({process:l.process,task:l.task_id,realtime:h(l.realtime),label:l.realtime}));m({table:o.data,statusData:p,timeData:f}),i(!1)};return c.useEffect(()=>{d()},[]),e.jsx("div",{children:r&&e.jsx($,{tabBarExtraContent:e.jsxs(v,{gap:"small",children:[e.jsx(u,{size:"small",color:"cyan",variant:"solid",onClick:d,children:"Refresh"}),t&&e.jsx(u,{size:"small",color:"red",variant:"solid",onClick:t,children:"Close"})]}),defaultActiveKey:"0",onChange:()=>{window.dispatchEvent(new Event("resize"))},items:[{key:"0",label:"任务表格",children:e.jsx(E,{data:(r==null?void 0:r.table)||[]})},{key:"1",label:"任务状态",children:e.jsx(S,{data:(r==null?void 0:r.statusData)||[]})},{key:"2",label:"运行时间",children:e.jsx(O,{data:(r==null?void 0:r.timeData)||[]})}]})})},O=({data:a})=>{const t=Array.from(new Set(a.map(i=>i.process))),[r,m]=c.useState(t[0]),n=a.filter(i=>i.process===r);return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:16},children:t.map(i=>e.jsx(u,{size:"small",type:i===r?"primary":"default",onClick:()=>m(i),style:{marginRight:8},children:i},i))}),e.jsx(B,{data:n})]})},S=({data:a})=>{const t={data:a,xField:"process",yField:"count",colorField:"status",stack:!0,sort:{reverse:!0,by:"y"},style:{maxWidth:50}};return e.jsx(_,{...t})},E=({data:a})=>{const{modal:t,openModal:r,closeModal:m}=C(),n=[{title:"process",dataIndex:"process",key:"process",ellipsis:!0},{title:"tag",dataIndex:"tag",key:"tag",ellipsis:!0},{title:"name",dataIndex:"name",key:"name",ellipsis:!0,render:(o,s)=>e.jsx(y,{title:e.jsx(e.Fragment,{children:e.jsx("ul",{children:e.jsxs("li",{children:[" ",s.workdir," "]})})}),children:o})},{title:"container",dataIndex:"container",key:"container",ellipsis:!0},{title:"status",dataIndex:"status",key:"status",ellipsis:!0},{title:"realtime",dataIndex:"realtime",key:"realtime",ellipsis:!0},{title:"cpus",dataIndex:"cpus",key:"cpus",ellipsis:!0,render:(o,s)=>e.jsx(y,{title:e.jsx(e.Fragment,{children:s["%cpu"]}),children:o})},{title:"memory",dataIndex:"memory",key:"memory",ellipsis:!0,width:100,render:(o,s)=>e.jsx(y,{title:e.jsx(e.Fragment,{children:s["%mem"]}),children:o})},{title:"操作",key:"action",fixed:"right",ellipsis:!0,width:200,render:(o,s)=>e.jsx(v,{gap:"small",children:e.jsx(u,{size:"small",color:"cyan",variant:"solid",onClick:()=>{r("openFile",{content:{".command.sh":`${s.workdir}/.command.sh`,".command.trace":`${s.workdir}/.command.trace`,".command.run":`${s.workdir}/.command.run`,".command.out":`${s.workdir}/.command.out`,".command.err":`${s.workdir}/.command.err`,".command.begin":`${s.workdir}/.command.begin`}})},children:"查看"})})}],[i,h]=c.useState(""),d=c.useMemo(()=>i?a.filter(o=>Object.values(o).some(s=>String(s).toLowerCase().includes(i.toLowerCase()))):a,[a,i]);return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:()=>e.jsx(F.Search,{size:"small",placeholder:"搜索任务...",allowClear:!0,enterButton:!0,value:i,onChange:o=>h(o.target.value),style:{width:300}}),scroll:{x:"max-content",y:55*5},size:"small",bordered:!0,footer:()=>`A total of ${d.length} records`,columns:n,dataSource:d,rowKey:o=>o.task_id}),e.jsx(I,{visible:t.key=="openFile"&&t.visible,onClose:m,params:t.params})]})};export{Ce as default};
