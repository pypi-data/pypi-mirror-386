import{I as se,u as W,c as te,k as oe,b as ae,r as n,j as e,R as z,C as j,F as b,P as q,X as ne,a as _,s as re,t as I,l as G,E as H,B as A,S as le,M as ie,y as ce}from"./main-CH82g4dw.js";import{C as $,M as Q}from"./index-ZaXfouA1.js";import{c as V}from"./utils-D2B0dIuM.js";import{b as pe,p as de}from"./index-DqMpSPzc.js";import{u as he}from"./usePagination-CNS7-0k1.js";import{D as ge}from"./index-BQEFpL7P.js";import{u as me}from"./useStickyTop-B1b0XRLa.js";import{S as K,P as xe}from"./index-C0dVCwMu.js";import{a as ue,R as ye}from"./index-CweiUdAw.js";import{L as Y}from"./index-BkCTNNpG.js";import{R as U}from"./RedoOutlined-DNpCn5kL.js";import{T as X}from"./index-B_L60N4-.js";import{S as fe}from"./index-L_EWe7Ii.js";import"./index-BDU4gvFg.js";import"./Table-Rz-gL0vt.js";import"./addEventListener-DrXUXNAy.js";import"./index-BL_XwOQI.js";import"./Dropdown-B4TP4OlU.js";import"./UpOutlined-MKfWXv9S.js";import"./DeleteOutlined-CIV_DNOf.js";import"./index-DOFo5PXu.js";const Oe=({params:g,map:p})=>{const{Search:l}=se,{baseURL:R}=W(t=>t.user),L=te(),{messageApi:J}=oe(),{modal:r,openModal:m,closeModal:C}=ae(),[v,B]=n.useState("all"),{ref:P,top:x,isSticky:S}=me(576),{component_type:k}=g,M=t=>(p&&(t=p(t)),t.tags&&(t.tags=JSON.parse(t.tags)),{id:t.id,component_id:t.component_id,name:t.name,category:t.category,img:t.img,tags:t.tags,component_type:t.component_type,order:t.order_index,path:`/component/${k}/${t.component_id}`,namespace:t.namespace,namespace_name:t.namespace_name}),{data:i,pageNumber:N,totalPage:u,loading:T,reload:d,pageSize:E,setPageNumber:y,search:F}=he({pageApi:de,params:{category:v,...g},map:M,initialPageSize:12}),[D,O]=n.useState([]),[w,h]=n.useState(!1),f=async()=>{h(!0);const t=await _.get("/component/get-all-category");O(["all",...t.data]),h(!1)};return n.useEffect(()=>{f()},[]),e.jsxs("div",{style:{maxWidth:"1800px",margin:"1rem auto"},children:[e.jsxs(z,{ref:P,gutter:[S?16:0,16],children:[e.jsx(j,{lg:21,sm:21,xs:24,style:{display:"flex",flexDirection:"column",height:"100%"},children:e.jsxs($,{size:"small",style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(e.Fragment,{children:e.jsxs(b,{gap:"small",children:[e.jsx(A,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("installComponents",{component_type:k})},children:"Intsall Components "}),e.jsx(A,{size:"small",color:"cyan",variant:"solid",onClick:()=>{m("modalA",{data:void 0,structure:{component_type:k}})},children:"Create Components "}),e.jsx(A,{size:"small",color:"primary",variant:"solid",onClick:d,children:"Refresh"})]})}),title:e.jsx(e.Fragment,{children:e.jsx(l,{size:"small",placeholder:"Search Components",allowClear:!0,enterButton:!0,onSearch:t=>{F(t)},style:{width:400}})}),children:[e.jsx(K,{spinning:T,children:Array.isArray(i)&&i.length!=0?e.jsx(z,{gutter:16,style:{position:"relative"},children:i.map((t,s)=>e.jsx(j,{lg:6,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsxs($,{hoverable:!0,size:"small",className:"custom-card",variant:"borderless",style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},bodyStyle:{padding:"12px 16px"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:t.label,src:`${R}${t.img}`})}),onClick:()=>L(`${t.path}`),children:[e.jsx(Q,{title:e.jsxs(b,{gap:"small",children:[e.jsx("span",{children:t.name}),e.jsx(q,{title:"Copy component ?",onConfirm:async o=>{o.stopPropagation(),await _.post(`/copy-component/${t.component_id}`),re.success("Component copied!"),d()},children:e.jsx(ne,{onClick:o=>{o.stopPropagation()}})})]}),description:t==null?void 0:t.description,style:{marginBottom:"1rem"}}),t.tags&&Array.isArray(t.tags)&&t.tags.map((o,a)=>e.jsx(I,{title:o,children:e.jsx(G,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:V[a],children:o})},a)),e.jsx("div",{onClick:o=>{o.stopPropagation(),m("modalG",t)},style:{position:"absolute",right:10,bottom:10,fontSize:15,color:"rgba(0,0,0,0.45)",cursor:"pointer"},children:e.jsx(ue,{})})]})},s))}):e.jsx(H,{})}),u!=0&&e.jsxs(b,{style:{marginTop:"1rem"},align:"center",children:["A total of ",u,"records Â ",e.jsx(xe,{current:N,pageSize:E,total:u,onChange:t=>y(t),showSizeChanger:!1})]})]})}),e.jsx(j,{lg:3,sm:3,xs:24,style:S?{overflow:"hidden",position:"sticky",top:`${x}px`,alignSelf:"flex-start",height:`calc(100vh - ${x}px - 1rem )`}:{},children:e.jsx($,{style:{flex:1,display:"flex",flexDirection:"column",height:" 100%"},styles:{body:{flex:1,overflowY:"auto"}},extra:e.jsx(U,{style:{cursor:"pointer"},onClick:()=>f()}),size:"small",loading:w,title:e.jsx("span",{style:{fontWeight:600},children:"Category"}),children:w?e.jsx(le,{active:!0,paragraph:{rows:5}}):e.jsx(Y,{dataSource:D,split:!1,renderItem:t=>e.jsx(Y.Item,{style:{padding:"6px 0",border:"none"},children:e.jsx(A,{block:!0,type:v===t?"primary":"default",onClick:()=>B(t),style:{textAlign:"left",borderRadius:"8px",transition:"all 0.2s"},className:"hover:shadow-md",children:t})})})})})]}),e.jsx(pe,{callback:d,visible:r.key=="modalA"&&r.visible,onClose:C,params:r.params}),e.jsx(ge,{visible:r.key=="modalG"&&r.visible,onClose:C,callback:d,params:r.params}),e.jsx(je,{visible:r.key=="installComponents"&&r.visible,onClose:C,callback:d,params:r.params})]})},je=({visible:g,onClose:p,params:l,callback:R})=>{const[L,J]=n.useState([]),[r,m]=n.useState([]),[C,v]=n.useState(!1),[B,P]=n.useState(!1),[x,S]=n.useState(),{baseURL:k}=W(s=>s.user),M=ce(),[i,N]=n.useState("github"),{githubToken:u,storeRepos:T}=W(s=>s.user),[d,E]=n.useState([]),[y,F]=n.useState("all"),[D,O]=n.useState();n.useEffect(()=>{g&&(l!=null&&l.component_type)&&w()},[g,l==null?void 0:l.component_type,i]);const w=async()=>{try{v(!0);let o=(await _.get(`/component-store/list-stores?address=${i}`)).data;if(i=="github"&&(o=[...JSON.parse(T||"[]").filter(c=>c.address==i),...o]),J(o),o.length>0){const a=o[0];S(a.store_name),h(a.store_name,void 0,a==null?void 0:a.store_path),O(a==null?void 0:a.store_path)}else m([]);v(!1)}catch{}},h=async(s,o=void 0,a=void 0)=>{P(!0);try{const c=await _.post("/component-store/list-components",{store_name:s,component_type:l==null?void 0:l.component_type,address:i,remote_force:o,token:u,store_path:a||D}),Z=c.data.map(ee=>ee.category);E(["all",...Array.from(new Set(Z))]),m(c.data)}catch{}P(!1)},f=n.useMemo(()=>y=="all"?r:r.filter(s=>s.category==y),[r,y]),t=s=>s.startsWith("http")?s:`${k}${s}`;return e.jsx(ie,{footer:null,title:e.jsxs(b,{gap:"small",children:[e.jsxs("span",{children:["Install Components"," "]}),e.jsx(U,{style:{cursor:"pointer"},onClick:()=>{i=="github"?h(x,!0):h(x)}})]}),width:"90%",open:g,onClose:p,onCancel:p,children:e.jsxs(K,{spinning:C,children:[e.jsx(X,{size:"small",tabBarExtraContent:e.jsxs(b,{gap:"small",children:[e.jsx(fe,{value:i,options:[{label:"Github",value:"github"},{label:"Local",value:"local"}],onChange:s=>{N(s)}}),e.jsx(U,{style:{cursor:"pointer"},onClick:()=>w()})]}),activeKey:x,onChange:s=>{S(s),h(s)},items:L.map(s=>({key:s.store_name,label:e.jsx(I,{title:s.store_path,children:s.name?s.name:s.store_name})}))}),e.jsx(K,{spinning:B,children:e.jsxs(z,{children:[e.jsx(j,{lg:21,sm:21,xs:24,children:Array.isArray(f)&&f.length!=0?e.jsx(z,{gutter:16,style:{position:"relative"},children:f.map((s,o)=>e.jsx(j,{lg:4,sm:4,xs:24,style:{marginBottom:"1rem",cursor:"pointer"},children:e.jsx(q,{okButtonProps:{color:`${s.installed?"red":"blue"}`,variant:"solid"},okText:s.installed?"Reinstall":"Install",title:s.installed?`Reinstall ${s.component_name} ?`:`Install ${s.component_name} ?`,onConfirm:async()=>{await _.post("/install-components",{path:s.file_path,force:!0,address:s.address,branch:s.branch,token:u},{timeout:6e4}),M.success(s.installed?"Reinstall success!":"Install success!"),R&&R(),p&&p()},children:e.jsxs($,{size:"small",hoverable:!0,className:"custom-card",title:e.jsx(I,{title:s==null?void 0:s.component_id,children:s.component_name}),style:{height:"100%",border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",transition:"all 0.3s ease"},cover:e.jsx("div",{style:{height:"15rem"},children:e.jsx("img",{style:{height:"100%",width:"100%",objectFit:"cover"},alt:s.label,src:t(s.img)})}),children:[e.jsx(Q,{title:e.jsxs(b,{justify:"space-between",align:"center",children:[e.jsx(G,{color:s.installed?"#108ee9":"#f5222d",children:s.installed?"Installed":"Not I nstalled"}),e.jsx(ye,{style:{cursor:"pointer"}})]}),description:s==null?void 0:s.description,style:{marginBottom:"1rem"}}),s.tags&&Array.isArray(s.tags)&&s.tags.map((a,c)=>e.jsx(I,{title:a,children:e.jsx(G,{style:{wordBreak:"break-word",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:100,display:"inline-block",cursor:"default"},color:V[c],children:a})},c))]})})},o))}):e.jsx(H,{})}),e.jsx(j,{lg:3,sm:3,xs:24,children:e.jsx(X,{activeKey:y,onChange:s=>F(s),tabBarStyle:{marginBottom:0},type:"card",size:"small",tabPosition:"right",items:d.map(s=>({key:s,label:s}))})})]})})]})})};export{Oe as default};
