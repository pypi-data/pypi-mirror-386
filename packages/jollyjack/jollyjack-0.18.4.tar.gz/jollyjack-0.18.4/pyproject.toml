[build-system]
requires = [
  "setuptools>=55",
  "Cython>=3",
  "pyarrow~=21.0.0",
  "numpy>=1.16.6",
]

build-backend = "setuptools.build_meta"

[project]
name = "jollyjack"
version = "0.18.4"
description = "Read parquet data directly into numpy array"
readme = "README.md"
requires-python = ">=3.9"
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: OS Independent",
]
dependencies = [
  "pyarrow~=21.0.0",
  "numpy>=1.16.6",
]

[tool.setuptools.packages.find]
include = ['jollyjack*']

[tool.setuptools.package-data]
"*" = ["*.pxd", "*.h", "*.pyx"]

[project.urls]
Homepage = "https://github.com/marcin-krystianc/jollyjack"
Issues = "https://github.com/marcin-krystianc/jollyjack/issues"


########################### cibuildwheel ###########################
[tool.cibuildwheel]
skip = [
 "*_i686", 
 "*-musllinux_*",
 "*win32",
 "cp314-*",
 "cp314t-*",
]

# We use manylinux_2_28 for ABI compatibility with pyarrow
manylinux-x86_64-image = "manylinux_2_28"
manylinux-aarch64-image = "manylinux_2_28"

########################### cibuildwheel Linux #####################
[tool.cibuildwheel.linux]
# ODO: Use native arch64 runner once repo is moved to corporate GitHub org
archs = ["auto", "aarch64",]

repair-wheel-command = [
 "auditwheel repair --exclude libarrow.so.2100 --exclude libparquet.so.2100 -w {dest_dir} {wheel}",
]

before-all = [
  "yum -y install liburing-devel",
]

########################### cibuildwheel Windows ###################
[tool.cibuildwheel.windows]
before-build = "pip install delvewheel"
repair-wheel-command = "delvewheel repair --exclude arrow.dll --exclude parquet.dll -w {dest_dir} {wheel}"

########################### cibuildwheel MacOS #####################
[tool.cibuildwheel.macos]
before-build = "pip install delocate"
repair-wheel-command = ""
