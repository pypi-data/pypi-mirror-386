# Cursor Rules 说明文档

本项目包含了一系列 Cursor Rules，用于指导开发团队在实现数据面功能的同时，为控制面设计预留必要的接口和架构。

## 规则文件概览

### 1. `project_architecture_rules.mdc` - 项目架构规则
**描述**: 定义项目的整体架构设计和实现范围
**适用范围**: 所有项目文件
**主要内容**:
- 项目定位：数据面实现 + 控制面设计
- 架构设计原则：数据面优先，控制面预留
- 实现范围：代码、Docker、配置的具体实现要求
- 控制面设计：需要设计但不需要实现的组件
- 技术架构：服务架构、接口设计、数据流设计

### 2. `implementation_scope_rules.mdc` - 实现范围规则
**描述**: 详细定义具体的实现范围和技术规范
**适用范围**: 代码、配置、Docker 相关文件
**主要内容**:
- 核心实现范围：数据面服务、Docker、配置管理
- 控制面设计范围：接口设计、配置格式、监控协议
- 技术实现规范：代码实现、Docker 实现、配置管理
- 实现检查清单：确保所有必要功能得到实现

## 核心原则

### 🎯 数据面优先（Data Plane First）
- **专注实现**：所有代码实现必须围绕数据面功能
- **性能优先**：确保沙盒代码执行的性能和稳定性
- **资源管理**：实现高效的资源分配、使用和回收
- **安全隔离**：确保沙盒环境的完全隔离和安全

### 🏗️ 控制面设计（Control Plane Design）
- **接口预留**：为控制面预留清晰的接口定义
- **配置支持**：支持控制面的配置下发和管理
- **监控集成**：提供控制面需要的监控数据
- **扩展性设计**：确保架构支持未来的控制面扩展

## 实现边界

### ✅ 需要实现的部分
- **核心服务**：文件系统、进程管理、终端会话服务
- **API 层**：gRPC 和 HTTP REST API 实现
- **业务逻辑**：沙盒生命周期管理、资源隔离、安全控制
- **Docker 支持**：服务镜像、基础镜像、多架构支持
- **配置管理**：YAML 配置、环境变量、配置验证
- **监控指标**：性能指标、资源使用、健康检查

### 🎯 需要设计但不需要实现的部分
- **API 网关**：路由、认证、限流、监控
- **配置中心**：配置存储、版本管理、分发策略
- **服务发现**：服务注册、健康检查、负载均衡
- **监控告警**：指标聚合、告警规则、通知渠道
- **用户管理**：身份认证、权限控制、审计日志
- **容器编排**：Kubernetes 部署、服务网格

## 使用指南

### 1. 开发新功能时
1. 参考 `implementation_scope_rules.mdc` 确认实现范围
2. 遵循 `project_architecture_rules.mdc` 的架构原则

### 2. 设计新接口时
1. 确保接口支持数据面功能需求
2. 为控制面预留必要的扩展点
3. 考虑接口的向后兼容性

### 3. 配置管理时
1. 支持本地配置和环境变量
2. 预留控制面配置接口
3. 实现配置验证和热重载

### 4. 监控和可观测性
1. 收集必要的业务指标
2. 提供标准的监控接口
3. 支持控制面的指标聚合

## 检查清单

### 代码实现检查
- [ ] 核心功能是否完整实现
- [ ] 是否为控制面预留了接口
- [ ] 是否实现了必要的安全控制
- [ ] 是否提供了监控指标
- [ ] 错误处理是否完善
- [ ] 性能是否满足要求

### 配置管理检查
- [ ] 配置文件结构是否清晰
- [ ] 是否支持环境变量覆盖
- [ ] 是否为控制面预留了配置接口
- [ ] 配置验证是否完善
- [ ] 是否支持动态更新

### Docker 实现检查
- [ ] 镜像构建是否优化
- [ ] 是否支持多架构
- [ ] 安全配置是否完善
- [ ] 资源限制是否合理
- [ ] 健康检查是否实现

### 文档和测试检查
- [ ] 架构文档是否完整
- [ ] API 文档是否准确
- [ ] 部署文档是否详细
- [ ] 测试覆盖率是否达标
- [ ] 安全测试是否通过

## 注意事项

### 1. 实现边界
- **不实现**：完整的控制面功能、用户界面、管理后台
- **需要设计**：控制面接口、配置格式、监控协议
- **重点实现**：数据面核心功能、性能优化、稳定性

### 2. 技术选择
- **优先选择**：成熟稳定的技术栈、标准协议、开源组件
- **避免选择**：过于复杂的技术方案、实验性功能、过度设计
- **考虑因素**：性能需求、维护成本、社区支持

### 3. 质量要求
- **代码质量**：覆盖率 > 80%、静态分析通过、性能达标
- **安全要求**：沙盒隔离、资源限制、权限控制
- **可维护性**：模块化设计、接口抽象、配置驱动

## 更新和维护

这些规则文件应该随着项目的发展而更新：

1. **定期审查**：每月审查规则的有效性和适用性
2. **反馈收集**：收集开发团队的使用反馈
3. **规则更新**：根据项目需求调整和优化规则
4. **版本管理**：记录规则的变更历史和原因

通过遵循这些规则，确保项目在实现数据面功能的同时，为未来的控制面扩展做好充分准备。
