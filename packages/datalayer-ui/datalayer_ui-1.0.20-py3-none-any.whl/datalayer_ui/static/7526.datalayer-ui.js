"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[7526],{57526:(e,t,o)=>{o.d(t,{j:()=>v});var l=o(62682),n=o(52280),a=o(84939),i=o(88037),s=o(38921),r=o(72490),d=o(85181);const c=["text/plain","application/vnd.jupyter.stdout","application/vnd.jupyter.stderr"],u="jp-toolbar-overlap";class h{constructor(e,t,o,l){if(this._isDisposed=!1,this._toolbar=null,this._toolbarItems=null,this._toolbarFactory=null,this._panel=e,this._previousActiveCell=this._panel.content.activeCell,this._toolbarItems=null!=t?t:null,this._toolbarFactory=null!=o?o:null,this._enabled=!0,this._trans=(null!=l?l:d.wK).load("jupyterlab"),null===this._toolbarItems&&null===this._toolbarFactory)throw Error("You must provide the toolbarFactory or the toolbar items.");!this._toolbarFactory&&this._toolbarItems&&(this._onToolbarChanged(),this._toolbarItems.changed.connect(this._onToolbarChanged,this)),e.revealed.then(()=>{requestAnimationFrame(()=>{const t=e.content;this._onActiveCellChanged(t),t.activeCellChanged.connect(this._onActiveCellChanged,this),t.renderingLayoutChanged.connect(this._onActiveCellChanged,this),t.disposed.connect(()=>{t.activeCellChanged.disconnect(this._onActiveCellChanged)})})})}_onMetadataChanged(e,t){"jupyter"===t.key&&("object"!=typeof t.newValue||!0!==t.newValue.source_hidden||"add"!==t.type&&"change"!==t.type?"object"==typeof t.oldValue&&!0===t.oldValue.source_hidden&&this._addToolbar(e):this._removeToolbar(e))}_onActiveCellChanged(e){this._previousActiveCell&&!this._previousActiveCell.isDisposed&&(this._removeToolbar(this._previousActiveCell.model),this._previousActiveCell.model.metadataChanged.disconnect(this._onMetadataChanged));const t=e.activeCell;this._previousActiveCell=t,null===t||t.inputHidden||(t.model.metadataChanged.connect(this._onMetadataChanged,this),this._addToolbar(t.model))}get isDisposed(){return this._isDisposed}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._onToolbarChanged()}dispose(){var e,t;this.isDisposed||(this._isDisposed=!0,null===(e=this._toolbarItems)||void 0===e||e.changed.disconnect(this._onToolbarChanged,this),null===(t=this._toolbar)||void 0===t||t.dispose(),this._panel=null,r.Signal.clearData(this))}_addToolbar(e){if(!this.enabled)return;const t=this._getCell(e);if(t&&!t.isDisposed){const e=this._toolbar=new a.M7;e.addClass("jp-cell-menu"),e.addClass("jp-cell-toolbar"),e.node.setAttribute("aria-label",this._trans.__("Cell toolbar"));const o=[t.ready];if(this._toolbarFactory){const l=this._toolbarFactory(t);for(const{name:t,widget:n}of l)e.addItem(t,n),n instanceof i._Q&&void 0!==n.renderPromise&&(n.update(),o.push(n.renderPromise))}else for(const{name:t,widget:l}of this._toolbarItems)e.addItem(t,l),l instanceof i._Q&&void 0!==l.renderPromise&&(l.update(),o.push(l.renderPromise));o.push(t.ready),Promise.all(o).then(()=>{var o;t.isDisposed||(null===(o=this._panel)||void 0===o?void 0:o.content.activeCell)!==t?e.dispose():(t.node.classList.add(u),t.inputArea.layout.insertWidget(0,e),t.displayChanged.connect(this._resizeEventCallback,this),t.model.contentChanged.connect(this._changedEventCallback,this),this._updateCellForToolbarOverlap(t))}).catch(e=>{console.error("Error rendering buttons of the cell toolbar: ",e)})}}_getCell(e){var t;return null===(t=this._panel)||void 0===t?void 0:t.content.widgets.find(t=>t.model===e)}_removeToolbar(e){var t,o;const l=this._getCell(e);l&&!l.isDisposed&&l.displayChanged.disconnect(this._resizeEventCallback,this),e.contentChanged.disconnect(this._changedEventCallback,this),(null===(t=this._toolbar)||void 0===t?void 0:t.parent)===(null==l?void 0:l.inputArea)&&!1===(null===(o=this._toolbar)||void 0===o?void 0:o.isDisposed)&&this._toolbar.dispose()}_onToolbarChanged(){var e;const t=null===(e=this._panel)||void 0===e?void 0:e.content.activeCell;t&&(this._removeToolbar(t.model),this._addToolbar(t.model))}_changedEventCallback(){var e;const t=null===(e=this._panel)||void 0===e?void 0:e.content.activeCell;null!=t&&this._updateCellForToolbarOverlap(t)}_resizeEventCallback(){var e;const t=null===(e=this._panel)||void 0===e?void 0:e.content.activeCell;null!=t&&this._updateCellForToolbarOverlap(t)}_updateCellForToolbarOverlap(e){requestIdleCallback(()=>{const t=e.node;t.classList.remove(u),this._cellToolbarOverlapsContents(e)&&t.classList.add(u)})}_cellToolbarOverlapsContents(e){var t,o,l,n;if(!e.model)return!1;const a=e.model.type,i=null===(t=e.editorWidget)||void 0===t?void 0:t.node.getBoundingClientRect(),s=null!==(o=null==i?void 0:i.left)&&void 0!==o?o:0,r=null!==(l=null==i?void 0:i.right)&&void 0!==l?l:0,d=this._cellToolbarLeft(e);return null!==d&&((s+r)/2>d||("markdown"===a&&e.rendered?this._markdownOverlapsToolbar(e):"default"===(null===(n=this._panel)||void 0===n?void 0:n.content.renderingLayout)?this._codeOverlapsToolbar(e):this._outputOverlapsToolbar(e)))}_markdownOverlapsToolbar(e){const t=e.inputArea;if(!t)return!1;const o=t.renderedInput.node.firstElementChild;if(null===o)return!1;const l=o.style.maxWidth;o.style.maxWidth="max-content";const n=o.getBoundingClientRect().right;o.style.maxWidth=l;const a=this._cellToolbarLeft(e);return null!==a&&n>a}_outputOverlapsToolbar(e){const t=e.outputArea.node;if(t){const o=t.querySelectorAll("[data-mime-type]"),l=this._cellToolbarRect(e);if(l){const{left:e,bottom:t}=l;return(0,s.some)(o,o=>{const l=o.firstElementChild;if(l){const n=new Range;c.includes(o.getAttribute("data-mime-type")||"")?n.selectNodeContents(l):n.selectNode(l);const{right:a,top:i}=n.getBoundingClientRect();return a>e&&i<t}return!1})}}return!1}_codeOverlapsToolbar(e){const t=e.editorWidget,o=e.editor;if(!t||!o)return!1;if(o.lineCount<1)return!1;const l=t.node.getElementsByClassName("cm-line");if(l.length<1)return!1;let n=l[0].getBoundingClientRect().left;const a=document.createRange();a.selectNodeContents(l[0]),n+=a.getBoundingClientRect().width;const i=this._cellToolbarLeft(e);return null!==i&&n>i}_cellToolbarRect(e){var t;return(null===(t=this._toolbar)||void 0===t?void 0:t.parent)!==e.inputArea?null:this._toolbar.node.getBoundingClientRect()}_cellToolbarLeft(e){var t;return(null===(t=this._cellToolbarRect(e))||void 0===t?void 0:t.left)||null}}const _=[{command:"notebook:duplicate-below",name:"duplicate-cell"},{command:"notebook:move-cell-up",name:"move-cell-up"},{command:"notebook:move-cell-down",name:"move-cell-down"},{command:"notebook:insert-cell-above",name:"insert-cell-above"},{command:"notebook:insert-cell-below",name:"insert-cell-below"},{command:"notebook:delete-cell",name:"delete-cell"}];class v{constructor(e,t){this._commands=e,this._toolbarFactory=null!=t?t:this.defaultToolbarFactory}createItemFactory(e){return(0,l.s)(e)}get defaultToolbarFactory(){const e=this.createItemFactory(this._commands);return(t,o)=>new n.y({values:_.map(l=>{const n=o?{...l,args:{...l.args,...o}}:l;return{name:l.name,widget:e(v.FACTORY_NAME,t,n)}})})}createNew(e){return this._tracker=new h(e,void 0,t=>this._toolbarFactory(t,{[v.WIDGET_ID_ARG]:e.id}))}get enabled(){return this._tracker.enabled}set enabled(e){this._tracker&&(this._tracker.enabled=e)}}v.FACTORY_NAME="Cell",v.WIDGET_ID_ARG="widgetId"},62682:(e,t,o)=>{o.d(t,{d:()=>s,s:()=>r});var l=o(72879),n=o(84939),a=o(14809),i=o(72490);class s{constructor(e){this._widgets=new Map,this._factoryAdded=new i.Signal(this),this._defaultFactory=e.defaultFactory}get defaultFactory(){return this._defaultFactory}set defaultFactory(e){this._defaultFactory=e}get factoryAdded(){return this._factoryAdded}createWidget(e,t,o){var l;const n=null===(l=this._widgets.get(e))||void 0===l?void 0:l.get(o.name);return n?n(t):this._defaultFactory(e,t,o)}addFactory(e,t,o){let l=this._widgets.get(e);const n=null==l?void 0:l.get(t);return l||(l=new Map,this._widgets.set(e,l)),l.set(t,o),this._factoryAdded.emit(t),n}registerFactory(e,t,o){return this.addFactory(e,t,o)}}function r(e){return(t,o,i)=>{var s,r;switch(null!==(s=i.type)&&void 0!==s?s:"command"){case"command":{const{command:t,args:a,label:s,caption:d,icon:c}=i,u=null!=t?t:"",h={toolbar:!0,...a},_=c?l.Tl.resolve({icon:c}):void 0,v=o.toolbar,b=(null!=_?_:e.icon(u,h))?null!=s?s:"":s;return new n.Fu({commands:e,id:u,args:h,icon:_,label:b,caption:d,noFocusOnClick:null!==(r=null==v?void 0:v.noFocusOnClick)&&void 0!==r&&r})}case"spacer":return n.M7.createSpacerItem();default:return new a.x0}}}}}]);