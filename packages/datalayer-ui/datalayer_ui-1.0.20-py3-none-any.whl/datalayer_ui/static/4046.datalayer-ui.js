"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4046],{61110:(e,t,i)=>{i.d(t,{J:()=>o,g:()=>s});var n=i(98238);const s=new n.Token("@jupyterlab/ui-components:IFormRendererRegistry","A service for settings form renderer registration."),o=new n.Token("@jupyterlab/ui-components:ILabIconManager","A service to register and request icons.")},84046:(e,t,i)=>{i.r(t),i.d(t,{default:()=>X});var n=i(4279),s=i(84939),o=i(52556);const r="CompletionProvider:context";class l{constructor(){this.identifier=r,this.rank=500,this.renderer=null}async isApplicable(e){return!0}fetch(e,t){const i=t.editor;return i?new Promise(e=>{e(a.contextHint(i))}):Promise.reject("No editor")}}var a;!function(e){e.contextHint=function(e){const t=e.getTokenAtCursor(),i=function(e,t){return t.getTokens().filter(t=>0===t.value.indexOf(e.value)&&t.value!==e.value)}(t,e).filter(e=>e.type).map(e=>e.value),n=new Set(i),s=new Array;return n.forEach(e=>s.push({label:e})),{start:t.offset,end:t.offset+t.value.length,items:s}}}(a||(a={}));var c=i(71784),d=i(85181),h=i(13855);class m{constructor(e){this.options=e,this.identifier="@jupyterlab/inline-completer:history",this._maxSuggestions=100;const t=e.translator||d.wK;this._trans=t.load("jupyterlab")}get name(){return this._trans.__("History")}get icon(){return h.oc}get schema(){return{properties:{maxSuggestions:{title:this._trans.__("Maximum number of suggestions"),description:this._trans.__("The maximum number of suggestions to retrieve from history."),type:"number"}},default:{enabled:!1,maxSuggestions:100}}}configure(e){var t;this._maxSuggestions=null!==(t=e.maxSuggestions)&&void 0!==t?t:100}async fetch(e,t,i){var n;const s=null===(n=t.session)||void 0===n?void 0:n.kernel;if(!s)throw new Error("No kernel for completion request.");const o=e.text.slice(0,e.offset).split("\n").slice(-1)[0],r=e.text.slice(e.offset).split("\n")[0];let l;const a=[];if(""===o){l={output:!1,raw:!0,hist_access_type:"tail",n:this._maxSuggestions};const e=await s.requestHistory(l);if("ok"===e.content.status){let t=e.content.history;const i=new Map;for(const e of t.reverse()){const t=e[2];i.set(t,(i.get(t)||0)+1)}const n=Array.from(i.entries()).sort((e,t)=>e[1]>t[1]?-1:e[1]<t[1]?1:0);for(const e of n)a.push({insertText:e[0]})}}else{l={output:!1,raw:!0,hist_access_type:"search",pattern:o+"*"+(r?r+"*":""),unique:!0,n:this._maxSuggestions};const e=await s.requestHistory(l);if("ok"===e.content.status)for(const t of e.content.history){const e=t[2].split("\n");for(let t=0;t<e.length;t++){const i=e[t];if(i.startsWith(o)){let n=i.slice(o.length);t+1<e.length&&(n+="\n"+e.slice(t+1).join("\n")),r&&(n=n.slice(0,n.indexOf(r))),a.push({insertText:n})}}}}return{items:a}}}var p=i(60639),u=i(72490),v=i(14809),g=i(20137),_=i(66087);const f="jp-GhostText-streamingIndicator",C="jp-GhostText-errorIndicator";class w{constructor(e){this.options=e}placeGhost(e,t){const i=[I.addMark.of(t)];e.state.field(I.markField,!1)||(i.push(_.Pe.appendConfig.of([I.markField])),i.push(_.Pe.appendConfig.of([g.Lz.domEventHandlers({blur:t=>{if(!1===this.options.onBlur(t))return!0;const i=[I.removeMark.of(null)];setTimeout(()=>{e.dispatch({effects:i})},0)}})]))),e.dispatch({effects:i})}clearGhosts(e){const t=[I.removeMark.of(null)];e.dispatch({effects:t})}}w.streamingAnimation="uncover",w.spacerRemovalDelay=700,w.spacerRemovalDuration=300;class x extends g.xO{constructor(e){super(),this.options=e,this.isSpacer=!1,this._clearErrorTimeout=null}eq(e){return e.content==this.content&&e.options.streaming===this.options.streaming&&e.options.error===this.options.error}get lineBreaks(){return(this.content.match(/\n/g)||"").length}updateDOM(e,t){return this._updateDOM(e),!0}get content(){return this.options.content}toDOM(){let e=document.createElement("span");return this.options.onPointerOver&&e.addEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.addEventListener("pointerleave",this.options.onPointerLeave),e.classList.add("jp-GhostText"),e.dataset.animation=w.streamingAnimation,e.dataset.providedBy=this.options.providerId,this._updateDOM(e),e}_removeErrorAnimation(e){e.querySelectorAll(`.${C}`).forEach(e=>{e.remove()})}_mountErrorAnimation(e){const t=document.createElement("span");t.className=C;const i=this.options.error;(null==i?void 0:i.message)&&(t.title=null==i?void 0:i.message),e.querySelectorAll(`.${f}, .${C}`).forEach(e=>{e.remove()}),e.appendChild(t)}_updateDOM(e){var t,i;if(this.options.error)return this._mountErrorAnimation(e),void(this._clearErrorTimeout=setTimeout(()=>{this._removeErrorAnimation(e),this._clearErrorTimeout=null},5e3));null!==this._clearErrorTimeout&&(clearTimeout(this._clearErrorTimeout),this._removeErrorAnimation(e),this._clearErrorTimeout=null);let n=this.content,s="",o=this.options.addedPart;if(o&&(o.startsWith("\n")&&(o=o.substring(1)),n=n.substring(0,n.length-o.length)),this.options.maxLines){const e=n.split("\n");n=e.slice(0,this.options.maxLines).join("\n"),s=e.slice(this.options.maxLines).join("\n")}const r=Math.min(null!==(t=this.options.minLines)&&void 0!==t?t:0,null!==(i=this.options.maxLines)&&void 0!==i?i:1/0),l=Math.max(0,r-n.split("\n").length+1),a=new Array(l).fill("").join("\n");if(this.isSpacer)return void(e.innerText=n+a);e.innerText=n;let c=e;if(s.length>0){const t=document.createElement("span");t.className="jp-GhostText-hiddenWrapper",e.appendChild(t);const i=document.createElement("span");i.className="jp-GhostText-expandHidden",i.innerText="â‡“";const n=document.createElement("span");t.appendChild(i),n.className="jp-GhostText-hiddenLines",n.innerText="\n"+s,t.appendChild(n),c=n}if(o){const e=document.createElement("span");e.className="jp-GhostText-streamedToken",e.innerText=o,c.appendChild(e)}if(this.options.streaming){const e=document.createElement("span");e.className=f,c.appendChild(e)}if(a.length>0){const e=document.createTextNode(a);c.appendChild(e)}}destroy(e){this.options.onPointerOver&&e.removeEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.removeEventListener("pointerleave",this.options.onPointerLeave),super.destroy(e)}}class y extends x{constructor(){super(...arguments),this.isSpacer=!0}}class P extends y{toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-lineSpacer"),e.style.animationDelay=w.spacerRemovalDelay+"ms",e.style.animationDuration=w.spacerRemovalDuration+"ms",e}}class b extends y{get content(){return this.options.content[0]}toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-letterSpacer"),e}}var I;!function(e){let t;function i(e,t){return g.NZ.widget({widget:new x(e),side:1,ghostSpec:e}).range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))}!function(e){e[e.Set=0]="Set",e[e.Remove=1]="Remove",e[e.FilterAndUpdate=2]="FilterAndUpdate"}(t||(t={})),e.addMark=_.Pe.define({map:(e,t)=>({...e,from:t.mapPos(e.from),to:t.mapPos(e.from+e.content.length)})}),e.removeMark=_.Pe.define(),e.markField=_.sU.define({create:()=>g.NZ.none,update(n,s){const o=function(i){for(let n of i.effects){if(n.is(e.addMark))return{action:t.Set,spec:n.value};if(n.is(e.removeMark))return{action:t.Remove}}return i.docChanged||i.selection?{action:t.FilterAndUpdate}:null}(s);if(n=n.update({filter:(e,t,i)=>!(i.spec.widget instanceof y&&i.spec.timeoutInfo.elapsed)}),!o)return n.map(s.changes);switch(o.action){case t.Set:{const e=i(o.spec,s);return n.update({add:[e],filter:(t,i,n)=>n===e.value})}case t.Remove:return n.update({filter:()=>!1});case t.FilterAndUpdate:{let e=n.iter();for(;e.value&&e.value.spec.widget instanceof y;)e.next();if(!e.value)return n.map(s.changes);const t=e.value.spec.ghostSpec,o={...t};let r=!1;s.changes.iterChanges((e,t,i,n,s)=>{if(!r)if(e===t&&i!==n)for(let e=0;e<s.lines;e++){const t=s.lineAt(e).text,i=e>0?"\n"+t:t;if(!o.content.startsWith(i)){r=!0;break}o.content=o.content.slice(i.length),o.from+=i.length}else r=!0});const l=r?function(e,t,i=1e3){if(e.content.length<2)return[];const n={elapsed:!1};setTimeout(()=>{n.elapsed=!0},i);const s=g.NZ.widget({widget:new b(e),side:1,timeoutInfo:n}),o=g.NZ.widget({widget:new P(e),side:1,timeoutInfo:n});return[s.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length)),o.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))]}(t,s):[i(o,s)],a=l.map(e=>e.value);if(n=n.update({add:l,filter:(e,t,i)=>a.includes(i)}),r)try{n=n.map(s.changes)}catch(e){return console.warn(e),g.NZ.none}return n}}},provide:e=>g.Lz.decorations.from(e)})}(I||(I={}));const T="jp-mod-inline-completer-active",S="jp-InlineCompleter-hover";class k extends v.x0{constructor(e){var t,i;super({node:document.createElement("div")}),this._clearHoverTimeout=null,this._current=0,this._editor=null,this._lastItem=null,this._model=null,this._providerWidget=new v.x0,this._showShortcuts=k.defaultSettings.showShortcuts,this._showWidget=k.defaultSettings.showWidget,this._suggestionsCounter=new v.x0,this._toolbar=new s.M7,this.model=null!==(t=e.model)&&void 0!==t?t:null,this.editor=null!==(i=e.editor)&&void 0!==i?i:null,this.addClass("jp-InlineCompleter"),this.addClass("jp-ThemedContainer"),this._ghostManager=new w({onBlur:this._onEditorBlur.bind(this)}),this._trans=e.trans;const n=this.layout=new v.DG;n.addWidget(this._suggestionsCounter),n.addWidget(this.toolbar),n.addWidget(this._providerWidget),this._progressBar=document.createElement("div"),this._progressBar.className="jp-InlineCompleter-progressBar",this.node.appendChild(this._progressBar),this._updateShortcutsVisibility(),this._updateDisplay(),this.node.tabIndex=0}get toolbar(){return this._toolbar}get editor(){return this._editor}set editor(e){var t;null===(t=this.model)||void 0===t||t.reset(),this._editor=e}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&(this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged,this),this._model.provisionProgress.disconnect(this._onProvisionProgress,this)),this._model=e,this._model&&(this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.connect(this._onModelFilterTextChanged,this),this._model.provisionProgress.connect(this._onProvisionProgress,this)))}cycle(e){var t,i;const n=null===(i=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===i?void 0:i.items;if(n){if("next"===e){const e=this._current+1;this._current=e===n.length?0:e}else{const e=this._current-1;this._current=-1===e?n.length-1:e}this._updateStreamTracking(),this._render()}}accept(){const e=this.model,t=this.current,i=this._editor;if(!i||!e||!t)return;const n=e.cursor,s=t.insertText,o=i.getOffsetAt(i.getCursorPosition()),r=i.getOffsetAt(n),l={changes:{from:r,to:o,insert:s}};o<=o&&o>=r&&(l.selection={anchor:r+s.length}),i.editor.dispatch(l),e.reset(),this.update()}get current(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.completions;return t?t.items[this._current]:null}_updateStreamTracking(){this._lastItem&&this._lastItem.stream.disconnect(this._onStream,this);const e=this.current;e&&e.stream.connect(this._onStream,this),this._lastItem=e}_onStream(e,t){var i;const n=null===(i=this.model)||void 0===i?void 0:i.completions;if(!n||!n.items||0===n.items.length)return;if(this.isHidden)return;const s=n.items[this._current];this._setText(s)}configure(e){this._showWidget=e.showWidget,this._updateDisplay(),e.showShortcuts!==this._showShortcuts&&(this._showShortcuts=e.showShortcuts,this._updateShortcutsVisibility()),w.streamingAnimation=e.streamingAnimation,w.spacerRemovalDelay=Math.max(0,e.editorResizeDelay-300),w.spacerRemovalDuration=Math.max(0,Math.min(300,e.editorResizeDelay-300)),this._minLines=e.minLines,this._maxLines=e.maxLines,this._reserveSpaceForLongest=e.reserveSpaceForLongest,this._suppressIfTabCompleterActive=e.suppressIfTabCompleterActive}get suppressIfTabCompleterActive(){return this._suppressIfTabCompleterActive}get isActive(){var e;return!!(null===(e=this.editor)||void 0===e?void 0:e.host.classList.contains(T))}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e)}}onUpdateRequest(e){super.onUpdateRequest(e);const t=this._model;if(!t)return;let i=t.completions;i&&i.items&&0!==i.items.length?this.isHidden&&(this.show(),this._setGeometry()):this.isHidden||this.hide()}onAfterAttach(e){document.addEventListener("scroll",this,!0),document.addEventListener("pointerdown",this,!0)}onBeforeDetach(e){document.removeEventListener("scroll",this,!0),document.removeEventListener("pointerdown",this,!0)}_evtPointerdown(e){var t;if(this.isHidden||!this._editor)return;const i=e.target;if(this.node.contains(i))return!0;this.hide(),null===(t=this.model)||void 0===t||t.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame(()=>{this._setGeometry()})}_onEditorBlur(e){var t;if(this.node.contains(e.relatedTarget))return!1;null===(t=this._editor)||void 0===t||t.host.classList.remove(T),this.hide()}_onModelSuggestionsChanged(e,t){var i;if(this.isAttached){if("set"===t.event)this._current=null!==(i=t.indexMap.get(this._current))&&void 0!==i?i:0;else if("clear"===t.event){const e=this.editor;e&&(this._ghostManager.clearGhosts(e.editor),e.host.classList.remove(T))}this._updateStreamTracking(),this.update(),this._render()}else this.update()}_onModelFilterTextChanged(e,t){var i,n;const s=null===(i=this.model)||void 0===i?void 0:i.completions;s&&s.items&&0!==s.items.length&&(this._current=null!==(n=t.get(this._current))&&void 0!==n?n:0,this._updateStreamTracking(),setTimeout(()=>{this._render(),this._setGeometry()},0))}_onProvisionProgress(e,t){requestAnimationFrame(()=>{0===t.pendingProviders?this._progressBar.style.display="none":(this._progressBar.style.display="",this._progressBar.style.width=100*t.pendingProviders/t.totalProviders+"%")})}_render(){var e,t;const i=null===(e=this.model)||void 0===e?void 0:e.completions;if(!i||!i.items||0===i.items.length)return;const n=i.items[this._current];this._setText(n),"never"!==this._showWidget&&(this._suggestionsCounter.node.innerText=this._trans.__("%1/%2",this._current+1,i.items.length),this._providerWidget.node.title=this._trans.__("Provider: %1",n.provider.name),(null!==(t=n.provider.icon)&&void 0!==t?t:h.XF).render(this._providerWidget.node))}_setText(e){var t,i,n;const s=e.insertText,o=this._editor,r=this._model;if(!r||!o)return;const l=o.editor;let a;if(this._reserveSpaceForLongest){const e=null!==(n=null===(i=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===i?void 0:i.items)&&void 0!==n?n:[],s=Math.max(...e.map(e=>e.insertText.split("\n").length));a=Math.max(this._minLines,s)}else a=this._minLines;this._ghostManager.placeGhost(l,{from:o.getOffsetAt(r.cursor),content:s,providerId:e.provider.identifier,addedPart:e.lastStreamed,streaming:e.streaming,minLines:a,maxLines:this._maxLines,onPointerOver:this._onPointerOverGhost.bind(this),onPointerLeave:this._onPointerLeaveGhost.bind(this),error:e.error}),o.host.classList.add(T)}_onPointerOverGhost(){null!==this._clearHoverTimeout&&(window.clearTimeout(this._clearHoverTimeout),this._clearHoverTimeout=null),this.node.classList.add(S)}_onPointerLeaveGhost(){this._clearHoverTimeout=window.setTimeout(()=>this.node.classList.remove(S),500)}_setGeometry(){const{node:e}=this,t=this._model,i=this._editor;if(!i||!t||!t.cursor)return;const n=i.host.closest(".jp-MainAreaWidget > .lm-Widget")||i.host;let s;try{const e=i.getCoordinateForPosition(t.cursor);if(!e)throw Error("No coordinates for cursor position");s=e}catch(e){return void this.hide()}p.e.setGeometry({anchor:s,host:n,maxHeight:40,minHeight:20,node:e,privilege:"forceAbove",outOfViewDisplay:{top:"stick-outside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}})}_updateShortcutsVisibility(){this.node.dataset.showShortcuts=this._showShortcuts+""}_updateDisplay(){this.node.dataset.display=this._showWidget}}!function(e){e.defaultSettings={showWidget:"onHover",showShortcuts:!0,streamingAnimation:"uncover",providers:{},minLines:2,maxLines:4,editorResizeDelay:1e3,reserveSpaceForLongest:!1,suppressIfTabCompleterActive:!0},e.Model=class{constructor(){this.suggestionsChanged=new u.Signal(this),this.filterTextChanged=new u.Signal(this),this.provisionProgress=new u.Signal(this),this._isDisposed=!1,this._completions=null}setCompletions(e){var t,i;const n=new Map(null===(i=null===(t=this._completions)||void 0===t?void 0:t.items)||void 0===i?void 0:i.map((e,t)=>[e.insertText,t]));this._completions=e;const s=new Map(e.items.map((e,t)=>[n.get(e.insertText),t]));this.suggestionsChanged.emit({event:"set",indexMap:s})}appendCompletions(e){this._completions&&this._completions.items?(this._completions.items.push(...e.items),this.suggestionsChanged.emit({event:"append"})):console.warn("No completions to append to")}notifyProgress(e){this.provisionProgress.emit(e)}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get completions(){return this._completions}reset(){this._completions=null,this.suggestionsChanged.emit({event:"clear"})}get isDisposed(){return this._isDisposed}handleTextChange(e){var t;const i=this._completions;if(!i||!i.items||0===i.items.length)return;const n=new Map(i.items.map((e,t)=>[e,t]));for(let n of null!==(t=e.sourceChange)&&void 0!==t?t:[]){const e=n.insert;if(e){const t=i.items.filter(t=>{var i;const n=null!==(i=t.filterText)&&void 0!==i?i:t.insertText;return!!n.startsWith(e)&&(t.filterText=n.substring(e.length),t.insertText=t.insertText.substring(e.length),!0)});0===t.length&&(this._completions=null),i.items=t}else n.retain||(this._completions=null)}const s=new Map(i.items.map((e,t)=>[n.get(e),t]));this.filterTextChanged.emit(s)}handleSelectionChange(e){const t=this.cursor;if(!t)return;const{start:i,end:n}=e;i.column===n.column&&i.line===n.line||this.reset(),(i.line!==t.line||i.column<t.column)&&this.reset()}dispose(){this._isDisposed||(this._isDisposed=!0,u.Signal.clearData(this))}}}(k||(k={}));var E=i(89492),A=i(67004),M=i(62097),D=i(37706);class L{constructor(){this._activeProviders=new Set([c.c,r]),this._inlineCompleterSettings=k.defaultSettings,this._providers=new Map,this._inlineProviders=new Map,this._panelHandlers=new Map,this._mostRecentContext=new Map,this._activeProvidersChanged=new u.Signal(this),this._selected=new u.Signal(this),this._inlineCompleterFactory=null}get activeProvidersChanged(){return this._activeProvidersChanged}get selected(){return this._selected}setTimeout(e){this._timeout=e}setShowDocumentationPanel(e){this._panelHandlers.forEach(t=>t.completer.showDocsPanel=e),this._showDoc=e}setSuppressIfInlineCompleterActive(e){this._panelHandlers.forEach(t=>t.completer.suppressIfInlineCompleterActive=e),this._suppressIfInlineCompleterActive=e}setContinuousHinting(e){this._panelHandlers.forEach(t=>t.autoCompletion=e),this._autoCompletion=e}registerProvider(e){const t=e.identifier;this._providers.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._providers.set(t,e),this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}))}registerInlineProvider(e){const t=e.identifier;this._inlineProviders.has(t)?console.warn(`Completion provider with identifier ${t} is already registered`):(this._inlineProviders.set(t,e),this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}))}getProviders(){return this._providers}activateProvider(e){this._activeProviders=new Set([]),e.forEach(e=>{this._providers.has(e)&&this._activeProviders.add(e)}),0===this._activeProviders.size&&(this._activeProviders.add(c.c),this._activeProviders.add(r)),this._activeProvidersChanged.emit()}async updateCompleter(e){var t,i;const{widget:n,editor:s,sanitizer:o}=e,r=n.id,l=this._panelHandlers.get(r),a=[...this._activeProviders][0],c=this._providers.get(a);let d=null!==(t=null==c?void 0:c.renderer)&&void 0!==t?t:D.A.getDefaultRenderer(o);const h=null==c?void 0:c.modelFactory;let m;m=h?await h.call(c,e):new M.X,this._mostRecentContext.set(n.id,e);const p={model:m,editor:s,renderer:d,sanitizer:o,showDoc:this._showDoc};if(l){const t=l.completer;null===(i=t.model)||void 0===i||i.dispose(),t.model=p.model,t.renderer=p.renderer,t.showDocsPanel=p.showDoc,t.suppressIfInlineCompleterActive=this._suppressIfInlineCompleterActive,l.autoCompletion=this._autoCompletion,s&&(l.editor=s,l.reconciliator=await this.generateReconciliator(e))}else{const t=await this._generateHandler(e,p);this._panelHandlers.set(n.id,t),t.completer.selected.connect((e,t)=>this._selected.emit({insertText:t})),n.disposed.connect(e=>{this.disposeHandler(e.id,t),this._mostRecentContext.delete(r)})}}invoke(e){const t=this._panelHandlers.get(e);t&&t.invoke()}select(e){const t=this._panelHandlers.get(e);t&&t.completer.selectActive()}setInlineCompleterFactory(e){this._inlineCompleterFactory=e,this._panelHandlers.forEach((e,t)=>{this.updateCompleter(this._mostRecentContext.get(t))}),this.inline||(this.inline={invoke:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.invokeInline()},isActive:e=>{const t=this._panelHandlers.get(e);return!(!t||!t.inlineCompleter)&&t.inlineCompleter.isActive},cycle:(e,t)=>{const i=this._panelHandlers.get(e);i&&i.inlineCompleter&&i.inlineCompleter.cycle(t)},accept:e=>{const t=this._panelHandlers.get(e);t&&t.inlineCompleter&&t.inlineCompleter.accept()},configure:e=>{this._inlineCompleterSettings=e;for(const[t,i]of this._inlineProviders.entries())i.configure&&i.configure(e.providers[t]);this._panelHandlers.forEach((t,i)=>{t.inlineCompleter&&t.inlineCompleter.configure(e),this.updateCompleter(this._mostRecentContext.get(i))})}})}get inlineProviders(){return[...this._inlineProviders.values()]}async generateReconciliator(e){const t=[];for(const[e,i]of Object.entries(this._inlineCompleterSettings.providers))!0===i.enabled&&t.push(e);const i=[...this._inlineProviders.values()].filter(e=>t.includes(e.identifier)),n=[];for(const e of this._activeProviders){const t=this._providers.get(e);t&&n.push(t)}return new E.C({context:e,providers:n,inlineProviders:i,inlineProvidersSettings:this._inlineCompleterSettings.providers,timeout:this._timeout})}disposeHandler(e,t){var i,n,s,o;null===(i=t.completer.model)||void 0===i||i.dispose(),t.completer.dispose(),null===(s=null===(n=t.inlineCompleter)||void 0===n?void 0:n.model)||void 0===s||s.dispose(),null===(o=t.inlineCompleter)||void 0===o||o.dispose(),t.dispose(),this._panelHandlers.delete(e)}async _generateHandler(e,t){const i=new D.A(t),n=this._inlineCompleterFactory?this._inlineCompleterFactory.factory({...t,model:new k.Model}):void 0;i.hide(),v.x0.attach(i,document.body),n&&(v.x0.attach(n,document.body),n.hide(),n.configure(this._inlineCompleterSettings));const s=await this.generateReconciliator(e),o=new A.$({completer:i,inlineCompleter:n,reconciliator:s});return o.editor=e.editor,o}}var H=i(69584),j=i(61110),F=i(16950),R=i(9387);const W="availableProviders";function O(e){const{schema:t}=e,i=t.title,n=t.description,s=e.formContext.settings,o=s.get(W).user,r={...t.default};if(o)for(const e of Object.keys(r))r[e]=e in o?o[e]:-1;const[l,a]=(0,R.useState)(r);return R.createElement("div",null,R.createElement("fieldset",null,R.createElement("legend",null,i),R.createElement("p",{className:"field-description"},n),Object.keys(r).map(e=>R.createElement("div",{key:e,className:"form-group small-field"},R.createElement("div",null,R.createElement("h3",null," ",e),R.createElement("div",{className:"inputFieldWrapper"},R.createElement("input",{className:"form-control",type:"number",value:l[e],onChange:t=>{((e,t)=>{const i={...l,[e]:parseInt(t.target.value)};s.set(W,i).catch(console.error),a(i)})(e,t)}})))))))}const G="@jupyterlab/completer-extension:manager",N="@jupyterlab/completer-extension:inline-completer";var q;!function(e){e.nextInline="inline-completer:next",e.previousInline="inline-completer:previous",e.acceptInline="inline-completer:accept",e.invokeInline="inline-completer:invoke"}(q||(q={}));const B={id:"@jupyterlab/completer-extension:base-service",description:"Adds context and kernel completion providers.",requires:[o.qx],autoStart:!0,activate:(e,t)=>{t.registerProvider(new l),t.registerProvider(new c.G)}},z={id:"@jupyterlab/completer-extension:inline-history",description:"Adds inline completion provider suggesting code from execution history.",requires:[o.qx],optional:[d.sQ],autoStart:!0,activate:(e,t,i)=>{t.registerInlineProvider(new m({translator:null!=i?i:d.wK}))}},U={id:"@jupyterlab/completer-extension:inline-completer-factory",description:"Provides a factory for inline completer.",provides:o.CF,optional:[d.sQ],autoStart:!0,activate:(e,t)=>{const i=(t||d.wK).load("jupyterlab");return{factory:t=>{const n=new k({...t,trans:i}),o=t=>{const i=e.commands.keyBindings.find(e=>e.command===t),n=i?F.J.formatKeystroke(i.keys):"";return n?`${n}`:""},r={[q.previousInline]:o(q.previousInline),[q.nextInline]:o(q.nextInline),[q.acceptInline]:o(q.acceptInline)};return e.commands.keyBindingChanged.connect((t,i)=>{const n=i.binding.command;if(r.hasOwnProperty(n)){const t=r[n],i=o(n);i!==t&&(r[n]=i,e.commands.notifyCommandChanged(n))}}),n.toolbar.addItem("previous-inline-completion",new s.Fu({commands:e.commands,icon:h.SW,id:q.previousInline,label:()=>r[q.previousInline],caption:i.__("Previous")})),n.toolbar.addItem("next-inline-completion",new s.Fu({commands:e.commands,icon:h.XU,id:q.nextInline,label:()=>r[q.nextInline],caption:i.__("Next")})),n.toolbar.addItem("accept-inline-completion",new s.Fu({commands:e.commands,icon:h.oE,id:q.acceptInline,label:()=>r[q.acceptInline],caption:i.__("Accept")})),n.model.suggestionsChanged.connect(()=>{for(const t of[q.previousInline,q.nextInline,q.acceptInline])e.commands.notifyCommandChanged(t)}),n}}}},$={id:N,description:"Registers the inline completer factory; adds inline completer commands, shortcuts and settings.",requires:[o.qx,o.CF,H.X],optional:[d.sQ],autoStart:!0,activate:(e,t,i,s,o)=>{t.setInlineCompleterFactory(i);const r=(o||d.wK).load("jupyterlab"),l=()=>!!e.shell.currentWidget&&!!t.inline;let a;e.commands.addCommand(q.nextInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.cycle(e.shell.currentWidget.id,"next")},label:r.__("Next Inline Completion"),isEnabled:l}),e.commands.addCommand(q.previousInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.cycle(e.shell.currentWidget.id,"previous")},label:r.__("Previous Inline Completion"),isEnabled:l}),e.commands.addCommand(q.acceptInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.accept(e.shell.currentWidget.id)},label:r.__("Accept Inline Completion"),isEnabled:()=>l()&&t.inline.isActive(e.shell.currentWidget.id)}),e.commands.addCommand(q.invokeInline,{execute:()=>{var i;null===(i=t.inline)||void 0===i||i.invoke(e.shell.currentWidget.id)},label:r.__("Invoke Inline Completer"),isEnabled:l});const c=e=>{var i;a=e.composite,null===(i=t.inline)||void 0===i||i.configure(a)};e.restored.then(()=>{var e;const i=null!==(e=t.inlineProviders)&&void 0!==e?e:[],n=e=>{var t,i;return{enabled:!0,autoFillInMiddle:!1,timeout:5e3,debouncerDelay:0,...null!==(i=null===(t=e.schema)||void 0===t?void 0:t.default)&&void 0!==i?i:{}}};s.transform(N,{compose:e=>{var t,s;const o=null!==(t=e.data.composite.providers)&&void 0!==t?t:{};for(const e of i){const t=n(e);o[e.identifier]={...t,...null!==(s=o[e.identifier])&&void 0!==s?s:{}}}return e.data.composite.providers=o,e},fetch:e=>{var t,s;const o=e.schema.properties,l={};for(const e of i)l[e.identifier]={title:r.__("%1 provider",e.name),properties:{...null!==(s=null===(t=e.schema)||void 0===t?void 0:t.properties)&&void 0!==s?s:{},timeout:{title:r.__("Timeout"),description:r.__("Timeout for %1 provider (in milliseconds).",e.name),type:"number",minimum:0},debouncerDelay:{title:r.__("Debouncer delay"),minimum:0,description:r.__("Time since the last key press to wait before requesting completions from %1 provider (in milliseconds).",e.name),type:"number"},enabled:{title:r.__("Enabled"),description:r.__("Whether to fetch completions %1 provider.",e.name),type:"boolean"},autoFillInMiddle:{title:r.__("Fill in middle on typing"),description:r.__("Whether to show completions in the middle of the code line from %1 provider on typing.",e.name),type:"boolean"}},default:n(e),type:"object"};return o.providers.properties=l,e}}),s.load(N).then(e=>{c(e),e.changed.connect(e=>{c(e)})}).catch(console.error)}).catch(console.error);const h=t=>e.commands.keyBindings.find(e=>e.command===t),m={[q.acceptInline]:h(q.acceptInline),[q.invokeInline]:h(q.invokeInline)};e.commands.keyBindingChanged.connect((e,t)=>{const i=t.binding.command;m.hasOwnProperty(i)&&(m[i]=h(i))}),document.addEventListener("keydown",t=>{if(!(t.target instanceof Element))return;const i=t.target;switch(t.keyCode){case 9:{const s=[m[q.acceptInline],m[q.invokeInline]];for(const o of s)if(o&&1===o.keys.length&&"Tab"===o.keys[0]&&i.closest(o.selector)&&e.commands.isEnabled(o.command)){const s=i.closest("."+n.Qr);if((null==a?void 0:a.suppressIfTabCompleterActive)&&s)return;return e.commands.execute(o.command).catch(console.error),t.preventDefault(),t.stopPropagation(),void t.stopImmediatePropagation()}break}default:return}},!0)}},K={id:G,description:"Provides the completion provider manager.",requires:[H.X],optional:[j.g],provides:o.qx,autoStart:!0,activate:(e,t,i)=>{const n="availableProviders",s=new L,o=(e,t)=>{var i;const o=e.get(n),r=e.composite;s.setTimeout(r.providerTimeout),s.setShowDocumentationPanel(r.showDocumentationPanel),s.setContinuousHinting(r.autoCompletion),s.setSuppressIfInlineCompleterActive(r.suppressIfInlineCompleterActive);const l=null!==(i=o.user)&&void 0!==i?i:o.composite,a=Object.entries(null!=l?l:{}).filter(e=>e[1]>=0&&t.includes(e[0])).sort(([,e],[,t])=>t-e).map(e=>e[0]);s.activateProvider(a)};if(e.restored.then(()=>{const e=[...s.getProviders().entries()],i=e.map(([e,t])=>e);t.transform(G,{fetch:t=>{const i=t.schema.properties,s={};return e.forEach(([e,t],i)=>{var n;s[e]=null!==(n=t.rank)&&void 0!==n?n:10*(i+1)}),i[n].default=s,t}}),t.load(G).then(e=>{o(e,i),e.changed.connect(e=>{o(e,i)})}).catch(console.error)}).catch(console.error),i){const e={fieldRenderer:e=>O(e)};i.addRenderer(`${G}.availableProviders`,e)}return s}},X=[K,B,z,U,$]}}]);