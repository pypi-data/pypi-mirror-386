"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[344,7963],{57963:(s,e,n)=>{n.r(e),n.d(e,{ISessions:()=>t,Sessions:()=>r});var i=n(67262);const t=new i.Token("@jupyterlite/session:ISessions");var a=n(78635),d=n(64053);class r{constructor(s){this._sessions=[],this._pendingRestarts=new Set,this._kernels=s.kernels,this._kernels.changed.connect((s,e)=>{var n,i;switch(e.type){case"remove":{const s=null===(n=e.oldValue)||void 0===n?void 0:n.id;if(!s)return;const i=this._sessions.find(e=>{var n;return(null===(n=e.kernel)||void 0===n?void 0:n.id)===s});if(!i)return;this._pendingRestarts.add(s),setTimeout(async()=>{this._pendingRestarts.has(s)&&(this._pendingRestarts.delete(s),await this.shutdown(i.id))},100);break}case"add":{const s=null===(i=e.newValue)||void 0===i?void 0:i.id;if(!s)return;this._pendingRestarts.delete(s);break}}})}async get(s){const e=this._sessions.find(e=>e.id===s);if(!e)throw Error(`Session ${s} not found`);return e}async list(){return this._sessions}async patch(s){const{id:e,path:n,name:t,kernel:d}=s,r=this._sessions.findIndex(s=>s.id===e),o=this._sessions[r];if(!o)throw Error(`Session ${e} not found`);const l={...o,path:null!=n?n:o.path,name:null!=t?t:o.name};if(d)if(d.id){const s=this._sessions.find(s=>{var e;return(null===(e=s.kernel)||void 0===e?void 0:e.id)===(null==d?void 0:d.id)});s&&(l.kernel=s.kernel)}else if(d.name){const s=await this._kernels.startNew({id:i.UUID.uuid4(),name:d.name,location:a.PathExt.dirname(l.path)});s&&(l.kernel=s),this._handleKernelShutdown({kernelId:s.id,sessionId:o.id})}return this._sessions[r]=l,l}async startNew(s){var e,n,t,d;const{path:r,name:o}=s,l=this._sessions.find(s=>s.name===o);if(l)return l;const h=null!==(n=null===(e=s.kernel)||void 0===e?void 0:e.name)&&void 0!==n?n:"",u=null!==(t=s.id)&&void 0!==t?t:i.UUID.uuid4(),c=null!==(d=s.name)&&void 0!==d?d:s.path,_=a.PathExt.dirname(s.name)||a.PathExt.dirname(s.path),k=c.includes(":")?c.split(":")[0]:"",v=_.includes(k)?_:`${k}:${_}`,f=await this._kernels.startNew({id:u,name:h,location:v}),p={id:u,path:r,name:null!=o?o:r,type:"notebook",kernel:{id:f.id,name:f.name}};return this._sessions.push(p),this._handleKernelShutdown({kernelId:u,sessionId:p.id}),p}async shutdown(s){var e;const n=this._sessions.find(e=>e.id===s);if(!n)throw Error(`Session ${s} not found`);const i=null===(e=n.kernel)||void 0===e?void 0:e.id;i&&await this._kernels.shutdown(i),d.ArrayExt.removeFirstOf(this._sessions,n)}async _handleKernelShutdown({kernelId:s,sessionId:e}){}}}}]);