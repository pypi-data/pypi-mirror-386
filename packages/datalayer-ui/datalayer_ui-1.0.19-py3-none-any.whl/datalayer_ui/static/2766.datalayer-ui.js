"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[2766],{37706:(e,t,i)=>{i.d(t,{A:()=>m});var s=i(75478),n=i(92848),o=i(60639),r=i(54503),l=i(72490),a=i(14809);const d="jp-Completer-item",h="jp-mod-active",c="jp-Completer-list",u=!0;class m extends a.x0{constructor(e){var t,i,n,o;super({node:document.createElement("div")}),this._activeIndex=0,this._editor=null,this._model=null,this._selected=new l.Signal(this),this._visibilityChanged=new l.Signal(this),this._indexChanged=new l.Signal(this),this._lastSubsetMatch="",this._geometryLock=!1,this._geometryCounter=0,this._docPanelExpanded=!1,this._renderCounter=0,this.sanitizer=null!==(t=e.sanitizer)&&void 0!==t?t:new s.I,this._defaultRenderer=m.getDefaultRenderer(this.sanitizer),this._renderer=null!==(i=e.renderer)&&void 0!==i?i:this._defaultRenderer,this._docPanel=this._createDocPanelNode(),this.model=null!==(n=e.model)&&void 0!==n?n:null,this.editor=null!==(o=e.editor)&&void 0!==o?o:null,this.addClass("jp-Completer"),this.addClass("jp-ThemedContainer"),this._updateConstraints()}_updateConstraints(){const e=document.createElement("div");e.classList.add(c),e.style.visibility="hidden",e.style.overflowY="scroll",document.body.appendChild(e);const t=window.getComputedStyle(e);this._maxHeight=parseInt(t.maxHeight,10),this._minHeight=parseInt(t.minHeight,10),this._scrollbarWidth=e.offsetWidth-e.clientWidth,document.body.removeChild(e);const i=this._createDocPanelNode();this._docPanelWidth=p.measureSize(i,"inline-block").width}get activeIndex(){return this._activeIndex}get editor(){return this._editor}set editor(e){this._editor=e}get selected(){return this._selected}get visibilityChanged(){return this._visibilityChanged}get indexChanged(){return this._indexChanged}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&(this._model.stateChanged.disconnect(this.onModelStateChanged,this),this._model.queryChanged.disconnect(this.onModelQueryChanged,this)),this._model=e,this._model&&(this._model.stateChanged.connect(this.onModelStateChanged,this),this._model.queryChanged.connect(this.onModelQueryChanged,this)))}get renderer(){return this._renderer}set renderer(e){this._renderer=e}set showDocsPanel(e){this._showDoc=e}get showDocsPanel(){return this._showDoc}dispose(){this._sizeCache=void 0,this._model=null,super.dispose()}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"keydown":this._evtKeydown(e);break;case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e)}}reset(){this._activeIndex=0,this._lastSubsetMatch="",this._model&&this._model.reset(!0),this._docPanel.style.display="none",this._sizeCache=void 0,this.node.scrollTop=0}selectActive(){const e=this.node.querySelector(`.${h}`);e?(this._selected.emit(e.getAttribute("data-value")),this.reset()):this.reset()}onAfterAttach(e){document.addEventListener("keydown",this,u),document.addEventListener("pointerdown",this,u),document.addEventListener("scroll",this,u)}onBeforeDetach(e){document.removeEventListener("keydown",this,u),document.removeEventListener("pointerdown",this,u),document.removeEventListener("scroll",this,u)}onModelStateChanged(){this.isAttached&&(this._activeIndex=0,this._indexChanged.emit(this._activeIndex),this.update())}onModelQueryChanged(e,t){if(this._sizeCache&&"editorUpdate"===t.origin){const t=e.completionItems(),i=this._sizeCache.items,s=i[this._findWidestItemIndex(i)],n=t[this._findWidestItemIndex(t)],o=this._getPreferredItemWidthHeuristic();t.length===this._sizeCache.items.length&&o(s)===o(n)||(this._sizeCache=void 0)}}onUpdateRequest(e){var t;const i=this._model;if(!i)return;i.query||this._populateSubset();let s=i.completionItems();if(!s.length)return void(this.isHidden||(this.reset(),this.hide(),this._visibilityChanged.emit(void 0)));this._updateConstraints(),this._geometryLock=!0;const n=this._createCompleterNode(i,s);let o=n.querySelectorAll(`.${d}`)[this._activeIndex];o.classList.add(h);const r=null===(t=this.model)||void 0===t?void 0:t.resolveItem(s[this._activeIndex]);this._showDoc&&(this._docPanel.innerText="",n.appendChild(this._docPanel),this._docPanelExpanded=!1,this._docPanel.style.display="none",this._updateDocPanel(r,o)),this.isHidden?(this.show(),this._setGeometry(),this._visibilityChanged.emit(void 0)):this._setGeometry(),this._geometryLock=!1}get sizeCache(){if(this._sizeCache)return{width:this._sizeCache.width+this._sizeCache.docPanelWidth,height:Math.max(this._sizeCache.height,this._sizeCache.docPanelHeight)}}_createDocPanelNode(){const e=document.createElement("div");return e.className="jp-Completer-docpanel",e}_createCompleterNode(e,t){const i=++this._renderCounter;let s=this.node;s.textContent="";let n=e.orderedTypes(),o=document.createElement("ul");o.className=c;const r=this._renderer.createCompletionItemNode(t[0],n),l=[r],a=p.measureSize(r,"inline-grid"),d=Math.max(Math.ceil(this._maxHeight/a.height),5),h=Math.min(d+1,t.length),u=performance.now();for(let e=1;e<h;e++){const i=this._renderer.createCompletionItemNode(t[e],n);l.push(i)}for(const e of l)o.appendChild(e);const m=this._findWidestItemIndex(t),g=m<l.length?l[m]:this._renderer.createCompletionItemNode(t[m],n),_=p.measureSize(g.cloneNode(!0),"inline-grid");if(this._sizeCache={height:Math.min(this._maxHeight,a.height*t.length),width:_.width+this._scrollbarWidth,items:t,docPanelWidth:0,docPanelHeight:0},h<t.length){const e=(performance.now()-u)/h,s=Math.max(5,Math.floor(12/e));let r=h,d=l[l.length-1];const c=()=>{if(r>=t.length)return;const e=a.height*(t.length-r);d.style.marginBottom=`${e}px`,requestAnimationFrame(()=>{if(i!=this._renderCounter)return;d.style.marginBottom="";const e=Math.min(t.length,r+s);for(let i=r;i<e;i++){const e=this._renderer.createCompletionItemNode(t[i],n);o.appendChild(e),d=e}r=e,c()})};c()}return s.appendChild(o),s}_findWidestItemIndex(e){const t=this._getPreferredItemWidthHeuristic(),i=e.map(t);return i.indexOf(Math.max(...i))}_getPreferredItemWidthHeuristic(){return this._renderer.itemWidthHeuristic?this._renderer.itemWidthHeuristic.bind(this._renderer):this._defaultRenderer.itemWidthHeuristic.bind(this._defaultRenderer)}_cycle(e){var t,i;const s=this.node.querySelectorAll(`.${d}`),n=this._activeIndex,o=s.length-1;let l=this.node.querySelector(`.${h}`);switch(l.classList.remove(h),e){case"up":this._activeIndex=0===n?o:n-1;break;case"down":this._activeIndex=n<o?n+1:0;break;case"pageUp":case"pageDown":{const t=this.node.getBoundingClientRect(),i=l.getBoundingClientRect(),s=Math.floor(t.height/i.height),r="pageUp"===e?-1:1;this._activeIndex=Math.min(Math.max(0,n+r*s),o);break}}l=s[this._activeIndex],l.classList.add(h);let a=this.node.querySelector(`.${c}`);r._$.scrollIntoViewIfNeeded(a,l),this._indexChanged.emit(this._activeIndex);const u=null===(t=this.model)||void 0===t?void 0:t.completionItems(),m=null==u?void 0:u[this._activeIndex];if(m){const e=null===(i=this.model)||void 0===i?void 0:i.resolveItem(m);this._showDoc&&this._updateDocPanel(e,l)}}_evtKeydown(e){if(!this.isHidden&&this._editor)if(this._editor.host.contains(e.target))switch(e.keyCode){case 9:{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=this._model;if(!t)return;const i=t.completionItems();if(i&&1===i.length)return this._selected.emit(i[0].insertText||i[0].label),void this.reset();const s=this._populateSubset();return t.query&&t.query!==this._lastSubsetMatch&&(t.subsetMatch=!0,this._selected.emit(t.query),t.subsetMatch=!1,this._lastSubsetMatch=t.query),s&&this.update(),void this._cycle(e.shiftKey?"up":"down")}case 27:return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void this.reset();case 33:case 34:case 38:case 40:{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=p.keyCodeMap[e.keyCode];return void this._cycle(t)}default:return}else this.reset()}_evtPointerdown(e){if(this.isHidden||!this._editor)return;if(p.nonstandardClick(e))return void this.reset();let t=e.target;for(;t!==document.documentElement;){if(t.classList.contains(d))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this._selected.emit(t.getAttribute("data-value")),void this.reset();if(t===this.node)return e.preventDefault(),e.stopPropagation(),void e.stopImmediatePropagation();t=t.parentElement}this.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame(()=>{this._setGeometry()})}_populateSubset(){const{model:e}=this;if(!e)return!1;const t=e.completionItems(),i=p.commonSubset(t.map(e=>e.insertText||e.label)),{query:s}=e;return!(!i||i===s||0!==i.indexOf(s)||(e.query=i,0))}_setGeometry(){const{node:e}=this,t=this._model,i=this._editor;if(!(i&&t&&t.original&&t.cursor))return;const s=t.cursor.start,n=i.getPositionAt(s),r=i.getCoordinateForPosition(n);if(!r)return;const l=window.getComputedStyle(e),a=parseInt(l.borderLeftWidth,10)||0,d=parseInt(l.paddingLeft,10)||0,h=i.host.closest(".jp-MainAreaWidget > .lm-Widget")||i.host,c=t.completionItems();this._sizeCache&&this._sizeCache.items.length!==c.length&&(this._sizeCache=void 0),o.e.setGeometry({anchor:r,host:h,maxHeight:this._maxHeight,minHeight:this._minHeight,node:e,size:this.sizeCache,offset:{horizontal:a+d},privilege:"below",style:l,outOfViewDisplay:{top:"stick-inside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}});const u=++this._geometryCounter;this._sizeCache||requestAnimationFrame(()=>{if(u!=this._geometryCounter)return;let t=e.getBoundingClientRect(),i=this._docPanel.getBoundingClientRect();this._sizeCache={width:t.width-i.width,height:t.height,items:c,docPanelWidth:i.width,docPanelHeight:i.height}})}_updateDocPanel(e,t){var i,s,n;let o=this._docPanel;if(!e)return void this._toggleDocPanel(!1);const r=null!==(n=null===(s=(i=this._renderer).createLoadingDocsIndicator)||void 0===s?void 0:s.call(i))&&void 0!==n?n:this._defaultRenderer.createLoadingDocsIndicator();t.appendChild(r),e.then(e=>{var t,i,s;if(e&&o)if(e.documentation){const n=null!==(s=null===(i=(t=this._renderer).createDocumentationNode)||void 0===i?void 0:i.call(t,e))&&void 0!==s?s:this._defaultRenderer.createDocumentationNode(e);o.textContent="",o.appendChild(n),this._toggleDocPanel(!0)}else this._toggleDocPanel(!1)}).catch(e=>console.error(e)).finally(()=>{t.removeChild(r)})}_toggleDocPanel(e){let t=this._docPanel;if(e){if(this._docPanelExpanded)return;t.style.display="",this._docPanelExpanded=!0}else{if(!this._docPanelExpanded)return;t.style.display="none",this._docPanelExpanded=!1}const i=this._sizeCache;i&&(i.docPanelHeight=e?this._maxHeight:0,i.docPanelWidth=e?this._docPanelWidth:0,this._geometryLock||this._setGeometry())}}var p;!function(e){class t{constructor(e){this.sanitizer=(null==e?void 0:e.sanitizer)||new s.I}createCompletionItemNode(e,t){let i=this._createWrapperNode(e.insertText||e.label);return e.deprecated&&i.classList.add("jp-Completer-deprecated"),this._constructNode(i,this._createLabelNode(e.label),!!e.type,e.type,t,e.icon)}createDocumentationNode(e){const t=document.createElement("div");t.classList.add("jp-RenderedText");const i=this.sanitizer,s=e.documentation||"";return(0,n.S5)({host:t,sanitizer:i,source:s}).catch(console.error),t}itemWidthHeuristic(e){var t;return e.label.replace(/<(\/)?mark>/g,"").length+((null===(t=e.type)||void 0===t?void 0:t.length)||0)}createLoadingDocsIndicator(){const e=document.createElement("div");e.classList.add("jp-Completer-loading-bar-container");const t=document.createElement("div");return t.classList.add("jp-Completer-loading-bar"),e.append(t),e}_createWrapperNode(e){const t=document.createElement("li");return t.className=d,t.setAttribute("data-value",e),t}_createLabelNode(e){const t=document.createElement("code");return t.className="jp-Completer-match",t.innerHTML=e,t}_constructNode(e,t,i,s,n,o){if(o){const t=o.element({className:"jp-Completer-type jp-Completer-icon"});e.appendChild(t)}else if(i){const t=document.createElement("span");t.textContent=(s[0]||"").toLowerCase();const i=n.indexOf(s)%10+1;t.className="jp-Completer-type jp-Completer-monogram",t.setAttribute("data-color-index",i.toString()),e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-monogram",e.appendChild(t)}if(e.appendChild(t),i){e.title=s;const t=document.createElement("code");t.className="jp-Completer-typeExtended",t.textContent=s.toLocaleLowerCase(),e.appendChild(t)}else{const t=document.createElement("span");t.className="jp-Completer-typeExtended",e.appendChild(t)}return e}}let i;e.Renderer=t,e.getDefaultRenderer=function(e){return(!i||e&&i.sanitizer!==e)&&(i=new t({sanitizer:e})),i}}(m||(m={})),function(e){e.keyCodeMap={38:"up",40:"down",33:"pageUp",34:"pageDown"},e.commonSubset=function(e){const t=e.length;let i="";if(t<2)return i;const s=e[0].length;for(let n=0;n<s;n++){const s=e[0][n];for(let o=1;o<t;o++)if(e[o][n]!==s)return i;i+=s}return i},e.nonstandardClick=function(e){return 0!==e.button||e.altKey||e.ctrlKey||e.shiftKey||e.metaKey},e.measureSize=function(e,t){e.isConnected&&console.warn("Measuring connected elements with `measureSize` has side-effects"),e.style.visibility="hidden",e.style.display=t,document.body.appendChild(e);const i=e.getBoundingClientRect();return document.body.removeChild(e),e.removeAttribute("style"),i}}(p||(p={}))},43165:(e,t,i)=>{function s(e){return!new Set(["text/plain","text/markdown","text/x-ipythongfm","text/x-rst","text/latex","application/json","text/html","text/css"]).has(e)}i.d(t,{o:()=>s})},52556:(e,t,i)=>{i.d(t,{CF:()=>r,qw:()=>n,qx:()=>l,t7:()=>s});var s,n,o=i(98238);!function(e){e[e.Invoked=1]="Invoked",e[e.TriggerCharacter=2]="TriggerCharacter",e[e.TriggerForIncompleteCompletions=3]="TriggerForIncompleteCompletions"}(s||(s={})),function(e){e[e.Invoke=0]="Invoke",e[e.Automatic=1]="Automatic"}(n||(n={}));const r=new o.Token("@jupyterlab/completer:IInlineCompleterFactory","A factory of inline completer widgets."),l=new o.Token("@jupyterlab/completer:ICompletionProviderManager","A service for the completion providers management.")},60639:(e,t,i)=>{i.d(t,{e:()=>o});const s="jp-HoverBox",n="-1000";var o;!function(e){e.setGeometry=function(e){const{anchor:t,host:i,node:o,privilege:r,outOfViewDisplay:l}=e,a=i.getBoundingClientRect();o.classList.contains(s)||o.classList.add(s),o.style.visibility&&(o.style.visibility=""),""===o.style.zIndex&&(o.style.zIndex=""),o.style.maxHeight="",o.style.marginTop="";const d=e.style||window.getComputedStyle(o),h=t.top-a.top,c=a.bottom-t.bottom,u=parseInt(d.marginTop,10)||0,m=parseInt(d.marginLeft,10)||0,p=parseInt(d.minHeight,10)||e.minHeight;let g=parseInt(d.maxHeight,10)||e.maxHeight;const _="forceAbove"!==r&&("forceBelow"===r||("above"===r?h<g&&h<c:c>=g||c>=h));if(_?g=Math.min(c-u,g):(g=Math.min(h,g),o.style.marginTop="0px"),o.style.maxHeight=`${g}px`,!(g>=p&&(c>=p||h>=p)))return o.style.zIndex=n,void(o.style.visibility="hidden");e.size?(o.style.width=`${e.size.width}px`,o.style.height=`${e.size.height}px`,o.style.contain="strict"):(o.style.contain="",o.style.width="auto",o.style.height="");const f=e.size?e.size.height:o.getBoundingClientRect().height,v=e.offset&&e.offset.vertical&&e.offset.vertical.above||0,C=e.offset&&e.offset.vertical&&e.offset.vertical.below||0;let y=_?a.bottom-c+C:a.top+h-f+v;o.style.top=`${Math.floor(y)}px`;const x=e.offset&&e.offset.horizontal||0;let I=t.left+x;o.style.left=`${Math.ceil(I)}px`;let b=o.getBoundingClientRect(),w=b.right;w>window.innerWidth&&(I-=w-window.innerWidth,w=window.innerWidth,o.style.left=`${Math.ceil(I)}px`),I<x-m&&(I=x-m,o.style.left=`${Math.ceil(I)}px`),o.style.zIndex="-1000";const P=b.bottom,k=i.contains(document.elementFromPoint(I,y)),S=i.contains(document.elementFromPoint(w,y)),M=i.contains(document.elementFromPoint(w,P)),T=i.contains(document.elementFromPoint(I,P));o.style.zIndex="";const q=k||S,E=T||M,z=k||T,L=M||S,D=P-y,H=w-I,A=y<a.top,N=P>a.bottom,j=I+m<a.left,R=w>a.right;let O=!1,W=!1,$=!1;if(A)switch((null==l?void 0:l.top)||"hidden-inside"){case"hidden-inside":q||(O=!0);break;case"hidden-outside":E||(O=!0);break;case"stick-inside":a.top>y&&(y=a.top,$=!0);break;case"stick-outside":a.top>P&&(y=a.top-D,$=!0)}if(N)switch((null==l?void 0:l.bottom)||"hidden-outside"){case"hidden-inside":E||(O=!0);break;case"hidden-outside":q||(O=!0);break;case"stick-inside":a.bottom<P&&(y=a.bottom-D,$=!0);break;case"stick-outside":a.bottom<y&&(y=a.bottom,$=!0)}if(j)switch((null==l?void 0:l.left)||"hidden-inside"){case"hidden-inside":z||(O=!0);break;case"hidden-outside":L||(O=!0);break;case"stick-inside":a.left>I+m&&(I=a.left-m,W=!0);break;case"stick-outside":a.left>w&&(I=a.left-m-H,W=!0)}if(R)switch((null==l?void 0:l.right)||"hidden-outside"){case"hidden-inside":L||(O=!0);break;case"hidden-outside":z||(O=!0);break;case"stick-inside":a.right<w&&(I=a.right-H,W=!0);break;case"stick-outside":a.right<I&&(I=a.right,W=!0)}O&&(o.style.zIndex=n,o.style.visibility="hidden"),W&&(o.style.left=`${Math.ceil(I)}px`),$&&(o.style.top=`${Math.ceil(y)}px`)}}(o||(o={}))},62097:(e,t,i)=>{i.d(t,{X:()=>a});var s,n=i(38921),o=i(98238),r=i(72490);function l(e){const t=document.createElement("span");return t.textContent=e,t.innerHTML}class a{constructor(){this.processedItemsCache=null,this._current=null,this._cursor=null,this._isDisposed=!1,this._completionItems=[],this._original=null,this._query="",this._subsetMatch=!1,this._typeMap={},this._orderedTypes=[],this._stateChanged=new r.Signal(this),this._queryChanged=new r.Signal(this),this._processedToOriginalItem=null,this._resolvingItem=0}get stateChanged(){return this._stateChanged}get queryChanged(){return this._queryChanged}get original(){return this._original}set original(e){this._original===e||this._original&&e&&o.JSONExt.deepEqual(e,this._original)||(this._reset(),this._current=this._original=e,this._stateChanged.emit(void 0))}get current(){return this._current}set current(e){if(this._current===e||this._current&&e&&o.JSONExt.deepEqual(e,this._current))return;const t=this._original;if(!t)return;const i=this._cursor;if(!i)return;const s=this._current=e;if(!s)return void this._stateChanged.emit(void 0);const n=t.text.split("\n")[t.line],r=s.text.split("\n")[s.line];if(!this._subsetMatch&&r.length<n.length)return void this.reset(!0);const{start:l,end:a}=i;let d=s.text.substring(l);const h=t.text.substring(a);d=d.substring(0,d.lastIndexOf(h)),this._query=d,this.processedItemsCache=null,this._processedToOriginalItem=null,this._queryChanged.emit({newValue:this._query,origin:"editorUpdate"}),this._stateChanged.emit(void 0)}get cursor(){return this._cursor}set cursor(e){this.original&&(this._cursor=e)}get query(){return this._query}set query(e){this._query=e,this.processedItemsCache=null,this._processedToOriginalItem=null,this._queryChanged.emit({newValue:this._query,origin:"setter"})}get subsetMatch(){return this._subsetMatch}set subsetMatch(e){this._subsetMatch=e}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed||(this._isDisposed=!0,r.Signal.clearData(this))}completionItems(){if(!this.processedItemsCache){let e=this._query;if(e){const t=this._markup(e);this.processedItemsCache=t.map(e=>e.processedItem),this._processedToOriginalItem=new WeakMap(t.map(e=>[e.processedItem,e.originalItem]))}else this.processedItemsCache=this._completionItems.map(e=>this._escapeItemLabel(e)),this._processedToOriginalItem=null}return this.processedItemsCache}setCompletionItems(e){o.JSONExt.deepEqual(e,this._completionItems)||(this._completionItems=e,this._orderedTypes=s.findOrderedCompletionItemTypes(this._completionItems),this.processedItemsCache=null,this._processedToOriginalItem=null,this._stateChanged.emit(void 0))}typeMap(){return this._typeMap}orderedTypes(){return this._orderedTypes}handleCursorChange(e){if(!this._original)return;const{column:t,line:i}=e,{current:s,original:n}=this;if(!n)return;if(i!==n.line)return void this.reset(!0);if(t<n.column)return void this.reset(!0);const{cursor:o}=this;if(!o||!s)return;const r=o.end-o.start,l=n.text.split("\n")[n.line],a=s.text.split("\n")[s.line].length-l.length;t>n.column+r+a&&this.reset(!0)}handleTextChange(e){const t=this._original;if(!t)return;const{text:i,column:s,line:n}=e,o=i.split("\n")[n][s-1];o&&o.match(/\S/)||e.column>=t.column?this.current=e:this.reset(!1)}createPatch(e){const t=this._original,i=this._cursor,s=this._current;if(!t||!i||!s)return;let{start:n,end:o}=i;return o+=s.text.length-t.text.length,{start:n,end:o,value:e}}reset(e=!1){!e&&this._subsetMatch||(this._reset(),this._stateChanged.emit(void 0))}_markup(e){var t;const i=this._completionItems;let o=[];for(const r of i){const i=r.label.indexOf("("),a=i>-1?r.label.substring(0,i):r.label,d=n.StringExt.matchSumOfSquares(l(a),e);if(d){let e=n.StringExt.highlight(l(r.label),d.indices,s.mark);const i=Object.assign({},r);i.label=e.join(""),i.insertText=null!==(t=r.insertText)&&void 0!==t?t:r.label,o.push({item:i,score:d.score,originalItem:r})}}return o.sort(s.scoreCmp),o.map(e=>({processedItem:e.item,originalItem:e.originalItem}))}resolveItem(e){let t,i;if("number"==typeof e){const i=this.completionItems();if(!i||!i[e])return;t=i[e]}else t=e;if(t)return i=this._processedToOriginalItem?this._processedToOriginalItem.get(t):t,i?this._resolveItemByValue(i):void 0}_resolveItemByValue(e){const t=++this._resolvingItem;let i;if(e.resolve){let t;e.insertText&&(t=this.createPatch(e.insertText)),i=e.resolve(t)}else i=Promise.resolve(e);return i.then(i=>(this._escapeItemLabel(i,!0),Object.keys(i).forEach(t=>{e[t]=i[t]}),e.resolve=void 0,t!==this._resolvingItem?Promise.resolve(null):i)).catch(t=>(console.error(t),Promise.resolve(e)))}_escapeItemLabel(e,t=!1){var i;const s=l(e.label);if(s!==e.label){const n=t?e:Object.assign({},e);return n.insertText=null!==(i=e.insertText)&&void 0!==i?i:e.label,n.label=s,n}return e}_reset(){const e=this._query;this._current=null,this._cursor=null,this._completionItems=[],this._original=null,this._query="",this.processedItemsCache=null,this._processedToOriginalItem=null,this._subsetMatch=!1,this._typeMap={},this._orderedTypes=[],e&&this._queryChanged.emit({newValue:this._query,origin:"reset"})}}!function(e){const t=["function","instance","class","module","keyword"],i=t.reduce((e,t)=>(e[t]=null,e),{});e.mark=function(e){return`<mark>${e}</mark>`},e.scoreCmp=function(e,t){var i,s,n;const o=e.score-t.score;return 0!==o?o:null!==(n=null===(i=e.item.insertText)||void 0===i?void 0:i.localeCompare(null!==(s=t.item.insertText)&&void 0!==s?s:""))&&void 0!==n?n:0},e.findOrderedCompletionItemTypes=function(e){const i=new Set;e.forEach(e=>{!e.type||t.includes(e.type)||i.has(e.type)||i.add(e.type)});const s=Array.from(i);return s.sort((e,t)=>e.localeCompare(t)),t.concat(s)},e.findOrderedTypes=function(e){const s=Object.keys(e).map(t=>e[t]).filter(e=>!!e&&!(e in i)).sort((e,t)=>e.localeCompare(t));return t.concat(s)}}(s||(s={}))},67004:(e,t,i)=>{i.d(t,{$:()=>a});var s=i(4279),n=i(63711),o=i(23316),r=i(72490),l=i(52556);class a{constructor(e){this._fetchingInline=0,this._editor=null,this._enabled=!1,this._isDisposed=!1,this._autoCompletion=!1,this._continuousInline=!0,this._tabCompleterActive=!1,this.completer=e.completer,this.inlineCompleter=e.inlineCompleter,this.completer.selected.connect(this.onCompletionSelected,this),this.completer.visibilityChanged.connect(this.onVisibilityChanged,this),this._reconciliator=e.reconciliator}set reconciliator(e){this._reconciliator=e}get editor(){return this._editor}set editor(e){if(e===this._editor)return;let t=this._editor;if(t&&!t.isDisposed){const e=t.model;t.host.classList.remove(s.nx),t.host.classList.remove(s.Qr),e.selections.changed.disconnect(this.onSelectionsChanged,this),e.sharedModel.changed.disconnect(this._onSharedModelChanged,this)}if(this.completer.reset(),this.completer.editor=e,t=this._editor=e,t){const e=t.model;this._enabled=!1,e.selections.changed.connect(this.onSelectionsChanged,this),e.sharedModel.changed.connect(this._onSharedModelChanged,this),this.onSelectionsChanged(),this.inlineCompleter&&(this.inlineCompleter.editor=t)}}get isDisposed(){return this._isDisposed}set autoCompletion(e){this._autoCompletion=e}get autoCompletion(){return this._autoCompletion}dispose(){this.isDisposed||(this._isDisposed=!0,r.Signal.clearData(this))}invokeInline(){const e=this._editor;e&&this._makeInlineRequest(e.getCursorPosition(),l.qw.Invoke).catch(e=>{console.warn("Inline invoke request bailed",e)})}invoke(){o.Mu.sendMessage(this,a.Msg.InvokeRequest)}processMessage(e){e.type===a.Msg.InvokeRequest.type&&this.onInvokeRequest(e)}getState(e,t){return{text:e.model.sharedModel.getSource(),line:t.line,column:t.column}}onCompletionSelected(e,t){const i=e.model,s=this._editor;if(!s||!i)return;const n=i.createPatch(t);if(!n)return;const{start:o,end:r,value:l}=n,a=s.getOffsetAt(s.getCursorPosition()),d={changes:{from:o,to:r,insert:l}};a<=r&&a>=o&&(d.selection={anchor:o+l.length}),s.editor.dispatch(d)}onInvokeRequest(e){if(!this.completer.model)return;if(this.completer.model.original)return;const t=this._editor;t&&this._makeRequest(t.getCursorPosition(),l.t7.Invoked).catch(e=>{console.warn("Invoke request bailed",e)})}onSelectionsChanged(){var e;const t=this.completer.model,i=this._editor;if(!i)return;const n=null===(e=this.inlineCompleter)||void 0===e?void 0:e.model;n&&n.handleSelectionChange(i.getSelection());const o=i.host;if(!t)return this._enabled=!1,void o.classList.remove(s.nx);if(t.subsetMatch)return;const r=i.getCursorPosition(),l=i.getLine(r.line),{start:a,end:d}=i.getSelection();if(a.column!==d.column||a.line!==d.line)return this._enabled=!1,t.reset(!0),void o.classList.remove(s.nx);l&&0!==d.column?l&&l.slice(0,r.column).match(/^\s*$/)?o.classList.add(s.iy):o.classList.remove(s.iy):o.classList.add(s.iy),this._enabled||(this._enabled=!0,o.classList.add(s.nx)),t.handleCursorChange(this.getState(i,i.getCursorPosition()))}async onTextChanged(e,t){var i;if(!this._enabled)return;const s=this.completer.model,n=this.editor;if(!n)return;s&&this._autoCompletion&&this._reconciliator.shouldShowContinuousHint&&await this._reconciliator.shouldShowContinuousHint(this.completer.isVisible,t)&&this._makeRequest(n.getCursorPosition(),l.t7.TriggerCharacter);const o=null===(i=this.inlineCompleter)||void 0===i?void 0:i.model;if(o&&(o.handleTextChange(t),this._continuousInline&&this._makeInlineRequest(n.getCursorPosition(),l.qw.Automatic)),s){const{start:e,end:t}=n.getSelection();if(e.column!==t.column||e.line!==t.line)return;s.handleTextChange(this.getState(n,n.getCursorPosition()))}}onVisibilityChanged(e){var t;if(e.isDisposed||e.isHidden)return this._tabCompleterActive=!1,void(this._editor&&(this._editor.host.classList.remove(s.Qr),this._editor.focus()));this._tabCompleterActive=!0,null===(t=this._editor)||void 0===t||t.host.classList.add(s.Qr)}async _onSharedModelChanged(e,t){t.sourceChange&&await this.onTextChanged(e,t)}_makeRequest(e,t){const i=this.editor;if(!i)return Promise.reject(new Error("No active editor"));const s=this._composeRequest(i,e),n=this.getState(i,e);return this._reconciliator.fetch(s,t).then(e=>{var t;if(!e)return;const i=this._updateModel(n,e.start,e.end);i&&(this.completer.suppressIfInlineCompleterActive&&(null===(t=this.inlineCompleter)||void 0===t?void 0:t.isActive)||i.setCompletionItems&&i.setCompletionItems(e.items))}).catch(e=>{})}async _makeInlineRequest(e,t){const i=this.editor;if(!i)return Promise.reject(new Error("No active editor"));if(!this.inlineCompleter)return Promise.reject(new Error("No inline completer"));const s=i.getLine(e.line);if(t===l.qw.Automatic&&(void 0===s||s.slice(0,e.column).match(/^\s*$/)))return void(this._fetchingInline+=1);let n=!1;void 0!==s&&e.column<s.length&&(n=!0);const o=this._composeRequest(i,e),r=this.inlineCompleter.model;if(!r)return;r.cursor=e;const a=++this._fetchingInline,d=this._reconciliator.fetchInline(o,t,n);let h=!1;const c=new Set;for(const e of d)e.then(t=>{var i;if(!h&&t&&t.items&&a===this._fetchingInline)if(c.add(e),1===c.size){if((null===(i=this.inlineCompleter)||void 0===i?void 0:i.suppressIfTabCompleterActive)&&this._tabCompleterActive)return void(h=!0);r.setCompletions(t)}else r.appendCompletions(t)}).catch(e=>{console.warn(e)}).finally(()=>{c.add(e);const t=d.length-c.size;r.notifyProgress({pendingProviders:t,totalProviders:d.length})})}_composeRequest(e,t){const i=e.model.sharedModel.getSource(),s=e.model.mimeType;return{text:i,offset:n.Text.jsIndexToCharIndex(e.getOffsetAt(t),i),mimeType:s}}_updateModel(e,t,i){const s=this.completer.model,o=e.text;return s?(s.original=e,s.cursor={start:n.Text.charIndexToJsIndex(t,o),end:n.Text.charIndexToJsIndex(i,o)},s):null}}!function(e){let t,i;!function(e){e[e.opened=0]="opened",e[e.update=1]="update",e[e.closed=2]="closed"}(t=e.StraemEvent||(e.StraemEvent={})),function(e){e.InvokeRequest=new o.QB("invoke-request")}(i=e.Msg||(e.Msg={}))}(a||(a={}))},71784:(e,t,i)=>{i.d(t,{G:()=>r,c:()=>o});var s=i(63711),n=i(43165);const o="CompletionProvider:kernel";class r{constructor(){this.identifier=o,this.rank=550,this.renderer=null}async isApplicable(e){var t;return!!(null===(t=e.session)||void 0===t?void 0:t.kernel)}async fetch(e,t){var i;const s=null===(i=t.session)||void 0===i?void 0:i.kernel;if(!s)throw new Error("No kernel for completion request.");const n={code:e.text,cursor_pos:e.offset},o=(await s.requestComplete(n)).content;if("ok"!==o.status)throw new Error("Completion fetch failed to return successfully.");const r=new Array,l=o.metadata._jupyter_types_experimental;return o.matches.forEach((e,t)=>{l&&l[t]?r.push({label:e,type:l[t].type,insertText:l[t].text}):r.push({label:e})}),{start:o.cursor_start,end:o.cursor_end,items:r}}async resolve(e,t,i){const{editor:n,session:o}=t;if(o&&n){let t=n.model.sharedModel.getSource();const r=n.getCursorPosition();let l=s.Text.jsIndexToCharIndex(n.getOffsetAt(r),t);const a=o.kernel;if(!t||!a)return Promise.resolve(e);if(i){const{start:e,value:s}=i;t=t.substring(0,e)+s,l+=s.length}const d={code:t,cursor_pos:l,detail_level:0},h=(await a.requestInspect(d)).content;return"ok"===h.status&&h.found?(e.documentation=h.data["text/plain"],e):e}return e}shouldShowContinuousHint(e,t,i){var s,o;const r=null!==(o=null===(s=null==i?void 0:i.editor)||void 0===s?void 0:s.model.mimeType)&&void 0!==o?o:"";if(!(0,n.o)(r))return!1;const l=t.sourceChange;return null==l||!l.some(e=>null!=e.delete)&&l.some(t=>null!=t.insert&&("."===t.insert||!e&&t.insert.trim().length>0))}}},89492:(e,t,i)=>{i.d(t,{C:()=>l});var s=i(67004),n=i(52556),o=i(72490),r=i(43165);class l{constructor(e){var t,i;this._resolveFactory=(e,t)=>e.resolve?i=>e.resolve(t,this._context,i):void 0,this._fetching=0,this._inlineFetching=0,this._providers=e.providers,this._inlineProviders=null!==(t=e.inlineProviders)&&void 0!==t?t:[],this._inlineProvidersSettings=null!==(i=e.inlineProvidersSettings)&&void 0!==i?i:{},this._context=e.context,this._timeout=e.timeout}async applicableProviders(){const e=this._providers.map(e=>e.isApplicable(this._context)),t=await Promise.all(e);return this._providers.filter((e,i)=>t[i])}fetchInline(e,t,i){let s=[];const r=++this._inlineFetching;for(const l of this._inlineProviders){const a=this._inlineProvidersSettings[l.identifier];if(t!==n.qw.Invoke&&i&&!a.autoFillInMiddle)continue;let d=0;t===n.qw.Automatic&&(d=a.debouncerDelay);const h=()=>{const i=l.fetch(e,{...this._context,triggerKind:t}).then(e=>({...e,items:e.items.map(e=>{const t=e;return t.stream=new o.Signal(t),t.provider=l,this._stream(t,l),t})})),s=new Promise(e=>setTimeout(()=>e(null),d+a.timeout));return Promise.race([i,s])},c=0===d?h():new Promise((e,t)=>setTimeout(()=>r!=this._inlineFetching?t(null):e(h()),d));s.push(c.catch(e=>e))}return s}async _stream(e,t){if(!e.isIncomplete||!t.stream||!e.token)return;const i=e.stream,n=e.token;e.token=void 0,e.streaming=!0,i.emit(s.$.StraemEvent.opened);for await(const o of t.stream(n)){const t=o.response,n=t.insertText.substring(e.insertText.length);e.insertText=t.insertText,e.lastStreamed=n,e.error=o.response.error,i.emit(s.$.StraemEvent.update)}e.isIncomplete=!1,e.lastStreamed=void 0,e.streaming=!1,i.emit(s.$.StraemEvent.closed)}async fetch(e,t){const i=++this._fetching;let s=[];const n=await this.applicableProviders();for(const o of n){let n;n=o.fetch(e,this._context,t).then(e=>{if(i!==this._fetching)return Promise.reject(void 0);const t=e.items.map(e=>({...e,resolve:this._resolveFactory(o,e)}));return{...e,items:t}});const r=new Promise(e=>setTimeout(()=>e(null),this._timeout));n=Promise.race([n,r]),s.push(n.catch(e=>e))}const o=Promise.all(s);return this._mergeCompletions(o)}async shouldShowContinuousHint(e,t){const i=await this.applicableProviders();return 0!==i.length&&(i[0].shouldShowContinuousHint?i[0].shouldShowContinuousHint(e,t,this._context):this._defaultShouldShowContinuousHint(e,t))}_alignPrefixes(e,t,i){if(t!=i){const t=this._context.editor;if(!t)return e;const s=t.getCursorPosition(),n=t.getLine(s.line);if(!n)return e;const o=t.getOffsetAt({line:s.line,column:0});return e.map(e=>{const t=Math.max(e.start-o,0),s=Math.max(i-o,0);if(t==s)return e;const r=n.substring(t,s);return{...e,items:e.items.map(e=>{let t=e.insertText||e.label;return e.insertText=t.startsWith(r)?t.slice(r.length):t,e})}})}return e}async _mergeCompletions(e){let t=(await e).filter(e=>!(!e||e instanceof Error||!e.items.length));if(0==t.length)return null;if(1==t.length)return t[0];const i=Math.min(...t.map(e=>e.end)),s=t.map(e=>e.start),n=Math.min(...s),o=Math.max(...s);t=this._alignPrefixes(t,n,o);const r=new Set,l=new Array;for(const e of t)e.items.forEach(e=>{let t=(e.insertText||e.label).trim();r.has(t)||(r.add(t),l.push(e))});return{start:o,end:i,items:l}}_defaultShouldShowContinuousHint(e,t){var i,s,n;const o=null!==(n=null===(s=null===(i=this._context)||void 0===i?void 0:i.editor)||void 0===s?void 0:s.model.mimeType)&&void 0!==n?n:"";return!!(0,r.o)(o)&&!e&&(null==t.sourceChange||t.sourceChange.some(e=>null!=e.insert&&e.insert.length>0))}}}}]);