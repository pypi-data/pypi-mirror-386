"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[3993],{53993:(e,t,n)=>{n.r(t),n.d(t,{NotebookEdit:()=>Ne,default:()=>Me});var r=n(9387),s=n(20568),a=n(97789),i=n(16950),o=n(17781),l=n(54617),d=n(99180),c=n(70985),u=n(58875),m=n(34447),p=n(93054),h=n(21538),x=n(11029),v=n(87324),f=n(48824),g=n(81461),j=n(72533),b=n(38621),y=n(32916),k=n(42389),C=n(34477),S=n(16476),w=n(2159),_=n(5700),A=n(2606),N=n(27203),M=n(27446),P=n(14551),I=n(52982),z=n(3188),D=n(46871),U=n(98970),T=n(6543),$=n(68652),L=n(75345),E=n(83051),O=n(99179),R=n(17788),V=n(66210),F=n(34279),W=n(41273),K=n(60105),B=n(56944),G=n(9570),J=n(26127),Q=n(92131),H=n(14178),q=n(35903),X=n(10069),Y=n(83626),Z=n(26480),ee=n(6417),te=n(88037),ne=n(41630),re=n(98754),se=n(18683);function ae(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ie extends te._Q{constructor(e){super(),ae(this,"_rows",void 0),ae(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map(e=>e.split(";"));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,se.jsx)("div",{children:"No data found!"}):(0,se.jsx)(ne.NP,{children:this._rows.map(e=>(0,se.jsx)(re.A,{mt:3,children:e}))})}}const oe={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new ie(e)};var le=n(27721),de=n(74349),ce=n(14809),ue=n(17310),me=n(34429),pe=n(4116);function he(e){const{createAIAgent:t}=(0,B.w)(),{aiAgents:n,addAIAgent:s}=(0,X.Ks)(),{cell:a,extensionProps:i}=e,{notebookId:o}=i,[l,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)(),[v,g]=(0,r.useState)({prompt:""}),[j,y]=(0,r.useState)({prompt:void 0});(0,r.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===t.key&&p)for(const e of a.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===p){h(void 0);break}};return a.model.sharedModel.metadataChanged.connect(e),()=>{a.model?.sharedModel.metadataChanged.disconnect(e)}},[a,p]),(0,r.useEffect)(()=>{p||m(!1)},[p]),(0,r.useEffect)(()=>{y({...j,prompt:void 0===v.prompt?void 0:v.prompt.length>0})},[v]);const k=(0,r.useCallback)(async()=>{const e=i.panel.context.sessionContext.session?.kernel,r=e?.serverSettings,l=e?.id;n.find(e=>e.documentId===o&&e.runtimeId===l)||(await t(o,"notebook_persist",r?.baseUrl,r?.token,l),s({documentId:o,runtimeId:l}));const d=(0,pe.f)();!function(e,t,n){const r=e.model.getMetadata("datalayer")??{},s=r.ai??{prompts:[],messages:[]},a=s.prompts??[];a.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),s.prompts=a,r.ai=s,e.model.setMetadata("datalayer",r)}(a,d,v.prompt),h(d)},[n,a,i.panel.context.sessionContext.session?.kernel,v.prompt,o,t]),C=(0,r.useCallback)(e=>{e.ctrlKey&&"Enter"===e.key&&k()},[k]);return(0,se.jsx)(ne.NP,{children:(0,se.jsx)(re.A,{display:"flex",style:{justifyContent:"right"},children:(0,se.jsx)(re.A,{className:"dla-Cell-ai-agent-button",children:(0,se.jsxs)(c.W,{open:l,onOpenChange:e=>m(e),children:[(0,se.jsx)(c.W.Anchor,{id:"custom-anchor-id",children:(0,se.jsx)(u.K,{icon:b.SD8,variant:"invisible","aria-label":"AI Agents menu"})}),(0,se.jsx)(c.W.Overlay,{width:"large",children:(0,se.jsxs)(re.A,{as:"form",m:3,children:[(0,se.jsxs)(x.A,{children:[(0,se.jsx)(x.A.Label,{visuallyHidden:!0}),(0,se.jsx)(f.Ay,{block:!0,value:v.prompt,onChange:e=>{g(t=>({...t,prompt:e.target.value}))},disabled:!!p,onKeyDown:C})]}),(0,se.jsxs)(re.A,{sx:{display:"flex",width:"100%",gap:"2px",marginTop:"var(--stack-gap-normal)"},children:[(0,se.jsx)(re.A,{flexGrow:1}),(0,se.jsx)(d.Q,{onClick:e=>m(!1),variant:"default",children:"Cancel"}),(0,se.jsx)(d.Q,{leadingVisual:ue.A,onClick:k,disabled:!j.prompt||!!p,variant:"primary",children:p?(0,se.jsx)(me.A,{size:"small"}):"Ask AI"})]})]})})]})})})})}var xe=n(94247);const ve=e=>{const{cell:t}=e,{datasources:n}=(0,q.Gr)(),[s,a]=(0,r.useState)(),[i,o]=(0,r.useState)("df");(0,r.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){a(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model?.metadataChanged.disconnect(e)}},[t,n]);const l=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:i??"df"}}),a(e.id),t.editor.model.mimeType=xe.bd):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),a(void 0),t.editor.model.mimeType=xe.dC)};return(0,se.jsx)(ne.NP,{children:(0,se.jsx)(I.az,{display:"flex",style:{justifyContent:"right"},children:(0,se.jsx)(I.az,{className:"dla-Cell-datasource-button",children:(0,se.jsxs)(c.W,{children:[(0,se.jsx)(c.W.Anchor,{id:"custom-anchor-id",children:(0,se.jsx)(u.K,{icon:b.bN0,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,se.jsx)(c.W.Overlay,{width:"medium",children:(0,se.jsx)(m.l,{selectionVariant:"single",showDividers:!0,children:(0,se.jsxs)(m.l.Group,{children:[(0,se.jsx)(m.l.GroupHeading,{children:"Datasources"}),0===n.length&&(0,se.jsxs)(m.l.Item,{onSelect:()=>{},children:["No Datasource available",(0,se.jsx)(m.l.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map(e=>(0,se.jsxs)(m.l.Item,{onSelect:()=>l(e),selected:e.id===s,children:[e.name,(0,se.jsx)(m.l.Description,{variant:"block",children:e.description})]},e.id)),(0,se.jsx)(m.l.Divider,{}),(0,se.jsx)(m.l.Item,{onSelect:e=>{e.preventDefault()},children:(0,se.jsxs)(x.A,{children:[(0,se.jsx)(x.A.Label,{children:"Destination variable"}),(0,se.jsx)(v.A,{size:"small",value:i,disabled:!s,onChange:e=>(e=>{o(e);const n=t.model.getMetadata("datalayer");t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{...n.datasource,destinationVar:e??"df"}})})(e.target.value)})]})}),(0,se.jsx)(m.l.Divider,{}),(0,se.jsx)(m.l.Item,{variant:"danger",onSelect:()=>l(void 0),children:"None"})]})})})]})})})})};function fe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ge="dla-CellToolbar-Container";class je extends te._Q{constructor(e,t){super(),fe(this,"_cell",void 0),fe(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(ge)}render(){return(0,se.jsxs)(I.az,{display:"flex",children:[(0,se.jsx)(I.az,{flexGrow:1}),(0,se.jsxs)(s.fS,{initialEntries:["/"],children:[(0,se.jsx)(s.BV,{children:(0,se.jsx)(s.qh,{path:"*",element:(0,se.jsx)(he,{cell:this._cell,extensionProps:this._props})})}),(0,se.jsx)(ve,{cell:this._cell,extensionProps:this._props})]})]})}}function be(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ye extends ce.x0{constructor(e,t){super(),be(this,"_panel",void 0),be(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect(()=>{n()})}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect(()=>{this._updateCodeCell(t)}),t.inViewportChanged.connect(()=>{this._updateCodeCell(t)}),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find(t=>t.model===e):null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(ge)||n.insertWidget(1,new je(e,this._props))}}}}class ke{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new ye(e,this._props)}get component(){return null}}var Ce=n(35769);const Se=e=>{const{mcpServerUrl:t}=e;return(0,se.jsx)(se.Fragment,{children:t?(0,se.jsx)(se.Fragment,{children:(0,se.jsx)(Ce.n,{mcpServerUrl:t,height:"calc(100vh - 245px)"})}):(0,se.jsx)(se.Fragment,{})})};var we=n(45077);const _e=e=>{const{documentServer:t,runtimeId:n,runtimeSettings:r}=e;return(0,se.jsxs)(I.az,{children:[(0,se.jsxs)(g.A,{children:[(0,se.jsx)(y.A,{})," MCP Server"]}),(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(I.az,{children:[(0,se.jsx)(j.A,{children:"Start a Jupyter MCP Server"}),(0,se.jsx)(we.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${r.baseUrl}   --start-new-runtime false   --runtime-id ${n}   --runtime-token ${r.token}   --port 4040\n`})]}),(0,se.jsxs)(I.az,{sx:{mb:2},children:[(0,se.jsx)(j.A,{children:"Connect a running Jupyter MCP Server"}),(0,se.jsx)(we.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --start-new-runtime false\n \njupyter-mcp-server connect   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${r.baseUrl}   --runtime-id ${n}   --runtime-token ${r.token}   --jupyter-mcp-server-url http://localhost:4040\n`})]}),(0,se.jsxs)(I.az,{sx:{mb:2},children:[(0,se.jsx)(j.A,{children:"Run Code on the Runtime"}),(0,se.jsx)(we.O,{code:`import os\n\nfrom platform import node\nfrom jupyter_kernel_client import KernelClient\n\nkernel = KernelClient(\n  server_url="${r.baseUrl}",\n  kernel_id="${n}",\n  token="${r.token}"\n)\nkernel.start()\ncode = """import os\nfrom platform import node\nx=f"Hey {os.environ.get('USER', 'Foo Bar')} from {node()}."\nprint(x)\n"""\nreply = kernel.execute(code)\nprint(reply)\nassert reply["execution_count"] > 1\nassert reply["status"] == "ok"\nassert len(reply["outputs"]) > 0\n\n`})]}),(0,se.jsxs)(I.az,{children:[(0,se.jsx)(j.A,{children:"Connect to the Room, add a Cell and run it."}),(0,se.jsx)(we.O,{code:`from jupyter_nbmodel_client import NbModelClient, get_notebook_websocket_url\n\nws_url = get_notebook_websocket_url(\n  server_url = "${t.baseURL}",\n  path = "${t.documentName}",\n  token = "${t.token}",\n  provider = "datalayer"\n)\n\nasync with NbModelClient(ws_url) as notebook:\n    cell_index = notebook.add_code_cell("1+1")\n    results = notebook.execute_cell(cell_index, kernel)\n    print(results)\n    assert results["status"] == "ok"\n    assert len(results["outputs"]) > 0\n\n`})]})]})]})},Ae=new k.Od;function Ne(){const{notebookId:e}=(0,s.g)();if(!e)return(0,se.jsx)(se.Fragment,{});const t=(0,O.J)(),k=(0,o.S)(),te=(0,R.Z)(),ne=(0,V.G)(e),{checkIsPlatformFeaturesPreviewer:re}=(0,F.x)(),ae=re(t),{configuration:ie}=(0,G._O)(),{credits:ce,token:ue}=(0,J.Y)(),{configuration:me,multiServiceManager:pe,runtimeModels:he}=(0,Q.c6)(),{jupyterLabAdapter:xe}=(0,C.Hf)(),[ve,fe]=(0,r.useState)(Ae),[ge,je]=(0,r.useState)(void 0),[be,ye]=(0,r.useState)(),[Ce,we]=(0,r.useState)(!1),[Ne,Me]=(0,r.useState)(),[Pe,Ie]=(0,r.useState)(!1),[ze,De]=(0,r.useState)(!0),[Ue,Te]=(0,r.useState)(""),[$e,Le]=(0,r.useState)(null),[Ee,Oe]=(0,r.useState)(),[Re,Ve]=(0,r.useState)(),[Fe,We]=(0,r.useState)(),[Ke,Be]=(0,r.useState)(),[Ge,Je]=(0,r.useState)({name:"",nameConfirm:"",description:""}),[Qe,He]=(0,r.useState)({name:void 0,nameConfirm:void 0,description:void 0}),{enqueueToast:qe,trackAsyncTask:Xe}=(0,W.d)(),{selectNotebookModel:Ye,reset:Ze}=(0,S.Gx)(),{screenCapture:et,space:tt,hideBackdrop:nt,setItem:rt,setScreenCapture:st,showBackdrop:at,showScreenshot:it,triggerItemsRefresh:ot}=(0,H.l5)(),{cloneNotebook:lt,deleteItem:dt,getDatasources:ct,getNotebook:ut,refreshDatasources:mt,refreshNotebook:pt,updateNotebook:ht,updateNotebookModel:xt}=(0,K.E)(),{updateDatasources:vt}=(0,q.Gr)(),{updateAIAgent:ft}=(0,X.Ks)(),{patchAIAgent:gt}=(0,B.w)(),jt=(0,r.useMemo)(()=>{const e=ie?.runUrl;if(e&&ue)return new z.k({runUrl:e,token:ue})},[ie,e,ue]),bt=(0,r.useMemo)(()=>[new ke,new w._({factory:_.N})],[]),yt=(0,r.useMemo)(()=>new i.J,[]),kt=(0,r.useMemo)(()=>[oe],[]),Ct=(0,r.useMemo)(()=>(0,Y.Kp)(),[]);(0,r.useEffect)(()=>{(0,le.wj)()},[]),(0,r.useEffect)(()=>{if(he&&he.length>0&&!Ne){const e=he[0];wt({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.given_name,kernelId:e.id,burningRate:e.burning_rate,podName:e.pod_name},runtimeModel:e})}},[he]),(0,r.useEffect)(()=>{$e&&$e.sharedModel.awareness.setLocalStateField("user",{username:t.id,name:t.handle,display_name:t.displayName,initials:`${t.firstName[0]?.toLocaleUpperCase()??"?"}${t.lastName[0]?.toLocaleUpperCase()||"?"}`,color:Ct,avatar_url:t.avatarUrl})},[$e,t,Ct]),(0,r.useEffect)(()=>(at(),pt(e).then(t=>{if(nt(),t.success){const t=ut(e);t?(Oe(t),Ve(t.nbformat),rt(t),Je({name:t.name,nameConfirm:"",description:t.description})):te("/")}else qe(t.message,{variant:"error"})}).finally(()=>{nt()}),()=>{ve.dispose(),Oe(void 0),Ze(),rt(void 0)}),[e]),(0,r.useEffect)(()=>{mt().then(e=>{if(e.success){const e=ct();vt(e)}})},[e]),(0,r.useEffect)(()=>{ne&&Ue&&ne.runtimeId!==ge&&(gt(e,ve.serverSettings.baseUrl,ve.serverSettings.token,ge),ft(e,ge))},[ne,ge,e,Ue,ve]),(0,r.useEffect)(()=>{He({...Qe,name:void 0===Ge.name?void 0:Ge.name.length>2,nameConfirm:Ge.nameConfirm===Ee?.name,description:void 0===Ge.description?void 0:Ge.description.length>2})},[Ge]);const St=(0,r.useCallback)(async()=>{at(),ht(e,Ge.name,Ge.description).then(e=>{e.success&&(qe("The notebook is successfully updated.",{variant:"success"}),ot(),Oe({...Ee,name:Ge.name,description:Ge.description}))}).finally(()=>{nt()})},[e,Ge.name,Ge.description,Ee]),wt=(0,r.useCallback)(async({runtimeDesc:r,runtimeModel:s,transferState:i})=>{const o=Ye(e);o?.model&&Ve(o.model.toJSON()),ye(r);const l=r?.location;switch(Te(""),l){case void 0:je(void 0),De(!0),we(!1),fe(Ae);break;case"browser":if(pe?.browser){if(xe){if(!xe.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(484),n.e(5378)]).then(n.bind(n,28924));xe.jupyterLab.registerPluginModule(e)}xe.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await xe.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}je(void 0),De(!1),we(!0),fe(pe.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!pe?.remote){console.error("Unable to use a remote runtime. No service manager for it.");break}let n;if(i&&ve&&ve===pe?.browser&&Ne?.kernel)try{at();let e=!0;const t=Ne.kernel.id,r=`pyodide-${t}`,s=(0,Z.T)({connection:Ne.kernel,metadata:{filename:`${r}.data`},onUploadProgress:()=>{e&&(e=!1,(0,ee.Ay)().then(e=>{n=e.find(e=>e.name===r)}))}});if(Xe(s,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel state…"},success:{message:()=>"Browser kernel state saved."}}),await s,!n)throw Error("Unable to find snapshot for pyodide state.");await pe.browser.kernels.shutdown(t)}finally{nt()}if(!s){const{name:e,displayName:a,params:i}=r,o=await(pe?.remote?.runtimesManager.startNew({environmentName:e,type:"notebook",givenName:a,creditsLimit:i?.creditsLimit??(ce?.available??0)/Math.max(me.maxCellRuntimes-he.filter(e=>"cell"!==e.type).length,1),capabilities:i?.capabilities,snapshot:n?.id},{username:t?.handle,handleComms:!0}));s=await pe.remote.runtimesManager.findById(o.id),o.dispose()}we(!1),je(s.id),De(!1),Te(s.pod_name);const o=pe.remote.runtimesManager.getServices(s.pod_name),l=new a.ServiceManager({contents:o?.contents,kernels:o?.kernels,kernelspecs:o?.kernelspecs,serverSettings:o?.serverSettings,sessions:o?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});fe(l),We("storage");const d=o?.serverSettings.baseUrl.replace("/jupyter/server","/mcp")+"/mcp";fetch(d+"/../api/connect",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({provider:"datalayer",runtime_url:o?.serverSettings.baseUrl,runtime_id:s.id,runtime_token:o?.serverSettings.token,document_url:ie.spacerRunUrl,document_id:e,document_token:ue})}).then(e=>{qe("Jupyter MCP Server connected successfully.",{variant:"success"}),We("ai-agents"),Be(d)})}}_t(void 0)},[me,ce,xe,e,pe,he,ve,Ne]),_t=(0,r.useCallback)(e=>{Me(e||void 0)},[]),At=(0,r.useCallback)(async()=>{k({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then(t=>{t&&(at(),lt(e).then(e=>{nt(),e.success&&(qe(e.message,{variant:"success"}),ot(),te("/my-library"))}))})},[k,Ee]),Nt=(0,r.useCallback)(e=>{Le(e)},[]),Mt=(0,r.useCallback)(()=>{if(!ze&&$e?.cells){at("Saving the notebook...");const t=$e.toJSON();xt(e,t).then(n=>{n.success&&(qe("The notebook is successfully updated.",{variant:"success"}),Oe({...Ee,id:e,nbformat:t}))}).finally(()=>{nt()})}},[e,$e,ze]),Pt=(0,r.useCallback)(()=>{We("storage"!==Fe&&ve&&ve!==Ae?"storage":void 0)},[Fe,ve]);return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(l.z,{"aria-label":Ee?.name,children:[(0,se.jsx)(l.z.TitleArea,{variant:"subtitle",children:(0,se.jsx)(l.z.Title,{children:Ee?.name})}),(0,se.jsx)(l.z.Actions,{children:Ee&&tt&&(0,se.jsxs)(I.az,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[pe?.remote&&Ne&&Ne.kernel&&(0,se.jsx)(U.m,{kernelId:Ne.kernel.id,serviceManager:pe.remote,onClick:()=>{te("/runtimes")}},"credits-indicator"),(0,se.jsx)(D.P,{assignRuntime:wt,sessionConnection:Ne},"runtime-picker"),(0,se.jsx)(T.C,{connection:Ne?.kernel??void 0,multiServiceManager:pe,podName:Ue,disabled:void 0===be?.location,children:"Snapshots"}),(0,se.jsx)(d.Q,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!ve||ve===Ae,leadingVisual:()=>(0,se.jsx)(P.Cx,{type:"content"}),onClick:Pt,children:"Storage"},"content"),(0,se.jsx)(L.E,{commandRegistry:yt,runtimeDesc:be,save:Mt,sessionConnection:Ne},"toolbar"),(0,se.jsx)(d.Q,{variant:"invisible",size:"small",leadingVisual:b.tSI,onClick:e=>We("ai-agents"===Fe?void 0:"ai-agents"),children:"AI Agent"},"clone"),(0,se.jsxs)(c.W,{children:[(0,se.jsx)(c.W.Anchor,{children:(0,se.jsx)(u.K,{variant:"invisible",icon:b.tno,"aria-label":"Open menu"})}),(0,se.jsx)(c.W.Overlay,{width:"medium",children:(0,se.jsxs)(m.l,{children:[(0,se.jsxs)(m.l.Item,{onSelect:()=>At(),children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(b.Nc$,{})}),"Duplicate"]}),ae&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(m.l.Divider,{}),(0,se.jsxs)(m.l.Item,{onSelect:()=>{it()},children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(b.rVi,{})}),"Capture Screen"]}),(0,se.jsxs)(m.l.Item,{onSelect:()=>Ie(!Pe),children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(P.Cx,{type:"share"})}),"Share"]}),(0,se.jsxs)(m.l.Item,{onSelect:()=>te(`/new/page/notebook/${e}`),children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(P.Cx,{type:"page"})}),"Publish"]})]}),(0,se.jsx)(m.l.Divider,{}),(0,se.jsxs)(m.l.Item,{onSelect:()=>We("mcp-server"===Fe?void 0:"mcp-server"),children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(y.A,{})}),"MCP Server"]}),(0,se.jsx)(m.l.Divider,{}),(0,se.jsxs)(m.l.Item,{onSelect:()=>We("properties"===Fe?void 0:"properties"),children:[(0,se.jsx)(m.l.LeadingVisual,{children:(0,se.jsx)(b.L64,{})}),"Properties"]})]})})]}),"datalayer"===jt?.type&&$e&&(0,se.jsx)(E.P,{awareness:$e.sharedModel.awareness,currentUserHandle:t.handle},"peers")]})})]}),(0,se.jsxs)(p.O7,{children:[(0,se.jsxs)(p.O7.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[et&&(0,se.jsx)(I.az,{mt:3,children:(0,se.jsxs)(I.az,{display:"flex",children:[(0,se.jsx)(I.az,{children:(0,se.jsx)("img",{src:et})}),(0,se.jsx)(I.az,{children:(0,se.jsx)(h.A,{href:"javascript: return false;",onClick:e=>st(void 0),children:(0,se.jsx)(b.uv5,{})})})]})}),Pe&&(0,se.jsx)(I.az,{sx:{flexGrow:1},children:(0,se.jsx)(de.a,{})}),Re&&jt&&(void 0===be?.location?(0,se.jsx)(I.az,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,se.jsx)(A.j,{nbformat:Re,outputs:!0})}):(0,se.jsx)(I.az,{children:(0,se.jsx)(N.k,{commands:yt,extensions:bt,id:e,collaborationProvider:jt,nbformat:Re,readonly:ze,renderers:kt,kernelId:ge,serviceManager:ve,startDefaultKernel:Ce,height:"calc(100vh - 150px)",maxHeight:"calc(100vh - 150px)",cellSidebarMargin:32,onNotebookModelChanged:Nt,onSessionConnection:_t})}))]}),Fe&&(0,se.jsxs)(p.O7.Pane,{"aria-label":"Notebook Sidebar",position:"start",width:"large",children:["storage"===Fe&&ve.contents&&(0,se.jsx)($.XV,{contents:ve.contents,documentRegistry:xe?.jupyterLab.docRegistry}),"properties"===Fe&&(0,se.jsxs)(I.az,{as:"form",sx:{label:{marginTop:2}},children:[(0,se.jsxs)(x.A,{children:[(0,se.jsx)(x.A.Label,{children:"Name"}),(0,se.jsx)(v.A,{block:!0,value:Ge.name,onChange:e=>{Je(t=>({...t,name:e.target.value}))}}),!1===Qe.name&&(0,se.jsx)(x.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,se.jsxs)(x.A,{children:[(0,se.jsx)(x.A.Label,{children:"Description"}),(0,se.jsx)(f.Ay,{block:!0,value:Ge.description,onChange:e=>{Je(t=>({...t,description:e.target.value}))}}),!1===Qe.description&&(0,se.jsx)(x.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,se.jsx)(x.A,{children:(0,se.jsx)(d.Q,{variant:"primary",disabled:!Qe.name||!Qe.description,style:{marginTop:2},onClick:St,children:"Update Notebook Properties"})}),(0,se.jsx)(I.az,{mt:3}),(0,se.jsx)(M.R,{variant:"default",data:Re,fileName:`notebook-${e}`,extension:"ipynb"}),(0,se.jsxs)(I.az,{sx:{marginTop:3},children:[(0,se.jsx)(g.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,se.jsxs)(I.az,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,se.jsxs)(I.az,{sx:{display:"grid",gap:1},children:[(0,se.jsx)(j.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,se.jsx)(x.A,{children:(0,se.jsx)(v.A,{block:!0,value:Ge.nameConfirm,onChange:e=>{Je(t=>({...t,nameConfirm:e.target.value}))}})}),(0,se.jsx)(j.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,se.jsx)(d.Q,{variant:"danger",disabled:!Qe.nameConfirm,onClick:async()=>{at("Deleting the notebook..."),dt(Ee.id).then(e=>{e.success&&(qe("The notebook is successfully deleted.",{variant:"success"}),te("/my-library"))}).finally(()=>{nt()})},children:"Delete notebook"})]})]})]}),"ai-agents"===Fe&&Ke&&(0,se.jsx)(Se,{mcpServerUrl:Ke}),"mcp-server"===Fe&&jt&&Ne&&Ne.kernel&&(0,se.jsx)(_e,{documentServer:{baseURL:ie.spacerRunUrl,token:ue,documentName:e,type:jt.type},runtimeId:Ne.kernel.id,runtimeSettings:Ne.serverSettings})]})]})]})}const Me=Ne}}]);