"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[4035],{66416:(e,t,s)=>{s.r(t),s.d(t,{CellEdit:()=>R,default:()=>Z});var l=s(9387),i=s(45222),a=s(20568),r=s(17781),n=s(54617),c=s(98754),o=s(99180),d=s(38621),u=s(99179),h=s(17788),p=s(41273),m=s(60105),x=s(23267),j=s(34447),g=s(55388),v=s(47769),f=s(18683);const b=()=>{const{getSpaceDatasets:e,refreshSpaceDatasets:t}=(0,m.E)(),s=(0,x.mt)(),i=(0,g.LC)(),a=s.layout().space,r=s.layout().organization,[n,c]=(0,l.useState)(e()),o=n.filter(e=>e.public),u=n.filter(e=>!e.public);return(0,l.useEffect)(()=>{a&&t(a,r).then(t=>{t.success&&c(e())})},[a]),(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(j.l,{showDividers:!0,role:"menu",children:[(0,f.jsxs)(j.l.Group,{children:[(0,f.jsx)(j.l.GroupHeading,{children:"My public datasets"}),o.map(e=>(0,f.jsxs)(j.l.Item,{onClick:t=>{t.preventDefault(),i.setDataset("cell",e)},children:[(0,f.jsx)(j.l.LeadingVisual,{children:(0,f.jsx)(d.bN0,{})}),e.name,(0,f.jsx)(j.l.Description,{children:(0,v.b)(e.description)})]},e.id)),0===o.length&&(0,f.jsx)(j.l.Item,{disabled:!0,children:"No public dataset"})]}),(0,f.jsxs)(j.l.Group,{children:[(0,f.jsx)(j.l.GroupHeading,{children:"My private datasets"}),u.map(e=>(0,f.jsxs)(j.l.Item,{onClick:t=>{t.preventDefault(),i.setDataset("cell",e)},children:[(0,f.jsx)(j.l.LeadingVisual,{children:(0,f.jsx)(d.bN0,{})}),e.name,(0,f.jsx)(j.l.Description,{children:(0,v.b)(e.description)})]},e.id)),0===u.length&&(0,f.jsx)(j.l.Item,{disabled:!0,children:"No private dataset"})]})]})})};var y=s(11029),A=s(87324),C=s(48824),D=s(14032),k=s(27322),I=s(78084),S=s(14178),E=s(72533),T=s(52982);const w=e=>{const{cell:t}=e,s=((0,h.Z)(),t.outputshotUrl||t.outputshotData);return(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(T.Zp,{border:!0,rounded:"medium",shadow:"medium",sx:{maxWidth:360},children:[(0,f.jsx)(T.Zp.Header,{title:"Cell",description:(0,v.b)(t.name,100)}),(0,f.jsx)(T.Zp.Image,{height:200,image:s}),(0,f.jsx)(T.Zp.Content,{children:(0,f.jsx)(E.A,{color:"fg.muted",children:(0,v.b)(t.description,100)})})]})})},z=(0,D.t)((0,k.Y)(()=>Promise.all([s.e(7583),s.e(3367),s.e(7080)]).then(s.bind(s,57080)))),U=()=>{const{cell:e,update:t}=(0,I.Xp)();if(!e)return(0,f.jsx)(f.Fragment,{});const{updateCell:s}=(0,m.E)(),{space:i,showBackdrop:a,triggerItemsRefresh:r,hideBackdrop:n}=(0,S.l5)(),{enqueueToast:d}=(0,p.d)(),[u,h]=(0,l.useState)(!1),[x,j]=(0,l.useState)({name:e.name,description:e.description}),[g,v]=(0,l.useState)({name:!0,description:!0});return(0,l.useEffect)(()=>{v({...g,name:void 0===x.name?void 0:x.name.length>2,description:void 0===x.description?void 0:x.description.length>2})},[x]),(0,f.jsx)(f.Fragment,{children:(0,f.jsxs)(c.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr"},children:[(0,f.jsxs)(c.A,{sx:{label:{marginTop:2}},children:[(0,f.jsxs)(y.A,{children:[(0,f.jsx)(y.A.Label,{children:"Name"}),(0,f.jsx)(A.A,{block:!0,value:x.name,onChange:e=>{j(t=>({...t,name:e.target.value})),t({name:e.target.value})}}),!1===g.name&&(0,f.jsx)(y.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,f.jsxs)(y.A,{children:[(0,f.jsx)(y.A.Label,{children:"Description"}),(0,f.jsx)(C.Ay,{block:!0,value:x.description,onChange:e=>{j(t=>({...t,description:e.target.value})),t({description:e.target.value})}}),!1===g.description&&(0,f.jsx)(y.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,f.jsx)(y.A,{sx:{marginTop:3},children:(0,f.jsxs)(c.A,{display:"flex",children:[(0,f.jsx)(o.Q,{variant:"primary",disabled:u||!g.name||!g.description,onClick:()=>{e?.outputshotData.length>3e5?d(`Output screenshot is too large (actual size is ${e?.outputshotData.length}, the maximum allowed is 300000)`,{variant:"error"}):(a(),h(!0),s({id:e?.id,name:e?.name,description:e?.description,source:e.source,outputshotUrl:e.outputshotUrl,outputshotData:e?.outputshotUrl?void 0:e?.outputshotData,spaceId:i?.id}).then(s=>{if(h(!1),s.success){const s={...e,public:e.public,description:e.description,source:e.source,outputshotUrl:e.outputshotUrl,outputshotData:e.outputshotData};r(),t(s),d("The cell is successfully updated.",{variant:"success"})}}).finally(()=>{h(!1),n()}))},children:u?"Updating cell...":"Update cell"}),(0,f.jsx)(c.A,{ml:3,children:(0,f.jsx)(z,{})})]})})]}),(0,f.jsx)(c.A,{ml:3,children:(0,f.jsx)(w,{cell:e})})]})})};var F=s(83799);const N=e=>{const{source:t,outputshotRef:s,cellId:l}=e;return(0,f.jsx)(c.A,{ref:s,style:{marginTop:"8px"},children:(0,f.jsx)(F.f,{startDefaultKernel:!0,source:t,id:l,autoStart:!0,showToolbar:!1})})},R=()=>{const{cellId:e}=(0,a.g)();if(!e)return(0,f.jsx)(f.Fragment,{});const t=(0,u.J)(),s=(0,x.mt)(),j=s.layout().space,g=s.cell().cell,v=(0,r.S)(),y=(0,h.Z)(),{enqueueToast:A}=(0,p.d)(),{getCell:C,refreshCell:D,cloneCell:k}=(0,m.E)(),[I,S]=(0,l.useState)(),[E,T]=(0,l.useState)(!1),w=(0,l.useMemo)(()=>(0,l.createRef)(),[]);(0,l.useEffect)(()=>{const t=document.getElementById("right-panel-id"),l=(0,i.createPortal)((0,f.jsx)(b,{}),t);return s.layout().setRightPortal({portal:l,pinned:!1}),D(e).then(t=>{if(t.success){const t=C(e);t?(S(t.source),s.cell().update(t),s.layout().setItem(t),S(t.source)):y("/")}}),()=>{s.layout().setItem(void 0)}},[e]);const z=(0,l.useCallback)(async l=>{v({title:"Are you sure?",content:"Please confirm you want to clone this cell in your private library."}).then(l=>{l&&k(e).then(e=>{e.success&&(A(e.message,{variant:"success"}),s.layout().triggerItemsRefresh(),y(`/${t?.handle}/library/cells`))})})},[v,g]);return(0,f.jsx)(f.Fragment,{children:g&&I&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(n.z,{"aria-label":"Cell Editor",children:[(0,f.jsx)(n.z.TitleArea,{variant:"subtitle",children:(0,f.jsx)(n.z.Title,{children:"Cell Editor"})}),(0,f.jsxs)(n.z.Actions,{children:[(0,f.jsx)(c.A,{children:E?(0,f.jsx)(o.Q,{variant:"invisible",size:"small",onClick:()=>T(!1),children:"Hide details"}):(0,f.jsx)(o.Q,{variant:"invisible",size:"small",onClick:()=>T(!0),children:"Show details"})}),(0,f.jsx)(c.A,{ml:1,children:t&&j&&(0,f.jsx)(o.Q,{variant:"invisible",size:"small",leadingVisual:d.Nc$,onClick:z,children:"Clone"})})]})]}),(0,f.jsxs)(c.A,{children:[E&&(0,f.jsx)(c.A,{children:(0,f.jsx)(U,{})}),(0,f.jsx)(c.A,{children:(0,f.jsx)(N,{source:I,outputshotRef:w,cellId:g?.id})})]})]})})},Z=R}}]);