import{api as n}from"./axios-v_u27raG.js";import{b2 as a}from"./index-DOZ-G8D5.js";const o=async()=>(await n.get("/api/admin/_models")).data;class c{constructor(){this.endpoints={},this.total_entries=0,this.schemas=[],this.crud_services={}}async setup(){const e=await o();this.endpoints=e.endpoints,this.total_entries=e.total_entries,this.schemas=e.schemas,this.crud_services={};for(const t of this.schemas)this.crud_services[t.name]=await this.get_or_create_crud_service(t);return this}async get_or_create_crud_service(e){var s;const t=(s=this.crud_services)!=null&&s[e.name]?this.crud_services[e.name]:null;if(!t){const i=new d(e,this.endpoints);return this.crud_services[e.name]=i,i}return t}get_crud_service(e){var t;return(t=this.crud_services)==null?void 0:t[e]}}class d{constructor(e,t){this.schema=e,this.name=e.name,this.endpoints={};for(const[s,i]of Object.entries(t))this.endpoints[s]=i.replaceAll("(model_name)",this.name);this.frontend_links={list:`/admin/${this.name}/list`,create:`/admin/${this.name}/create`,edit:`/admin/${this.name}/{{item_id}}`},this.columns=[]}async get_columns(){return this.columns.length>0?this.columns:await this.create_columns()}async create_columns(){for(const e of this.schema.fields)this.columns.push({name:e.name,label:e.name,field:t=>t[e.name],sortable:!0});return this.columns}async get_item(e){const t=this.endpoints.get.replaceAll("{item_id}",e);return(await n.get(t)).data}async form(){const e=this.endpoints.form;return console.log(e),(await n.get(e)).data}async create(e){const t=this.endpoints.create;return(await n.post(t,e)).data}async update(e,t){const s=this.endpoints.update.replaceAll("{item_id}",e);return(await n.put(s,t)).data}async delete(e){if(Array.isArray(e)){const t=this.endpoints.delete;return(await n.delete(t,{data:e})).data}else{const t=this.endpoints.delete.replaceAll("{{item_id}}",e);return(await n.delete(t)).data}}async list(){const e=this.endpoints.list;return(await n.get(e)).data}}const p=new c,h=a(async({app:r})=>{const e=await p.setup();r.config.globalProperties.$crud_factory=e});export{h as default,p as factory};
