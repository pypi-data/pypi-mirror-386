import{Q as b,a as q}from"./TouchPan-DHpMpgZy.js";import{Q as k,_ as S,a as V}from"./SelectField-CP6QtoyQ.js";import{L as R,r as f,o as B,M as D,N as u,O as c,P as i,Q as r,W as N,R as j,U as p,$ as _,S as g,a1 as C,a2 as T,X as v}from"./index-CupPPfef.js";import{Q as E}from"./QSelect-Cokpcjts.js";import{factory as y}from"./crud-DdVQ_Q4O.js";import"./format-DorNbEf-.js";import"./axios-DIQdMCEy.js";const U={__name:"DetailPage",props:{model_name:{type:String,required:!0},item_id:{type:String,required:!0}},setup(Q){R();let d;const o=Q,l=f({}),m=f({}),h=(e,a)=>{e&&(m.value[a]=e)},w=()=>{const e=[];return Object.keys(m.value).forEach(a=>{const s=m.value[a];if(s&&s.getValue){const t=s.getValue(),n={name:t.name};t.data!==null&&t.data!==void 0&&(n.data=t.data),t.selected!==null&&t.selected!==void 0&&(n.selected=t.selected),e.push(n)}}),{name:o.model_name,fields:e}},x=async()=>{try{const e=w();console.log("Sending form data:",e);const a=y.get_crud_service(o.model_name),s=o.item_id?await a.update(o.item_id,e):await a.create(e);console.log("Result:",s),alert(`successfully saved new item with id ${s.fields.filter(t=>t.name==="id")[0].data}`)}catch(e){console.error("Error saving item:",e),e.response&&e.response.status===422&&console.error("Validation error:",e.response.data)}};return B(async()=>{if(console.log("detail page"),d=await y.get_crud_service(o.model_name),d){const e=await d.get_item(o.item_id);console.log(e),l.value={name:o.model_name,fields:e.fields},console.log(l.value)}}),(e,a)=>{const s=D("q-label");return c(),u(V,{class:"column justify-start items-stretch"},{default:i(()=>[r(b,{class:"col-4 bg-primary text-primary q-ma-sm q-pa-sm bg-transparent"},{default:i(()=>[l.value.name?(c(),u(q,{key:0},{default:i(()=>[p(_(l.value.name),1)]),_:1})):j("",!0),r(k),r(g,{flat:"",round:"",dense:"",icon:"save",class:"text-h5",onClick:x}),r(g,{flat:"",round:"",dense:"",icon:"delete",class:"text-h5"})]),_:1}),(c(!0),N(C,null,T(l.value.fields,t=>(c(),u(E,{key:t.name,class:"row justify-start items-end full-width q-ma-sm q-pa-md"},{default:i(()=>[a[0]||(a[0]=v("div",{class:"col-1"},null,-1)),r(s,{class:"col-2 text-h5"},{default:i(()=>[p(_(t.name),1)]),_:2},1024),a[1]||(a[1]=v("div",{class:"col-1 text-h5"},":",-1)),r(S,{field:t,ref_for:!0,ref:n=>h(n,t.name)},null,8,["field"])]),_:2},1024))),128))]),_:1})}}};export{U as default};
