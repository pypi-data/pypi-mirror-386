import{c as Q,j as R,h as y,A as h,g as V,L as $,r as v,o as q,W as w,O as g,R as b,Q as m,X as _,$ as f,P as p,a0 as B,V as j,N as I,S as k,T as S,U as T}from"./index-D3Z3DZSY.js";import{Q as L}from"./QTable-DCVEsjri.js";import{factory as M}from"./crud-Ck7i_6se.js";import"./QSelect-BP87xem-.js";import"./format-DvmtIt1M.js";import"./axios-CZVAb7GI.js";const O=Q({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(l,{slots:i}){const r=V(),c=R(()=>"q-td"+(l.autoWidth===!0?" q-table--col-auto-width":"")+(l.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(l.props===void 0)return y("td",{class:c.value},h(i.default));const s=r.vnode.key,d=(l.props.colsMap!==void 0?l.props.colsMap[s]:null)||l.props.col;if(d===void 0)return;const{row:n}=l.props;return y("td",{class:c.value+d.__tdClass(n),style:d.__tdStyle(n)},h(i.default))}}}),U={class:"q-pa-md"},W={key:0,class:"text-center q-pa-lg"},A={class:"text-caption"},D={class:"row justify-between q-gutter-x-md"},z={__name:"ListPage",props:{model_name:{type:String,required:!0}},setup(l){const i=$(),r=v([]),c=v([]);let s;const d=v(""),n=l,u=v([]),C=()=>u.value.length>0?`Selected ${u.value.length}`:"None selected",x=async()=>{console.log(u.value),await s.delete(u.value.map(a=>a.id)),await i.go(0)},N=a=>{console.log("Row clicked:",a),console.log("Model name:",n.model_name),console.log("Row ID:",a.id),console.log("Full URL:",`/admin/${n.model_name}/${a.id}`),i.push(`/admin/${n.model_name}/${a.id}`)};return q(async()=>{if(s=await M.get_crud_service(n.model_name),s){const a=await s.list();console.log("Raw items from API:",a),r.value=a.map(o=>{const e={id:o.id};return o.fields.forEach(t=>{t.type==="json"&&typeof t.data=="object"&&t.data!==null?e[t.name]=JSON.stringify(t.data,null,2):typeof t.data=="object"&&t.data!==null?e[t.name]=JSON.stringify(t.data):e[t.name]=t.data}),e}),console.log("Processed rows:",r.value),c.value=await s.get_columns(),console.log(c.value)}}),(a,o)=>(g(),w("div",U,[r.value.length===0?(g(),w("div",W,[o[3]||(o[3]=_("div",{class:"text-h6"},"Loading data...",-1)),_("div",A,"Rows: "+f(r.value.length)+", Columns: "+f(c.value.length),1)])):b("",!0),m(L,{flat:"",bordered:"","binary-state-sort":"",title:n.model_name,rows:r.value,columns:c.value,"row-key":"id",filter:d.value,selection:"multiple",selected:u.value,"onUpdate:selected":o[2]||(o[2]=e=>u.value=e),"selected-rows-label":C},{"body-cell":p(e=>[m(O,{props:e,class:"cursor-pointer hover:bg-grey-2",onClick:t=>N(e.row)},{default:p(()=>[T(f(e.value),1)]),_:2},1032,["props","onClick"])]),"top-left":p(()=>[u.value.length>0?(g(),I(k,{key:0,label:"delete",icon:"delete",dense:"",flat:"",color:"negative",onClick:x})):b("",!0),m(k,{label:"create",icon:"add",dense:"",flat:"",color:"primary",onClick:o[0]||(o[0]=e=>S(i).push(S(s).frontend_links.create))})]),"top-right":p(()=>[_("div",D,[m(B,{borderless:"",dense:"",debounce:"300",modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e),placeholder:"Search"},{append:p(()=>[m(j,{name:"search"})]),_:1},8,["modelValue"])])]),_:1},8,["title","rows","columns","filter","selected"])]))}};export{z as default};
