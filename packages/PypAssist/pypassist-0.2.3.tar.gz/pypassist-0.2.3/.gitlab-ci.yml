pages:
  artifacts:
    paths:
      - public
  image: sphinxdoc/sphinx
  rules:
    - if: $CI_COMMIT_TAG =~ /^v.*/    
  script:
    - apt update
    - bash ./scripts/build_documentation.sh
  stage: doc

test:
  image: $PYTHON_IMAGE
  only:
    - main
    - dev-arno
  parallel:
    matrix:
      - PYTHON_IMAGE: python:3.7
      - PYTHON_IMAGE: python:latest
  script:
    - bash scripts/test.sh
  stage: test

publish:
  stage: deploy
  image: python:latest
  script:
    - pip install build twine
    - python -m build
    - twine upload dist/*
  rules:
    - if: $CI_COMMIT_TAG =~ /^v.*/

stages:
  - test
  - doc
  - deploy