(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1975],{34849:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return D}});var a=s(24246),o=s(87949),i=s(27378);s(51901);var n=s(86298),r=s(3124),d=s.n(r),l=s(8335),I=s(49820),c=s.n(I),_=e=>{let{data:t,selected:s}=e;return(0,a.jsxs)("div",{className:c().container,"data-testid":"datamap-system-node",children:[(0,a.jsx)(o.wpx,{className:"".concat(c().button," ").concat(s?c()["button--selected"]:""),type:"text",children:(0,a.jsx)(o.AntTypography.Text,{ellipsis:!0,style:{color:"inherit"},children:t.label})}),(0,a.jsx)(n.HH,{type:"source",position:l.Ly.Right,className:c().handle}),(0,a.jsx)(n.HH,{type:"target",position:l.Ly.Left,className:c().handle})]})},E=s(24259),u=s.n(E);let m=new(u()).graphlib.Graph;m.setDefaultEdgeLabel(()=>({}));let f=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"LR";return m.setGraph({rankdir:s,ranksep:60,nodesep:60,edgesep:50,marginx:15,marginy:15}),e.forEach(e=>{m.setNode(e.id,{width:220,height:70})}),t.forEach(e=>{m.setEdge(e.source,e.target)}),u().layout(m),{nodes:e.map(e=>{let t=m.node(e.id);return{...e,position:{x:t.x-t.width/2,y:t.y-t.height/2},sourcePosition:"LR"===s?l.Ly.Right:l.Ly.Bottom,targetPosition:"LR"===s?l.Ly.Left:l.Ly.Top}}),edges:t}},S=e=>{let{data:t}=e,s=(0,i.useMemo)(()=>t.nodes.map(e=>({id:e.id,data:{label:e.name,description:e.description},position:{x:0,y:0},type:"systemNode"})),[t.nodes]),a=(0,i.useMemo)(()=>t.links.map((e,t)=>({id:"edge-".concat(t),source:e.source,target:e.target,markerEnd:{type:l.QZ.ArrowClosed,color:d().FIDESUI_NEUTRAL_300,width:15,height:15},style:{stroke:d().FIDESUI_NEUTRAL_300,strokeWidth:1.5,strokeOpacity:.8},animated:!1})),[t.links]),{nodes:o,edges:n}=(0,i.useMemo)(()=>{let e=new Set;a.forEach(t=>{e.add(t.source),e.add(t.target)});let t=[],o=[];s.forEach(s=>{e.has(s.id)?o.push(s):t.push(s)});let{nodes:i}=f(o,a,"LR"),n=Math.max(1,Math.ceil(Math.sqrt(t.length))),r=t.map((e,t)=>({...e,position:{x:t%n*240,y:120*Math.floor(t/n)},sourcePosition:"right",targetPosition:"left"})),d=120*Math.ceil(r.length/n)+80;return{nodes:[...r,...i.map(e=>({...e,position:{x:e.position.x,y:e.position.y+d}}))],edges:a}},[s,a]);return{nodes:o,edges:n}},p=e=>{let{data:t,setSelectedSystemId:s,selectedSystemId:o}=e,{nodes:r,edges:l}=S({data:t}),I=(0,n._K)(),c=(0,i.useRef)(null),E=(0,i.useRef)(null),u=(0,i.useMemo)(()=>r.map(e=>({...e,selected:e.id===o})),[r,o]),m=(0,i.useMemo)(()=>({systemNode:_}),[]);(0,i.useEffect)(()=>{r.length>0&&setTimeout(()=>{I.fitView({padding:.2})},150)},[r,I]),(0,i.useEffect)(()=>{o&&u.length>0?setTimeout(()=>{var e;let t=u.find(e=>e.id===o);if(!t)return;let s=I.getViewport(),a=null===(e=c.current)||void 0===e?void 0:e.getBoundingClientRect(),i=document.querySelector('[data-testid="datamap-drawer"]');if(!a){fidesDebugger("DatamapGraph: ReactFlow bounds not available for viewport management");return}if(!i){fidesDebugger("DatamapGraph: Drawer element not found for viewport management");return}E.current||(E.current={...s});let n=i.getBoundingClientRect().width,r=t.position.x*s.zoom+s.x,d=a.width-n;r>d-100&&I.setViewport({x:s.x+(d/2-r),y:s.y,zoom:s.zoom},{duration:300})},600):!o&&E.current&&setTimeout(()=>{if(E.current){let e=I.getViewport(),t=E.current,s=performance.now(),a=e=>1-(1-e)**3,o=i=>{let n=Math.min((i-s)/800,1),r=a(n),d={x:e.x+(t.x-e.x)*r,y:e.y+(t.y-e.y)*r,zoom:e.zoom+(t.zoom-e.zoom)*r};I.setViewport(d),n<1&&requestAnimationFrame(o)};requestAnimationFrame(o),E.current=null}},100)},[o,u,I,c]);let f=(0,i.useCallback)((e,t)=>{s(t.id)},[s]);return(0,a.jsx)("div",{ref:c,"data-testid":"reactflow-graph",className:"absolute size-full",children:(0,a.jsx)("div",{className:"size-full",style:{backgroundColor:d().FIDESUI_BG_CORINTH},children:(0,a.jsxs)(n.x$,{nodes:u,edges:l,onNodeClick:f,nodeTypes:m,nodesFocusable:!1,edgesFocusable:!1,connectOnClick:!1,nodesConnectable:!1,elementsSelectable:!0,fitView:!0,minZoom:.3,maxZoom:2,proOptions:{hideAttribution:!0},children:[(0,a.jsx)(n.Aq,{color:d().FIDESUI_NEUTRAL_100,variant:n.T7.Dots,size:3}),(0,a.jsx)(n.a9,{nodeStrokeWidth:3,pannable:!0}),(0,a.jsx)(n.ZX,{showInteractive:!1})]})})})};var U=e=>(0,a.jsx)(n.tV,{children:(0,a.jsx)(p,{...e})}),g=s(99811);let h=e=>{let t=(0,i.useMemo)(()=>new Set(null==e?void 0:e.map(e=>e.original["system.fides_key"])),[e]),s=(0,i.useMemo)(()=>e.reduce((e,t)=>{let s=t.original["system.fides_key"];return e[s]||(e[s]={name:t.original["system.name"],description:t.original["system.description"],ingress:t.original["system.ingress"]?t.original["system.ingress"].split(", "):[],egress:t.original["system.egress"]?t.original["system.egress"].split(", "):[],id:t.original["system.fides_key"]}),e},{}),[e]);return{data:(0,i.useMemo)(()=>{let e=[],t=new Set([]);return s&&(e=Object.values(s)).map(e=>[...e.ingress.filter(e=>s[e]).map(t=>({source:t,target:e.id})),...e.egress.filter(e=>s[e]).map(t=>({source:e.id,target:t}))]).flatMap(e=>e).forEach(e=>t.add(JSON.stringify(e))),{nodes:e,links:Array.from(t).map(e=>JSON.parse(e))}},[s]),highlightedNodes:t}};var D=e=>{let{setSelectedSystemId:t,selectedSystemId:s}=e,{tableInstance:n}=(0,i.useContext)(g.Z);if(!n)return null;let{rows:r}=n.getRowModel(),{data:d}=h(r);return(0,a.jsx)(o.xuv,{boxSize:"100%",minHeight:"600px",position:"relative",children:(0,a.jsx)(U,{data:d,setSelectedSystemId:t,selectedSystemId:s})})}},49820:function(e){e.exports={FIDESUI_FULL_BLACK:"#000",FIDESUI_FULL_WHITE:"#fff",FIDESUI_BG_WHITE:"#fff",FIDESUI_NEUTRAL_50:"#fafafa",FIDESUI_NEUTRAL_75:"#f5f5f5",FIDESUI_NEUTRAL_100:"#e6e6e8",FIDESUI_NEUTRAL_200:"#d1d2d4",FIDESUI_NEUTRAL_300:"#bcbec1",FIDESUI_NEUTRAL_400:"#a8aaad",FIDESUI_NEUTRAL_500:"#93969a",FIDESUI_NEUTRAL_600:"#7e8185",FIDESUI_NEUTRAL_700:"#696c71",FIDESUI_NEUTRAL_800:"#53575c",FIDESUI_NEUTRAL_900:"#2b2e35",FIDESUI_BG_DEFAULT:"#f5f5f5",FIDESUI_CORINTH:"#fafafa",FIDESUI_BG_CORINTH:"#fafafa",FIDESUI_LIMESTONE:"#f1efee",FIDESUI_MINOS:"#2b2e35",FIDESUI_BG_MINOS:"#4f525b",FIDESUI_TERRACOTTA:"#b9704b",FIDESUI_BG_TERRACOTTA:"#f1b193",FIDESUI_OLIVE:"#999b83",FIDESUI_BG_OLIVE:"#d4d5c8",FIDESUI_MARBLE:"#cdd2d3",FIDESUI_BG_MARBLE:"#e1e5e6",FIDESUI_SANDSTONE:"#cecac2",FIDESUI_BG_SANDSTONE:"#e3e0d9",FIDESUI_NECTAR:"#f0ebc1",FIDESUI_BG_NECTAR:"#f5f2d7",FIDESUI_ERROR:"#d9534f",FIDESUI_BG_ERROR:"#f7c2c2",FIDESUI_WARNING:"#e59d47",FIDESUI_BG_WARNING:"#fbddb5",FIDESUI_BG_CAUTION:"#f6e3a4",FIDESUI_SUCCESS:"#5a9a68",FIDESUI_BG_SUCCESS:"#c3e6b2",FIDESUI_INFO:"#4a90e2",FIDESUI_BG_INFO:"#a5d6f3",FIDESUI_ALERT:"#7b4ea9",FIDESUI_BG_ALERT:"#d9b0d7",FIDESUI_ERROR_TEXT:"#d32f2f",FIDESUI_SUCCESS_TEXT:"#388e3c",FIDESUI_LINK:"#2272ce",container:"DatamapSystemNode_container__Nerx0",button:"DatamapSystemNode_button__Uj4fu","button--selected":"DatamapSystemNode_button--selected__AUuiF",handle:"DatamapSystemNode_handle__eawrd"}}}]);