(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7984],{69453:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications/digests",function(){return s(80181)}])},129:function(e,t,s){"use strict";var i=s(24246),a=s(87949),n=s(86677),r=s(16134),l=s(25980),d=s(77830),c=s(65735),o=s(31793);t.Z=()=>{let e=(0,n.useRouter)(),t=e.pathname,{plus:s}=(0,l.hz)(),u="providers";t.startsWith(d.AD)?u="providers":t.startsWith(d.Wi)?u="templates":t.startsWith(d.DN)&&(u="digests");let h=[{key:"templates",label:"Templates",requiresPlus:!0,scopes:[c.Sh.MESSAGING_TEMPLATE_UPDATE],path:d.Wi},{key:"digests",label:"Digests",requiresPlus:!0,scopes:[c.Sh.DIGEST_CONFIG_READ],path:d.DN},{key:"providers",label:"Providers",requiresPlus:!1,scopes:[c.Sh.MESSAGING_CREATE_OR_UPDATE],path:d.AD}];s||(h=h.filter(e=>!e.requiresPlus));let p=(0,r.C)(o.uu);h=h.filter(e=>e.scopes.some(e=>p.includes(e)));let g=t=>{let s=h.find(e=>e.key===t);s&&e.push(s.path)},_=h.map(e=>({label:e.label,key:e.key}));return(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsx)(a.Niu,{mode:"horizontal",selectedKeys:[u],onClick:e=>{let{key:t}=e;return g(t)},items:_})})}},80181:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var i=s(24246),a=s(87949),n=s(77213),r=s(129),l=s(58754),d=s(86677),c=s(812),o=s(77830),u=s(19904),h=s(65735),p=s(35493),g=s(40822),_=s(81179),m=s(27378);let x=()=>{var e;let t=(0,d.useRouter)(),[s,i]=(0,m.useState)(""),[a,n]=(0,m.useState)(1),[r,l]=(0,m.useState)(50),c=h.tB.MANUAL_TASKS,p=(0,u.Tg)([h.Sh.DIGEST_CONFIG_CREATE,h.Sh.DIGEST_CONFIG_UPDATE]),_=(0,u.Tg)([h.Sh.DIGEST_CONFIG_DELETE]),{data:x,isLoading:j,refetch:y}=(0,g.Q6)({digest_config_type:c,page:a,size:r}),[E,{isLoading:f}]=(0,g.yG)(),[S,T]=(0,m.useState)(!1),[v,C]=(0,m.useState)(null),N=(0,m.useMemo)(()=>{if(!(null==x?void 0:x.items))return[];if(!s)return x.items;let e=s.toLowerCase();return x.items.filter(t=>{var s;return t.name.toLowerCase().includes(e)||(null===(s=t.description)||void 0===s?void 0:s.toLowerCase().includes(e))})},[null==x?void 0:x.items,s]),A=async()=>{v&&(await E({config_id:v.id,digest_config_type:c}),T(!1),C(null),y())};return{data:N,total:null!==(e=null==x?void 0:x.total)&&void 0!==e?e:0,isLoading:j,page:a,pageSize:r,searchQuery:s,setPage:n,setPageSize:l,setSearchQuery:i,refetch:y,handleEdit:e=>{t.push(o.xn.replace("[id]",e.id))},handleDeleteClick:e=>{C(e),T(!0)},deleteModalOpen:S,configToDelete:v,confirmDelete:A,cancelDelete:()=>{T(!1),C(null)},isDeleting:f,canUpdate:p,canDelete:_}},{Search:j}=a.AntInput;var y=()=>{let e=(0,d.useRouter)(),[t,s]=a.Pg3.useMessage(),{data:n,total:r,isLoading:l,page:m,pageSize:y,searchQuery:E,setPage:f,setPageSize:S,setSearchQuery:T,handleEdit:v,canUpdate:C}=x(),[N]=(0,g.zb)(),A=(0,u.Tg)([h.Sh.DIGEST_CONFIG_CREATE]),w=async e=>{let s=await N({config_id:e.id,digest_config_type:h.tB.MANUAL_TASKS,data:{name:e.name,description:e.description,digest_type:e.digest_type,enabled:!e.enabled,messaging_service_type:e.messaging_service_type,cron_expression:e.cron_expression,timezone:e.timezone,config_metadata:e.config_metadata}});if((0,c.D4)(s)){t.error((0,c.e$)(s.error));return}t.success('Digest "'.concat(e.name,'" ').concat(e.enabled?"disabled":"enabled"," successfully"))};return(0,i.jsxs)("div",{children:[s,(0,i.jsxs)(a.jqI,{justify:"space-between",align:"center",className:"mb-4",children:[(0,i.jsx)("div",{className:"w-1/3",children:(0,i.jsx)(j,{placeholder:"Search digests...",allowClear:!0,value:E,onChange:e=>T(e.target.value),"data-testid":"search-input"})}),A&&(0,i.jsx)(a.wpx,{type:"primary",onClick:()=>{e.push(o.dx)},"data-testid":"add-digest-btn",children:"Create digest"})]}),(0,i.jsx)(a.krs,{loading:l,itemLayout:"horizontal",dataSource:n,locale:{emptyText:(0,i.jsx)("div",{className:"px-4 py-8 text-center",children:(0,i.jsxs)(a.AntTypography.Paragraph,{type:"secondary",children:["No digest configurations yet. ",(0,i.jsx)("br",{}),(0,i.jsx)(u.ZP,{scopes:[h.Sh.DIGEST_CONFIG_CREATE],children:'Click "Create digest" to get started.'})]})})},renderItem:e=>(0,i.jsxs)(a.krs.Item,{actions:C?[(0,i.jsx)(a.wpx,{type:"link",onClick:()=>v(e),"data-testid":"edit-list-btn",className:"px-1",children:"Edit"},"edit")]:[],children:[(0,i.jsx)(a.krs.Item.Meta,{title:e.name,description:(0,i.jsx)(a.vyj,{direction:"vertical",size:4,children:(0,i.jsxs)(a.vyj,{size:4,children:[(0,i.jsx)(a.j8w,{children:p.Um[e.digest_type]}),(0,i.jsx)(a.j8w,{children:p.oU[e.messaging_service_type]})]})})}),(0,i.jsxs)(a.jqI,{align:"center",gap:24,children:[(0,i.jsx)(a.AntTypography.Text,{children:(0,_.uw)(e.cron_expression)}),C&&(0,i.jsx)(a.rAg,{checked:e.enabled,onChange:()=>w(e),size:"small","data-testid":"toggle-enabled-switch"})]})]},e.id)}),r>y&&(0,i.jsx)(a.jqI,{justify:"end",className:"mt-4",children:(0,i.jsx)(a.B7X,{current:m,total:r,pageSize:y,onChange:(e,t)=>{f(e),t!==y&&S(t)},showSizeChanger:!0,showTotal:e=>"Total ".concat(e," items")})})]})},E=()=>(0,i.jsx)(n.Z,{title:"Notifications",children:(0,i.jsxs)(a.xuv,{"data-testid":"digests-management",children:[(0,i.jsx)(l.Z,{heading:"Notifications"}),(0,i.jsx)(r.Z,{}),(0,i.jsx)(a.xuv,{maxWidth:"1200px",children:(0,i.jsx)(y,{})})]})})}},function(e){e.O(0,[8212,2888,9774,179],function(){return e(e.s=69453)}),_N_E=e.O()}]);