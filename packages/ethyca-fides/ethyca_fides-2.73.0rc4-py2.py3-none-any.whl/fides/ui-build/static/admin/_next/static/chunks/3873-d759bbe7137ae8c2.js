"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3873],{35287:function(e,t,s){var i=s(24246),a=s(87949),l=s(88038),r=s.n(l);s(27378),t.Z=e=>{let{children:t,title:s,fullHeight:l,fullWidth:n,mainProps:d}=e;return(0,i.jsxs)(a.kCb,{"data-testid":s,direction:"column",height:l?"100vh":"calc(100vh - 48px)",width:n?"100vw":"calc(100vw - 240px)",children:[(0,i.jsxs)(r(),{children:[(0,i.jsxs)("title",{children:["Fides Admin UI - ",s]}),(0,i.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsx)(a.kCb,{px:10,py:6,as:"main",overflow:"auto",direction:"column",flex:1,minWidth:0,...d,children:t})]})}},87361:function(e,t,s){var i=s(24246),a=s(87949);t.Z=e=>{let{title:t,text:s,onClose:l}=e;return(0,i.jsxs)(a.Ugi,{backgroundColor:"gray.50",border:"1px solid",borderRadius:"md",justifyContent:"space-between",py:4,pr:6,pl:3,"data-testid":"empty-state",gap:2,position:"relative",children:[l&&(0,i.jsx)(a.Two,{boxSize:5,position:"absolute",right:3,top:3,zIndex:1,cursor:"pointer",p:1,onClick:l}),(0,i.jsx)(a.iid,{alignSelf:"start",color:"minos",mt:.5,flexGrow:0}),(0,i.jsxs)(a.kCb,{direction:"column",gap:2,flexGrow:1,children:[(0,i.jsx)(a.X6q,{fontSize:"md",children:t}),(0,i.jsx)(a.xvT,{fontSize:"sm",color:"gray.600",lineHeight:"5",children:s})]})]})}},96718:function(e,t,s){s.d(t,{z:function(){return l}});var i=s(24246),a=s(87949);let l=e=>{let{...t}=e;return(0,i.jsx)(a.WPr,{defaultActiveFirstOption:!1,maxTagCount:"responsive",allowClear:!0,styles:t.mode?void 0:{popup:{root:{width:"auto",minWidth:"200px"}}},className:"w-auto","data-testid":"filter-select",...t})}},97181:function(e,t,s){s.d(t,{d:function(){return o}});var i=s(24246),a=s(87949),l=s(34090),r=s(27378),n=s(46238),d=s(40324);let o=e=>{let{name:t,label:s,labelProps:o,tooltip:c,isRequired:u,layout:p="inline",helperText:m,...x}=e,[h,y,{setValue:v}]=(0,l.U$)(t),j=!!(y.touched&&y.error),[f,g]=(0,r.useState)("");h.value||"tags"!==x.mode&&"multiple"!==x.mode||(h.value=[]),"tags"===x.mode&&"string"==typeof h.value&&(h.value=[h.value]);let _="tags"===x.mode?(e,t)=>e?e.value!==f||h.value.includes(f)?x.optionRender?x.optionRender(e,t):e.label:'Create "'.concat(f,'"'):void 0:x.optionRender||void 0,b=e=>{g(e),x.onSearch&&x.onSearch(e)},q=(e,t)=>{v(e),x.onChange&&x.onChange(e,t)};return"inline"===p?(0,i.jsx)(a.NIc,{isInvalid:j,isRequired:u,children:(0,i.jsxs)(a.rjZ,{templateColumns:s?"1fr 3fr":"1fr",children:[s?(0,i.jsx)(d.__,{htmlFor:x.id||t,...o,children:s}):null,(0,i.jsxs)(a.jqI,{align:"center",children:[(0,i.jsxs)(a.jqI,{vertical:!0,flex:1,className:"mr-2",children:[(0,i.jsx)(a.WPr,{...h,id:x.id||t,"data-testid":"controlled-select-".concat(h.name),...x,optionRender:_,onSearch:"tags"===x.mode?b:void 0,onChange:q,value:h.value||void 0,status:j?"error":void 0}),m&&(0,i.jsx)(a.Q6r,{children:m}),(0,i.jsx)(d.Bc,{isInvalid:j,message:y.error,fieldName:h.name})]}),(0,i.jsx)(n.b,{label:c,className:j?"mt-2 self-start":void 0})]})]})}):(0,i.jsx)(a.NIc,{isInvalid:j,isRequired:u,children:(0,i.jsxs)(a.gCW,{alignItems:"start",children:[(0,i.jsxs)(a.jqI,{align:"center",children:[s?(0,i.jsx)(d.__,{htmlFor:x.id||t,fontSize:"xs",my:0,mr:1,...o,children:s}):null,(0,i.jsx)(n.b,{label:c})]}),(0,i.jsx)(a.WPr,{...h,id:x.id||t,"data-testid":"controlled-select-".concat(h.name),...x,optionRender:_,onSearch:"tags"===x.mode?b:void 0,onChange:q,value:h.value||void 0,status:j?"error":void 0}),m&&(0,i.jsx)(a.Q6r,{style:{marginTop:0},children:m}),(0,i.jsx)(d.Bc,{isInvalid:j,message:y.error,fieldName:h.name})]})})}},9270:function(e,t,s){s.d(t,{S:function(){return l}});var i=s(27378),a=s(36866);let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,a.h)(e),{pageIndex:s,pageSize:l,updatePageIndex:r,updatePageSize:n,pageSizeOptions:d,showSizeChanger:o}=t,c=(0,i.useMemo)(()=>({current:s,pageSize:l,showSizeChanger:o,pageSizeOptions:d.map(String),onChange:r,onShowSizeChange:(e,t)=>{n(t)}}),[s,l,o,d,r,n]);return{...t,paginationProps:c}}},28686:function(e,t,s){s.d(t,{m:function(){return I}});var i=s(24246),a=s(87949),l=s(56141),r=s.n(l),n=s(86677),d=s(27378),o=s(16134),c=s(91317),u=s(18225),p=s(77830),m=s(19904),x=s(28407),h=s(16394),y=s(65735),v=s(32735),j=s(59969),f=s(71784),g=s(45116);let _=e=>{let{label:t,children:s}=e;return(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"shrink-0 grow-0 basis-1/3 pr-2",children:(0,i.jsxs)(a.AntTypography.Text,{className:"text-gray-700",children:[t,":"]})}),(0,i.jsx)("div",{className:"min-w-0 shrink grow text-gray-600",children:s})]})},b=e=>{let{task:t}=e,s=t.request_type===y.k6.ACCESS?y.Us.ACCESS:y.Us.ERASURE,l=f.rE.get(s)||t.request_type;return(0,i.jsxs)("div",{className:"flex flex-col space-y-3","data-testid":"task-details-container",children:[(0,i.jsx)(_,{label:"Name",children:(0,i.jsx)(a.AntTypography.Text,{children:t.name})}),(0,i.jsx)(_,{label:"Description",children:(0,i.jsx)(a.AntTypography.Text,{children:t.description||"-"})}),(0,i.jsx)(_,{label:"Request Type",children:(0,i.jsx)(a.AntTypography.Text,{children:l})}),(0,i.jsx)(_,{label:"Assigned To",children:t.assigned_users&&t.assigned_users.length>0?(0,i.jsx)("div",{className:"flex flex-wrap gap-1","data-testid":"assigned-users-tags",children:t.assigned_users.map(e=>(0,i.jsx)(a.j8w,{"data-testid":"assigned-user-tag-".concat(e.id),children:"".concat(e.first_name||""," ").concat(e.last_name||"").trim()||e.email_address||"Unknown User"},e.id))}):(0,i.jsx)(a.AntTypography.Text,{children:"No one assigned"})}),t.privacy_request.subject_identities&&Object.keys(t.privacy_request.subject_identities).length>0?(0,i.jsx)(_,{label:"Subject identities",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.privacy_request.subject_identities).map(e=>{let[t,s]=e;return(0,i.jsxs)(a.j8w,{children:[t,": ",String(s)]},t)})})}):null,t.privacy_request.custom_fields&&Object.keys(t.privacy_request.custom_fields).length>0?(0,i.jsx)(_,{label:"Custom fields",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.privacy_request.custom_fields).filter(e=>{let[,t]=e;return t}).map(e=>{let[t,s]=e;return(0,i.jsxs)(a.j8w,{children:[t,": ",String(s)]},t)})})}):null]})},q=e=>{let{isOpen:t,onClose:s,task:l}=e,[r,{isLoading:n}]=(0,g.HP)(),[o,c]=(0,d.useState)(""),[u,p]=(0,d.useState)(!1),[m,x]=(0,d.useState)(""),[h,v]=(0,d.useState)([]),j=async()=>{try{await r({privacy_request_id:l.privacy_request.id,manual_field_id:l.manual_field_id,field_value:l.input_type===y.PF.TEXT?o:l.input_type===y.PF.CHECKBOX?u.toString():void 0,comment_text:m||void 0,attachments:h.length>0?h.map(e=>e.originFileObj).filter(Boolean):void 0}).unwrap(),c(""),p(!1),x(""),v([]),s()}catch(e){a.Pg3.error("Failed to complete task. Please try again.")}};return(0,i.jsxs)(a.u_l,{isOpen:t,onClose:s,size:"700px",isCentered:!0,children:[(0,i.jsx)(a.ZAr,{}),(0,i.jsxs)(a.hzk,{maxWidth:"700px","data-testid":"complete-task-modal",children:[(0,i.jsx)(a.xBx,{children:(0,i.jsx)(a.AntTypography.Title,{level:4,children:"Complete Task"})}),(0,i.jsx)(a.fef,{children:(0,i.jsxs)("div",{className:"flex flex-col space-y-6",children:[(0,i.jsx)("div",{children:(0,i.jsx)(b,{task:l})}),(0,i.jsx)(a.htM,{}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex flex-col space-y-4",children:[(()=>{switch(l.input_type){case y.PF.TEXT:return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Subject data"}),(0,i.jsx)(a.AntInput.TextArea,{value:o,onChange:e=>c(e.target.value),placeholder:"Enter your response...",rows:4,"data-testid":"complete-modal-text-input"})]});case y.PF.CHECKBOX:return(0,i.jsx)("div",{className:"space-y-2",children:(0,i.jsx)(a.E_O,{checked:u,onChange:e=>p(e.target.checked),"data-testid":"complete-modal-checkbox",children:"The task has been completed"})});default:return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Upload Files"}),(0,i.jsx)("div",{children:(0,i.jsx)(a.pMK,{fileList:h,onChange:e=>{let{fileList:t}=e;return v(t)},beforeUpload:()=>!1,"data-testid":"complete-modal-file-upload",multiple:!0,children:(0,i.jsx)(a.wpx,{"data-testid":"complete-modal-upload-button",children:"Click to Upload"})})})]})}})(),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Internal comment"}),(0,i.jsx)(a.AntInput.TextArea,{value:m,onChange:e=>x(e.target.value),placeholder:"Add any additional comments...",rows:3,"data-testid":"complete-modal-comment-input"})]})]})})]})}),(0,i.jsx)(a.mzw,{children:(0,i.jsxs)(a.vyj,{children:[(0,i.jsx)(a.wpx,{onClick:()=>{c(""),p(!1),x(""),v([]),s()},disabled:n,"data-testid":"complete-modal-cancel-button",children:"Cancel"}),(0,i.jsx)(a.wpx,{type:"primary",onClick:j,loading:n,disabled:!(()=>{switch(l.input_type){case y.PF.TEXT:return o.trim().length>0;case y.PF.CHECKBOX:return u;default:return h.length>0}})(),"data-testid":"complete-modal-save-button",children:"Save"})]})})]})]})},C=e=>{let{isOpen:t,onClose:s,task:l}=e,[r,{isLoading:n}]=(0,g.DA)(),[o,c]=(0,d.useState)(""),u=async()=>{try{await r({privacy_request_id:l.privacy_request.id,manual_field_id:l.manual_field_id,skip_reason:o}).unwrap(),c(""),s()}catch(e){a.Pg3.error("Failed to skip task. Please try again.")}};return(0,i.jsxs)(a.u_l,{isOpen:t,onClose:s,size:"700px",isCentered:!0,children:[(0,i.jsx)(a.ZAr,{}),(0,i.jsxs)(a.hzk,{maxWidth:"700px","data-testid":"skip-task-modal",children:[(0,i.jsx)(a.xBx,{children:(0,i.jsx)(a.AntTypography.Title,{level:4,children:"Skip Task"})}),(0,i.jsx)(a.fef,{children:(0,i.jsxs)("div",{className:"flex flex-col space-y-6",children:[(0,i.jsx)("div",{children:(0,i.jsx)(b,{task:l})}),(0,i.jsx)(a.htM,{}),(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"flex flex-col space-y-4",children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Reason for skipping (Required)"}),(0,i.jsx)(a.AntInput.TextArea,{value:o,onChange:e=>c(e.target.value),placeholder:"Please provide a reason for skipping this task...",rows:4,"data-testid":"skip-modal-comment-input"})]})})})]})}),(0,i.jsx)(a.mzw,{children:(0,i.jsxs)(a.vyj,{children:[(0,i.jsx)(a.wpx,{onClick:()=>{c(""),s()},disabled:n,"data-testid":"skip-modal-cancel-button",children:"Cancel"}),(0,i.jsx)(a.wpx,{type:"primary",onClick:u,loading:n,disabled:!o.trim(),danger:!0,"data-testid":"skip-modal-skip-button",children:"Skip Task"})]})})]})]})},k=e=>{let{task:t}=e,s=(0,n.useRouter)(),{isOpen:l,onOpen:r,onClose:d}=(0,a.qY0)(),{isOpen:o,onOpen:c,onClose:u}=(0,a.qY0)(),x=(0,m.Tg)([y.Sh.PRIVACY_REQUEST_READ]);if(t.status!==y.OS.NEW)return null;let h=[{key:"skip",label:"Skip task",onClick:c}];return x&&h.push({key:"go-to-request",label:"Go to request",onClick:()=>{s.push({pathname:p.ld,query:{id:t.privacy_request.id}})}}),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a.vyj,{size:"small",children:[(0,i.jsx)(a.wpx,{type:"default",onClick:r,size:"small",children:"Complete"}),(0,i.jsx)(a.S0p,{menu:{items:h},trigger:["click"],placement:"bottomRight",overlayStyle:{minWidth:120},children:(0,i.jsx)(a.wpx,{size:"small",icon:(0,i.jsx)(a.PJP.r43,{}),"aria-label":"More actions"})})]}),(0,i.jsx)(q,{isOpen:l,onClose:d,task:t}),(0,i.jsx)(C,{isOpen:o,onClose:u,task:t})]})},S={[y.OS.NEW]:{color:a.tAb.INFO,label:"New"},[y.OS.COMPLETED]:{color:a.tAb.SUCCESS,label:"Completed"},[y.OS.SKIPPED]:{color:a.tAb.MARBLE,label:"Skipped"}},w=[{text:"New",value:y.OS.NEW},{text:"Completed",value:y.OS.COMPLETED},{text:"Skipped",value:y.OS.SKIPPED}],E=[{text:"Access",value:y.k6.ACCESS},{text:"Erasure",value:y.k6.ERASURE}],R=e=>{let{systemFilters:t,userFilters:s,onUserClick:l,currentFilters:r,hasAccessToAllTasks:n}=e,d=[{title:"Task name",dataIndex:"name",key:"name",minWidth:100,render:e=>(0,i.jsx)(a.AntTypography.Text,{ellipsis:{tooltip:e},children:e})},{title:"Status",dataIndex:"status",key:"status",width:110,render:e=>(0,i.jsx)(a.j8w,{color:S[e].color,"data-testid":"manual-task-status-tag",children:S[e].label}),filters:w,filterMultiple:!1},{title:"System",dataIndex:["system","name"],key:"system_name",minWidth:100,render:e=>(0,i.jsx)(a.AntTypography.Text,{ellipsis:{tooltip:e},children:e}),filters:t,filterMultiple:!1},{title:"Type",dataIndex:"request_type",key:"request_type",width:80,render:e=>{let t=e===y.k6.ACCESS?y.Us.ACCESS:y.Us.ERASURE,s=f.rE.get(t)||e;return(0,i.jsx)(a.AntTypography.Text,{ellipsis:{tooltip:s},children:s})},filters:E,filterMultiple:!1},{title:"Assigned to",dataIndex:"assigned_users",key:"assigned_users",minWidth:100,render:e=>{if(!e||0===e.length)return(0,i.jsx)(a.AntTypography.Text,{children:"-"});let t=e.map(e=>({label:(0,h.gJ)(e),value:e.id})),s=e.map(e=>e.id);return(0,i.jsx)(a.d3V,{value:s,options:t,readonly:!0,onTagClick:e=>l(String(e))})},filters:s,filterMultiple:!1,defaultFilteredValue:r.assignedUsers?[r.assignedUsers]:void 0},{title:"Days left",dataIndex:["privacy_request","days_left"],key:"days_left",width:90,render:e=>(0,i.jsx)(j.Z,{daysLeft:e||0,includeText:!1,status:y.q2.PENDING})},{title:"Subject identity",dataIndex:["privacy_request","subject_identities"],key:"subject_identities",minWidth:120,render:e=>{if(!e)return(0,i.jsx)(a.AntTypography.Text,{children:"-"});let t=e.email||e.phone_number||"";return(0,i.jsx)(a.AntTypography.Text,{ellipsis:{tooltip:t},children:t})}},{title:"Actions",key:"actions",width:145,render:(e,t)=>(0,i.jsx)(k,{task:t})}];return n?d:d.filter(e=>"assigned_users"!==e.key)};var A=s(812),T=()=>{let e=(0,a.pmc)(),[t,{isFetching:s}]=(0,g.zp)();return{downloadReport:async s=>{let i=await t(s);if(i.isError)e({status:"error",description:(0,A.e$)(i.error,"A problem occurred while generating your manual tasks report. Please try again.")});else{let t=document.createElement("a"),s=new Blob([i.data],{type:"text/csv"}),a=window.URL.createObjectURL(s);t.href=a,t.download="manual-tasks-report.csv",t.click(),t.remove(),window.URL.revokeObjectURL(a),e({status:"success",description:"Successfully downloaded Manual Tasks report."})}},isDownloadingReport:s}};let I=()=>{let e=(0,n.useRouter)(),t=(0,o.C)(c.dy),[s,l]=(0,d.useState)(1),[j,f]=(0,d.useState)(25),_=(0,m.Tg)([y.Sh.MANUAL_FIELD_READ_ALL]),b=e.query.privacy_request_id||void 0,q=(0,d.useMemo)(()=>{let e={};return(null==t?void 0:t.id)&&!b&&(e.assignedUsers=t.id),b&&"string"==typeof b&&(e.privacyRequestId=b),e},[null==t?void 0:t.id,b]),[C,k]=(0,d.useState)(q),{data:S,isLoading:w,isFetching:E}=(0,g.Ym)({page:s,size:j,status:C.status,system_name:C.systemName,request_type:C.requestType,assigned_user_id:C.assignedUsers,privacy_request_id:C.privacyRequestId}),{downloadReport:A,isDownloadingReport:I}=T(),N=async()=>{await A({status:C.status,system_name:C.systemName,request_type:C.requestType,assigned_user_id:C.assignedUsers,privacy_request_id:C.privacyRequestId})},{data:P}=(0,g.Ym)({page:1,size:1}),{items:O,total:U}=(0,d.useMemo)(()=>S||{items:[],total:0,pages:0,filter_options:{assigned_users:[],systems:[]}},[S]),z=(0,d.useMemo)(()=>(null==P?void 0:P.filter_options)||{assigned_users:[],systems:[]},[P]),F=R({systemFilters:(0,d.useMemo)(()=>{var e;return(null==z?void 0:null===(e=z.systems)||void 0===e?void 0:e.map(e=>({text:e.name,value:e.name})))||[]},[null==z?void 0:z.systems]),userFilters:(0,d.useMemo)(()=>{var e;let s=(null==z?void 0:null===(e=z.assigned_users)||void 0===e?void 0:e.map(e=>({text:(0,h.gJ)(e),value:e.id})))||[];return(null==t?void 0:t.id)&&!s.some(e=>e.value===t.id)&&s.push({text:(0,h.gJ)(t,{fallbackToId:!0}),value:t.id}),s},[null==z?void 0:z.assigned_users,t]),onUserClick:t=>{e.push({pathname:p.fw,query:{id:t}})},currentFilters:C,hasAccessToAllTasks:_}),D=(0,d.useMemo)(()=>r()(C,q),[C,q]);return w?(0,i.jsx)(u.Z,{}):(0,i.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,i.jsxs)(a.kCb,{gap:3,align:"center",justify:"space-between",className:"mb-4",children:[(0,i.jsx)(x.H,{globalFilter:C.privacyRequestId||"",setGlobalFilter:e=>{let t={...C};e&&e.trim()?t.privacyRequestId=e.trim():delete t.privacyRequestId,k(t),l(1)},placeholder:"Search by privacy request ID",testid:"privacy-request-id-filter"}),(0,i.jsx)(a.wpx,{"aria-label":"Export manual tasks as CSV","data-testid":"export-manual-tasks-btn",icon:(0,i.jsx)(a.PJP.UWx,{}),loading:I,onClick:N})]}),(0,i.jsx)(a.V5H,{columns:F,dataSource:O,rowKey:e=>"".concat(e.privacy_request.id,"-").concat(e.manual_field_id),pagination:{current:s,pageSize:j,pageSizeOptions:v.VZ,total:U||0,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),onChange:(e,t)=>{l(e),t!==j&&(f(t),l(1))}},onChange:(e,t)=>{let s={privacyRequestId:C.privacyRequestId};t.status&&([s.status]=t.status),t.system_name&&([s.systemName]=t.system_name),t.request_type&&([s.requestType]=t.request_type),t.assigned_users&&([s.assignedUsers]=t.assigned_users),k(s),l(1)},locale:{emptyText:D?(0,i.jsx)("div",{"data-testid":"empty-state-current-user",className:"my-4",children:(0,i.jsxs)(a.AntTypography.Paragraph,{children:["You have no tasks assigned."," ",_&&(0,i.jsx)("span",{children:'You can modify the "Assigned to" column filter to view tasks assigned to other users.'})]})}):(0,i.jsx)("div",{"data-testid":"empty-state",className:"my-4",children:"No results found."})},loading:w||E,scroll:{scrollToFirstRowOnChange:!0},tableLayout:"fixed",className:"[&_th]:!break-normal"})]})}},98855:function(e,t,s){s.d(t,{q:function(){return m}});var i=s(24246),a=s(87949),l=s(58452),r=s(19904),n=s(7426),d=s(57526),o=s(66548),c=s(45489),u=s(65735),p=s(42478);let m=e=>{var t;let{subjectRequest:s,...m}=e,x=(0,a.qY0)(),h=(0,a.qY0)(),y=(0,a.qY0)(),v=(0,a.qY0)(),{handleApproveRequest:j,handleDenyRequest:f,handleDeleteRequest:g,handleFinalizeRequest:_,isLoading:b}=(0,c.Z)({subjectRequest:s}),{data:q}=(0,n.tB)({api_set:!1}),{data:C}=(0,p.JE)(),k=null==q?void 0:null===(t=q.notifications)||void 0===t?void 0:t.send_request_completion_notification;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(a.Ugi,{...m,children:["pending"!==s.status?null:(0,i.jsx)(a.wpx,{title:"Approve","aria-label":"Approve",icon:(0,i.jsx)(a.PJP.MCw,{}),onClick:x.onOpen,loading:b,disabled:b,"data-testid":"privacy-request-approve-btn",size:"small"}),"pending"!==s.status?null:(0,i.jsx)(a.wpx,{title:"Deny","aria-label":"Deny",icon:(0,i.jsx)(a.PJP.x8P,{}),onClick:h.onOpen,loading:b,disabled:b,"data-testid":"privacy-request-deny-btn",size:"small"}),s.status!==u.q2.REQUIRES_MANUAL_FINALIZATION?null:(0,i.jsx)(r.ZP,{scopes:[u.Sh.PRIVACY_REQUEST_REVIEW],children:(0,i.jsx)(a.wpx,{title:"Finalize","aria-label":"Finalize",icon:(0,i.jsx)(a.PJP.Ok8,{}),onClick:v.onOpen,loading:b,disabled:b,"data-testid":"privacy-request-finalize-btn",size:"small"})}),(0,i.jsx)(r.ZP,{scopes:[u.Sh.PRIVACY_REQUEST_DELETE],children:(0,i.jsx)(a.wpx,{title:"Delete","aria-label":"Delete",icon:(0,i.jsx)(a.PJP.ZNm,{size:14}),onClick:y.onOpen,loading:b,disabled:b,"data-testid":"privacy-request-delete-btn",size:"small"})})]}),(0,i.jsx)(a.h_i,{children:(0,i.jsx)(d.Z,{isOpen:x.isOpen,isLoading:b,onClose:x.onClose,onApproveRequest:j,subjectRequest:s})}),(0,i.jsx)(a.h_i,{children:(0,i.jsx)(o.Z,{isOpen:h.isOpen,onClose:h.onClose,onDenyRequest:f})}),(0,i.jsx)(l.Z,{isOpen:y.isOpen,onClose:y.onClose,onConfirm:g,message:(0,i.jsx)(a.xvT,{children:"You are about to permanently delete the privacy request. Are you sure you would like to continue?"})}),(0,i.jsx)(l.Z,{isOpen:v.isOpen,onClose:v.onClose,onConfirm:()=>{_(),v.onClose()},title:"Finalize privacy request",message:(0,i.jsxs)(a.xvT,{children:['You are about to finalize this privacy request. The status will be updated to "Complete"',k&&(null==C?void 0:C.service_type)?" and the requesting user will be notified":"",". Would you like to continue?"]})})]})}},61653:function(e,t,s){s.d(t,{S:function(){return d}});var i=s(24246),a=s(87949),l=s(71784),r=s(52451),n=s(96718);let d=e=>{let{onClose:t,onFilterChange:s,...d}=e,{handleStatusChange:o,handleActionTypeChange:c,handleFromChange:u,handleToChange:p,handleClearAllFilters:m,from:x,to:h,status:y,action_type:v}=(0,r.h)(s);return(0,i.jsxs)(a.u_l,{onClose:t,size:"xl",...d,children:[(0,i.jsx)(a.ZAr,{}),(0,i.jsxs)(a.hzk,{children:[(0,i.jsx)(a.xBx,{borderBottomWidth:1,borderBottomColor:"gray.200",children:"All Filters"}),(0,i.jsx)(a.olH,{}),(0,i.jsx)(a.fef,{py:4,sx:{"& label":{mb:0}},children:(0,i.jsxs)(a.Kqy,{gap:4,children:[(0,i.jsxs)(a.Kqy,{children:[(0,i.jsx)(a.lXp,{size:"md",id:"request-date-range-label",children:"Date range"}),(0,i.jsxs)(a.Ugi,{gap:3,children:[(0,i.jsxs)(a.BZy,{size:"sm",flex:1,children:[(0,i.jsx)(a.UiE,{as:"label",htmlFor:"from-date",borderRadius:"md",children:"From"}),(0,i.jsx)(a.IIB,{type:"date",name:"From",value:x,max:h||void 0,onChange:u,borderRadius:"md",id:"from-date","aria-describedby":"request-date-range-label"})]}),(0,i.jsxs)(a.BZy,{size:"sm",flex:1,children:[(0,i.jsx)(a.UiE,{as:"label",htmlFor:"to-date",borderRadius:"md",children:"To"}),(0,i.jsx)(a.IIB,{type:"date",borderRadius:"md",name:"To",value:h,min:x||void 0,onChange:p,id:"to-date","aria-describedby":"request-date-range-label"})]})]})]}),(0,i.jsxs)(a.Kqy,{children:[(0,i.jsx)(a.lXp,{size:"md",htmlFor:"request-status",children:"Status"}),(0,i.jsx)(n.z,{id:"request-status",mode:"multiple",options:l.I3,value:y,onChange:o,"data-testid":"request-status-filter"})]}),(0,i.jsxs)(a.Kqy,{children:[(0,i.jsx)(a.lXp,{size:"md",htmlFor:"request-action-type",children:"Request Type"}),(0,i.jsx)(n.z,{id:"request-action-type",mode:"multiple",options:l.kN,value:v,onChange:c,"data-testid":"request-action-type-filter"})]})]})}),(0,i.jsxs)(a.mzw,{justifyContent:"space-between",children:[(0,i.jsx)(a.wpx,{type:"text",onClick:m,children:"Clear all"}),(0,i.jsx)(a.wpx,{type:"primary",onClick:t,children:"Done"})]})]})]})}},86291:function(e,t,s){s.d(t,{Z:function(){return S}});var i=s(24246),a=s(87949),l=s(27378),r=s(812),n=s(87361),d=s(46628),o=s(32885),c=s(90867),u=s(34090),p=s(55484),m=s(40324);let x=(e,t)=>null==t?void 0:t.find(t=>t.policy_key===e),h=e=>{var t,s;if(!e)return p.Ry().shape({policy_key:p.Z_().required().label("Request type")});let i=e.custom_privacy_request_fields?Object.entries(e.custom_privacy_request_fields).filter(e=>{let[,t]=e;return"field_type"in t&&"location"!==t.field_type}).map(e=>{let[t,s]=e;return{[t]:p.Ry().shape({value:s.required&&!s.hidden?p.Z_().required().label(s.label):p.Z_().nullable()})}}).reduce((e,t)=>({...e,...t}),{}):{};return p.Ry().shape({policy_key:p.Z_().required().label("Request type"),identity:p.Ry().shape({email:(null===(t=e.identity_inputs)||void 0===t?void 0:t.email)==="required"?p.Z_().email().required().label("Email address"):p.Z_().nullable(),phone_number:(null===(s=e.identity_inputs)||void 0===s?void 0:s.phone)==="required"?p.Z_().matches(/^\+?[1-9]\d{1,14}$/,"Phone number must be formatted correctly (e.g. 15555555555)").required().label("Phone number"):p.Z_().matches(/^\+?[1-9]\d{1,14}$/,"Phone number must be formatted correctly (e.g. 15555555555)").nullable()}),custom_privacy_request_fields:p.Ry().shape(i)})};var y=s(97181);let v={is_verified:!1,policy_key:"",identity:{}},j=e=>{let{identityInputs:t}=e;return t?(0,i.jsxs)(i.Fragment,{children:[t.email?(0,i.jsx)(m.j0,{name:"identity.email",label:"User email address",isRequired:"required"===t.email,variant:"stacked"}):null,t.phone?(0,i.jsx)(m.j0,{name:"identity.phone_number",label:"User phone number",isRequired:"required"===t.phone,variant:"stacked"}):null]}):null},f=e=>{var t;let{label:s,required:l,name:r}=e,[n,d,o]=(0,u.U$)(e),c=!!(d.touched&&d.error),{setValue:p}=o,{value:m}={...n,value:null!==(t=n.value)&&void 0!==t?t:""};return(0,i.jsx)(a.PPS.Item,{label:s,name:r,required:null!=l?l:void 0,layout:"vertical",validateStatus:c?"error":void 0,children:(0,i.jsx)(a.AOh,{value:m,onChange:e=>{e&&p(e)}},r)})},g=e=>{let{customFieldInputs:t}=e;if(!t)return null;let s=Object.entries(t);return(0,i.jsx)(i.Fragment,{children:s.map(e=>{let[t,s]=e;return"field_type"in s&&"location"===s.field_type?(0,i.jsx)(f,{name:t,label:s.label,required:!!s.required},t):(0,i.jsx)(m.j0,{name:"custom_privacy_request_fields.".concat(t,".value"),label:s.label,isRequired:!!s.required,variant:"stacked"},t)})})},_=e=>{let{onSubmit:t,onCancel:s,privacyCenterUrl:l}=e,{onCopy:r}=(0,a.VPI)(""),n=(0,a.pmc)();return(0,i.jsx)(u.J9,{initialValues:{identity:{email:""}},onSubmit:e=>{r("".concat(l,"?email=").concat(encodeURIComponent(e.identity.email))),t(e),n({status:"success",description:"DSR Link Copied!"})},validationSchema:()=>p.Ry().shape({identity:p.Ry().shape({email:p.Z_().email().required().label("Email Address")})}),children:e=>{let{dirty:t,isValid:l}=e;return(0,i.jsx)(u.l0,{children:(0,i.jsxs)(a.Kqy,{spacing:6,mb:2,children:[(0,i.jsx)(j,{identityInputs:{email:"required"}}),(0,i.jsxs)("div",{className:"flex gap-4 self-end",children:[(0,i.jsx)(a.wpx,{onClick:s,children:"Cancel"}),(0,i.jsx)(a.wpx,{htmlType:"submit",type:"primary",disabled:!t||!l,"data-testid":"submit-btn",icon:(0,i.jsx)(a.xPt,{}),children:"Copy"})]})]})})}})};var b=e=>{let{onSubmit:t,onCancel:s}=e,{data:l}=(0,c.xv)();return(0,i.jsx)(u.J9,{initialValues:v,onSubmit:t,validationSchema:()=>(0,p.Vo)(e=>h(x(e.policy_key,null==l?void 0:l.actions))),children:e=>{var t;let{values:r,dirty:n,isValid:d,isSubmitting:o,setFieldValue:c}=e,p=x(r.policy_key,null==l?void 0:l.actions);return(0,i.jsx)(u.l0,{children:(0,i.jsxs)(a.Kqy,{spacing:6,mb:2,children:[(0,i.jsx)(y.d,{name:"policy_key",label:"Request type",options:null!==(t=null==l?void 0:l.actions.map(e=>({label:e.title,value:e.policy_key})))&&void 0!==t?t:[],onChange:e=>{let t=x(e,null==l?void 0:l.actions);if(!(null==t?void 0:t.custom_privacy_request_fields)){c("custom_privacy_request_fields",void 0);return}c("custom_privacy_request_fields",Object.entries(t.custom_privacy_request_fields).map(e=>{let[t,s]=e;return{[t]:{label:s.label,value:s.default_value}}}).reduce((e,t)=>({...e,...t}),{}))},layout:"stacked",isRequired:!0}),(0,i.jsx)(j,{identityInputs:null==p?void 0:p.identity_inputs}),(0,i.jsx)(g,{customFieldInputs:null==p?void 0:p.custom_privacy_request_fields}),(0,i.jsx)(m.Xl,{name:"is_verified",label:"I confirm that I have verified this user information"}),(0,i.jsxs)("div",{className:"flex gap-4 self-end",children:[(0,i.jsx)(a.wpx,{onClick:s,children:"Cancel"}),(0,i.jsx)(a.wpx,{htmlType:"submit",type:"primary",disabled:!r.is_verified||!n||!d,loading:o,"data-testid":"submit-btn",children:"Create"})]})]})})}})},q=s(31883);let C=e=>{let{isOpen:t,onClose:s}=e,[l]=(0,c.M6)(),o=(0,a.pmc)(),u=async e=>{let{is_verified:t,...i}=e,a=i.custom_privacy_request_fields?Object.entries(i.custom_privacy_request_fields).map(e=>{let[t,s]=e;return s.value?{[t]:s}:{}}).reduce((e,t)=>({...e,...t}),{}):void 0,n={...i,custom_privacy_request_fields:a},c=await l([n]);(0,q.D4)(c)?o((0,d.Vo)((0,r.e$)(c.error,"An error occurred while creating this privacy request. Please try again"))):o((0,d.t5)("Privacy request created")),s()};return(0,i.jsxs)(a.u_l,{isOpen:t,onClose:s,size:"2xl",isCentered:!0,children:[(0,i.jsx)(a.ZAr,{}),(0,i.jsxs)(a.hzk,{"data-testid":"submit-request-modal",maxHeight:"80%",overflowY:"auto",children:[(0,i.jsx)(a.xBx,{children:"Create privacy request"}),(0,i.jsx)(a.fef,{children:(0,i.jsxs)(a.Kqy,{spacing:4,children:[(0,i.jsx)(n.Z,{title:"Warning: You are bypassing identity verification",text:"You are bypassing Fides' built-in identity verification step. Please ensure that you are only entering information on behalf of a verified and approved user's privacy request."}),(0,i.jsx)(b,{onSubmit:u,onCancel:()=>s()})]})})]})]})},k=e=>{let{isOpen:t,onClose:s,privacyCenterUrl:l}=e;return(0,i.jsxs)(a.u_l,{size:"md",isOpen:t,onClose:s,children:[(0,i.jsx)(a.ZAr,{}),(0,i.jsxs)(a.hzk,{children:[(0,i.jsx)(a.xBx,{children:"Create a Privacy Request Link"}),(0,i.jsxs)(a.fef,{children:[(0,i.jsx)(a.Kqy,{spacing:4}),(0,i.jsx)(_,{privacyCenterUrl:l,onSubmit:s,onCancel:s})]})]})]})};var S=()=>{var e;let[t,s]=(0,l.useState)("closed"),r=()=>s("closed"),{data:n}=(0,o.Vh)(),d=(null!==(e=null==n?void 0:n.privacy_center_url)&&void 0!==e?e:"").trim(),c=d.length>0;return(0,i.jsxs)(i.Fragment,{children:[c?(0,i.jsx)(k,{isOpen:"create-link"===t,onClose:r,privacyCenterUrl:d}):null,(0,i.jsx)(C,{isOpen:"submit-request"===t,onClose:r}),(0,i.jsx)(a.S0p.Button,{type:"primary",onClick:()=>s("submit-request"),"data-testid":"submit-request-btn",menu:{items:[{label:"Create request link",key:"create-request-link",icon:(0,i.jsx)(a.xPt,{}),onClick:()=>s("create-link"),disabled:!c}]},icon:(0,i.jsx)(a.v4q,{}),children:"Create request"})]})}},71784:function(e,t,s){s.d(t,{DE:function(){return n},I3:function(){return a},kN:function(){return r},rE:function(){return l}});var i=s(65735);let a=[...new Map([[i.q2.APPROVED,"Approved"],[i.q2.AWAITING_EMAIL_SEND,"Awaiting email send"],[i.q2.CANCELED,"Canceled"],[i.q2.COMPLETE,"Completed"],[i.q2.DENIED,"Denied"],[i.q2.ERROR,"Error"],[i.q2.IN_PROCESSING,"In progress"],[i.q2.PENDING,"New"],[i.q2.PAUSED,"Paused"],[i.q2.IDENTITY_UNVERIFIED,"Unverified"],[i.q2.REQUIRES_INPUT,"Requires input"],[i.q2.REQUIRES_MANUAL_FINALIZATION,"Requires finalization"]])].map(e=>{let[t,s]=e;return{label:s,value:t}}),l=new Map([[i.Us.ACCESS,"Access"],[i.Us.ERASURE,"Erasure"],[i.Us.CONSENT,"Consent"],[i.Us.UPDATE,"Update"]]),r=[...l].map(e=>{let[t,s]=e;return{label:s,value:t}}),n={local:"local",s3:"s3",gcs:"gcs"}},88152:function(e,t,s){s.d(t,{Y:function(){return o}});var i=s(24246),a=s(87949),l=s(27378),r=s(17245),n=s(65735),d=s(90867);let o=()=>{let{errorAlert:e}=(0,r.VY)(),[t,s]=(0,l.useState)(!1),[o,c]=(0,l.useState)({count:0,total:0}),[u,p]=(0,l.useState)(!0),m=n.q2.ERROR,{data:x}=(0,d.tE)(),{data:h}=(0,d.QA)({status:[m]},{pollingInterval:15e3,skip:u});return(0,l.useEffect)(()=>{p(!(x&&x.notify_after_failures>0))},[x]),(0,l.useEffect)(()=>{let e=(null==h?void 0:h.total)||0;e>=((null==x?void 0:x.notify_after_failures)||0)&&e>o.total?(c({count:e-o.total,total:e}),s(!0)):s(!1)},[null==h?void 0:h.total,null==x?void 0:x.notify_after_failures,o.total]),{processing:()=>{t&&e((0,i.jsxs)(a.xuv,{children:["DSR automation has failed for"," ",(0,i.jsx)(a.xvT,{as:"span",fontWeight:"semibold",children:o.count})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null,id:"dsrErrorAlert"})}}}},49529:function(e,t,s){var i=s(87949),a=s(812),l=s(90867);t.Z=()=>{let e=(0,i.pmc)(),[t,{isFetching:s}]=(0,l.ZU)();return{downloadReport:async s=>{let i=await t(s);if(i.isError)e({status:"error",description:(0,a.e$)(i.error,"A problem occurred while generating your privacy request report.  Please try again.")});else{let t=document.createElement("a"),s=new Blob([i.data],{type:"text/csv"}),a=window.URL.createObjectURL(s);t.href=a,t.download="privacy-request-report.csv",t.click(),t.remove(),window.URL.revokeObjectURL(a),e({status:"success",description:"Successfully downloaded Privacy Request report."})}},isDownloadingReport:s}}},52451:function(e,t,s){s.d(t,{h:function(){return r}});var i=s(27378),a=s(16125),l=s(90867);let r=e=>{let t=(0,a.v9)(l.dp),s=(0,a.I0)();return{handleStatusChange:t=>{s((0,l.CI)(t)),e()},handleActionTypeChange:t=>{s((0,l.aM)(t)),e()},handleFromChange:t=>{s((0,l.su)(null==t?void 0:t.target.value)),e()},handleToChange:t=>{s((0,l.Ue)(null==t?void 0:t.target.value)),e()},handleClearAllFilters:()=>{s((0,l.Mk)()),e()},anyFiltersApplied:(0,i.useMemo)(()=>{var e,s;return(null===(e=t.action_type)||void 0===e?void 0:e.length)||""!==t.from||""!==t.to||(null===(s=t.status)||void 0===s?void 0:s.length)||void 0!==t.sort_field||void 0!==t.sort_direction},[t]),...t}}},31883:function(e,t,s){s.d(t,{Bw:function(){return i.Bw},D4:function(){return i.D4}});var i=s(19043)}}]);