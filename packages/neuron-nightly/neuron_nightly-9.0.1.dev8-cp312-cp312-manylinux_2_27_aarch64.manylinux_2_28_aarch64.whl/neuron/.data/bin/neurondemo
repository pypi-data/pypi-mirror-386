#!/usr/bin/env bash
set -e

ARCH=aarch64
MODSUBDIR=aarch64

if test "x${NRNHOME}" = x ; then
        prefix="/tmp/tmpgj96wtpu/wheel/platlib"
	exec_prefix=/tmp/tmpgj96wtpu/wheel/platlib
	NRNBIN=${exec_prefix}/bin/
	NRNDEMO=/tmp/tmpgj96wtpu/wheel/platlib/share/"nrn"/demo/
else
    prefix="$NRNHOME"
    exec_prefix="${prefix}"
	NRNBIN="${exec_prefix}/bin/"
	NRNDEMO="${prefix}/share/"nrn"/demo/"
fi

if test "${NRNHOME_EXEC}" != "" ; then
	exec_prefix="${NRNHOME_EXEC}"
	NRNBIN="${exec_prefix}/bin/"
fi

export NRNDEMO

if [ ! -f "${NRNDEMO}neuron" ] ; then
	(cd "${NRNDEMO}release" ; "${NRNBIN}nrnivmodl" ; cd .. ; rm -f neuron ; touch neuron)
fi

if [ "ON" = "ON" ]; then
    ${NRNBIN}nrniv -dll "${NRNDEMO}release/${MODSUBDIR}/libnrnmech.so" "${NRNDEMO}demo.hoc" "$@" -
else
    "${NRNDEMO}release/${MODSUBDIR}/special" "${NRNDEMO}demo.hoc" "$@" -
fi
