<?xml version="1.0" encoding="utf-8" ?>
<odoo>
  <data>

        <!-- proceed to set all cooperator email_templates noupdate = False
        By this way no change on source nor translation made by UI will be persistent
        because any module update with i18n-overwrite will restore the original
        (xml model data and translations) email template definition. For any reason (?)
        we need to execute again this call AFTER each template record override in order
        to ensure that the noupdate change persist-->

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_waiting_list')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_confirmation')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_release_capital')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_certificate')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_share_increase')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_share_transfer')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_share_update')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_share_update_no_shares')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

    <!-- proceed to override the email_template_confirmation -->
        <record id="cooperator.email_template_confirmation" model="mail.template">
            <field name="name">Confirmation Email for CE Subscription Request Receipt</field>
            <field name="description">Sent to cooperators to confirm their subscription request</field>
            <field name="email_from">{{(object.company_id.coop_email_contact or object.company_id.email_formatted)}}</field>
            <field name="email_cc">{{((object.company_id.parent_id and object.company_id.parent_id.hierarchy_level == 'coordinator' and object.company_id.parent_id.notify_to_coord_child_ccee_submissions and (object.company_id.parent_id.coop_email_contact or object.company_id.parent_id.email_formatted)) or '')}}</field>
            <field name="subject">Application to become Community membership</field>
            <field name="email_to">{{ object.email }}{{ object.is_company and (", " + object.company_email) }}</field>
            <field name="reply_to">{{(object.company_id.coop_email_contact or object.company_id.email_formatted)}}</field>
            <field name="model_id" ref="model_subscription_request" />
            <field name="auto_delete" eval="False" />
            <field name="lang">{{(object.lang or object.company_id.default_lang_id.code or object.company_id.partner_id.lang)}}</field>
            <field name="is_cooperator_template" eval="True" />
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello <t t-out="object.firstname" />,
                    <br/><br/>
                    Thank you for filling out the form and request to join<t t-out="object.company_id.comercial_name or object.company_id.name"/><t t-if="object.is_company"> on behalf of <t t-out="object.company_name"/></t>.
                    <br/>
                    In the coming weeks we will contact you to indicate the next steps.
                    <br/><br/>
                    Here is a copy of the data we received:
                    <br/><br/>
                    <ul>
                        <li><strong>Request to join:</strong> <t t-out="object.company_id.name"/><br/></li>
                        <t t-if="object.is_company">
                            <li><strong>Company Name:</strong> <t t-out="object.company_name"/><br/></li>
                            <li><strong>Company VAT:</strong> <t t-out="object.vat"/><br/></li>
                            <li><strong>Company Email:</strong> <t t-out="object.company_email"/><br/></li>
                            <li><strong>Representative firstname:</strong> <t t-out="object.firstname"/><br/></li>
                            <li><strong>Representative lastname:</strong> <t t-out="object.lastname"/><br/></li>
                            <li><strong>Representative function:</strong> <t t-out="object.contact_person_function"/><br/></li>
                            <li><strong>Representative email:</strong> <t t-out="object.email"/><br/></li>
                            <li><strong>Representative phone:</strong> <t t-out="object.phone or ''"/><br/></li>
                            <t t-if="object.gender">
                                <li><strong>Representative gender:</strong> <t t-out="dict(object.fields_get(allfields=['gender'])['gender']['selection'])[object.gender]"/><br/></li>
                            </t>
                            <li><strong>Representative birthdate:</strong> <t t-out="object.birthdate"/><br/></li>
                        </t>
                        <t t-else="">
                            <li><strong>VAT:</strong> <t t-out="object.vat"/><br/></li>
                            <li><strong>Firstname:</strong> <t t-out="object.firstname"/><br/></li>
                            <li><strong>Lastname:</strong> <t t-out="object.lastname"/><br/></li>
                            <li><strong>Email:</strong> <t t-out="object.email"/><br/></li>
                            <li><strong>Phone:</strong> <t t-out="object.phone or ''"/><br/></li>
                            <t t-if="object.gender">
                                <li><strong>Gender:</strong> <t t-out="dict(object.fields_get(allfields=['gender'])['gender']['selection'])[object.gender]"/><br/></li>
                            </t>
                            <li><strong>Birthdate:</strong> <t t-out="object.birthdate"/><br/></li>
                        </t>
                        <li><strong>Address:</strong> <t t-out="object.address"/><br/></li>
                        <li><strong>Zip code:</strong> <t t-out="object.zip_code"/><br/></li>
                        <li><strong>City:</strong> <t t-out="object.city"/><br/></li>
                        <li><strong>Country:</strong> <t t-out="object.country_id.name"/><br/></li>
                        <li><strong>Language:</strong> <t t-out="dict(object.fields_get(allfields=['lang'])['lang']['selection'])[object.lang]"/><br/></li>
                        <li><strong>Initial share amount:</strong> <t t-out="object.subscription_amount"/><br/></li>
                        <t t-if="object.payment_mode_id.payment_method_id.code == 'sepa_direct_debit' and object.iban">
                            <li><strong>Bank account finished on:</strong> <t t-out="object.iban[-4:]"/><br/></li>
                            <li><strong>I authorize bank receipts to be sent to this account:</strong> <t t-out="object.mandate_approved and 'YES' or 'NOT'"/><br/></li>
                        </t>
                    </ul>
                    <br/>
                    We keep in touch for any questions.<br/>
                    Yours faithfully,<br/>
                    </p>
                </div>
            </field>
        </record>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_confirmation')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

    <!-- proceed to override the email_template_release_capital -->
        <record id="cooperator.email_template_release_capital" model="mail.template">
            <field name="name">Request email to Release Capital for CE</field>
            <field name="description">Sent to cooperators with their capital release request in attachment</field>
            <field name="email_from">{{(object.company_id.coop_email_contact or object.company_id.email_formatted)}}</field>
            <field name="subject">Request to release capital for Energy Community</field>
            <field name="partner_to">{{object.partner_id.id}}</field>
            <field name="reply_to">{{(object.company_id.coop_email_contact or object.company_id.email_formatted)}}</field>
            <field name="model_id" ref="account.model_account_move" />
            <field name="auto_delete" eval="False" />
            <field name="report_template" />
            <!--
            <field name="report_template" ref="action_cooperator_invoices" />
            <field name="report_name">{{(object.name or "capital_release_request").replace("/", "_")}}{{object.state == "draft" and "_draft" or ""}}</field>
             -->
            <field name="lang">{{object.partner_id.lang}}</field>
            <field name="is_cooperator_template" eval="True" />
            <field name="body_html"  type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello <t t-out="object.subscription_request.firstname" />,<br/><br/>
                    <t t-if="object.payment_mode_id.payment_method_id.code == 'sepa_direct_debit'">
                    Your request to become member of <t t-out="object.company_id.comercial_name or object.company_id.name"/> is already underway!<br/><br/>
                    We will shortly issue a bank receipt to your bank account finished on <t t-out="object.subscription_request.iban[-4:]"/> for the collection of the initial mandatory contribution (<t t-out="object.amount_total"/> €).<br/>
                    Once we have been able to process this payment, you will receive a final welcome email where we will provide you with your membership number that will link you to <t t-out="object.company_id.comercial_name or object.company_id.name"/>.<br/><br/>
                    </t>
                    <t t-else="">
                    Your request to become member of <t t-out="object.company_id.comercial_name or object.company_id.name"/> is already underway!<br/>
                    In order to complete it you must make a bank deposit of the amount indicated below:<br/><br/>
                    <ul>
                        <li><strong>Initial registration fee amount:</strong> <t t-out="object.amount_total"/> €<br/></li>
                        <li><strong>Banck account number:</strong> <t t-out="( object.company_id.bank_ids and object.company_id.bank_ids[0].acc_number ) or 'ESXX XXXX XXXX XX XXXXXXXXXX'"/><br/></li>
                        <li><strong>Receiver:</strong> <t t-out="object.company_id.name"/><br/></li>
                        <li><strong>Concept:</strong> Your first and last names<br/><br/></li>
                    </ul>
                    Once the payment is made, please send us the document proof of it by email to <t t-out="( object.company_id.coop_email_contact or object.company_id.email_formatted )"/><br/><br/>
                    </t>
                    We keep in touch for any questions.<br/>
                    Yours faithfully,<br/>
                    </p>
                </div>
            </field>
        </record>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_release_capital')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

        <!-- proceed to override the email_template_certificate -->
        <record id="cooperator.email_template_certificate" model="mail.template">
            <field name="name">Confirmation email for CE initial payment Received</field>
            <field name="description">Sent to cooperators with their cooperator certificate in attachment</field>
            <field name="email_from">{{(object.company_id.coop_email_contact or object.company_id.email_formatted)}}</field>
            <field name="subject">Wellcome to the Energy Community {{object.env.company.comercial_name or object.env.company.name}}!</field>
            <field name="partner_to">{{object.id}}</field>
            <field name="reply_to">{{(object.company_id.coop_email_contact or object.company_id.email)}}</field>
            <field name="model_id" ref="model_res_partner" />
            <field name="auto_delete" eval="False" />
            <field name="report_template" ref="cooperator.action_cooperator_report_certificate" />
            <field name="report_name" >Certificate {{ (object.cooperator_register_number or '') }}</field>
            <field name="lang">{{object.lang}}</field>
            <field name="is_cooperator_template" eval="True" />
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello
                    <t t-if="object.is_company" t-out="object.get_representative().firstname" />
                    <t t-else="" t-out="object.firstname" />,<br/><br/>
                    We welcome you to <t t-out="object.env.company.comercial_name or object.env.company.name"/>!<br/>
                    You have succesfully finished the incoming process so you are now a member of our community!<br/><br/>
                    Here you have your community member number: <strong><t t-out="(object.cooperator_register_number or 'XXX')"/></strong><br/><br/>
                    Please find in attachment your <t t-out="object.env.company.comercial_name or object.env.company.name"/> cooperator certificate.<br/><br/>
                    We keep in touch for any questions.<br/>
                    Yours faithfully,<br/>
                    </p>
                </div>
            </field>
        </record>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_certificate')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>

   <record id="cooperator.email_template_share_increase" model="mail.template">
        <field name="name">Share Increase: Payment Received Confirmation: Cooperator Certificate</field>
        <field name="description">E-mail confirmation of payment received and certified by the cooperator.</field>
        <field name="model_id" ref="model_res_partner" />
        <field name="email_from">{{ object.company_id.coop_email_contact or object.company_id.email_formatted }}</field>
        <field name="partner_to">{{ object.id }}</field>
        <field name="reply_to">{{(object.company_id.coop_email_contact or object.company_id.email)}}</field>
        <field name="subject">Payment Received Confirmation</field>
        <field name="description">Sent to cooperators in case of share increase with their cooperator certificate in attachment</field>
        <field name="report_template" ref="cooperator.action_cooperator_report_certificate" />
        <field name="report_name">Certificate {{ (object.cooperator_register_number or '') }}</field>
        <field name="lang">{{ object.lang }}</field>
        <field name="auto_delete" eval="False" />
        <field name="is_cooperator_template" eval="True" />
        <field name="body_html" type="html">
            <div style="margin: 0px; padding: 0px;">
                <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello
                    <t t-if="object.is_company" t-out="object.get_representative().firstname" />
                    <t t-else="" t-out="object.firstname" />,<br /><br />
                    We confirm the reception of your payment for the new share(s) you have taken.<br /><br />
                    Please find in attachment your <t t-out="object.env.company.comercial_name or object.env.company.name"/> cooperator certificate.<br /><br />
                We keep in touch for any questions.<br/>
                Yours faithfully,<br/>
                </p>
            </div>
        </field>
    </record>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', '=', 'cooperator'),('name', '=', 'email_template_share_increase')]"/>
            </function>
            <value eval="{'noupdate': False}" />
        </function>
  </data>
</odoo>
