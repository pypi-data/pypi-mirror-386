{%- extends "_layout_creatupdate.html" %}

{%- block itemform_fields %}
    {{ macros_form.render_form_item_default(form.name) }}
    {{ macros_form.render_form_item_radiobutton(form.source_based) }}
    {{ macros_form.render_form_item_default(form.label_en) }}
    {{ macros_form.render_form_item_default(form.label_cz) }}
    {{ macros_form.render_form_item_default(form.reference) }}

    <hr>

    {{ macros_form.render_form_item_select(form.displayed_main) }}
    {{ macros_form.render_form_item_select(form.displayed_source) }}
    {{ macros_form.render_form_item_select(form.displayed_target) }}

    <hr>

    {{ macros_form.render_form_item_ransack(form.rule) }}
    {{ macros_form.render_form_item_default(form.priority) }}
    {{ macros_form.render_form_item_select(form.severity) }}
    {{ macros_form.render_form_item_default(form.subclassing) }}

    <hr>

    {{ macros_form.render_form_item_radiobutton(form.state) }}
{%- endblock itemform_fields %}

{%- block itemform_buttons %}
    <a href="{{ referrer }}" class="btn btn-secondary">
        {{ _("Cancel") }}
    </a>
    <button id="test-button" class="btn btn-secondary" type="button">
        {{ _("Test") }}
    </button>
    {{ form.submit(class_='btn btn-primary') }}
{%- endblock itemform_buttons %}

{%- block itemform_devel %}
    {%- if filter_tree %}
        {{ macros_site.render_raw_var('raw-filter-tree', filter_tree) }}
    {%- endif %}
{%- endblock itemform_devel %}

{%- block bodyjs %}
    {{ super() }}
    <script>
        const filter_playground_url = "{{ url_for('filters.playground') }}";
    </script>
    <script>
        function test_filter() {
            const rule = document.getElementById("rule").value;
            window.open(`${filter_playground_url}?rule=${encodeURIComponent(rule)}`, '_blank');
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('test-button').addEventListener('click', test_filter);
        });
    </script>
{%- endblock bodyjs %}
