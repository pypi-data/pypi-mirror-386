{%- extends "_layout.html" %}

{%- block content %}
    <div>
        {{ macros_page.render_breadcrumbs(item) }}

        <h3>
            {{ item.name }}
        </h3>
        <div class="float-end">
            {{ macros_page.render_menu_actions(item) }}
        </div>
        <p>
            <small>
                <strong>{{ _("Event class created") }}:</strong>
                {{ babel_format_datetime(item.createtime) }}
                ({{ _('%(delta)s ago', delta = babel_format_timedelta(current_datetime_utc - item.createtime)) }})
            </small>
        </p>

        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-0" role="tablist">
            <li role="presentation" class="nav-item">
                <a href="#tab-general"
                   aria-controls="tab-general"
                   role="tab"
                   data-bs-toggle="tab"
                   class="nav-link active">
                    <strong>{{ get_icon("alert-info") }} {{ _("General information") }}</strong>
                </a>
            </li>
            <li role="presentation" class="nav-item">
                <a href="#tab-changelog"
                   aria-controls="tab-changelog"
                   role="tab"
                   data-bs-toggle="tab"
                   class="nav-link">
                    <strong>{{ get_icon("module-changelogs") }} {{ _("Changelogs") }}</strong>
                    <span class="badge rounded-pill text-bg-secondary">
                        {{ item_changelog | length }}
                    </span>
                </a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in show active" id="tab-general">
                <table class="table table-striped align-middle">
                    <tbody>
                        <tr>
                            <th>
                                {{ _("Name") }}:
                            </th>
                            <td>
                                {{ item.name | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Type") }}:
                            </th>
                            <td>
                                {{ _(item.get_type()) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Label in English") }}:
                            </th>
                            <td>
                                {{ item.label_en | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Label in Czech") }}:
                            </th>
                            <td>
                                {{ item.label_cz | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Reference") }}:
                            </th>
                            <td>
                                {% if item.reference %}
                                    {{ macros_site.ref_to_html_link(item.reference) }}
                                {% else %}
                                    {{ get_icon("unassigned") }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Displayed main fields") }}:
                            </th>
                            <td>
                                {{ ", ".join(item.displayed_main) or get_icon('unassigned')  }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Displayed source fields") }}:
                            </th>
                            <td>
                                {{ ", ".join(item.displayed_source) or get_icon('unassigned')  }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Displayed target fields") }}:
                            </th>
                            <td>
                                {{ ", ".join(item.displayed_target) or get_icon('unassigned') }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Rule") }}:
                            </th>
                            <td>
                                <code>{{ item.rule | default(_('<< unknown >>'), True) }}</code>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Priority") }}:
                            </th>
                            <td>
                                {{ item.priority | default("0", True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Severity") }}:
                            </th>
                            <td>
                                {{ macros_site.render_report_label_severity(item, True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Subclassing") }}:
                            </th>
                            <td>
                                {% if item.subclassing %}
                                    <code>{{ item.subclassing }}</code>
                                {% else %}
                                    {{ get_icon("unassigned") }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("State") }}:
                            </th>
                            <td>
                                {{ macros_site.render_label_item_state(item.state, True) }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div role="tabpanel" class="tab-pane fade" id="tab-changelog">
                {%- if item_changelog %}
                    {{ macros_page.render_changelog_records(item_changelog, context_action_menu_changelogs) }}
                    <p>
                        <small>
                            {{ _('Displaying only latest %(count)s changelogs', count = 100) }}
                        </small>
                    </p>
                {%- else %}
                    {%- call macros_site.render_alert('info', False) %}
                        {{ _("This object does not have any changelog records at the moment.") }}
                    {%- endcall %}
                {%- endif %}
            </div>
        </div>
    </div>

    {%- if permission_can('developer') %}
        <hr>
        {{ macros_site.render_raw_item_view(item) }}
        {{ macros_site.render_raw_var('filter_tree', filter_tree) }}
    {%- endif %}
{%- endblock content %}
