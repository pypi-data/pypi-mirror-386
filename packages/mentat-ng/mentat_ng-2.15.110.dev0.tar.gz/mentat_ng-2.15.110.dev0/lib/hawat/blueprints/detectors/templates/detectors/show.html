{%- extends "_layout.html" %}

{%- block content %}
    <div>
        {{ macros_page.render_breadcrumbs(item) }}

        <h3>
            {{ item.name }}
        </h3>
        <div class="float-end">
            {{ macros_page.render_menu_actions(item) }}
        </div>
        <p>
            <small>
                <strong>{{ _("Detector created") }}:</strong>
                {{ babel_format_datetime(item.createtime) }}
                ({{ _('%(delta)s ago', delta = babel_format_timedelta(current_datetime_utc - item.createtime)) }})
            </small>
        </p>

        <!-- Nav tabs -->
        <ul class="nav nav-tabs mb-0" role="tablist">
            <li role="presentation" class="nav-item">
                <a href="#tab-general"
                   aria-controls="tab-general"
                   role="tab"
                   data-bs-toggle="tab"
                   class="nav-link active">
                    <strong>{{ get_icon("alert-info") }} {{ _("General information") }}</strong>
                </a>
            </li>
            {%- if can_access_endpoint('detectors.update', item) %}
                <li role="presentation" class="nav-item">
                    <a href="#tab-changelog"
                       aria-controls="tab-changelog"
                       role="tab"
                       data-bs-toggle="tab"
                       class="nav-link">
                        <strong>{{ get_icon("module-changelogs") }} {{ _("Changelogs") }}</strong>
                        <span class="badge rounded-pill  text-bg-secondary">
                            {{ item_changelog | length }}
                        </span>
                    </a>
                </li>
            {%- endif %}
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in show active" id="tab-general">
                <table class="table table-striped">
                    <tbody>
                        <tr>
                            <th>
                                {{ _("Name") }}:
                            </th>
                            <td>
                                {{ item.name | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Source") }}:
                            </th>
                            <td>
                                {{ item.source | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Description") }}:
                            </th>
                            <td>
                                {{ item.description | default(_('<< unknown >>'), True) }}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Warden registration date") }}:
                            </th>
                            <td>
                                {%- if item.registered -%}
                                    {{ babel_format_datetime(item.registered) }}
                                {%- else -%}
                                    {{ _('<< unknown >>') }}
                                {%- endif -%}
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Hits") }}:
                            </th>
                            <td>
                                <span class="badge rounded-pill  text-bg-secondary">{{ item.hits }}</span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                {{ _("Credibility") }}:
                            </th>
                            <td>
                                {{ item.credibility }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {%- if can_access_endpoint('detectors.update', item) %}
                <div role="tabpanel" class="tab-pane fade" id="tab-changelog">
                    <br>
                    {%- if item_changelog %}
                        {{ macros_page.render_changelog_records(item_changelog, context_action_menu_changelogs) }}
                        <p>
                            <small>
                                {{ _('Displaying only latest %(count)s changelogs', count = 100) }}
                            </small>
                        </p>
                    {%- else %}
                        {%- call macros_site.render_alert('info', False) %}
                            {{ _("This object does not have any changelog records at the moment.") }}
                        {%- endcall %}
                    {%- endif %}
                </div>
            {%- endif %}
        </div>
    </div>

    {%- if permission_can('developer') %}
        <hr>
        {{ macros_site.render_raw_item_view(item) }}
    {%- endif %}
{%- endblock content %}
