const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Index-DUJr_fmc.js","./init-5dmMBTcc.js","./init-Bx_S9_FC.css","./StreamingBar-Co5WtsWH.js","./FullscreenButton-pJVgMiya.js","./MarkdownCode-CJL7VgM9.js","./prism-python-DspNkBda.js","./MarkdownCode-CcElFC5s.css","./FullscreenButton-BYduS5IX.css","./StreamingBar-Dq7cCzkm.css","./Index-BkyjjaNE.css","./index-CBjracNG.js"])))=>i.map(i=>d[i]);
import*as re from"./svelte/svelte.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const Ze="modulepreload",Ye=function(t,s){return new URL(t,s).href},Ee={},K=function(s,e,n){let r=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=Promise.allSettled(e.map(u=>{if(u=Ye(u,n),u in Ee)return;Ee[u]=!0;const p=u.endsWith(".css"),c=p?'[rel="stylesheet"]':"";if(!!n)for(let h=o.length-1;h>=0;h--){const v=o[h];if(v.href===u&&(!p||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${c}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":Ze,p||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),p)return new Promise((h,v)=>{g.addEventListener("load",h),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return s().catch(i)})},Qe="host",Le="queue/data",Xe="queue/join",Se="upload",et="login",V="config",tt="info",st="runtime",nt="sleeptime",it="heartbeat",rt="component_server",ot="reset",at="cancel",ct="app_id",Ne="This application is currently busy. Please try again. ",M="Connection errored out. ",L="Could not resolve app config. ",lt="Could not get space status. ",ut="Could not get API info. ",he="Space metadata could not be loaded. ",pt="Invalid URL. A full URL path is required.",ht="Not authorized to access this space. ",Pe="Invalid credentials. Could not login. ",dt="Login credentials are required to access this space.",ft="File system access is only available in Node.js environments",De="Root URL not found in client config",_t="Error uploading file";async function $e(t,s,e){try{return(await(await fetch(`https://huggingface.co/api/spaces/${t}/jwt`,{headers:{Authorization:`Bearer ${s}`,...e?{Cookie:e}:{}}})).json()).token||!1}catch{return!1}}function mt(t){let s={};return t.forEach(({api_name:e,id:n})=>{e&&(s[e]=n)}),s}async function gt(t){const s=this.options.token?{Authorization:`Bearer ${this.options.token}`}:{};if(s["Content-Type"]="application/json",typeof window<"u"&&window.gradio_config&&location.origin!=="http://localhost:9876"){if(window.gradio_config.current_page&&(t=t.substring(0,t.lastIndexOf("/"))),window.gradio_config.dev_mode){let e=ae(t,this.deep_link?V+"?deep_link="+this.deep_link:V);const n=await this.fetch(e,{headers:s,credentials:"include"}),r=await ke(n,t,!!this.options.auth);window.gradio_config={...r,current_page:window.gradio_config.current_page}}return window.gradio_config.root=t,{...window.gradio_config}}else if(t){let e=ae(t,this.deep_link?V+"?deep_link="+this.deep_link:V);const n=await this.fetch(e,{headers:s,credentials:"include"});return ke(n,t,!!this.options.auth)}throw new Error(L)}async function ke(t,s,e){if(t?.status===401&&!e){const r=(await t.json())?.detail?.auth_message;throw new Error(r||dt)}else if(t?.status===401&&e)throw new Error(Pe);if(t?.status===200){let n=await t.json();return n.root=s,n.dependencies?.forEach((r,i)=>{r.id===void 0&&(r.id=i)}),n}else if(t?.status===401)throw new Error(ht);throw new Error(L)}async function wt(){const{http_protocol:t,host:s}=await fe(this.app_reference,this.options.token);try{if(this.options.auth){const e=await xe(t,s,this.options.auth,this.fetch,this.options.token);e&&this.set_cookies(e)}}catch(e){throw Error(e.message)}}async function xe(t,s,e,n,r){const i=new FormData;i.append("username",e?.[0]),i.append("password",e?.[1]);let o={};r&&(o.Authorization=`Bearer ${r}`);const a=await n(`${t}//${s}/${et}`,{headers:o,method:"POST",body:i,credentials:"include"});if(a.status===200)return a.headers.get("set-cookie");throw a.status===401?new Error(Pe):new Error(he)}function oe(t){if(t.startsWith("http")){const{protocol:s,host:e,pathname:n}=new URL(t);return{ws_protocol:s==="https:"?"wss":"ws",http_protocol:s,host:e+(n!=="/"?n:"")}}return{ws_protocol:"wss",http_protocol:"https:",host:new URL(t).host}}const Ie=t=>{let s=[];return t.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach(n=>{const[r,i]=n.split(";")[0].split("=");r&&i&&s.push(`${r.trim()}=${i.trim()}`)}),s},de=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,yt=/.*hf\.space\/{0,1}.*$/;async function fe(t,s){const e={};s&&(e.Authorization=`Bearer ${s}`);const n=t.trim().replace(/\/$/,"");if(de.test(n))try{const i=(await(await fetch(`https://huggingface.co/api/spaces/${n}/${Qe}`,{headers:e})).json()).host;return{space_id:t,...oe(i)}}catch{throw new Error(he)}if(yt.test(n)){const{ws_protocol:r,http_protocol:i,host:o}=oe(n);return{space_id:o.split("/")[0].replace(".hf.space",""),ws_protocol:r,http_protocol:i,host:o}}return{space_id:!1,...oe(n)}}const ae=(...t)=>{try{return t.reduce((s,e)=>(s=s.replace(/\/+$/,""),e=e.replace(/^\/+/,""),new URL(e,s+"/").toString()))}catch{throw new Error(pt)}};function bt(t,s,e){const n={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(t).forEach(r=>{(r==="named_endpoints"||r==="unnamed_endpoints")&&(n[r]={},Object.entries(t[r]).forEach(([i,{parameters:o,returns:a}])=>{const l=s.dependencies.find(c=>c.api_name===i||c.api_name===i.replace("/",""))?.id||e[i.replace("/","")]||-1,u=l!==-1?s.dependencies.find(c=>c.id==l)?.types:{generator:!1,cancel:!1};if(l!==-1&&s.dependencies.find(c=>c.id==l)?.inputs?.length!==o.length){const c=s.dependencies.find(f=>f.id==l).inputs.map(f=>s.components.find(g=>g.id===f)?.type);try{c.forEach((f,g)=>{if(f==="state"){const h={component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0};o.splice(g,0,h)}})}catch(f){console.error(f)}}const p=(c,f,g,h)=>({...c,description:Et(c?.type,g),type:vt(c?.type,f,g,h)||""});n[r][i]={parameters:o.map(c=>p(c,c?.component,c?.serializer,"parameter")),returns:a.map(c=>p(c,c?.component,c?.serializer,"return")),type:u}}))}),n}function vt(t,s,e,n){if(s==="Api")return t.type;switch(t?.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}if(e==="JSONSerializable"||e==="StringSerializable")return"any";if(e==="ListStringSerializable")return"string[]";if(s==="Image")return n==="parameter"?"Blob | File | Buffer":"string";if(e==="FileSerializable")return t?.type==="array"?n==="parameter"?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":n==="parameter"?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}";if(e==="GallerySerializable")return n==="parameter"?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]"}function Et(t,s){return s==="GallerySerializable"?"array of [file, label] tuples":s==="ListStringSerializable"?"array of strings":s==="FileSerializable"?"array of files or single file":t?.description}function Re(t,s){switch(t.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:!0,message:Ne,stage:"error",code:t.code,success:t.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:!0,message:t.message,session_not_found:t.session_not_found,stage:"error",success:!1}};case"broken_connection":return{type:"broken_connection",status:{queue:!0,message:t.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:!0,stage:s||"pending",code:t.code,size:t.queue_size,position:t.rank,eta:t.rank_eta,success:t.success}};case"progress":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,progress_data:t.progress_data,success:t.success}};case"log":return{type:"log",data:t};case"process_generating":return{type:"generating",status:{queue:!0,message:t.success?null:t.output.error,stage:t.success?"generating":"error",code:t.code,progress_data:t.progress_data,eta:t.average_duration,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_streaming":return{type:"streaming",status:{queue:!0,message:t.output.error,stage:"streaming",time_limit:t.time_limit,code:t.code,progress_data:t.progress_data,eta:t.eta},data:t.output};case"process_completed":return"error"in t.output?{type:"update",status:{queue:!0,title:t.output.title,message:t.output.error,visible:t.output.visible,duration:t.output.duration,stage:"error",code:t.code,success:t.success}}:{type:"complete",status:{queue:!0,message:t.success?void 0:t.output.error,stage:t.success?"complete":"error",code:t.code,progress_data:t.progress_data,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_starts":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,size:t.rank,position:0,success:t.success,eta:t.eta},original_msg:"process_starts"}}return{type:"none",status:{stage:"error",queue:!0}}}const St=(t=[],s)=>{const e=s?s.parameters:[];if(Array.isArray(t))return s&&e.length>0&&t.length>e.length&&console.warn("Too many arguments provided for the endpoint."),t;const n=[],r=Object.keys(t);return e.forEach((i,o)=>{if(t.hasOwnProperty(i.parameter_name))n[o]=t[i.parameter_name];else if(i.parameter_has_default)n[o]=i.parameter_default;else throw new Error(`No value provided for required parameter: ${i.parameter_name}`)}),r.forEach(i=>{if(!e.some(o=>o.parameter_name===i))throw new Error(`Parameter \`${i}\` is not a valid keyword argument. Please refer to the API for usage.`)}),n.forEach((i,o)=>{if(i===void 0&&!e[o].parameter_has_default)throw new Error(`No value provided for required parameter: ${e[o].parameter_name}`)}),n};async function $t(){if(this.api_info)return this.api_info;const{token:t}=this.options,{config:s}=this,e={"Content-Type":"application/json"};if(t&&(e.Authorization=`Bearer ${t}`),!!s)try{let n,r;if(typeof window<"u"&&window.gradio_api_info)r=window.gradio_api_info;else{const i=ae(s.root,this.api_prefix,tt);if(n=await this.fetch(i,{headers:e,credentials:"include"}),!n.ok)throw new Error(M);r=await n.json()}return"api"in r&&(r=r.api),r.named_endpoints["/predict"]&&!r.unnamed_endpoints[0]&&(r.unnamed_endpoints[0]=r.named_endpoints["/predict"]),bt(r,s,this.api_map)}catch(n){throw new Error("Could not get API info. "+n.message)}}async function kt(t,s,e){const n={};this?.options?.token&&(n.Authorization=`Bearer ${this.options.token}`);const r=1e3,i=[];let o;for(let a=0;a<s.length;a+=r){const l=s.slice(a,a+r),u=new FormData;l.forEach(c=>{u.append("files",c)});try{const c=e?`${t}${this.api_prefix}/${Se}?upload_id=${e}`:`${t}${this.api_prefix}/${Se}`;o=await this.fetch(c,{method:"POST",body:u,headers:n,credentials:"include"})}catch(c){throw new Error(M+c.message)}if(!o.ok){const c=await o.text();return{error:`HTTP ${o.status}: ${c}`}}const p=await o.json();p&&i.push(...p)}return{files:i}}async function Rt(t,s,e,n){let r=(Array.isArray(t)?t:[t]).map(o=>o.blob);const i=r.filter(o=>o.size>(n??1/0));if(i.length)throw new Error(`File size exceeds the maximum allowed size of ${n} bytes: ${i.map(o=>o.name).join(", ")}`);return await Promise.all(await this.upload_files(s,r,e).then(async o=>{if(o.error)throw new Error(o.error);return o.files?o.files.map((a,l)=>new Y({...t[l],path:a,url:`${s}${this.api_prefix}/file=${a}`})):[]}))}async function ns(t,s){return t.map(e=>new Y({path:e.name,orig_name:e.name,blob:e,size:e.size,mime_type:e.type,is_stream:s}))}class Y{path;url;orig_name;size;blob;is_stream;mime_type;alt_text;b64;meta={_type:"gradio.FileData"};constructor({path:s,url:e,orig_name:n,size:r,blob:i,is_stream:o,mime_type:a,alt_text:l,b64:u}){this.path=s,this.url=e,this.orig_name=n,this.size=r,this.blob=e?void 0:i,this.is_stream=o,this.mime_type=a,this.alt_text=l,this.b64=u}}class At{type;command;meta;fileData;constructor(s,e){this.type="command",this.command=s,this.meta=e}}typeof process<"u"&&process.versions&&process.versions.node;function Ae(t,s,e){for(;e.length>1;){const r=e.shift();if(typeof r=="string"||typeof r=="number")t=t[r];else throw new Error("Invalid key type")}const n=e.shift();if(typeof n=="string"||typeof n=="number")t[n]=s;else throw new Error("Invalid key type")}async function ce(t,s=void 0,e=[],n=!1,r=void 0){if(Array.isArray(t)){let i=[];return await Promise.all(t.map(async(o,a)=>{let l=e.slice();l.push(String(a));const u=await ce(t[a],n?r?.parameters[a]?.component||void 0:s,l,!1,r);i=i.concat(u)})),i}else{if(globalThis.Buffer&&t instanceof globalThis.Buffer||t instanceof Blob)return[{path:e,blob:new Blob([t]),type:s}];if(typeof t=="object"&&t!==null){let i=[];for(const o of Object.keys(t)){const a=[...e,o],l=t[o];i=i.concat(await ce(l,void 0,a,!1,r))}return i}}return[]}function Ot(t,s){let e=s?.dependencies?.find(n=>n.id==t)?.queue;return e!=null?!e:!s.enable_queue}function Ct(t,s){return new Promise((e,n)=>{const r=new MessageChannel;r.port1.onmessage=({data:i})=>{r.port1.close(),e(i)},window.parent.postMessage(t,s,[r.port2])})}function W(t,s,e,n,r=!1){if(n==="input"&&!r)throw new Error("Invalid code path. Cannot skip state inputs for input.");if(n==="output"&&r)return t;let i=[],o=0;const a=n==="input"?s.inputs:s.outputs;for(let l=0;l<a.length;l++){const u=a[l];if(e.find(c=>c.id===u)?.type==="state"){if(r)if(t.length===a.length){const c=t[o];i.push(c),o++}else i.push(null);else{o++;continue}continue}else{const c=t[o];i.push(c),o++}}return i}async function Tt(t,s,e){const n=this;await Lt(n,s);const r=await ce(s,void 0,[],!0,e);return(await Promise.all(r.map(async({path:o,blob:a,type:l})=>{if(!a)return{path:o,type:l};const u=await n.upload_files(t,[a]),p=u.files&&u.files[0];return{path:o,file_url:p,type:l,name:typeof File<"u"&&a instanceof File?a?.name:void 0}}))).forEach(({path:o,file_url:a,type:l,name:u})=>{if(l==="Gallery")Ae(s,a,o);else if(a){const p=new Y({path:a,orig_name:u});Ae(s,p,o)}}),s}async function Lt(t,s){if(!(t.config?.root||t.config?.root_url))throw new Error(De);await Ue(t,s)}async function Ue(t,s,e=[]){for(const n in s)s[n]instanceof At?await Nt(t,s,n):typeof s[n]=="object"&&s[n]!==null&&await Ue(t,s[n],[...e,n])}async function Nt(t,s,e){let n=s[e];const r=t.config?.root||t.config?.root_url;if(!r)throw new Error(De);try{let i,o;if(typeof process<"u"&&process.versions&&process.versions.node){const p=await K(()=>import("./__vite-browser-external-D7Ct-6yo.js").then(f=>f._),[],import.meta.url);o=(await K(()=>import("./__vite-browser-external-D7Ct-6yo.js").then(f=>f._),[],import.meta.url)).resolve(process.cwd(),n.meta.path),i=await p.readFile(o)}else throw new Error(ft);const a=new Blob([i],{type:"application/octet-stream"}),l=await t.upload_files(r,[a]),u=l.files&&l.files[0];if(u){const p=new Y({path:u,orig_name:n.meta.name||""});s[e]=p}}catch(i){console.error(_t,i)}}async function Pt(t,s,e){const n={"Content-Type":"application/json"};this.options.token&&(n.Authorization=`Bearer ${this.options.token}`);try{var r=await this.fetch(t,{method:"POST",body:JSON.stringify(s),headers:{...n,...e},credentials:"include"})}catch{return[{error:M},500]}let i,o;try{i=await r.json(),o=r.status}catch(a){i={error:`Could not parse server response: ${a}`},o=500}return[i,o]}async function Dt(t,s={}){let e=!1,n=!1;if(!this.config)throw new Error("Could not resolve app config");if(typeof t=="number")this.config.dependencies.find(r=>r.id==t);else{const r=t.replace(/^\//,"");this.config.dependencies.find(i=>i.id==this.api_map[r])}return new Promise(async(r,i)=>{const o=this.submit(t,s,null,null,!0);let a;for await(const l of o)l.type==="data"&&(n&&r(a),e=!0,a=l),l.type==="status"&&(l.stage==="error"&&i(l),l.stage==="complete"&&(n=!0,e&&r(a)))})}async function F(t,s,e){let n=s==="subdomain"?`https://huggingface.co/api/spaces/by-subdomain/${t}`:`https://huggingface.co/api/spaces/${t}`,r,i;try{if(r=await fetch(n),i=r.status,i!==200)throw new Error;r=await r.json()}catch{e({status:"error",load_status:"error",message:lt,detail:"NOT_FOUND"});return}if(!r||i!==200)return;const{runtime:{stage:o},id:a}=r;switch(o){case"STOPPED":case"SLEEPING":e({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:o}),setTimeout(()=>{F(t,s,e)},1e3);break;case"PAUSED":e({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:o,discussions_enabled:await Oe(a)});break;case"RUNNING":case"RUNNING_BUILDING":e({status:"running",load_status:"complete",message:"Space is running.",detail:o});break;case"BUILDING":e({status:"building",load_status:"pending",message:"Space is building...",detail:o}),setTimeout(()=>{F(t,s,e)},1e3);break;case"APP_STARTING":e({status:"starting",load_status:"pending",message:"Space is starting...",detail:o}),setTimeout(()=>{F(t,s,e)},1e3);break;default:e({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:o,discussions_enabled:await Oe(a)});break}}const qe=async(t,s)=>{let e=0;const n=12,r=5e3;return new Promise(i=>{F(t,de.test(t)?"space_name":"subdomain",o=>{s(o),o.status==="running"||o.status==="error"||o.status==="paused"||o.status==="space_error"?i():(o.status==="sleeping"||o.status==="building")&&(e<n?(e++,setTimeout(()=>{qe(t,s).then(i)},r)):i())})})},xt=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function Oe(t){try{const s=await fetch(`https://huggingface.co/api/spaces/${t}/discussions`,{method:"HEAD"}),e=s.headers.get("x-error-message");return!(!s.ok||e&&xt.test(e))}catch{return!1}}async function It(t,s){const e={};s&&(e.Authorization=`Bearer ${s}`);try{const n=await fetch(`https://huggingface.co/api/spaces/${t}/${st}`,{headers:e});if(n.status!==200)throw new Error("Space hardware could not be obtained.");const{hardware:r}=await n.json();return r.current}catch(n){throw new Error(n.message)}}async function Ut(t,s,e){const n={};e&&(n.Authorization=`Bearer ${e}`);const r={seconds:s};try{const i=await fetch(`https://huggingface.co/api/spaces/${t}/${nt}`,{method:"POST",headers:{"Content-Type":"application/json",...n},body:JSON.stringify(r)});if(i.status!==200)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await i.json()}catch(i){throw new Error(i.message)}}const Ce=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function qt(t,s){const{token:e,private:n,hardware:r,timeout:i,auth:o}=s;if(r&&!Ce.includes(r))throw new Error(`Invalid hardware type provided. Valid types are: ${Ce.map(y=>`"${y}"`).join(",")}.`);const{http_protocol:a,host:l}=await fe(t,e);let u=null;if(o){const y=await xe(a,l,o,fetch);y&&(u=Ie(y))}const p={Authorization:`Bearer ${e}`,"Content-Type":"application/json",...u?{Cookie:u.join("; ")}:{}},c=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:p})).json()).name,f=t.split("/")[1],g={repository:`${c}/${f}`};n&&(g.private=!0);let h;try{r||(h=await It(t,e))}catch(y){throw Error(he+y.message)}const v=r||h||"cpu-basic";g.hardware=v;try{const y=await fetch(`https://huggingface.co/api/spaces/${t}/duplicate`,{method:"POST",headers:p,body:JSON.stringify(g)});if(y.status===409)try{return await Z.connect(`${c}/${f}`,s)}catch(N){throw console.error("Failed to connect Client instance:",N),N}else if(y.status!==200)throw new Error(y.statusText);const Q=await y.json();return await Ut(`${c}/${f}`,i||300,e),await Z.connect(jt(Q.url),s)}catch(y){throw new Error(y)}}function jt(t){const s=/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/,e=t.match(s);if(e)return e[1]}class zt extends TransformStream{#e="";constructor(s={allowCR:!1}){super({transform:(e,n)=>{for(e=this.#e+e;;){const r=e.indexOf(`
`),i=s.allowCR?e.indexOf("\r"):-1;if(i!==-1&&i!==e.length-1&&(r===-1||r-1>i)){n.enqueue(e.slice(0,i)),e=e.slice(i+1);continue}if(r===-1)break;const o=e[r-1]==="\r"?r-1:r;n.enqueue(e.slice(0,o)),e=e.slice(r+1)}this.#e=e},flush:e=>{if(this.#e==="")return;const n=s.allowCR&&this.#e.endsWith("\r")?this.#e.slice(0,-1):this.#e;e.enqueue(n)}})}}function Bt(t){let s=new TextDecoderStream,e=new zt({allowCR:!0});return t.pipeThrough(s).pipeThrough(e)}function Ft(t){let e=/[:]\s*/.exec(t),n=e&&e.index;if(n)return[t.substring(0,n),t.substring(n+e[0].length)]}function Te(t,s,e){t.get(s)||t.set(s,e)}async function*Mt(t,s){if(!t.body)return;let e=Bt(t.body),n,r=e.getReader(),i;for(;;){if(s&&s.aborted)return r.cancel();if(n=await r.read(),n.done)return;if(!n.value){i&&(yield i),i=void 0;continue}let[o,a]=Ft(n.value)||[];o&&(o==="data"?(i||={},i[o]=i[o]?i[o]+`
`+a:a):o==="event"?(i||={},i[o]=a):o==="id"?(i||={},i[o]=+a||a):o==="retry"&&(i||={},i[o]=+a||void 0))}}async function Gt(t,s){let e=new Request(t,s);Te(e.headers,"Accept","text/event-stream"),Te(e.headers,"Content-Type","application/json");let n=await fetch(e);if(!n.ok)throw n;return Mt(n,e.signal)}async function Jt(){let{event_callbacks:t,unclosed_events:s,pending_stream_messages:e,stream_status:n,config:r,jwt:i}=this;const o=this;if(!r)throw new Error("Could not resolve app config");n.open=!0;let a=null,l=new URLSearchParams({session_hash:this.session_hash}).toString(),u=new URL(`${r.root}${this.api_prefix}/${Le}?${l}`);if(i&&u.searchParams.set("__sign",i),a=this.stream(u),!a){console.warn("Cannot connect to SSE endpoint: "+u.toString());return}a.onmessage=async function(p){let c=JSON.parse(p.data);if(c.msg==="close_stream"){_e(n,o.abort_controller);return}const f=c.event_id;if(!f)await Promise.all(Object.keys(t).map(g=>t[g](c)));else if(t[f]&&r){c.msg==="process_completed"&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(r.protocol)&&s.delete(f);let g=t[f];typeof window<"u"&&typeof document<"u"?setTimeout(g,0,c):g(c)}else e[f]||(e[f]=[]),e[f].push(c)},a.onerror=async function(p){console.error(p),await Promise.all(Object.keys(t).map(c=>t[c]({msg:"broken_connection",message:M})))}}function _e(t,s){t&&(t.open=!1,s?.abort())}function Ht(t,s,e){!t[s]?(t[s]=[],e.data.forEach((r,i)=>{t[s][i]=r})):e.data.forEach((r,i)=>{let o=Vt(t[s][i],r);t[s][i]=o,e.data[i]=o})}function Vt(t,s){return s.forEach(([e,n,r])=>{t=Wt(t,n,e,r)}),t}function Wt(t,s,e,n){if(s.length===0){if(e==="replace")return n;if(e==="append")return t+n;throw new Error(`Unsupported action: ${e}`)}let r=t;for(let o=0;o<s.length-1;o++)r=r[s[o]];const i=s[s.length-1];switch(e){case"replace":r[i]=n;break;case"append":r[i]+=n;break;case"add":Array.isArray(r)?r.splice(Number(i),0,n):r[i]=n;break;case"delete":Array.isArray(r)?r.splice(Number(i),1):delete r[i];break;default:throw new Error(`Unknown action: ${e}`)}return t}function Kt(t,s={}){const e={close:()=>{console.warn("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:t.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:()=>{throw new Error("Method not implemented.")},dispatchEvent:()=>{throw new Error("Method not implemented.")},removeEventListener:()=>{throw new Error("Method not implemented.")}};return Gt(t,s).then(async n=>{e.readyState=e.OPEN;try{for await(const r of n)e.onmessage&&e.onmessage(r);e.readyState=e.CLOSED}catch(r){e.onerror&&e.onerror(r),e.readyState=e.CLOSED}}).catch(n=>{console.error(n),e.onerror&&e.onerror(n),e.readyState=e.CLOSED}),e}function Zt(t,s={},e,n,r){try{let i=function(_){(r||Ge[_.type])&&u(_)},o=function(){for(Ve=!0;z.length>0;)z.shift()({value:void 0,done:!0})},a=function(_){z.length>0?z.shift()(_):ne.push(_)},l=function(_){a(Yt(_)),o()},u=function(_){a({value:_,done:!1})},p=function(){return ne.length>0?Promise.resolve(ne.shift()):new Promise(_=>z.push(_))};const{token:c}=this.options,{fetch:f,app_reference:g,config:h,session_hash:v,api_info:y,api_map:Q,stream_status:N,pending_stream_messages:X,pending_diff_streams:ee,event_callbacks:te,unclosed_events:ze,post_data:se,options:G,api_prefix:x}=this,Be=this;if(!y)throw new Error("No API found");if(!h)throw new Error("Could not resolve app config");let{fn_index:d,endpoint_info:me,dependency:q}=Qt(y,t,Q,h),Fe=St(s,me),I,A=h.protocol??"ws";if(A==="ws")throw new Error("WebSocket protocol is not supported in this version");let ge="",Me=()=>ge;const m=typeof t=="number"?"/predict":t;let J,b=null,O=!1,we={},j=typeof window<"u"&&typeof document<"u"?new URLSearchParams(window.location.search).toString():"";const Ge=G?.events?.reduce((_,R)=>(_[R]=!0,_),{})||{};async function Je(){let _={},R={};_={event_id:b},R={event_id:b,session_hash:v,fn_index:d};try{if(!h)throw new Error("Could not resolve app config");"event_id"in R&&await f(`${h.root}${x}/${at}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(R)}),await f(`${h.root}${x}/${ot}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(_)})}catch{console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}const He=async _=>{await this._resolve_heartbeat(_)};async function ye(_){if(!h)return;let R=_.render_id;h.components=[...h.components.filter(E=>E.props.rendered_in!==R),..._.components],h.dependencies=[...h.dependencies.filter(E=>E.rendered_in!==R),..._.dependencies];const H=h.components.some(E=>E.type==="state"),w=h.dependencies.some(E=>E.targets.some(P=>P[1]==="unload"));h.connect_heartbeat=H||w,await He(h),i({type:"render",data:_,endpoint:m,fn_index:d})}this.handle_blob(h.root,Fe,me).then(async _=>{if(J={data:W(_,q,h.components,"input",!0)||[],event_data:e,fn_index:d,trigger_id:n},Ot(d,h))i({type:"status",endpoint:m,stage:"pending",queue:!1,fn_index:d,time:new Date}),se(`${h.root}${x}/run${m.startsWith("/")?m:`/${m}`}${j?"?"+j:""}`,{...J,session_hash:v}).then(([w,E])=>{const P=w.data;E==200?(i({type:"data",endpoint:m,fn_index:d,data:W(P,q,h.components,"output",G.with_null_state),time:new Date,event_data:e,trigger_id:n}),w.render_config&&ye(w.render_config),i({type:"status",endpoint:m,fn_index:d,stage:"complete",eta:w.average_duration,queue:!1,time:new Date})):i({type:"status",stage:"error",endpoint:m,fn_index:d,message:w.error,queue:!1,time:new Date})}).catch(w=>{i({type:"status",stage:"error",message:w.message,endpoint:m,fn_index:d,queue:!1,time:new Date})});else if(A=="sse"){i({type:"status",stage:"pending",queue:!0,endpoint:m,fn_index:d,time:new Date});var H=new URLSearchParams({fn_index:d.toString(),session_hash:v}).toString();let w=new URL(`${h.root}${x}/${Le}?${j?j+"&":""}${H}`);if(this.jwt&&w.searchParams.set("__sign",this.jwt),I=this.stream(w),!I)return Promise.reject(new Error("Cannot connect to SSE endpoint: "+w.toString()));I.onmessage=async function(E){const P=JSON.parse(E.data),{type:D,status:C,data:T}=Re(P,we[d]);if(D==="update"&&C&&!O)i({type:"status",endpoint:m,fn_index:d,time:new Date,...C}),C.stage==="error"&&(I?.close(),o());else if(D==="data"){let[U,B]=await se(`${h.root}${x}/queue/data`,{...J,session_hash:v,event_id:b});B!==200&&(i({type:"status",stage:"error",message:M,queue:!0,endpoint:m,fn_index:d,time:new Date}),I?.close(),o())}else D==="complete"?O=C:D==="log"?i({type:"log",title:T.title,log:T.log,level:T.level,endpoint:m,duration:T.duration,visible:T.visible,fn_index:d}):(D==="generating"||D==="streaming")&&i({type:"status",time:new Date,...C,stage:C?.stage,queue:!0,endpoint:m,fn_index:d});T&&(i({type:"data",time:new Date,data:W(T.data,q,h.components,"output",G.with_null_state),endpoint:m,fn_index:d,event_data:e,trigger_id:n}),O&&(i({type:"status",time:new Date,...O,stage:C?.stage,queue:!0,endpoint:m,fn_index:d}),I?.close(),o()))}}else if(A=="sse_v1"||A=="sse_v2"||A=="sse_v2.1"||A=="sse_v3"){i({type:"status",stage:"pending",queue:!0,endpoint:m,fn_index:d,time:new Date});let w="";typeof window<"u"&&typeof document<"u"&&(w=window?.location?.hostname);const P=w.includes(".dev.")?`https://moon-${w.split(".")[1]}.dev.spaces.huggingface.tech`:"https://huggingface.co";(typeof window<"u"&&typeof document<"u"&&window.parent!=window&&window.supports_zerogpu_headers?Ct("zerogpu-headers",P):Promise.resolve(null)).then(U=>se(`${h.root}${x}/${Xe}?${j}`,{...J,session_hash:v},U)).then(async([U,B])=>{if(B===503)i({type:"status",stage:"error",message:Ne,queue:!0,endpoint:m,fn_index:d,time:new Date});else if(B===422)i({type:"status",stage:"error",message:U.detail,queue:!0,endpoint:m,fn_index:d,code:"validation_error",time:new Date}),o();else if(B!==200)i({type:"status",stage:"error",broken:!1,message:U.detail,queue:!0,endpoint:m,fn_index:d,time:new Date});else{b=U.event_id,ge=b;let ve=async function(ie){try{const{type:S,status:$,data:k,original_msg:We}=Re(ie,we[d]);if(S=="heartbeat")return;if(S==="update"&&$&&!O)i({type:"status",endpoint:m,fn_index:d,time:new Date,original_msg:We,...$});else if(S==="complete")O=$;else if(S=="unexpected_error"||S=="broken_connection"){console.error("Unexpected error",$?.message);const Ke=S==="broken_connection";i({type:"status",stage:"error",message:$?.message||"An Unexpected Error Occurred!",queue:!0,endpoint:m,broken:Ke,session_not_found:$?.session_not_found,fn_index:d,time:new Date})}else if(S==="log"){i({type:"log",title:k.title,log:k.log,level:k.level,endpoint:m,duration:k.duration,visible:k.visible,fn_index:d});return}else(S==="generating"||S==="streaming")&&(i({type:"status",time:new Date,...$,stage:$?.stage,queue:!0,endpoint:m,fn_index:d}),k&&q.connection!=="stream"&&["sse_v2","sse_v2.1","sse_v3"].includes(A)&&Ht(ee,b,k));k&&(i({type:"data",time:new Date,data:W(k.data,q,h.components,"output",G.with_null_state),endpoint:m,fn_index:d}),k.render_config&&await ye(k.render_config),O&&(i({type:"status",time:new Date,...O,stage:$?.stage,queue:!0,endpoint:m,fn_index:d}),o())),($?.stage==="complete"||$?.stage==="error")&&(te[b]&&delete te[b],b in ee&&delete ee[b])}catch(S){console.error("Unexpected client exception",S),i({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:m,fn_index:d,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(A)&&(_e(N,Be.abort_controller),N.open=!1,o())}};b in X&&(X[b].forEach(ie=>ve(ie)),delete X[b]),te[b]=ve,ze.add(b),N.open||await this.open_stream()}})}});let Ve=!1;const ne=[],z=[],be={[Symbol.asyncIterator]:()=>be,next:p,throw:async _=>(l(_),p()),return:async()=>(o(),p()),cancel:Je,event_id:Me};return be}catch(i){throw console.error("Submit function encountered an error:",i),i}}function Yt(t){return{then:(s,e)=>e(t)}}function Qt(t,s,e,n){let r,i,o;if(typeof s=="number")r=s,i=t.unnamed_endpoints[r],o=n.dependencies.find(a=>a.id==s);else{const a=s.replace(/^\//,"");r=e[a],i=t.named_endpoints[s.trim()],o=n.dependencies.find(l=>l.id==e[a])}if(typeof r!="number")throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:r,endpoint_info:i,dependency:o}}class Z{app_reference;options;deep_link=null;config;api_prefix="";api_info;api_map={};session_hash=Math.random().toString(36).substring(2);jwt=!1;last_status={};cookies=null;stream_status={open:!1};closed=!1;pending_stream_messages={};pending_diff_streams={};event_callbacks={};unclosed_events=new Set;heartbeat_event=null;abort_controller=null;stream_instance=null;current_payload;get_url_config(s=null){if(!this.config)throw new Error(L);s===null&&(s=window.location.href);const e=o=>o.replace(/^\/+|\/+$/g,"");let n=e(new URL(this.config.root).pathname),r=e(new URL(s).pathname),i;return r.startsWith(n)?i=e(r.substring(n.length)):i="",this.get_page_config(i)}get_page_config(s){if(!this.config)throw new Error(L);let e=this.config;return s in e.page||(s=""),{...e,current_page:s,layout:e.page[s].layout,components:e.components.filter(n=>e.page[s].components.includes(n.id)),dependencies:this.config.dependencies.filter(n=>e.page[s].dependencies.includes(n.id))}}fetch(s,e){const n=new Headers(e?.headers||{});if(this&&this.cookies&&n.append("Cookie",this.cookies),this&&this.options.headers)for(const r in this.options.headers)n.append(r,this.options.headers[r]);return fetch(s,{...e,headers:n})}stream(s){const e=new Headers;if(this&&this.cookies&&e.append("Cookie",this.cookies),this&&this.options.headers)for(const n in this.options.headers)e.append(n,this.options.headers[n]);return this&&this.options.token&&e.append("Authorization",`Bearer ${this.options.token}`),this.abort_controller=new AbortController,this.stream_instance=Kt(s.toString(),{credentials:"include",headers:e,signal:this.abort_controller.signal}),this.stream_instance}view_api;upload_files;upload;handle_blob;post_data;submit;predict;open_stream;resolve_config;resolve_cookies;constructor(s,e={events:["data"]}){this.app_reference=s,this.deep_link=e.query_params?.deep_link||null,e.events||(e.events=["data"]),this.options=e,this.current_payload={},this.view_api=$t.bind(this),this.upload_files=kt.bind(this),this.handle_blob=Tt.bind(this),this.post_data=Pt.bind(this),this.submit=Zt.bind(this),this.predict=Dt.bind(this),this.open_stream=Jt.bind(this),this.resolve_config=gt.bind(this),this.resolve_cookies=wt.bind(this),this.upload=Rt.bind(this),this.fetch=this.fetch.bind(this),this.handle_space_success=this.handle_space_success.bind(this),this.stream=this.stream.bind(this)}async init(){this.options.auth&&await this.resolve_cookies(),await this._resolve_config().then(({config:s})=>this._resolve_heartbeat(s)),this.api_info=await this.view_api(),this.api_map=mt(this.config?.dependencies||[])}async _resolve_heartbeat(s){if(s&&(this.config=s,this.api_prefix=s.api_prefix||"",this.config&&this.config.connect_heartbeat&&this.config.space_id&&this.options.token&&(this.jwt=await $e(this.config.space_id,this.options.token,this.cookies))),s.space_id&&this.options.token&&(this.jwt=await $e(s.space_id,this.options.token)),this.config&&this.config.connect_heartbeat){const e=new URL(`${this.config.root}${this.api_prefix}/${it}/${this.session_hash}`);this.jwt&&e.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(e))}}static async connect(s,e={events:["data"]}){const n=new this(s,e);return e.session_hash&&(n.session_hash=e.session_hash),await n.init(),n}async reconnect(){const s=new URL(`${this.config.root}${this.api_prefix}/${ct}`);let e;try{const n=await this.fetch(s);if(!n.ok)throw new Error;e=(await n.json()).app_id}catch{return"broken"}return e!==this.config.app_id?"changed":"connected"}close(){this.closed=!0,_e(this.stream_status,this.abort_controller)}set_current_payload(s){this.current_payload=s}static async duplicate(s,e={events:["data"]}){return qt(s,e)}async _resolve_config(){const{http_protocol:s,host:e,space_id:n}=await fe(this.app_reference,this.options.token),{status_callback:r}=this.options;n&&r&&await qe(n,r);let i;try{let o=`${s}//${e}`;if(i=await this.resolve_config(o),!i)throw new Error(L);return this.config_success(i)}catch(o){if(n&&r)F(n,de.test(n)?"space_name":"subdomain",this.handle_space_success);else throw r&&r({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(o)}}async config_success(s){if(this.config=s,this.api_prefix=s.api_prefix||"",this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(e){console.error(ut+e.message)}return this.prepare_return_obj()}async handle_space_success(s){if(!this)throw new Error(L);const{status_callback:e}=this.options;if(e&&e(s),s.status==="running")try{if(this.config=await this._resolve_config(),this.api_prefix=this?.config?.api_prefix||"",!this.config)throw new Error(L);return await this.config_success(this.config)}catch(n){throw e&&e({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),n}}async component_server(s,e,n){if(!this.config)throw new Error(L);const r={},{token:i}=this.options,{session_hash:o}=this;i&&(r.Authorization=`Bearer ${this.options.token}`);let a,l=this.config.components.find(p=>p.id===s);l?.props?.root_url?a=l.props.root_url:a=this.config.root;let u;if("binary"in n){u=new FormData;for(const p in n.data)p!=="binary"&&u.append(p,n.data[p]);u.set("component_id",s.toString()),u.set("fn_name",e),u.set("session_hash",o)}else u=JSON.stringify({data:n,component_id:s,fn_name:e,session_hash:o}),r["Content-Type"]="application/json";i&&(r.Authorization=`Bearer ${i}`);try{const p=await this.fetch(`${a}${this.api_prefix}/${rt}/`,{method:"POST",body:u,headers:r,credentials:"include"});if(!p.ok)throw new Error("Could not connect to component server: "+p.statusText);return await p.json()}catch(p){console.warn(p)}}set_cookies(s){this.cookies=Ie(s).join("; ")}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}}const Xt="./assets/index-DtyHWtsU.css";let le;le=[];let ue,pe,je,es=new Promise(t=>{je=t});async function ts(){const t=await Promise.all([K(()=>import("./Index-DUJr_fmc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url),K(()=>import("./index-CBjracNG.js"),__vite__mapDeps([11,1,2]),import.meta.url)]);ue=t[0].default,pe=t[1].mount_css,je()}function ss(){const t={SvelteComponent:re.SvelteComponent};for(const e in re)e!=="SvelteComponent"&&(e==="SvelteComponentDev"?t[e]=t.SvelteComponent:t[e]=re[e]);window.__gradio__svelte__internal=t;class s extends HTMLElement{control_page_title;initial_height;is_embed;container;info;autoscroll;eager;theme_mode;host;space;src;app;loading;updating;constructor(){super(),this.host=this.getAttribute("host"),this.space=this.getAttribute("space"),this.src=this.getAttribute("src"),this.control_page_title=this.getAttribute("control_page_title"),this.initial_height=this.getAttribute("initial_height")??"300px",this.is_embed=this.getAttribute("embed")??"true",this.container=this.getAttribute("container")??"true",this.info=this.getAttribute("info")??!0,this.autoscroll=this.getAttribute("autoscroll"),this.eager=this.getAttribute("eager"),this.theme_mode=this.getAttribute("theme_mode"),this.updating=!1,this.loading=!1}async connectedCallback(){await ts(),this.loading=!0,this.app&&this.app.$destroy(),typeof le!="string"&&le.forEach(i=>pe(i,document.head)),await pe(Xt,document.head);const n=new CustomEvent("domchange",{bubbles:!0,cancelable:!1,composed:!0});new MutationObserver(i=>{this.dispatchEvent(n)}).observe(this,{childList:!0}),this.app=new ue({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"6-0-0-dev-1",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:Z,app_mode:window.__gradio_mode__==="app"}}),this.updating&&this.setAttribute(this.updating.name,this.updating.value),this.loading=!1}static get observedAttributes(){return["src","space","host"]}async attributeChangedCallback(n,r,i){if(await es,(n==="host"||n==="space"||n==="src")&&i!==r){if(this.updating={name:n,value:i},this.loading)return;this.app&&this.app.$destroy(),this.space=null,this.host=null,this.src=null,n==="host"?this.host=i:n==="space"?this.space=i:n==="src"&&(this.src=i),this.app=new ue({target:this,props:{space:this.space?this.space.trim():this.space,src:this.src?this.src.trim():this.src,info:this.info!=="false",container:this.container!=="false",is_embed:this.is_embed!=="false",initial_height:this.initial_height,eager:this.eager==="true",version:"6-0-0-dev-1",theme_mode:this.theme_mode,autoscroll:this.autoscroll==="true",control_page_title:this.control_page_title==="true",Client:Z,app_mode:window.__gradio_mode__==="app"}}),this.updating=!1}}}customElements.get("gradio-app")||customElements.define("gradio-app",s)}ss();export{Y as F,K as _,ns as p};
//# sourceMappingURL=index-CtRY-svv.js.map
