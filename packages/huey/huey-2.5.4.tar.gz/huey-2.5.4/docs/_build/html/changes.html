
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Changes in 2.0 &#8212; huey 2.4.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Troubleshooting and Common Pitfalls" href="troubleshooting.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting and Common Pitfalls"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">huey 2.4.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Changes in 2.0</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="changes-in-2-0">
<span id="changes"></span><h1>Changes in 2.0<a class="headerlink" href="#changes-in-2-0" title="Permalink to this headline">¶</a></h1>
<p>The 2.0 release of Huey is mostly API-compatible with previous versions, but
there are a number of things that have been altered or improved in this
release.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The serialization format for tasks has changed. An attempt has been made to
provide backward compatibility when reading messages enqueued by an older
version of Huey, but this is not guaranteed to work.</p>
</div>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">always_eager</span></code> mode has been renamed <a class="reference internal" href="guide.html#immediate"><span class="std std-ref">Immediate mode</span></a>. As the new name
implies, tasks are run immediately instead of being enqueued. Immediate mode is
designed to be used during testing and development. When immediate mode is
enabled, Huey switches to using in-memory storage by default, so as to avoid
accidental writes to a live storage. Immediate mode improves greatly on
<code class="docutils literal notranslate"><span class="pre">always_eager</span></code> mode, as it no longer requires special-casing and follows the
same code-paths used when Huey is in live mode. See <a class="reference internal" href="guide.html#immediate"><span class="std std-ref">Immediate mode</span></a> for more
details.</p>
<p>Previously, the Huey consumer accepted options to run in UTC or local-time.
Various APIs, particularly around scheduling and task revocation, needed to be
compatible with however the consumer was configured, and it could easily get
confusing. As of 2.0, UTC-vs-localtime is specified when instantiating Huey,
and all conversion happens internally, hopefully making things easier to think
about – that is, you don’t have to think about it.</p>
<p>The events APIs have been removed and replaced by a <a class="reference internal" href="signals.html#signals"><span class="std std-ref">Signals</span></a> system.
Signal handlers are executed synchronously by the worker(s) as they run, so
it’s a bit different, but hopefully a lot easier to actually utilize, as the
events API required a dedicated listener thread if you were to make any use of
it (since it used a pub/sub approach). Events could be built on-top of the
signals, but currently I have no plans for this.</p>
<p>Errors are no longer stored in a separate list. Should a task fail due to an
unhandled exception, the exception will be placed in the result store, and can
be introspected using the task’s <a class="reference internal" href="api.html#Result" title="Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> handle.</p>
<p>Huey now supports <a class="reference internal" href="guide.html#priority"><span class="std std-ref">Task priority</span></a>. To use priorities with Redis, you need to be
running Redis 5.0 or newer, and should use <a class="reference internal" href="api.html#PriorityRedisHuey" title="PriorityRedisHuey"><code class="xref py py-class docutils literal notranslate"><span class="pre">PriorityRedisHuey</span></code></a>. The
original <a class="reference internal" href="api.html#RedisHuey" title="RedisHuey"><code class="xref py py-class docutils literal notranslate"><span class="pre">RedisHuey</span></code></a> continues to support older versions of Redis.
<a class="reference internal" href="api.html#SqliteHuey" title="SqliteHuey"><code class="xref py py-class docutils literal notranslate"><span class="pre">SqliteHuey</span></code></a> and the in-memory storage used for dev/testing provide
full support for task priorities.</p>
</section>
<section id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p>Changes when initializing <a class="reference internal" href="api.html#Huey" title="Huey"><code class="xref py py-class docutils literal notranslate"><span class="pre">Huey</span></code></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">result_store</span></code> parameter has been renamed to <code class="docutils literal notranslate"><span class="pre">results</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">events</span></code> parameter is removed. Events have been replaced by <a class="reference internal" href="signals.html#signals"><span class="std std-ref">Signals</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">store_errors</span></code> parameter is removed. Huey no longer maintains a separate
list of recent errors. Unhandled errors that occur when running a task are
stored in the result store. Also the <code class="docutils literal notranslate"><span class="pre">max_errors</span></code> parameter of the Redis
storage engine is removed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">global_registry</span></code> parameter is removed. Tasks are no longer registered to a
global registry - tasks are registered to the Huey instance with which they
are decorated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">always_eager</span></code> has been renamed <code class="docutils literal notranslate"><span class="pre">immediate</span></code>.</p></li>
</ul>
<p>New initialization arguments:</p>
<ul class="simple">
<li><p>Boolean <code class="docutils literal notranslate"><span class="pre">utc</span></code> parameter (defaults to true). This setting is used to control
how Huey interprets datetimes internally. Previously, this logic was spread
across a number of APIs and a consumer flag.</p></li>
<li><p>Serializer parameter accepts an (optional) object implementing the
<a class="reference internal" href="api.html#Serializer" title="Serializer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Serializer</span></code></a> interface. Defaults to using <code class="docutils literal notranslate"><span class="pre">pickle</span></code>.</p></li>
<li><p>Accepts option to use gzip <code class="docutils literal notranslate"><span class="pre">compression</span></code> when serializing data.</p></li>
</ul>
<p>Other changes to <a class="reference internal" href="api.html#Huey" title="Huey"><code class="xref py py-class docutils literal notranslate"><span class="pre">Huey</span></code></a>:</p>
<ul class="simple">
<li><p>Immediate mode can be enabled or disabled at runtime by setting the
<a class="reference internal" href="api.html#Huey.immediate" title="Huey.immediate"><code class="xref py py-attr docutils literal notranslate"><span class="pre">immediate</span></code></a> property.</p></li>
<li><p>Event emitter has been replaced by <a class="reference internal" href="signals.html#signals"><span class="std std-ref">Signals</span></a>, so all event-related APIs
have been removed.</p></li>
<li><p>Special classes of exceptions for the various storage operations have been
removed. For more information see <a class="reference internal" href="api.html#exceptions"><span class="std std-ref">Exceptions</span></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Huey.errors()</span></code> method is gone. Errors are no longer tracked
separately.</p></li>
</ul>
<p>Changes to the <a class="reference internal" href="api.html#Huey.task" title="Huey.task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">task()</span></code></a> and <a class="reference internal" href="api.html#Huey.periodic_task" title="Huey.periodic_task"><code class="xref py py-meth docutils literal notranslate"><span class="pre">periodic_task()</span></code></a>
decorators:</p>
<ul class="simple">
<li><p>Previously these decorators accepted two optional keyword arguments,
<code class="docutils literal notranslate"><span class="pre">retries_as_argument</span></code> and <code class="docutils literal notranslate"><span class="pre">include_task</span></code>. Since the remaining retries are
stored as an attribute on the task itself, the first is redundant. In 2.0
these are replaced by a new keyword argument <code class="docutils literal notranslate"><span class="pre">context</span></code>, which, if <code class="docutils literal notranslate"><span class="pre">True</span></code>,
will pass the task instance to the decorated function as a keyword argument.</p></li>
<li><p>Enqueueing a task pipeline will now return a <a class="reference internal" href="api.html#ResultGroup" title="ResultGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultGroup</span></code></a> instead
of a list of individual <a class="reference internal" href="api.html#Result" title="Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> instances.</p></li>
</ul>
<p>Changes to the <a class="reference internal" href="api.html#Result" title="Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a> handle (previous called
<code class="docutils literal notranslate"><span class="pre">TaskResultWrapper</span></code>):</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">task_id</span></code> property is renamed to <code class="docutils literal notranslate"><span class="pre">id</span></code>.</p></li>
<li><p>Task instances that are revoked via <a class="reference internal" href="api.html#Result.revoke" title="Result.revoke"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Result.revoke()</span></code></a> will default to
using <code class="docutils literal notranslate"><span class="pre">revoke_once=True</span></code>.</p></li>
<li><p>The <a class="reference internal" href="api.html#Result.reschedule" title="Result.reschedule"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reschedule()</span></code></a> method no longer requires a delay or eta.
Leaving both empty will reschedule the task immediately.</p></li>
</ul>
<p>Changes to <a class="reference internal" href="api.html#crontab" title="crontab"><code class="xref py py-func docutils literal notranslate"><span class="pre">crontab()</span></code></a>:</p>
<ul class="simple">
<li><p>The order of arguments has been changed to match the order used on linux
crontab. The order is now minute, hour, day, month, day of week.</p></li>
</ul>
<p>Miscellaneous:</p>
<ul class="simple">
<li><p>Huey no longer uses a global registry for task functions. Task functions are
only visible to the huey instance they are decorated by.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RedisHuey</span></code> defaults to using a blocking pop on the queue, which should
improve latency and reduce chatter. To go back to the old polling default,
specify <code class="docutils literal notranslate"><span class="pre">blocking=False</span></code> when creating your huey instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SqliteHuey</span></code> no longer has any third-party dependencies and has been moved
into the main <code class="docutils literal notranslate"><span class="pre">huey</span></code> module.</p></li>
<li><p>The <a class="reference internal" href="mini.html#MiniHuey" title="MiniHuey"><code class="xref py py-class docutils literal notranslate"><span class="pre">MiniHuey</span></code></a> contrib module has been renamed to
<code class="docutils literal notranslate"><span class="pre">huey.contrib.mini</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">SimpleStorage</span></code> contrib module has been removed.</p></li>
</ul>
<p>Django-specific:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">backend_class</span></code> setting has been renamed to <code class="docutils literal notranslate"><span class="pre">huey_class</span></code> (used to
specify import-path to Huey implementation, e.g. <code class="docutils literal notranslate"><span class="pre">huey.RedisHuey</span></code>).</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Changes in 2.0</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#details">Details</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="troubleshooting.html"
                          title="previous chapter">Troubleshooting and Common Pitfalls</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/changes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="troubleshooting.html" title="Troubleshooting and Common Pitfalls"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">huey 2.4.5 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Changes in 2.0</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013, charles leifer.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>