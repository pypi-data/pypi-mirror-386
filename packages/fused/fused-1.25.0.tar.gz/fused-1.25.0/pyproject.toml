[project]
name = "fused"
description = ""
authors = []
requires-python = ">=3.10,<4"
readme = "README.md"
dynamic = ["version"]

dependencies = [
    "pydantic>=2.7.0,<3",
    "requests>=2.31,<3",
    "aiohttp>=3.8.3,<4",
    "yarl>=1.9.4,<2",
    "tqdm>=4.67.1,<5",
    "loguru>=0.7.0,<0.8",
    "pyarrow>=11",
    "numpy>=1.20",
    "rtoml>=0,<1 ; sys_platform != 'emscripten'",
    "fsspec>=2024.3.1",
]


[project.optional-dependencies]
batch = [
    "shapely>=2,<3",
    "geopandas>=0.14,<2",
    "affine>=2,<3",
    "pyproj>=3.7.1,<4",
    "importlib-resources>=5.12.0,<6",
    "pandas>=2.2.0,<3",
    "pillow>=10",
    "xarray==2024.3.0",
    "rioxarray>=0.15,<0.16",
    "jinja2>=3.1.2,<4",
    "mercantile>=1.2.1,<2",
]
raster = [
    "mercantile>=1.2.1,<2",
    "pillow>=10",
    "xarray==2024.3.0",
    "rioxarray>=0.15,<0.16",
    "rasterio>=1.3.10,<2",
]
vector = ["mercantile>=1.2.1,<2", "geopandas>=0.14,<2", "shapely>=2,<3"]
all = [
    "shapely>=2,<3",
    "mercantile>=1.2.1,<2",
    "pillow>=10",
    "xarray==2024.3.0",
    "rioxarray>=0.15,<0.16",
    "rasterio>=1.3.10,<2",
    "geopandas>=0.14,<2",
]

[dependency-groups]
dev = [
    "black[jupyter]==23.7.0",
    "isort>=5.12.0,<6",
    "ipykernel>=6.22.0,<7",
    "ipython>=8.7.0,<8.12.1",
    "mypy>=1,<2",
    "types-requests>=2.29.0.0,<3",
    "pytest>=7.3.1,<8",
    "pytest-asyncio>=0.23.5,<0.24",
    "pre-commit>=3.3.1,<4",
    "pytest-httpserver>=1.0.8,<2",
    "coverage>=7.3.1,<8",
    "h3==4.0.0b3",
    "contextily>=1.3.0",
    "gcsfs>=2024.9.0,<2025",
    "s3fs>=2024.3.1,<2025",
    "notebook>=7.4.4",
]

[project.urls]
Homepage = "https://www.fused.io"
Documentation = "https://docs.fused.io"
Changelog = "https://docs.fused.io/python-sdk/changelog/"

[build-system]
requires = ["hatchling", "uv-dynamic-versioning"]
build-backend = "hatchling.build"

[tool.hatch.build]
packages = ["fused"]

[tool.hatch.build.hooks.version]
path = "fused/_version.py"
template = '''
__version__ = "{version}"
'''

[tool.uv]
package = true
default-groups = ["dev"]

[tool.hatch.version]
source = "uv-dynamic-versioning"

[tool.uv-dynamic-versioning]
enable = true
vcs = "git"
# This makes strings like `1.3.2.dev3+28c1684` instead of `1.3.1.post3.dev0+28c1684`
bump = true
fallback-version = "0.0.0"
pattern-prefix = "fused-py-"

[tool.uv-dynamic-versioning.substitution]
folders = [{ path = "fused" }]

[tool.ruff]
extend-exclude = ["tests/data/udf_with_utils/udf_with_utils.py"]
target-version = "py310"

[tool.ruff.lint]
select = [
    # pycodestyle
    "E",
    # Pyflakes
    "F",
    # isort
    "I",
]

ignore = [
    "E501", # Line length
    "E731", # assign to lambda
]

[tool.mypy]
plugins = "pydantic.mypy"

[tool.pytest.ini_options]
norecursedirs = [
    "integration_tests",
    "docker_integration_tests",
] # do not run the integration tests unless explicitly requested
markers = [
    "require_auth: tests that require an authenticated API (locally, or with refresh token on CI)",
]
asyncio_mode = "auto"
