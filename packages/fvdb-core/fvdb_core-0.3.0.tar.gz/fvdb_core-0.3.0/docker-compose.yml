version: '3'
services:
  fvdb-dev:
    build:
      context: ./
      dockerfile: Dockerfile
      args:
        MODE: dev
    working_dir: /workspace
    volumes:
      - type: bind
        source: .
        target: /workspace
      # Keep build artifacts inside the container (not mirrored to host)
      - type: volume
        target: /workspace/build
      - type: volume
        target: /workspace/dist
      - type: volume
        target: /workspace/_skbuild
    # Uncomment and adjust the following as needed
    # ports:
    #   - "8888:8888"  # Example for Jupyter notebook
    entrypoint: /bin/bash
    stdin_open: true
    tty: true
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
