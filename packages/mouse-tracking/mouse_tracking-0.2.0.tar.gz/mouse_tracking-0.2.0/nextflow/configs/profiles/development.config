// development configuration file

nextflow_resources = "/media/bgeuther/LL3_Internal/nextflow-artifacts"
nextflow_runtime_containers = "${nextflow_resources}/images"
workDir = "${nextflow_resources}/nextflow-work/cache/"

params {
    /*
     * Additional Parameters for the development profile
     * These parameters are described in the sumner2 profile
     */
    pubdir = "${nextflow_resources}/nextflow-work/pubdir/"
    tracking_code_dir = "/kumar_lab_models/mouse-tracking-runtime/"
    gait_code_dir = "/gait-analysis/"
    vfi_code_dir = "/vfi/Code/"
    support_code_dir = "/mouse-tracking-runtime/support_code/"
    heuristic_classifier_folder = "/opt/JABS-postprocess/src/jabs_postprocess/heuristic_classifiers/"
    filter_processed = false
    model_dir = "${nextflow_resources}/neural-net-models/"

    jabs_version = "0.37.0"
    classifier_project_folders = "${nextflow_resources}/jabs-classifiers/project_folders/"
    classifier_training_file_folder = "${nextflow_resources}/jabs-classifiers/training_files/"
    exported_classifier_folder = "${nextflow_resources}/jabs-classifiers/exported_classifiers/"
    classifier_artifact_suffix = "_classifier_v${jabs_version}.pickle"
    classifier_window_sizes = [2, 5, 10, 20, 30, 60]
    // Classifiers are described as behavior_name: project_folder
    single_mouse_classifiers = [
        // Missing classifiers did not have artifacts exported on local test
        "Rearing_supported": [
            classifier_path: "${exported_classifier_folder}Rearing_supported_classifier_v0.37.0.pickle",
            stitch_value: 5,
            filter_value: 5,
        ],
        "Rearing_unsupported": [
            classifier_path: "${exported_classifier_folder}Rearing_unsupported_classifier_v0.37.0.pickle",
            stitch_value: 5,
            filter_value: 5,
        ],
    ]
    heuristic_classifiers = ["corner", "corner_facing", "freeze", "locomotion", "periphery", "wall_facing"]

    // Number of 5-minute bins for transforming summary tables into bins
    // 1 = 5 minutes, 4 = 20 minutes, etc.
    feature_bins = [1, 4, 11]

    // Some default parameters for branches in the pipeline
    default_feature_input = ["${projectDir}/nextflow/default-data/DEFAULT_VIDEO.mp4", "${projectDir}/nextflow/default-data/DEFAULT_VIDEO_pose_est_v6.h5"]
    default_manual_correction_input = default_feature_input

    // Remote storage parameters
    globus_compute_endpoint = "INVALID" // Personal endpoint where compute filesystem is visible
    globus_remote_endpoint = "70850914-722d-11e7-aa01-22000bf2d287" // JAX T2 storage endpoint
    globus_remote_folder = "/tier2/vkumar/"
    dropbox_prefix = "labdropbox:\"/KumarLab's shared workspace/VideoData/MDS_Tests/\""
}

singularity {
   enabled = true
   autoMounts = true
}

process {
    executor = 'local'
    maxForks = 1

    // Since we can't assume local has multiple GPUs, we limit all tasks
    // Note that maxForks attached to GPU label will only limit processes of the same name
    queueSize = 1

    withLabel: "gpu" {
        maxForks = 1
        containerOptions = "--nv"
    }


    /*
     * Runtime options
     */
    withLabel: "tracking" {
        container = "${nextflow_runtime_containers}/mouse-tracking-runtime/runtime/v0.1.2/9ffc3812d5bdc860833fb1d211fbb700ac95cc15ccba3b2821540aa9a3fa69f0.sif"
        containerOptions = "--nv -B /media"
    }
    withLabel: "jabs_classify" {
        container = "${nextflow_runtime_containers}/JABS-behavior-classifier/headless/v0.37.0/4505b4e9a7606ded8212de5a60a6966ab103bb47282f5d559054be4c16fefd62.sif"
        // Classifiers exist in a folder not bound by default
        containerOptions = "-B /media"
    }
    withLabel: "jabs_postprocess" {
        container = "${nextflow_runtime_containers}/JABS-postprocess/jabs-postprocess/v0.4.0/f5fe5738abbd8eeb3e9212046973d45258e665d5dbebf527e65f935488a88c27.sif"
        containerOptions = "-B /media"
    }
    withLabel: "jabs_table_convert" {
        container = "${nextflow_runtime_containers}/mouse-tracking-runtime/RBase/v0.1.2/d9736c87a8d3132bd8e466374dad9bab0813d8a03df2303d26c252160da8c62f.sif"
        containerOptions = "-B /media"
    }
    withLabel: "gait" {
        container = "${nextflow_runtime_containers}/../vms/gait-pipeline-2025-03-27.sif"
        containerOptions = "-B /media"
    }
    withLabel: "frailty" {
        container = "${nextflow_runtime_containers}/../vms/vfi-2025-03-27.sif"
        containerOptions = "-B /media"
    }
    withLabel: "sleap" {
        container = "${nextflow_runtime_containers}/mouse-tracking-runtime/sleap-1.4.1/v0.1.2/fde4ce805487311e10e73600ebae8ad5815bc49d879ecd3fbacb0ad53f39226b.sif"
        containerOptions = "-B /media"
    }
    withLabel: "sleap_io" {
        container = "${nextflow_runtime_containers}/mouse-tracking-runtime/sleap-io-0.2.0/v0.1.2/c1ab1626c527bc80d79fc0bd9431092dfdb44d947ad88741637907b45439145f.sif"
        containerOptions = "-B /media"
    }
    withLabel: "globus" {
        container = "${nextflow_runtime_containers}/mouse-tracking-runtime/globus-cli/v0.1.2/e0031a860d0a023ef35d3af6eee13ce5e293cf718cdbae37c09e7696ba3d778d.sif"
        containerOptions = "-B /media"
    }
}

executor {
    name = 'local'
}
