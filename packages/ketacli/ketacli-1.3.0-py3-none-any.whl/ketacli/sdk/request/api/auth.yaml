token:
  path: auth/token
  desc: 获取 token
  methods:
    create:
      path: auth/tokens
      method: post
      data:
        audience: "{{ audience |default('') }}"
        username: "{{ username |default('keta') }}"
        expireTime: "{{ int(time.time()*1000) + duration |default(3600) * 1000  }}"
        notBefore: "{{ int(time.time()*1000) }}"
    delete:
      path: auth/tokens/{{ token_id }}
      method: delete
 
    list:
      path: auth/tokens
      method: get
      query_fields:
        - field: sort
          required: true
          default: issuedAt
      default_fields:
      - name: id
        alias: ID
      - name: username
        alias: 用户名
      - name: audience
        alias: 受众
      - name: expired
        alias: 过期
        convert:
          function: format_boolean
        
      - name: issuer
        alias: 发行者
      
      - name: status
        alias: 状态
        convert:
          function: format_enum
          args:
            - enum_map:
                enabled: 启用
                disabled: 禁用
                expired: 过期
      - name: lastAccessIP
        alias: 最后访问IP
      - name: lastAccessTime
        alias: 最后访问时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'

      - name: issuedAt
        alias: 发行时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'
      - name: expireTime
        alias: 过期时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'

dc-token:
  path: dc/token
  desc: 获取 token
  methods:
    list:
      path: dc/token
      method: get
      query_fields:
        - field: sort
          required: true
          default: createTime
      default_fields:
      - name: id
        alias: ID
      - name: name
        alias: 名称
      - name: description
        alias: 描述
      - name: enabled
        alias: 是否开启
        convert:
          function: format_boolean
      - name: createTime
        alias: 创建时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'
      - name: expireTime
        alias: 过期时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'
      - name: notBeforeTime
        alias: 生效时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'
      - name: lastAccessTime
        alias: 最后访问时间
        convert:
          function: format_timestamp
          args:
            - format: '%Y-%m-%d %H:%M:%S'
            - tz: '+08:00'
      - name: lastAccessIP
        alias: 最后访问IP
      - name: expired
        alias: 过期
        convert:
          function: format_boolean
    delete:
      path: dc/token/{{ token_id }}
      method: delete
    create:
      path: dc/token
      method: post
      data:
        name: "{{ name | default(faker.word()) }}"
        description: "{{ description |default('created by ketacli') }}"
        expireTime: "{{ int(time.time()*1000) + duration |default(3600) * 1000  }}"
        notBefore: "{{ int(time.time()*1000) }}"