ä»¥ä¸‹æ˜¯å°†æ‚¨çš„ AsyncCallAI åº“ä¸ RAG Knowledge Base & AI Toolkit æ•´åˆçš„å®Œæ•´ READMEï¼š

# AsyncCallAI & RAG Knowledge Base - æ™ºèƒ½AIå¯¹è¯ä¸çŸ¥è¯†åº“ç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Pythonå·¥å…·åŒ…ï¼Œé›†æˆäº†å¼‚æ­¥AIå¯¹è¯è°ƒç”¨ã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰çŸ¥è¯†åº“æ„å»ºã€äº‘å­˜å‚¨æ“ä½œå’Œæ•°æ®å¤„ç†ç­‰å¤šç§åŠŸèƒ½ã€‚ç‰¹åˆ«é€‚ç”¨äºéœ€è¦ç»“åˆå¤–éƒ¨çŸ¥è¯†è¿›è¡Œæ™ºèƒ½å¯¹è¯å’Œæ•°æ®ç®¡ç†çš„åœºæ™¯ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. **å¼‚æ­¥AIå¯¹è¯ç³»ç»Ÿ (AsyncCallAi)**
åŸºäºå¼‚æ­¥ç¼–ç¨‹çš„é«˜æ•ˆAIå¯¹è¯è°ƒç”¨åº“ï¼Œæ”¯æŒæ‰¹é‡å¹¶å‘å¤„ç†å¤šä¸ªå¯¹è¯è¯·æ±‚ï¼š

- ğŸš€ **å¼‚æ­¥å¹¶å‘**ï¼šä½¿ç”¨ asyncio å®ç°é«˜æ•ˆçš„æ‰¹é‡è¯·æ±‚å¤„ç†
- ğŸ± **è§’è‰²æ‰®æ¼”**ï¼šæ”¯æŒè‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯ï¼Œå®ç°è§’è‰²æ‰®æ¼”åŠŸèƒ½
- ğŸ”§ **çµæ´»é…ç½®**ï¼šå¯è‡ªå®šä¹‰APIå¯†é’¥å’ŒåŸºç¡€URL
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- ğŸ“ **ç»“æœå±•ç¤º**ï¼šæ¸…æ™°çš„è¯·æ±‚-å“åº”ç»“æœè¾“å‡º

### 2. **RAGçŸ¥è¯†åº“ç³»ç»Ÿ (P_RAGKnowledgeBase)**
åŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆæ¶æ„çš„çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ•°æ®æºæ„å»ºå‘é‡æ•°æ®åº“ï¼š

- **PDFæ–‡æ¡£å¤„ç†**ï¼šè‡ªåŠ¨æå–PDFæ–‡æœ¬å¹¶åˆ†å‰²ä¸ºå‘é‡å—
- **åŸå§‹æ–‡æœ¬å¤„ç†**ï¼šç›´æ¥å¤„ç†ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ–‡æœ¬
- **æ•°æ®åº“Schemaæ„å»º**ï¼šå°†æ•°æ®åº“è¡¨ç»“æ„è½¬æ¢ä¸ºå¯æ£€ç´¢çš„çŸ¥è¯†
- **æ™ºèƒ½æ–‡æœ¬åˆ†å‰²**ï¼šä½¿ç”¨é‡å åˆ†å—ä¿æŒä¸Šä¸‹æ–‡è¿è´¯æ€§

### 3. **AIæ¨¡å‹è°ƒç”¨ (CallAi & CallBailianApp)**
æ”¯æŒå¤šç§AIæœåŠ¡æ¥å£çš„ç»Ÿä¸€è°ƒç”¨ï¼š

- **OpenAIå…¼å®¹æ¥å£**ï¼šæ”¯æŒä»»ä½•å…¼å®¹OpenAI APIçš„æ¨¡å‹æœåŠ¡
- **é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°**ï¼šä¸“ä¸ºé˜¿é‡Œäº‘DashScopeåº”ç”¨è®¾è®¡
- **RAGå¢å¼ºå¯¹è¯**ï¼šå¯ç»“åˆçŸ¥è¯†åº“ä¸Šä¸‹æ–‡ç”Ÿæˆæ›´å‡†ç¡®çš„å›ç­”
- **çµæ´»çš„æç¤ºè¯ç®¡ç†**ï¼šæ”¯æŒåŠ¨æ€ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿

### 4. **äº‘å­˜å‚¨é›†æˆ (OSSHandler)**
é˜¿é‡Œäº‘OSSå¯¹è±¡å­˜å‚¨çš„ä¾¿æ·æ“ä½œæ¥å£ï¼š

- **æ–‡ä»¶ä¸Šä¼ ä¸‹è½½**ï¼šæœ¬åœ°ä¸OSSé—´çš„æ–‡ä»¶åŒæ­¥
- **Excelæ•°æ®å¤„ç†**ï¼šç›´æ¥ä»OSSè¯»å–Excelæ–‡ä»¶ä¸ºDataFrame
- **æ ¼å¼éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯æ–‡ä»¶ç±»å‹å’Œå­˜åœ¨æ€§

### 5. **æ•°æ®å¯¼å‡ºä¸é‚®ä»¶å‘é€ (ExportToEmail)**
å°†æ•°æ®å¤„ç†ç»“æœè‡ªåŠ¨åŒ–å‘é€ï¼š

- **Excelå¯¼å‡º**ï¼šDataFrameè‡ªåŠ¨è½¬æ¢ä¸ºExcelæ ¼å¼
- **é‚®ä»¶å‘é€**ï¼šæ”¯æŒHTMLæ ¼å¼é‚®ä»¶å’Œé™„ä»¶
- **ä¸´æ—¶æ–‡ä»¶ç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶

## ğŸ›  å®‰è£…ä¾èµ–

```bash
pip install openai httpx python-dotenv pandas oss2 sentence-transformers faiss-cpu PyPDF2 langchain dashscope
```

## âš™ï¸ ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶é…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š

```env
# OpenAIé…ç½®
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=your_base_url

# é˜¿é‡Œäº‘OSSé…ç½®
ACCESS_KEY_ID=your_access_key_id
ACCESS_KEY_SECRET=your_access_key_secret
ENDPOINT=your_oss_endpoint
BUCKET_NAME=your_bucket_name

# é‚®ä»¶æœåŠ¡é…ç½®
email_sender=your_email@163.com
email_password=your_smtp_password
```

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### 1. **å¼‚æ­¥AIå¯¹è¯ - åŸºç¡€ç”¨æ³•**

```python
from async_ai_toolkit import AsyncCallAi
import asyncio

async def main():
    # åˆå§‹åŒ–å¼‚æ­¥AIå®¢æˆ·ç«¯
    obj = AsyncCallAi()
    
    # è®¾ç½®çŒ«å’ªè§’è‰²æç¤ºè¯
    obj.prompt = """ä½ ç°åœ¨æ˜¯ä¸€åªåˆšæ»¡1å²çš„å°å¥¶çŒ«ï¼Œä¼šç”¨äººç±»çš„è¯å’Œæˆ‘èŠå¤©ï¼Œè¶…é»äººè¶…å¯çˆ±ï¼"""
    
    # æ‰¹é‡å¯¹è¯å¤„ç†
    prompts = [
        "è§£é‡Šä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹",
        "å†™ä¸€ä¸ªç®€å•çš„Pythonåˆ—è¡¨æ¨å¯¼å¼ç¤ºä¾‹",
        "æ€»ç»“å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«"
    ]
    
    # å¹¶å‘æ‰§è¡Œæ‰€æœ‰å¯¹è¯è¯·æ±‚
    await obj.chat(prompts)

# è¿è¡Œ
if __name__ == '__main__':
    asyncio.run(main())
```

### 2. **RAGçŸ¥è¯†åº“æ„å»ºä¸æ£€ç´¢**

```python
from async_ai_toolkit import P_RAGKnowledgeBase, AsyncCallAi
import asyncio

async def rag_example():
    # æ„å»ºçŸ¥è¯†åº“
    kb = P_RAGKnowledgeBase(chunk_size=500, chunk_overlap=50)
    kb.build_from_pdf("document.pdf")
    
    # åˆå§‹åŒ–AIå®¢æˆ·ç«¯
    ai = AsyncCallAi()
    ai.prompt = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŠ©æ‰‹ï¼Œè¯·æ ¹æ®çŸ¥è¯†åº“å†…å®¹å›ç­”é—®é¢˜ã€‚"
    
    # RAGå¢å¼ºå¯¹è¯
    question = "æ–‡æ¡£ä¸­æåˆ°çš„å…³é”®æŠ€æœ¯æ˜¯ä»€ä¹ˆï¼Ÿ"
    response = await ai.get_openai_response(question)  # æ™®é€šå›ç­”
    
    # ç»“åˆçŸ¥è¯†åº“çš„RAGå›ç­”
    rag_response = await ai.get_openai_response(question, knowledge_base=kb)
    
    return response, rag_response

asyncio.run(rag_example())
```

### 3. **å®Œæ•´ä¸šåŠ¡æµç¨‹ç¤ºä¾‹**

```python
from async_ai_toolkit import AsyncCallAi, P_RAGKnowledgeBase, OSSHandler, ExportToEmail
import asyncio
import pandas as pd

async def complete_workflow():
    """å®Œæ•´çš„ä¸šåŠ¡å¤„ç†æµç¨‹ï¼šçŸ¥è¯†åº“æ„å»º â†’ AIåˆ†æ â†’ ç»“æœå¯¼å‡º"""
    
    # 1. ä»OSSè·å–æ•°æ®
    oss = OSSHandler()
    df = oss.get_excel_from_oss("business_data.xlsx")
    
    # 2. æ„å»ºä¸šåŠ¡çŸ¥è¯†åº“
    kb = P_RAGKnowledgeBase()
    kb.build_from_text("ä¸šåŠ¡è§„åˆ™æ–‡æ¡£å†…å®¹...")
    
    # 3. AIåˆ†ææ•°æ®
    ai = AsyncCallAi()
    ai.prompt = "ä½ æ˜¯ä¸€ä¸ªä¸šåŠ¡åˆ†æå¸ˆï¼Œè¯·åˆ†ææ•°æ®å¹¶æä¾›è§è§£ã€‚"
    
    analysis_prompts = [
        f"åˆ†æé”€å”®è¶‹åŠ¿: {df['sales'].tail(10).tolist()}",
        f"å®¢æˆ·åˆ†å¸ƒæƒ…å†µ: {df['customers'].describe().to_dict()}"
    ]
    
    results = await ai.chat(analysis_prompts)
    
    # 4. å¯¼å‡ºç»“æœåˆ°é‚®ç®±
    result_df = pd.DataFrame(results)
    email_result = ExportToEmail(
        df=result_df,
        receiver="team@company.com",
        subject="ä¸šåŠ¡åˆ†ææŠ¥å‘Š"
    )
    
    return email_result

# æ‰§è¡Œå®Œæ•´æµç¨‹
asyncio.run(complete_workflow())
```

### 4. **æ•°æ®åº“Schemaæ™ºèƒ½é—®ç­”**

```python
from async_ai_toolkit import AsyncCallAi, construct_schema
import asyncio

async def database_assistant():
    # æ„å»ºæ•°æ®åº“SchemaçŸ¥è¯†åº“
    schema_dict, schema_text = construct_schema(
        desc_path="table_desc.xlsx",
        sample_data_path="sample_data.xlsx", 
        table_name="database.users"
    )
    
    # åˆå§‹åŒ–æ•°æ®åº“åŠ©æ‰‹AI
    ai = AsyncCallAi()
    ai.prompt = f"""ä½ æ˜¯ä¸€ä¸ªæ•°æ®åº“ä¸“å®¶ï¼Œè¯·åŸºäºä»¥ä¸‹è¡¨ç»“æ„å›ç­”é—®é¢˜ï¼š
    
    {schema_text}
    
    è¯·ç”¨ä¸“ä¸šçš„SQLæœ¯è¯­å›ç­”ç”¨æˆ·é—®é¢˜ã€‚"""
    
    # æ•°æ®åº“ç›¸å…³é—®é¢˜
    questions = [
        "å¦‚ä½•æŸ¥è¯¢æ‰€æœ‰æ´»è·ƒç”¨æˆ·ï¼Ÿ",
        "ç”¨æˆ·è¡¨çš„ç´¢å¼•ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ",
        "å†™ä¸€ä¸ªç»Ÿè®¡ç”¨æˆ·æ³¨å†Œé‡çš„SQL"
    ]
    
    # æ‰¹é‡è·å–ä¸“ä¸šå›ç­”
    answers = await ai.chat(questions)
    
    for q, a in zip(questions, answers):
        print(f"Q: {q}")
        print(f"A: {a}\n")

asyncio.run(database_assistant())
```

## ğŸ”§ æ ¸å¿ƒç±»è¯¦è§£

### AsyncCallAi - å¼‚æ­¥AIå¯¹è¯

**ä¸»è¦æ–¹æ³•ï¼š**
- `async chat(text_list)`: æ‰¹é‡å¤„ç†å¯¹è¯è¯·æ±‚
- `async get_openai_response(text, knowledge_base=None)`: å•ä¸ªå¯¹è¯è¯·æ±‚ï¼Œæ”¯æŒçŸ¥è¯†åº“å¢å¼º
- `prompt`å±æ€§: è·å–æˆ–è®¾ç½®ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿

**å¼‚æ­¥ä¼˜åŠ¿ï¼š**
```python
# ä¼ ç»ŸåŒæ­¥æ–¹å¼ï¼ˆé¡ºåºæ‰§è¡Œï¼Œæ€»æ—¶é—´=å„è¯·æ±‚æ—¶é—´ä¹‹å’Œï¼‰
results = []
for prompt in prompts:
    result = sync_ai.chat(prompt)  # ç­‰å¾…ä¸Šä¸€ä¸ªå®Œæˆ
    results.append(result)

# å¼‚æ­¥æ–¹å¼ï¼ˆå¹¶å‘æ‰§è¡Œï¼Œæ€»æ—¶é—´â‰ˆæœ€æ…¢è¯·æ±‚æ—¶é—´ï¼‰
tasks = [async_ai.get_openai_response(prompt) for prompt in prompts]
results = await asyncio.gather(*tasks)  # åŒæ—¶å‘èµ·æ‰€æœ‰è¯·æ±‚
```

### P_RAGKnowledgeBase - çŸ¥è¯†åº“ç®¡ç†

**ä¸»è¦æ–¹æ³•ï¼š**
- `build_from_pdf(file_path)`: ä»PDFæ–‡ä»¶æ„å»ºå‘é‡çŸ¥è¯†åº“
- `build_from_text(text)`: ä»åŸå§‹æ–‡æœ¬æ„å»ºçŸ¥è¯†åº“  
- `build_from_schema(schema)`: ä»æ•°æ®åº“Schemaå­—å…¸æ„å»ºçŸ¥è¯†åº“
- `search(query, k=3)`: æ£€ç´¢ç›¸å…³çŸ¥è¯†ç‰‡æ®µ

## ğŸ¯ åº”ç”¨åœºæ™¯

### æ™ºèƒ½å®¢æœç³»ç»Ÿ
```python
async def customer_service():
    ai = AsyncCallAi()
    ai.prompt = "ä½ æ˜¯ä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ï¼Œè¯·å‹å¥½å›ç­”ç”¨æˆ·é—®é¢˜ã€‚"
    
    # æ‰¹é‡å¤„ç†ç”¨æˆ·å’¨è¯¢
    user_questions = await get_pending_questions()  # ä»æ•°æ®åº“è·å–å¾…å¤„ç†é—®é¢˜
    responses = await ai.chat(user_questions)
    
    # ä¿å­˜å›ç­”åˆ°æ•°æ®åº“
    await save_responses(responses)
```

### æ–‡æ¡£æ™ºèƒ½åˆ†æ
```python
async def document_analysis():
    # æ„å»ºæ–‡æ¡£çŸ¥è¯†åº“
    kb = P_RAGKnowledgeBase()
    kb.build_from_pdf("research_paper.pdf")
    
    ai = AsyncCallAi()
    ai.prompt = "è¯·åŸºäºæ–‡æ¡£å†…å®¹å›ç­”æŠ€æœ¯é—®é¢˜ã€‚"
    
    # RAGå¢å¼ºçš„æŠ€æœ¯é—®ç­”
    technical_questions = [
        "è®ºæ–‡çš„ä¸»è¦è´¡çŒ®æ˜¯ä»€ä¹ˆï¼Ÿ",
        "å®éªŒæ–¹æ³•éƒ¨åˆ†çš„å…³é”®æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ",
        "ç ”ç©¶ç»“è®ºå¯¹å®é™…åº”ç”¨æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"
    ]
    
    return await ai.chat(technical_questions, knowledge_base=kb)
```

### æ•°æ®æŠ¥å‘Šè‡ªåŠ¨åŒ–
```python
async def automated_reporting():
    # ä»å¤šä¸ªæ•°æ®æºæ„å»ºçŸ¥è¯†åº“
    kb = P_RAGKnowledgeBase()
    kb.build_from_pdf("business_guidelines.pdf")
    kb.build_from_text("å­£åº¦ä¸šç»©æ•°æ®...")
    
    ai = AsyncCallAi()
    ai.prompt = "åŸºäºä¸šåŠ¡çŸ¥è¯†åº“åˆ†ææ•°æ®å¹¶ç”ŸæˆæŠ¥å‘Šã€‚"
    
    analysis_requests = [
        "åˆ†ææœ¬å­£åº¦é”€å”®è¶‹åŠ¿",
        "è¯„ä¼°å¸‚åœºé£é™©å› ç´ ", 
        "æä¾›ä¸‹å­£åº¦ä¸šåŠ¡å»ºè®®"
    ]
    
    reports = await ai.chat(analysis_requests, knowledge_base=kb)
    
    # è‡ªåŠ¨å‘é€æŠ¥å‘Šé‚®ä»¶
    for report in reports:
        ExportToEmail(df=pd.DataFrame([report]), receiver="management@company.com")
```

## âš¡ æ€§èƒ½ä¼˜åŠ¿

### å¹¶å‘å¤„ç†å¯¹æ¯”
| åœºæ™¯ | åŒæ­¥å¤„ç† | å¼‚æ­¥å¤„ç† |
|------|----------|----------|
| 10ä¸ªAPIè¯·æ±‚ | 30ç§’ï¼ˆ3ç§’/ä¸ªï¼‰ | 3ç§’ï¼ˆå¹¶å‘ï¼‰ |
| 100ä¸ªå¯¹è¯ | 300ç§’ | 30ç§’ |
| æ··åˆæ“ä½œ | é¡ºåºæ‰§è¡Œ | å¹¶è¡Œæ‰§è¡Œ |

### ä»£ç ç¤ºä¾‹
```python
import asyncio
import time

async def benchmark():
    ai = AsyncCallAi()
    prompts = [f"é—®é¢˜{i}" for i in range(10)]
    
    # å¼‚æ­¥å¹¶å‘
    start = time.time()
    results = await ai.chat(prompts)
    async_time = time.time() - start
    
    print(f"å¼‚æ­¥å¤„ç†10ä¸ªè¯·æ±‚: {async_time:.2f}ç§’")
    return results

asyncio.run(benchmark())
```

## ğŸ”„ æ‰©å±•å¼€å‘

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•ï¼š

- **æ·»åŠ æ–°çš„AIæœåŠ¡**ï¼šç»§æ‰¿åŸºç¡€AIç±»å®ç°ç‰¹å®šæ¥å£
- **æ”¯æŒæ–°çš„æ–‡ä»¶æ ¼å¼**ï¼šåœ¨ç›¸åº”å¤„ç†å™¨ä¸­æ·»åŠ æ ¼å¼è§£æé€»è¾‘  
- **è‡ªå®šä¹‰çŸ¥è¯†åº“æ¥æº**ï¼šå®ç°æ–°çš„`build_from_*`æ–¹æ³•
- **é›†æˆå…¶ä»–äº‘æœåŠ¡**ï¼šæ·»åŠ æ–°çš„å¤„ç†å™¨ç±»

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¼‚æ­¥ç¯å¢ƒ**ï¼šç¡®ä¿åœ¨å¼‚æ­¥ç¯å¢ƒä¸­ä½¿ç”¨ï¼ˆasyncioã€Jupyterç­‰ï¼‰
2. **APIé™åˆ¶**ï¼šåˆç†æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…è§¦å‘APIé™åˆ¶
3. **èµ„æºç®¡ç†**ï¼šåŠæ—¶å…³é—­è¿æ¥ï¼Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶
4. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰æ“ä½œéƒ½æœ‰å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
