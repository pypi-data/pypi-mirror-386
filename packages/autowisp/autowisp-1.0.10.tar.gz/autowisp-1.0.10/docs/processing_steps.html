

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pipeline Steps &mdash; AutoWISP  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="_static/unlimited_width.css?v=eea1f72d" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration Options" href="wisp_options.html" />
    <link rel="prev" title="Example Usage: Processing the test data" href="test_data.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            AutoWISP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#run-the-tests-optional">Run the Tests (optional)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test_data.html">Example Usage: Processing the test data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Create-a-temporary-directory-to-work-in-(remember-to-delete-it-at-the-end),-enter-it,-and-get-its-path">Create a temporary directory to work in (remember to delete it at the end), enter it, and get its path</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Download-the-test-data">Download the test data</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-the-calibration-for-the-zero-frames">Perform the calibration for the zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Create-a-master-bias-by-stacking-the-calibrated-zero-frames">Create a master bias by stacking the calibrated zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-the-calibration-for-the-dark-frames">Perform the calibration for the dark frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Create-a-master-dark-by-stacking-the-calibrated-dark-images">Create a master dark by stacking the calibrated dark images</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-calibration-for-flat-frames">Perform calibration for flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Build-a-master-flat-out-of-the-individual-calibrated-flat-frames">Build a master flat out of the individual calibrated flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-calibration-for-object-frames">Perform calibration for object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Find-stars-in-the-calibrated-object-frames">Find stars in the calibrated object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-astrometry-on-DR-files">Perform astrometry on DR files</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-PSF/PRF-fitting">Perform PSF/PRF fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-aperture-photometry">Perform aperture photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Run-fit-source-extracted-PSF-map">Run fit source extracted PSF map</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-magnitude-fitting">Perform magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Create-light-curves">Create light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-EPD-on-light-curves">Perform EPD on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Generate-EPD-statistics-file-for-light-curves">Generate EPD statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Perform-TFA-on-light-curves">Perform TFA on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Generate-TFA-statistics-file-for-light-curves">Generate TFA statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="test_data.html#Extract-brightness-vs-time-from-lightcurves">Extract brightness vs time from lightcurves</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pipeline Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#split-raw-frames-by-type">Split Raw Frames by Type:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-calibration">1. Image Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#find-stars">2. Find Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="#astrometry">3. Astrometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prf-psf-fitting">4. PRF/PSF Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aperture-photometry">5. Aperture Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fit-psf-map-to-extracted-stars">6. Fit PSF Map to Extracted Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="#magnitude-fitting">7. Magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-lightcurves">8. Creating Lightcurves</a></li>
<li class="toctree-l2"><a class="reference internal" href="#external-parameter-decorrelation-epd">9. External Parameter Decorrelation (EPD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trend-filtering-algorithm-tfa">10. Trend Filtering Algorithm (TFA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wisp_options.html">Configuration Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation/autowisp.html">autowisp package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="implementation/autowisp.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="implementation/autowisp.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="implementation/autowisp.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AutoWISP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pipeline Steps</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/processing_steps.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pipeline-steps">
<h1>Pipeline Steps<a class="headerlink" href="#pipeline-steps" title="Link to this heading"></a></h1>
<p>The pipeline operations can be broken down into 10 big steps each of which is
described in more detail below. The results of each step are saved in three
types of files:</p>
<dl>
<dt>calibrated images:</dt><dd><p>These are the individual images of the night sky, corrected for bias, dark
current and flat fielding (see below). Those are stored using the <a class="reference external" href="https://fits.gsfc.nasa.gov/fits_primer.html">FITS</a> format with three
extensions:</p>
<blockquote>
<div><ul class="simple">
<li><p>The values of the image pixels</p></li>
<li><p>Formal estimate of the standard deviation of each pixel value</p></li>
<li><p>A pixel quality mask, flagging things like saturated pixels, pixels
which may have received charge from overflowing neighboring pixels, etc.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>data reduction files:</dt><dd><p>These are the files that contain information about the stars in each image
extracted from the calibrated images. Including things like star positions,
point spread function information, flux measurements, etc. They are
generally in FITS format and can be used for further analysis. Those are in
<a class="reference external" href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a> format.</p>
</dd>
<dt>lightcurves:</dt><dd><p>These are the files that contain the time series of all available
measurements for a given star star in each image. They are generally in
<a class="reference external" href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a> format, and include
things like several different version of flux measurements, coordinates of
the star in the image, and many others.</p>
</dd>
</dl>
<section id="split-raw-frames-by-type">
<h2>Split Raw Frames by Type:<a class="headerlink" href="#split-raw-frames-by-type" title="Link to this heading"></a></h2>
<p>Before you begin processing the images you have accumulated, a bit of
preparation is needed. It is very convenient and helps avoid mistakes if you
split your images inte separate directories by type:</p>
<blockquote>
<div><dl class="simple">
<dt>bias</dt><dd><p>Images with near-zero exposure intended to measure the behavior of the
analog-to-digital converter(s) of your camera. This shows up in the
final image as a value that each pixel starts at, even if there is no
signal.</p>
</dd>
<dt>dark</dt><dd><p>Images with no light falling on the detector, but exposure similar
(ideally equal) to the exposure used for science images. These are
intended to measure the rate of accumulation of charge in the detector
pixels in the absence of light.</p>
</dd>
<dt>flat</dt><dd><p>Images of something with uniform brightness (or as close to it as one
can manage). There are intended to measure the sensitivity to light of
the system coming from different directions.</p>
</dd>
<dt>object</dt><dd><p>Images of the night sky from which photometry is to be extracted. Those
can further be split into sub-groups from which independent lightcurves
need to be generated. For example if several different exposure times
were used, or there could be a number of filters or other chages in the
optical system between frames which may produce better results if
processed independently.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="image-calibration">
<h2>1. Image Calibration<a class="headerlink" href="#image-calibration" title="Link to this heading"></a></h2>
<p><strong>Commands:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code>, <code class="docutils literal notranslate"><span class="pre">wisp-stack-to-master</span></code>,
<code class="docutils literal notranslate"><span class="pre">wisp-stack-to-master-flat</span></code></p>
<section id="important-parameters">
<h3>Important Parameters<a class="headerlink" href="#important-parameters" title="Link to this heading"></a></h3>
<p>The most important parameters to set for the calibration are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-exposure-start-utc"><code class="xref std std-option docutils literal notranslate"><span class="pre">exposure-start-utc</span></code></a> or <a class="reference internal" href="wisp_options.html#cmdoption-arg-exposure-start-jd"><code class="xref std std-option docutils literal notranslate"><span class="pre">exposure-start-jd</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-exposure-seconds"><code class="xref std std-option docutils literal notranslate"><span class="pre">exposure-seconds</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-saturation-threshold"><code class="xref std std-option docutils literal notranslate"><span class="pre">saturation-threshold</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-fnum"><code class="xref std std-option docutils literal notranslate"><span class="pre">fnum</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-image-area"><code class="xref std std-option docutils literal notranslate"><span class="pre">image-area</span></code></a>: If your camera generates images with overscan or
other areas that are not part of the image.</p></li>
<li><p><code class="xref std std-option docutils literal notranslate"><span class="pre">split-channels</span></code> or <a class="reference internal" href="wisp_options.html#cmdoption-arg-raw-hdu"><code class="xref std std-option docutils literal notranslate"><span class="pre">raw-hdu</span></code></a>: If using a color
detector</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-gain"><code class="xref std std-option docutils literal notranslate"><span class="pre">gain</span></code></a>: If known. Used for accurate error estimates.</p></li>
</ul>
</section>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h3>
<p>Before raw images are used, they need to be calibrated. The sequence of steps
is:</p>
<blockquote>
<div><dl class="simple">
<dt>calibrate the raw bias images</dt><dd><p>Accomplished using <code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code> command with no master files
specified with raw bias images as input.</p>
</dd>
<dt>generate master bias image</dt><dd><p>Use <code class="docutils literal notranslate"><span class="pre">wisp-stack-to-master</span></code> command with the calibrated bias images as
input.</p>
</dd>
<dt>calibrate raw dark images using the master bias</dt><dd><p><code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code> with the <a class="reference internal" href="wisp_options.html#cmdoption-arg-master-bias"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-bias</span></code></a> option set to the
master bias file generated in the step above.</p>
</dd>
<dt>generate master dark image</dt><dd><p>Just like generating master bias but using the calibrated dark images.</p>
</dd>
<dt>calibrate the raw flat images</dt><dd><p><code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code> with the <a class="reference internal" href="wisp_options.html#cmdoption-arg-master-bias"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-bias</span></code></a> option set to the
master bias file and the <a class="reference internal" href="wisp_options.html#cmdoption-arg-master-dark"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-dark</span></code></a> option set to the master
dark.</p>
</dd>
<dt>generate master flat image(s)</dt><dd><p><code class="docutils literal notranslate"><span class="pre">wisp-stack-to-master-flat</span></code> command. This is different from how master
bias and dark are created, because AutoWISP is designed to allow using
sky flats, which may be affected by clouds, or the sky is not perfectly
uniformly bright.</p>
</dd>
<dt>calibrate raw object images</dt><dd><p><code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code> with <a class="reference internal" href="wisp_options.html#cmdoption-arg-master-bias"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-bias</span></code></a>,
<a class="reference internal" href="wisp_options.html#cmdoption-arg-master-dark"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-dark</span></code></a>, and <a class="reference internal" href="wisp_options.html#cmdoption-arg-master-flat"><code class="xref std std-option docutils literal notranslate"><span class="pre">master-flat</span></code></a> all specified.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="no-calibration-data">
<h3>No Calibration Data?<a class="headerlink" href="#no-calibration-data" title="Link to this heading"></a></h3>
<p>In case calibration data is not available, only the last of these steps needs to
be performed, with no masters specified (see below). Even though in this case
the pixels values will not be corrected for any of the effects described above,
this step is still needed. It will add change the data format (float point
instead of integer), add required information in the headher, split the
different colors if using a color camera etc.</p>
</section>
<section id="overscan-corrections">
<h3>Overscan Corrections<a class="headerlink" href="#overscan-corrections" title="Link to this heading"></a></h3>
<p>In many instances, the imaging device provides extra areas that attempt to
measure bias level and dark current, e.g. by continuing to read pixels past the
physical number of pixels in the device, thus measuring the bias or by having an
area of pixels which are somehow shielded from light, thus measuring the dark
level in real time. Such corrections can be supierior to the master frames in
that they measure the instantaneous bias and dark level, which may vary over
time due to for example the temperature of the detector varying. However, bias
level and dark current in particular can vary from pixel to pixel, which is not
captured by these real-time areas. Hence, the best strategy is a combination of
both, and is different for different detectors.</p>
<p>AutoWISP allows (but does not require) such areas to be used to estimate
some smooth function of image position to subtract from each raw image, and then
the masters are applied to the result. This works mathematically, because the
masters will also have their values corrected for the bias and dark measured by
these areas from the individual frames that were used to construct them. In this
scheme, the master frames are used only to capture the pixel to pixel
differences in bias and dark current. We refer to these areas as “overscan”,
although that term really means only one type of such area.</p>
<p>Overscan area(s) can be specified using the <a class="reference internal" href="wisp_options.html#cmdoption-arg-overscans"><code class="xref std std-option docutils literal notranslate"><span class="pre">overscans</span></code></a> option of the
<code class="docutils literal notranslate"><span class="pre">wisp-calibrate</span></code> command.</p>
</section>
</section>
<section id="find-stars">
<span id="srcfind-section"></span><h2>2. Find Stars<a class="headerlink" href="#find-stars" title="Link to this heading"></a></h2>
<p><strong>Command:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-find-stars</span></code></p>
<section id="id2">
<h3>Important parameters<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-brightness-threshold"><code class="xref std std-option docutils literal notranslate"><span class="pre">brightness-threshold</span></code></a>.</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-filter-sources"><code class="xref std std-option docutils literal notranslate"><span class="pre">filter-sources</span></code></a> (if needed)</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-srcextract-max-sources"><code class="xref std std-option docutils literal notranslate"><span class="pre">srcextract-max-sources</span></code></a> (if needed)</p></li>
</ul>
</section>
<section id="id3">
<h3>Description<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Before AutoWISP can measure the brightnesses of the star in images, it needs to
know the coordinates of the stars in the image. Finding a reliable sets of
coordinates consists of two steps: running a source extraction algorithm to find
an initial (not extremely precise) list of stars and their coordinates, and
then matching these stars to an external high-precision and high-accuracy in
order to find a function that can convert the coordinates of the stars in the
catalogue to coordinates of the stars in the image.</p>
<p>The first of these steps is performed using the <code class="docutils literal notranslate"><span class="pre">wisp-find-stars</span></code> command.
Behind the scenes, this command runs the source extraction algorithm
from the <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2012MNRAS.421.1825P/abstract">FITSH</a> package.</p>
<p>The browser interface provides a sandbox where source extraction can be tested
interactively on any calibrated image with different values of
<a class="reference internal" href="wisp_options.html#cmdoption-arg-brightness-threshold"><code class="xref std std-option docutils literal notranslate"><span class="pre">brightness-threshold</span></code></a>, <a class="reference internal" href="wisp_options.html#cmdoption-arg-filter-sources"><code class="xref std std-option docutils literal notranslate"><span class="pre">filter-sources</span></code></a>, and
<a class="reference internal" href="wisp_options.html#cmdoption-arg-srcextract-max-sources"><code class="xref std std-option docutils literal notranslate"><span class="pre">srcextract-max-sources</span></code></a>.</p>
</section>
</section>
<section id="astrometry">
<h2>3. Astrometry<a class="headerlink" href="#astrometry" title="Link to this heading"></a></h2>
<p><strong>Commnd:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-solve-astrometry</span></code></p>
<section id="id4">
<h3>Important Parameters<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-astrometry-catalog-max-magnitude"><code class="xref std std-option docutils literal notranslate"><span class="pre">astrometry-catalog-max-magnitude</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-max-srcmatch-distance"><code class="xref std std-option docutils literal notranslate"><span class="pre">max-srcmatch-distance</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-astrometry-order"><code class="xref std std-option docutils literal notranslate"><span class="pre">astrometry-order</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-min-match-fraction"><code class="xref std std-option docutils literal notranslate"><span class="pre">min-match-fraction</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-max-rms-distance"><code class="xref std std-option docutils literal notranslate"><span class="pre">max-rms-distance</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-frame-center-estimate"><code class="xref std std-option docutils literal notranslate"><span class="pre">frame-center-estimate</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-frame-fov-estimate"><code class="xref std std-option docutils literal notranslate"><span class="pre">frame-fov-estimate</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-anet-api-key"><code class="xref std std-option docutils literal notranslate"><span class="pre">anet-api-key</span></code></a> if using the online astrometry.net service.</p></li>
</ul>
</section>
<section id="id5">
<h3>Description<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">wisp-solve-astrometry</span></code> command finds the transformation that converts sky
coordinates (right ascention and declination) into image coorditanes (x, y). This
allows the use of external catalogue data for more precise positions of the
sources than can be extracted from survey images and also the use of auxiliary
data provided in the catalogue about each source, in the subsequent processing
steps of the pipeline.</p>
<p>Astrometry is accomplished in 2 steps. First, AutoWISP uses <a class="reference external" href="https://nova.astrometry.net/">astrometry.net</a> to find an initial match between the few tens
(to few hundred) brightest extracted source to the Gaia catalog, and then
iteratively refines this match and the transformation parameters to match almost
every single extracted source to its catalog counterpart. For wide-field images,
this means thousands of matches that are used to find the transfomation
parameters, allowing AutoWISP to model transformation involving signifiacant
image distortion, which often occurs in wide-field images.</p>
</section>
</section>
<section id="prf-psf-fitting">
<span id="psffit-section"></span><h2>4. PRF/PSF Fitting<a class="headerlink" href="#prf-psf-fitting" title="Link to this heading"></a></h2>
<p><strong>Command:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-fit-star-shape</span></code></p>
<section id="id6">
<h3>Important Parameters<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-photometry-catalog-max-magnitude"><code class="xref std std-option docutils literal notranslate"><span class="pre">photometry-catalog-max-magnitude</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-subpixmap"><code class="xref std std-option docutils literal notranslate"><span class="pre">subpixmap</span></code></a>: if processing images collected with a color camera</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-background-annulus"><code class="xref std std-option docutils literal notranslate"><span class="pre">background-annulus</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-shapefit-smoothing"><code class="xref std std-option docutils literal notranslate"><span class="pre">shapefit-smoothing</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-shape-grid"><code class="xref std std-option docutils literal notranslate"><span class="pre">shape-grid</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-shape-mode"><code class="xref std std-option docutils literal notranslate"><span class="pre">shape-mode</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-shape-terms-expression"><code class="xref std std-option docutils literal notranslate"><span class="pre">shape-terms-expression</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-map-variables"><code class="xref std std-option docutils literal notranslate"><span class="pre">map-variables</span></code></a></p></li>
</ul>
</section>
<section id="id7">
<h3>Description<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>The first flux measurements AutoWISP generates for each image is one based on
fitting for the shape of stars in the image and the flux (as the proportionality
constant before the shape and the actual pixels belonging to that star on the
image), called PSF or PRF fitting. This is accomplished by the
<code class="docutils literal notranslate"><span class="pre">wisp-fit-star-shape</span></code> command.</p>
<p>Each point source once it is imaged by our observing system produces a
particular distribution of light on the detector.  The idea of PRF and PSF
fitting is to model that distribution as some smooth parametric function
centered on the projected source position that has an integral of one. For each
star AutoWISP also fits for the amplitude that best scales this shape to the
observed pixel values. The amplitude of course is then a measure of the flux of
the source, while the parameters of the function specify its shape.</p>
<p>To review the terms:</p>
<blockquote>
<div><ul class="simple">
<li><p>Point Spread Function or PSF: PSF(dx, dy) is the amount of light that hits
the surface of the detector offset by (dx, dy) from the projected position
of the source. In order to actually predict what a particular detector
pixel will measure, one computes the integral of the PSF times a sub-pixel
sensitivity map over the area of the pixel.</p></li>
<li><p>Pixel Response Function or PRF: PRF(dx, dy) is the value that a pixel with
a center offset by (dx, dy) from the projected source position will
register.  Note that dx and dy can be arbitrary real values and not just
integers. The PRF already folds in its definition the sub-pixel
sensitivity map, and other detector characteristics. Further, since the
PRF is the PSF convolved with the sub-pixel sensitiity map it is generally
smoother than the PSF and thus easier to model.</p></li>
</ul>
</div></blockquote>
<p>In this pipeline we use <a class="reference external" href="https://github.com/kpenev/AstroWISP">AstroWISP</a> to
perform PSF and PRF fitting. For the details of how this is done, see the
<a class="reference external" href="https://kpenev.github.io/AstroWISP/">AstroWISP documentation</a>. Briefly, the
PSF and PRF are modeled as piecewise bi-cubic functions with a number of free
parameters.  These parameters are in turn forced to vary smoothly as a function
of source and image properties across sources and across images.</p>
<p>The information from PSF fitting is then used in the next step
(<a class="reference internal" href="#apphot-section"><span class="std std-ref">Aperture Photometry</span></a>)</p>
</section>
</section>
<section id="aperture-photometry">
<span id="apphot-section"></span><h2>5. Aperture Photometry<a class="headerlink" href="#aperture-photometry" title="Link to this heading"></a></h2>
<p><strong>Command</strong>: <code class="docutils literal notranslate"><span class="pre">wisp-measure-aperture-photometry</span></code></p>
<section id="id8">
<h3>Important Parameters<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-apertures"><code class="xref std std-option docutils literal notranslate"><span class="pre">apertures</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-subpixmap"><code class="xref std std-option docutils literal notranslate"><span class="pre">subpixmap</span></code></a>: if processing images collected with a color camera</p></li>
</ul>
</section>
<section id="id9">
<h3>Description<a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<p>For each source, <code class="docutils literal notranslate"><span class="pre">wisp-measure-aperture-photometry</span></code> sums-up the flux in the
image within a series of concentric circles centered on the projected source
position. In order to properly handle the inevitable pixels that are partiallly
within an aperture, knowledge of the distribution of light accross these pixels
as well as the sub-pixel sensitivy map is required.</p>
</section>
</section>
<section id="fit-psf-map-to-extracted-stars">
<h2>6. Fit PSF Map to Extracted Stars<a class="headerlink" href="#fit-psf-map-to-extracted-stars" title="Link to this heading"></a></h2>
<p><strong>Command:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-fit-source-extracted-psf-map</span></code></p>
<section id="id10">
<h3>Important Parameters<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-srcextract-psfmap-terms"><code class="xref std std-option docutils literal notranslate"><span class="pre">srcextract-psfmap-terms</span></code></a></p></li>
</ul>
<p>The various systematics removal steps in the pipeline can make use of
information about the shape of stars in the images (a.k.a. PRF). That can come
from two sources: <a class="reference internal" href="#srcfind-section"><span class="std std-ref">the find stars step</span></a> as part of the
process fits for a PRF model, and obviously the <a class="reference internal" href="#psffit-section"><span class="std std-ref">PSF/PRF fitting step</span></a> does as well. At the moment, the latter does not produce
summary information (e.g.  full-width at half maximum, ellpticity, etc.).
Furthermore, in many applications, the <a class="reference internal" href="#psffit-section"><span class="std std-ref">PSF/PRF fitting step</span></a> is too computationally expensive, and so it is replaced with a
dummy fit.  The result is that presently we rely on information from <a class="reference internal" href="#srcfind-section"><span class="std std-ref">the
find stars step</span></a>.</p>
<p>Fitting the PRF of each individual star (as <a class="reference internal" href="#srcfind-section"><span class="std std-ref">the find stars step</span></a> does) results in quite noisy estimated parameters. In order
to reduce that noise, this step of the pipeline fits a smooth function of image
position and possibly stellar properties (brightness, color, etc. from the
catalog) to each of the relevant parameters. Because the fit is based on a large
number of stars, the noise gets averaged out to a large extent. The map is then
evaluated for each star to produce higher-quality estimates of the PRF
parameters.</p>
<p>The step is accomplished by the <code class="docutils literal notranslate"><span class="pre">wisp-fit-source-extracted-psf-map</span></code> command.</p>
</section>
</section>
<section id="magnitude-fitting">
<h2>7. Magnitude fitting<a class="headerlink" href="#magnitude-fitting" title="Link to this heading"></a></h2>
<p><strong>Command:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-fit-magnitudes</span></code></p>
<section id="id11">
<h3>Important Parameters<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-single-photref-dr-fname"><code class="xref std std-option docutils literal notranslate"><span class="pre">single-photref-dr-fname</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-correction-parametrization"><code class="xref std std-option docutils literal notranslate"><span class="pre">correction-parametrization</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-magfit-catalog-max-magnitude"><code class="xref std std-option docutils literal notranslate"><span class="pre">magfit-catalog-max-magnitude</span></code></a></p></li>
</ul>
</section>
<section id="id12">
<h3>Description<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p>In ground based applications, the night sky is imaged through variable amount of
atmosphere, which itself is subject to changes (i.e. clouds, humidity, etc.). In
addition various instrumental effects are generally present. The purpose of the
magnitude fitting step is to eliminate as much as possible effects that modify
the measured source brightness within an image in a manner that depends
smoothly on the properties of the source.</p>
<p>In short, a reference frame is selected (and later generated). Then for each
individual frame (target frame from now on) a smooth multiplicative correction
is derived that when applied to the brightness measurements in the target frame
matches the brightness measurements in the reference frame as closely as
possible.</p>
<p>In the pipeline this is actually done multiple times. The first time, a single
frame which appears to be of very high quality (sharp PSF, high atmospheric
transparency, dark sky etc.) is used as the reference frame. The corrected
brightness measurements of the individua frames are then stacked to produce a
much highe signal to noise “master reference frame”, which is then used in a
second iteration of the magnitude fitting process and so on.</p>
</section>
</section>
<section id="creating-lightcurves">
<h2>8. Creating Lightcurves<a class="headerlink" href="#creating-lightcurves" title="Link to this heading"></a></h2>
<p><strong>Command:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-create-lightcurves</span></code></p>
<section id="id13">
<h3>Important Parameters<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-lc-catalog-max-magnitude"><code class="xref std std-option docutils literal notranslate"><span class="pre">lc-catalog-max-magnitude</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-max-memory"><code class="xref std std-option docutils literal notranslate"><span class="pre">max-memory</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-latitude-deg"><code class="xref std std-option docutils literal notranslate"><span class="pre">latitude-deg</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-longitude-deg"><code class="xref std std-option docutils literal notranslate"><span class="pre">longitude-deg</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-altitude-meters"><code class="xref std std-option docutils literal notranslate"><span class="pre">altitude-meters</span></code></a></p></li>
</ul>
</section>
<section id="id14">
<h3>Description<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<p>This is a simple transpose operation. In all previous steps, the photometry is
extracted simultaneously for all sources in a given image or in a short series
of images. In order to study each source’s individual variability, the
measurements from all frames for that source must be collected together. This
step simply performs that reorganization. For each catalogue source, all
available measurements from the individual frames are collected in a file,
possibly combined with earlier measurements from say a different but overlapping
pointing of the telescope or with another instrumental set-up.</p>
</section>
</section>
<section id="external-parameter-decorrelation-epd">
<h2>9. External Parameter Decorrelation (EPD)<a class="headerlink" href="#external-parameter-decorrelation-epd" title="Link to this heading"></a></h2>
<p><strong>Commands:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-epd</span></code>, <code class="docutils literal notranslate"><span class="pre">wisp-generate-epd-statistics</span></code></p>
<section id="id15">
<h3>Important Parameters<a class="headerlink" href="#id15" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-variables"><code class="xref std std-option docutils literal notranslate"><span class="pre">variables</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-epd-datasets"><code class="xref std std-option docutils literal notranslate"><span class="pre">epd-datasets</span></code></a> (automatically set by BUI but not on the command line)</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-epd-terms-expression"><code class="xref std std-option docutils literal notranslate"><span class="pre">epd-terms-expression</span></code></a></p></li>
</ul>
</section>
<section id="id16">
<h3>Description<a class="headerlink" href="#id16" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">wisp-epd</span></code> command removes from each individual lightcurve the linear
combintion of user specified instrumental and other time variable parameters
that explain the most variance. Clearly care must be taken when selecting the
parameters to decorrelate against, lest they vary on similar timescales as the
target signal.  If this happens, this step will highly distort if not eliminate
the target signal.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">wisp-generate-epd-statistics</span></code> command is used to calculate summary
statistics for each lightcurve, showing how much scatter remains in it. This
information is useb by the <a class="reference internal" href="#tfa-section"><span class="std std-ref">TFA step</span></a> to select stars that
would serve as good templates.</p>
</section>
</section>
<section id="trend-filtering-algorithm-tfa">
<span id="tfa-section"></span><h2>10. Trend Filtering Algorithm (TFA)<a class="headerlink" href="#trend-filtering-algorithm-tfa" title="Link to this heading"></a></h2>
<p><strong>Commands:</strong> <code class="docutils literal notranslate"><span class="pre">wisp-tfa</span></code>, <code class="docutils literal notranslate"><span class="pre">wisp-generate-tfa-statistics</span></code></p>
<section id="id17">
<h3>Important Parameters<a class="headerlink" href="#id17" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-tfa-datasets"><code class="xref std std-option docutils literal notranslate"><span class="pre">tfa-datasets</span></code></a> (automatically set by BUI but not on the command line)</p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-tfa-faint-mag-limit"><code class="xref std std-option docutils literal notranslate"><span class="pre">tfa-faint-mag-limit</span></code></a></p></li>
<li><p><a class="reference internal" href="wisp_options.html#cmdoption-arg-tfa-sqrt-num-templates"><code class="xref std std-option docutils literal notranslate"><span class="pre">tfa-sqrt-num-templates</span></code></a></p></li>
</ul>
<p>In this step signals which are shared by mulitple stars are removed from each
star’s lightcurve. The idea is that most instrumental effects will affect
multiple stars in a similar way, and thus signals common to several sources
are suspected of being instrumental, rather than real astrophysical variability.
Again this steps has the potential to distort or eliminate target signals, so it
should be used with care. If the shape of the target signal is known, there are
versions of this procedure which tend to preserve it.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="test_data.html" class="btn btn-neutral float-left" title="Example Usage: Processing the test data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wisp_options.html" class="btn btn-neutral float-right" title="Configuration Options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Kaloyan Penev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>