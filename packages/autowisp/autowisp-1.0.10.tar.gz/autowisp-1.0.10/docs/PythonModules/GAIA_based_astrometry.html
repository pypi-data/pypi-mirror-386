

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GAIA Based Astrometry &mdash; AutoWISP  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/unlimited_width.css?v=eea1f72d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AutoWISP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#run-the-tests-optional">Run the Tests (optional)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../test_data.html">Example Usage: Processing the test data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-temporary-directory-to-work-in-(remember-to-delete-it-at-the-end),-enter-it,-and-get-its-path">Create a temporary directory to work in (remember to delete it at the end), enter it, and get its path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Download-the-test-data">Download the test data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-the-calibration-for-the-zero-frames">Perform the calibration for the zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-master-bias-by-stacking-the-calibrated-zero-frames">Create a master bias by stacking the calibrated zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-the-calibration-for-the-dark-frames">Perform the calibration for the dark frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-master-dark-by-stacking-the-calibrated-dark-images">Create a master dark by stacking the calibrated dark images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-calibration-for-flat-frames">Perform calibration for flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Build-a-master-flat-out-of-the-individual-calibrated-flat-frames">Build a master flat out of the individual calibrated flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-calibration-for-object-frames">Perform calibration for object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Find-stars-in-the-calibrated-object-frames">Find stars in the calibrated object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-astrometry-on-DR-files">Perform astrometry on DR files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-PSF/PRF-fitting">Perform PSF/PRF fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-aperture-photometry">Perform aperture photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Run-fit-source-extracted-PSF-map">Run fit source extracted PSF map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-magnitude-fitting">Perform magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-light-curves">Create light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-EPD-on-light-curves">Perform EPD on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Generate-EPD-statistics-file-for-light-curves">Generate EPD statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-TFA-on-light-curves">Perform TFA on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Generate-TFA-statistics-file-for-light-curves">Generate TFA statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Extract-brightness-vs-time-from-lightcurves">Extract brightness vs time from lightcurves</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../processing_steps.html">Pipeline Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#split-raw-frames-by-type">Split Raw Frames by Type:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#image-calibration">1. Image Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#find-stars">2. Find Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#astrometry">3. Astrometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#prf-psf-fitting">4. PRF/PSF Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#aperture-photometry">5. Aperture Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#fit-psf-map-to-extracted-stars">6. Fit PSF Map to Extracted Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#magnitude-fitting">7. Magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#creating-lightcurves">8. Creating Lightcurves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#external-parameter-decorrelation-epd">9. External Parameter Decorrelation (EPD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#trend-filtering-algorithm-tfa">10. Trend Filtering Algorithm (TFA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wisp_options.html">Configuration Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/autowisp.html">autowisp package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../implementation/autowisp.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../implementation/autowisp.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../implementation/autowisp.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AutoWISP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GAIA Based Astrometry</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/PythonModules/GAIA_based_astrometry.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gaia-based-astrometry">
<h1>GAIA Based Astrometry<a class="headerlink" href="#gaia-based-astrometry" title="Link to this heading"></a></h1>
<section id="querying-the-gaia-catalogue">
<h2>Querying the GAIA Catalogue<a class="headerlink" href="#querying-the-gaia-catalogue" title="Link to this heading"></a></h2>
<p>The first task is to allow creating lists of sources  in a rectangular or
circular area of the sky down to some limiting magnitude, optionally imposing
cuts based on other factors, e.g.  color quality flags etc. The minimum
information required is:</p>
<blockquote>
<div><ul class="simple">
<li><p>GAIA Source Identifier</p></li>
<li><p>Sky position (RA, Dec), optionally corrected for proper motion</p></li>
<li><p>Some indicator of the brightness of the source in a relevant filter</p></li>
<li><p>Any relevant quality flags for the reliability of the position or
brightness.</p></li>
</ul>
</div></blockquote>
<p>It is worth considering if more efficient queries can be accomplished by
re-packaging the GAIA data release files into another format, e.g. one splitting
the data based on HEALPix of a level coarser than 12, sorting by flux etc. Some
options include:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Advantages</p></th>
<th class="head" colspan="2"><p>Disadvantages/Concerns</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mysql</p></td>
<td><ul class="simple">
<li><p>Can add indices by
sub-HEALPix, brightness,
color etc.</p></li>
<li><p>Can partition table by super-
HEALPix.</p></li>
</ul>
</td>
<td colspan="2"><ul class="simple">
<li><p>Could result in big data
volume.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>sqlite</p></td>
<td><ul class="simple">
<li><p>Can add indices by
sub-HEALPix, brightness,
color etc.</p></li>
<li><p>Each batch of data can be in
a separate file</p></li>
</ul>
</td>
<td colspan="2"><ul class="simple">
<li><p>Could result in big data
volume.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>FITS</p></td>
<td><ul class="simple">
<li><p>Very standard</p></li>
<li><p>Each batch of data can be in
a separate file</p></li>
</ul>
</td>
<td colspan="2"><ul class="simple">
<li><p>More work to perform queries.</p></li>
<li><p>Possibly slower queries
(no indices).</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>HDF5</p></td>
<td><ul class="simple">
<li><p>Good compression options.</p></li>
<li><p>Each batch of data can be in
a separate file</p></li>
</ul>
</td>
<td colspan="2"><ul class="simple">
<li><p>More work to perform queries.</p></li>
<li><p>Possibly slower queries.
(no indices).</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Queries will be accomplished in three or four steps depnending on how the data
is organized:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Using the healpy module get a list of HEALPix indices covering the query
area.</p></li>
<li><p><strong>If not using a database</strong>, get a list of the GAIA data release files
containing the identified indices.</p></li>
<li><p>Extract all sources from the selected pixels and apply the specified
magnitude, color etc. cuts.</p></li>
<li><p>Apply proper motion corrections to the desired epoch.</p></li>
</ol>
</div></blockquote>
</section>
<section id="source-extraction">
<h2>Source Extraction<a class="headerlink" href="#source-extraction" title="Link to this heading"></a></h2>
<p>There are four possible source extractor tools:</p>
<blockquote>
<div><ul class="simple">
<li><p><cite>fistar</cite> (from HATpipe)</p></li>
<li><p><cite>hatphot</cite> (from HATpipe)</p></li>
<li><p><cite>sextractor</cite></p></li>
<li><p><cite>simplexy</cite> (from astrometry.net)</p></li>
</ul>
</div></blockquote>
<p>In practice <cite>simplexy</cite> seems to misbehave if sources are over-sampled, requiring
binning, which necessarily degrades the precision of the extracted source
positions, os it is probably not competitive with the other options. All other
options will eventually be supported by the pipeline. The result of source
extraction will always consist of (x, y) image positons, an estiamte of the
source brightness and some indicators for the properties of the source (e.g.
extendend vs point source, signal to noise, etc.</p>
</section>
<section id="two-step-plate-solving">
<h2>Two Step Plate Solving<a class="headerlink" href="#two-step-plate-solving" title="Link to this heading"></a></h2>
<section id="step-1-astrometry-net">
<h3>Step 1: Astrometry.net<a class="headerlink" href="#step-1-astrometry-net" title="Link to this heading"></a></h3>
<p><a class="reference external" href="http://astrometry.net">Astrometry.net</a> provides unparalleled robustness in
finding the location on sky of a collection of sources. To take advantage of
that we will first use a locally compiled copy of <cite>solve-field</cite> along with the
standard indices shipped by <cite>astrometry.net</cite> to find an approximate astrometric
solution for the extracted sources from the <a class="reference internal" href="#source-extraction">Source Extraction</a> step, producing
a WCS file.</p>
</section>
<section id="step-2-refinement-based-on-gaia">
<h3>Step 2: Refinement based on GAIA<a class="headerlink" href="#step-2-refinement-based-on-gaia" title="Link to this heading"></a></h3>
<p>The approximate solution derived above is refined as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The sky to frame transformaion from the WCS file above will be used to
project the list of catalogue sources obtained by <a class="reference internal" href="#querying-the-gaia-catalogue">Querying the GAIA
Catalogue</a>, using the <cite>astropy.wcs module
&lt;http://docs.astropy.org/en/stable/wcs/index.html&gt;</cite></p></li>
<li><p>Build a <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.cKDTree.html">cKDtree</a>
from the projected sources, and query it for the neighbours within some
tolerance to each extracted source.</p></li>
<li><p>Resolve multiple candidate matches are using brightness informatino or
discard matches if no clear determination can be made.</p></li>
<li><p>Derive a polynomial transformation between tan-projected (RA, Dec)
positions of the matched sources and the corresponding extracted image (x,
y) positions. This will be done iteratively, re-deriving the center used
for tan projection by inverting the last solution for the central image
position, until the center changes no more than some tolerance. Usually
just a single re-fit is necessary.</p></li>
</ol>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Kaloyan Penev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>