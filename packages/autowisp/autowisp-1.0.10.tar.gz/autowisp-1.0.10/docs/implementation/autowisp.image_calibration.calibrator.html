

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>autowisp.image_calibration.calibrator module &mdash; AutoWISP  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/unlimited_width.css?v=eea1f72d" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="autowisp.image_calibration.fits_util module" href="autowisp.image_calibration.fits_util.html" />
    <link rel="prev" title="autowisp.image_calibration package" href="autowisp.image_calibration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AutoWISP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#run-the-tests-optional">Run the Tests (optional)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../test_data.html">Example Usage: Processing the test data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-temporary-directory-to-work-in-(remember-to-delete-it-at-the-end),-enter-it,-and-get-its-path">Create a temporary directory to work in (remember to delete it at the end), enter it, and get its path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Download-the-test-data">Download the test data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-the-calibration-for-the-zero-frames">Perform the calibration for the zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-master-bias-by-stacking-the-calibrated-zero-frames">Create a master bias by stacking the calibrated zero frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-the-calibration-for-the-dark-frames">Perform the calibration for the dark frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-a-master-dark-by-stacking-the-calibrated-dark-images">Create a master dark by stacking the calibrated dark images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-calibration-for-flat-frames">Perform calibration for flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Build-a-master-flat-out-of-the-individual-calibrated-flat-frames">Build a master flat out of the individual calibrated flat frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-calibration-for-object-frames">Perform calibration for object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Find-stars-in-the-calibrated-object-frames">Find stars in the calibrated object frames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-astrometry-on-DR-files">Perform astrometry on DR files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-PSF/PRF-fitting">Perform PSF/PRF fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-aperture-photometry">Perform aperture photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Run-fit-source-extracted-PSF-map">Run fit source extracted PSF map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-magnitude-fitting">Perform magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Create-light-curves">Create light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-EPD-on-light-curves">Perform EPD on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Generate-EPD-statistics-file-for-light-curves">Generate EPD statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Perform-TFA-on-light-curves">Perform TFA on light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Generate-TFA-statistics-file-for-light-curves">Generate TFA statistics file for light curves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test_data.html#Extract-brightness-vs-time-from-lightcurves">Extract brightness vs time from lightcurves</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../processing_steps.html">Pipeline Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#split-raw-frames-by-type">Split Raw Frames by Type:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#image-calibration">1. Image Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#find-stars">2. Find Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#astrometry">3. Astrometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#prf-psf-fitting">4. PRF/PSF Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#aperture-photometry">5. Aperture Photometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#fit-psf-map-to-extracted-stars">6. Fit PSF Map to Extracted Stars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#magnitude-fitting">7. Magnitude fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#creating-lightcurves">8. Creating Lightcurves</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#external-parameter-decorrelation-epd">9. External Parameter Decorrelation (EPD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_steps.html#trend-filtering-algorithm-tfa">10. Trend Filtering Algorithm (TFA)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wisp_options.html">Configuration Options</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="autowisp.html">autowisp package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="autowisp.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="autowisp.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="autowisp.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AutoWISP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="autowisp.html">autowisp package</a></li>
          <li class="breadcrumb-item"><a href="autowisp.image_calibration.html">autowisp.image_calibration package</a></li>
      <li class="breadcrumb-item active">autowisp.image_calibration.calibrator module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/implementation/autowisp.image_calibration.calibrator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-autowisp.image_calibration.calibrator">
<span id="autowisp-image-calibration-calibrator-module"></span><h1>autowisp.image_calibration.calibrator module<a class="headerlink" href="#module-autowisp.image_calibration.calibrator" title="Link to this heading"></a></h1>
<section id="class-inheritance-diagram">
<h2>Class Inheritance Diagram<a class="headerlink" href="#class-inheritance-diagram" title="Link to this heading"></a></h2>
<div class="graphviz"><img src="../_images/inheritance-88113ea335d74b97179be538bc58e83352773664.png" alt="Inheritance diagram of Calibrator, ImageMismatchError, OutsideImageError, Processor" usemap="#inheritance2965e86f4c" class="inheritance graphviz" /></div>
<map id="inheritance2965e86f4c" name="inheritance2965e86f4c">
<area shape="rect" id="node1" href="#autowisp.image_calibration.calibrator.Calibrator" target="_top" title="Provide basic calibration operations (bias/dark/flat) fully tracking noise." alt="" coords="5,80,301,107"/>
<area shape="rect" id="node2" href="autowisp.processor.html#autowisp.processor.Processor" target="_top" title="Providing and enforcing uniform interface for config, recovery, and logging." alt="" coords="54,5,252,32"/>
<area shape="rect" id="node3" href="autowisp.pipeline_exceptions.html#autowisp.pipeline_exceptions.ImageMismatchError" target="_top" title="Attempt to combine incompatible images in some way." alt="" coords="276,5,592,32"/>
<area shape="rect" id="node4" href="autowisp.pipeline_exceptions.html#autowisp.pipeline_exceptions.OutsideImageError" target="_top" title="Attempt to access image data outside the bounds of the image." alt="" coords="617,5,921,32"/>
</map><p>Define a class (Calibrator) for low-level image calibration.</p>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">autowisp.image_calibration.calibrator.</span></span><span class="sig-name descname"><span class="pre">Calibrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">saturation_threshold</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">configuration</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="autowisp.processor.html#autowisp.processor.Processor" title="autowisp.processor.Processor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Processor</span></code></a></p>
<div class="graphviz"><img src="../_images/inheritance-2e566e35572d32cd7ef7009a78316ccde1c4adc3.png" alt="Inheritance diagram of autowisp.image_calibration.calibrator.Calibrator" usemap="#inheritancebe5c281165" class="inheritance graphviz" /></div>
<map id="inheritancebe5c281165" name="inheritancebe5c281165">
<area shape="rect" id="node1" href="#autowisp.image_calibration.calibrator.Calibrator" target="_top" title="Provide basic calibration operations (bias/dark/flat) fully tracking noise." alt="" coords="5,80,301,107"/>
<area shape="rect" id="node2" href="autowisp.processor.html#autowisp.processor.Processor" target="_top" title="Providing and enforcing uniform interface for config, recovery, and logging." alt="" coords="54,5,252,32"/>
</map><p>Provide basic calibration operations (bias/dark/flat) fully tracking noise.</p>
<p>Public attributes, set through <a class="reference internal" href="#autowisp.image_calibration.calibrator.Calibrator.__init__" title="autowisp.image_calibration.calibrator.Calibrator.__init__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__init__()</span></code></a>, provide defaults for
calibration parameters that can be overwritten on a one-time basis for
each frame being calibrated by passing arguments to <a class="reference internal" href="#autowisp.image_calibration.calibrator.Calibrator.__call__" title="autowisp.image_calibration.calibrator.Calibrator.__call__"><code class="xref py py-func docutils literal notranslate"><span class="pre">__call__()</span></code></a>.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.configuration">
<span class="sig-name descname"><span class="pre">configuration</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.configuration" title="Link to this definition"></a></dt>
<dd><p>Defines the following calibration parameters:</p>
<dl class="simple">
<dt>raw_hdu:    Which hdu of the raw frame contains the image to</dt><dd><p>calibrate. If a single number, the channels are assumed
staggeder in that image. Otherwise, should be be a dictionary
indexed by channel name specifying the header of each color
channel. Note that the header is always taken from the first
non-trivial hdu. For compressed frames, this should never be
zero.</p>
</dd>
<dt>split_channels:    If this is a color image (i.e. staggering 4 color</dt><dd><p>channels), this argument should be a dictionary with keys the
names to use for the color channels and values specifying slices
in the image that isolate the pixels of each channel. If single
color images it should be <code class="docutils literal notranslate"><span class="pre">{None:</span> <span class="pre">slice(None)}</span></code>.</p>
</dd>
<dt>saturation_threshold:    The value (in ADU) above which the pixel is</dt><dd><p>considered saturated.</p>
</dd>
</dl>
<p>overscan:   A dictionary containing:</p>
<blockquote>
<div><ul>
<li><p>areas:    The areas in the raw image to use for overscan
corrections.  The format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">xmin</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span>
         <span class="n">xmax</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span>
         <span class="n">ymin</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span>
         <span class="n">ymax</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>method:    See <code class="xref py py-class docutils literal notranslate"><span class="pre">overscan_methods.Base</span></code></p></li>
</ul>
</div></blockquote>
<dl>
<dt>image_area:    The area in the raw image which actually contains the</dt><dd><p>useful image of the night sky. The dimensions must match the
dimensions of the masters to apply an of the overscan correction
retured by overscan_method. The format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">dict</span><span class="p">(</span><span class="n">xmin</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>gain:    The gain to assume for the input image (electrons/ADU).</dt><dd><p>Only useful when estimating errors and could be used by the
overscan_method.</p>
</dd>
<dt>calibrated_fname:    The filename under which to save the craeted</dt><dd><p>image. Treated as a format string that may involve replacement
fields from the resulting header, including {CLRCHNL}, which
gets replaced by the color channel if channel splitting is
performed, as well as {RAWFNAME}, which gets replaced by the
file name of the input FITS file with all directories and
<cite>.fits</cite> or <cite>.fits.fz</cite> extension stripped and {FNUM} which gets
replaced by the frame number (see above).</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.master_bias">
<span class="sig-name descname"><span class="pre">master_bias</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.master_bias" title="Link to this definition"></a></dt>
<dd><p>A dictionary indexed by channel with each entry being
further dictionary containing:</p>
<ul class="simple">
<li><p>filenames: Dictionary indexed by color channel of the filename of
the master bias frame to use in subsequent calibrations (if not
overwritten).</p></li>
<li><p>correction:    The correction to apply (if not overwritten)
constructed by combining the master biases for each channel.</p></li>
<li><p>variance:    An estimate of the variance of the <code class="docutils literal notranslate"><span class="pre">correction</span></code>
entry.</p></li>
<li><p>mask:    The bitmask the pixel indicating the combination of
flags raised for each pixel. The individual flages are defined
by <code class="xref py py-data docutils literal notranslate"><span class="pre">mask_utilities.mask_flags</span></code>.</p></li>
</ul>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.master_dark">
<span class="sig-name descname"><span class="pre">master_dark</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.master_dark" title="Link to this definition"></a></dt>
<dd><p>Analogous to <a class="reference internal" href="#autowisp.image_calibration.calibrator.Calibrator.master_bias" title="autowisp.image_calibration.calibrator.Calibrator.master_bias"><code class="xref py py-attr docutils literal notranslate"><span class="pre">master_bias</span></code></a> but contaning the
information about the default master dark.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.master_flat">
<span class="sig-name descname"><span class="pre">master_flat</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.master_flat" title="Link to this definition"></a></dt>
<dd><p>Analogous to <a class="reference internal" href="#autowisp.image_calibration.calibrator.Calibrator.master_bias" title="autowisp.image_calibration.calibrator.Calibrator.master_bias"><code class="xref py py-attr docutils literal notranslate"><span class="pre">master_bias</span></code></a> but contaning the
information about the default master flat.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.masks">
<span class="sig-name descname"><span class="pre">masks</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.masks" title="Link to this definition"></a></dt>
<dd><p>A dictionary containing:</p>
<ul class="simple">
<li><p>filenames: Dictionary indexed by channel containing a list of the
files from which this mask was constructed.</p></li>
<li><p>image: The combined mask image (bitwise OR) of all masks in
<code class="docutils literal notranslate"><span class="pre">filenames</span></code>.</p></li>
</ul>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.extra_header">
<span class="sig-name descname"><span class="pre">extra_header</span></span><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.extra_header" title="Link to this definition"></a></dt>
<dd><p>Additional keywords to add to the header.</p>
</dd></dl>

<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">autowisp.image_calibration</span><span class="w"> </span><span class="kn">import</span> <span class="n">Calibrator</span><span class="p">,</span>\
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">overscan_methods</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#Create a calibrator callable instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calibrate</span> <span class="o">=</span> <span class="n">Calibrator</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#The first 20 lines of the image are overscan area and overscan</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#is applied by subtracting the median of all pixels in the</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#overscan area from the remaining image.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">overscans</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">areas</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">20</span><span class="p">)],</span>
<span class="gp">&gt;&gt;&gt; </span>                   <span class="n">method</span><span class="o">=</span><span class="n">overscan_methods</span><span class="o">.</span><span class="n">Median</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#The master bias frame to use.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">master_bias</span><span class="o">=</span><span class="s1">&#39;masters/master_bias1.fits&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#The gain (electrons/ADU) to assume for the input images.</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">gain</span><span class="o">=</span><span class="mf">16.0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="c1">#The area within the raw frame containing the image:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">image_area</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">4116</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#Specify a master dark after construction.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calibrate</span><span class="o">.</span><span class="n">set_masters</span><span class="p">(</span><span class="n">dark</span><span class="o">=</span><span class="s1">&#39;masters/master_dark3.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#Calibrate an image called &#39;raw1.fits&#39;, producing (or overwriting a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#calibrated file called &#39;calib1.fits&#39; using the previously specified</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#calibration parameters. Note that no flat correction is going to be</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#applied, since a master flat was never specified.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calibrate</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="s1">&#39;raw1.fits&#39;</span><span class="p">,</span> <span class="n">calibrated</span><span class="o">=</span><span class="s1">&#39;calib1.fits&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#Calibrate an image, changing the gain assumed for this image only</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1">#and disabling overscan correction for this image only.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calibrate</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="s1">&#39;raw2.fits&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="n">calibrated</span><span class="o">=</span><span class="s1">&#39;calib2.fits&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="n">gain</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>          <span class="n">overscans</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">calibration_params</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.__call__" title="Link to this definition"></a></dt>
<dd><p>Calibrate the raw frame, save result to calibrated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw</strong> – The filename of the raw frame to calibrate.</p></li>
<li><p><strong>calibration_params</strong> – Keyword only arguments allowing one of the
calibration parameters to be switched for this calibration only.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">saturation_threshold</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">configuration</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.__init__" title="Link to this definition"></a></dt>
<dd><p>Create a calibrator and define some default calibration parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>default</strong> (<em>Any configuration parameters users wish to change from their</em>)</p></li>
<li><p><strong>values</strong> (<em>see class description for details</em>)</p></li>
<li><p><strong>masters</strong> – See set_masters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator._calib_mask_from_master">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_calib_mask_from_master</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator._calib_mask_from_master"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator._calib_mask_from_master" title="Link to this definition"></a></dt>
<dd><p>Overwrite a master mask with what should be used for a calibrated frame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mask</strong> – The mask of the master frame. On exit, gets overwritten by
the mask with which the calibrated image mask should be combined
to account for imperfections in the master.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator._document_in_header">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">_document_in_header</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calibration_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">header</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator._document_in_header"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator._document_in_header" title="Link to this definition"></a></dt>
<dd><p>Return header(s) documenting how the calibration was done.</p>
<p>The following keywords are added or overwritten:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MBIASFNM</span><span class="p">:</span> <span class="n">Filename</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">bias</span> <span class="n">used</span>

<span class="n">MBIASSHA</span><span class="p">:</span> <span class="n">Sha</span><span class="o">-</span><span class="mi">1</span> <span class="n">checksum</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">bias</span> <span class="n">frame</span> <span class="n">used</span><span class="o">.</span>

<span class="n">MDARKFNM</span><span class="p">:</span> <span class="n">Filename</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">dark</span> <span class="n">used</span>

<span class="n">MDARKSHA</span><span class="p">:</span> <span class="n">Sha</span><span class="o">-</span><span class="mi">1</span> <span class="n">checksum</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">dark</span> <span class="n">frame</span> <span class="n">used</span><span class="o">.</span>

<span class="n">MFLATFNM</span><span class="p">:</span> <span class="n">Filename</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">flat</span> <span class="n">used</span>

<span class="n">MFLATSHA</span><span class="p">:</span> <span class="n">Sha</span><span class="o">-</span><span class="mi">1</span> <span class="n">checksum</span> <span class="n">of</span> <span class="n">the</span> <span class="n">master</span> <span class="n">flat</span> <span class="n">frame</span> <span class="n">used</span><span class="o">.</span>

<span class="n">OVRSCN</span><span class="o">%</span><span class="mi">02</span><span class="n">d</span><span class="p">:</span> <span class="n">The</span> <span class="n">overscan</span> <span class="n">regions</span> <span class="n">get</span> <span class="n">consecutive</span> <span class="n">IDs</span> <span class="ow">and</span> <span class="k">for</span>
    <span class="n">each</span> <span class="n">one</span><span class="p">,</span> <span class="n">the</span> <span class="nb">id</span> <span class="n">gets</span> <span class="n">substituted</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">keyword</span> <span class="k">as</span> <span class="n">given</span><span class="o">.</span>
    <span class="n">The</span> <span class="n">value</span> <span class="n">describes</span> <span class="n">the</span> <span class="n">overscan</span> <span class="n">region</span> <span class="n">like</span><span class="p">:</span>
    <span class="o">%</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">%</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span><span class="n">d</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="o">%</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span><span class="n">d</span> <span class="k">with</span> <span class="n">the</span>
    <span class="n">sibustition</span> <span class="n">dictionary</span> <span class="n">given</span> <span class="n">directly</span> <span class="n">by</span> <span class="n">the</span> <span class="n">corresponding</span>
    <span class="n">overscan</span> <span class="n">area</span><span class="o">.</span>

<span class="n">IMAGAREA</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%(xmin)d</span><span class="s1"> &lt; x &lt; </span><span class="si">%(xmax)d</span><span class="s1">, </span><span class="si">%(ymin)d</span><span class="s1"> &lt; y &lt; </span><span class="si">%(ymax)d</span><span class="s1">&#39;</span>
    <span class="n">subsituted</span> <span class="k">with</span> <span class="n">the</span> <span class="n">image</span> <span class="n">are</span> <span class="k">as</span> <span class="n">specified</span> <span class="n">during</span>
    <span class="n">calibration</span><span class="o">.</span>

<span class="n">CALBGAIN</span><span class="p">:</span> <span class="n">The</span> <span class="n">gain</span> <span class="n">assumed</span> <span class="n">during</span> <span class="n">calibration</span><span class="o">.</span>

<span class="n">CLIBSHA</span><span class="p">:</span> <span class="n">Sha</span><span class="o">-</span><span class="mi">1</span> <span class="n">chacksum</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Calibrator</span><span class="o">.</span><span class="n">py</span> <span class="n">blob</span> <span class="n">per</span> <span class="n">Git</span><span class="o">.</span>
</pre></div>
</div>
<p>In addition, the overscan method describes itself in the header in
any way it sees fit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>calibration_params</strong> – The parameters used when calibrating (see
calibration_params argument to <a class="reference internal" href="#autowisp.image_calibration.calibrator.Calibrator.__call__" title="autowisp.image_calibration.calibrator.Calibrator.__call__"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__()</span></code></a>.</p></li>
<li><p><strong>header</strong> – The header to update with the calibration information.
Must already have the <code class="docutils literal notranslate"><span class="pre">CLRCHNL</span></code> keyword defined.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Indexed by channel name the header to use for the</dt><dd><p>calibrated image.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator._get_calibration_params">
<span class="sig-name descname"><span class="pre">_get_calibration_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">overwrite_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_image</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator._get_calibration_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator._get_calibration_params" title="Link to this definition"></a></dt>
<dd><p>Set all calibration parameters following overwrite rules.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.check_calib_params">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">check_calib_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calib_params</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator.check_calib_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.check_calib_params" title="Link to this definition"></a></dt>
<dd><p>Check if calibration parameters are consistent mutually and with image.</p>
<p>Raises an exception if some problem is detected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_image</strong> – The raw image to calibrate (numpy 2-D array).</p></li>
<li><p><strong>calib_params</strong> – The current set of calibration parameters to apply.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<dl class="simple">
<dt>Checks for:</dt><dd><ul class="simple">
<li><p>Overscan or image areas outside the image.</p></li>
<li><p>Any master resolution does not match image area for
corresponding channel.</p></li>
<li><p>Image or overscan areas have inverted boundaries, e.g.
xmin &gt; xmax</p></li>
<li><p>gain is not a finite positive number</p></li>
<li><p>leak_directions is not an iterable of 2-element iterables</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.default_configuration">
<span class="sig-name descname"><span class="pre">default_configuration</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'allow_overwrite':</span> <span class="pre">False,</span> <span class="pre">'bias_level_adu':</span> <span class="pre">0.0,</span> <span class="pre">'compress_calibrated':</span> <span class="pre">16,</span> <span class="pre">'gain':</span> <span class="pre">1.0,</span> <span class="pre">'image_area':</span> <span class="pre">None,</span> <span class="pre">'leak_directions':</span> <span class="pre">[],</span> <span class="pre">'overscans':</span> <span class="pre">{'areas':</span> <span class="pre">None,</span> <span class="pre">'method':</span> <span class="pre">None},</span> <span class="pre">'split_channels':</span> <span class="pre">False}</span></em><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.default_configuration" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.module_git_ids">
<span class="sig-name descname"><span class="pre">module_git_ids</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'calibrator':</span> <span class="pre">'$Id:</span> <span class="pre">577de2417317dd1d26c623e59f8474f0efd50369</span> <span class="pre">$',</span> <span class="pre">'mask_utilities':</span> <span class="pre">'$Id:</span> <span class="pre">5b6835e1bfd0bec642536c00517b8d088d1f5d28</span> <span class="pre">$',</span> <span class="pre">'overscan_methods':</span> <span class="pre">'$Id:</span> <span class="pre">4aad389e1ad0897f0fa4ec0744ba76050d01fe00</span> <span class="pre">$'}</span></em><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.module_git_ids" title="Link to this definition"></a></dt>
<dd><p>A collection of Git Id values (sha1 checksums of the git blobs) for each
module used by the calibration. Those get added to the header to ensure
reprobducability.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="autowisp.image_calibration.calibrator.Calibrator.set_masters">
<span class="sig-name descname"><span class="pre">set_masters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dark</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">masks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/autowisp/image_calibration/calibrator.html#Calibrator.set_masters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#autowisp.image_calibration.calibrator.Calibrator.set_masters" title="Link to this definition"></a></dt>
<dd><p>Define the default masterts to use for calibrations.</p>
<p>The cannels and image area must be correctly set by __init__.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bias</strong> – The filename of the master bias to use. String if single
channel processing, dictionary indexed by channel if
multi-channel.</p></li>
<li><p><strong>dark</strong> – The filename of the master dark to use. See bias.</p></li>
<li><p><strong>flat</strong> – The filename of the master flat to use. See bias.</p></li>
<li><p><strong>masks</strong> – Either a single filename or a list of the mask files
to use. See bias.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="autowisp.image_calibration.html" class="btn btn-neutral float-left" title="autowisp.image_calibration package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="autowisp.image_calibration.fits_util.html" class="btn btn-neutral float-right" title="autowisp.image_calibration.fits_util module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Kaloyan Penev.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>