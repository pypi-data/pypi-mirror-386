<div class="tos-uploader-container{% if widget.readonly %} readonly{% endif %}">
    <!-- éšè—çš„å®é™…è¡¨å•å­—æ®µ -->
    <input type="hidden" 
           name="{{ widget.name }}" 
           value="{{ widget.value|default:'' }}" 
           class="tos-uploader-hidden-input"
           id="id_{{ widget.name }}">
    
    <!-- å·¦å³åˆ†æ å¸ƒå±€ -->
    <div class="tos-uploader-layout">
        <!-- å·¦ä¾§ï¼šè¾“å…¥å’Œä¸Šä¼ ä¿¡æ¯ -->
        <div class="tos-uploader-left">
            {% if not widget.readonly %}
            <!-- ä¸Šä¼ è·¯å¾„è¾“å…¥æ¡† -->
            <div class="upload-path-container">
                <label for="{{ widget.name }}_path" class="upload-path-label">ä¸Šä¼ è·¯å¾„:</label>
                <input type="text" 
                       id="{{ widget.name }}_path"
                       class="upload-path-input" 
                       placeholder="ä¾‹å¦‚: è®¡ç®—æœºæ•™æ/è®¡ç®—æœºç½‘ç»œ"
                       value="{{ widget.upload_path|default:'user-uploads' }}">
                <small class="upload-path-help">è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•è·¯å¾„</small>
            </div>
            {% endif %}
            
            <!-- æ˜¾ç¤ºç”¨çš„æ–‡æœ¬è¾“å…¥æ¡† -->
            <div style="position: relative;">
                <input type="text" 
                       class="tos-uploader-display-input" 
                       placeholder="{% if widget.readonly %}åªè¯»æ¨¡å¼ - ä»…é¢„è§ˆ{% else %}æ–‡ä»¶å°†ä¸Šä¼ åè‡ªåŠ¨å¡«å…¥URL{% endif %}"
                       value="{{ widget.value|default:'' }}"
                       readonly>
                
                {% if not widget.readonly %}
                <button type="button" class="tos-upload-button" onclick="document.getElementById('{{ widget.name }}_file').click()">
                    ğŸ“ é€‰æ‹©æ–‡ä»¶
                </button>
                {% endif %}
            </div>
            
            <!-- é¢„è§ˆæ§åˆ¶æŒ‰é’® -->
            {% if widget.value %}
            <div class="preview-controls">
                <button type="button" class="preview-toggle-button" data-target="{{ widget.name }}">
                    ğŸ‘ï¸ é¢„è§ˆæ–‡ä»¶
                </button>
                <span class="preview-status">ç‚¹å‡»é¢„è§ˆæŒ‰é’®æŸ¥çœ‹æ–‡ä»¶</span>
            </div>
            {% endif %}
            
            {% if not widget.readonly %}
            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" 
                   id="{{ widget.name }}_file"
                   class="file-input"
                   data-target-input="#id_{{ widget.name }}"
                   data-sts-url="{{ get_sts_token_url }}"
                   data-upload-path="{{ widget.upload_path|default:'user-uploads' }}"
                   data-path-input="#{{ widget.name }}_path"
                   {% if widget.accept %}accept="{{ widget.accept }}"{% endif %}
                   style="display: none;">
            
            <!-- è¿›åº¦æ¡ -->
            <div class="progress-container" style="display: none;">
                <div class="progress-label">ä¸Šä¼ è¿›åº¦</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                <div class="progress-text">å‡†å¤‡ä¸Šä¼ ...</div>
            </div>
            
            <!-- æ–‡ä»¶ä¿¡æ¯ -->
            <div class="file-info" style="display: none;">
                <div class="file-icon">ğŸ“„</div>
                <div class="file-details">
                    <div class="file-name"></div>
                    <div class="file-size"></div>
                </div>
                <div class="file-status"></div>
            </div>
            {% else %}
            <!-- åªè¯»æ¨¡å¼ä¸‹çš„æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
            {% if widget.value %}
            <div class="file-info readonly-info" style="display: block;">
                <div class="file-icon">ğŸ“„</div>
                <div class="file-details">
                    <div class="file-name">å·²è®¾ç½®æ–‡ä»¶</div>
                    <div class="file-size">åªè¯»æ¨¡å¼</div>
                </div>
                <div class="file-status">âœ“ åªè¯»</div>
            </div>
            {% endif %}
            {% endif %}
        </div>
        
        <!-- å³ä¾§ï¼šé¢„è§ˆï¼ˆæ‡’åŠ è½½ï¼‰ -->
        <div class="tos-uploader-right">
            <div class="preview-container" data-lazy="true"></div>
        </div>
    </div>
</div>