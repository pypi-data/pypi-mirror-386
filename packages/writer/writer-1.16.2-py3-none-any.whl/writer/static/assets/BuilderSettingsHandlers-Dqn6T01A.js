import{d as O,i as S,a as h,c as a,o as g,f as $,J as R,g as b,x as l,y as H,R as o,at as x,aE as U,S as W,_ as L,u as Q,bj as X,V as Y,z as T,W as N,t as Z,b as F,D as J,E as K,aw as ee,aH as te,A as ne,l as se}from"./index-BmyhSU9Y.js";import{W as V,b as G}from"./BuilderApp-DtTxddCW.js";import{a as re}from"./useBlueprintRun-CeQ0z_2A.js";import{W as ie}from"./BuilderSettings-RM74vmgN.js";import"./WdsCheckbox-D_sNexhI.js";import"./marked.esm-273vDTCT.js";import"./useComponentDescription-CFd5_M9E.js";import"./WdsDropdownMenu-XXUhZVaD.js";import"./useKeyValueEditor-B1VyXVga.js";const oe={class:"BuilderBlueprintState"},le={class:"BuilderBlueprintState__status BuilderBlueprintState__status--success"},ae={class:"BuilderBlueprintState__status BuilderBlueprintState__status--error"},ue=O({__name:"BuilderBlueprintState",props:{blueprintId:{type:String,required:!0}},setup(y){const r=y,u=S(h.core),i=S(h.builderManager),m=a(()=>u.getComponents(r.blueprintId)),E=a(()=>m.value.map(c=>c.id)),_=a(()=>{var t,f,p;const d=(t=i.getLogEntries().filter(B=>B.blueprintExecution?B.blueprintExecution.summary.some(C=>E.value.includes(C.componentId)):!1).at(0))==null?void 0:t.blueprintExecution.summary.at(-1);if(!d)return;if(d.outcome==="in_progress")return"in_progress";const k=u.getComponentById(d.componentId);return((p=(f=u.getComponentDefinition(k.type).outs)==null?void 0:f[d.outcome])==null?void 0:p.style)??"success"});return(c,d)=>(g(),$("div",oe,[_.value?_.value==="success"?R(c.$slots,"success",{key:1},()=>[b("div",le,[l(H,{name:"check"})])],!0):_.value==="error"?R(c.$slots,"error",{key:2},()=>[b("div",ae,[l(H,{name:"circle-alert"})])],!0):_.value==="in_progress"?R(c.$slots,"running",{key:3},()=>[l(U,{class:"BuilderBlueprintState__status",color:o(x).Gray5},null,8,["color"])],!0):W("",!0):R(c.$slots,"unknown",{key:0},void 0,!0)]))}}),ce=L(ue,[["__scopeId","data-v-1ef50b43"]]),de=["aria-busy"],pe={class:"BuilderSettingsHandlersBlueprint__title"},me={class:"BuilderSettingsHandlersBlueprint__list"},_e={class:"BuilderSettingsHandlersBlueprint__list__item"},ve={class:"BuilderSettingsHandlersBlueprint__list__item"},fe=O({__name:"BuilderSettingsHandlersBlueprint",props:{component:{type:Object,required:!0},eventType:{type:String,required:!0},eventDescription:{type:String,required:!1,default:void 0}},setup(y){const r=S(h.core),u=S(h.builderManager),i=y,m=Q(r),{createAndInsertComponentsTree:E,removeComponentsSubtree:_}=ee(r,u,m),c=a(()=>i.eventType.replace(/^wf-/,"").replaceAll("-"," ")),{blueprints:d,triggers:k}=X(r,a(()=>i.component.id),a(()=>i.eventType)),{run:v,isRunning:t}=re(r,a(()=>k.value.map(e=>({blueprintId:e.parentId,branchId:e.id})))),{pushToast:f}=Y();function p(){const e=d.value.map(s=>{const n=(s.content.key??"0").match(/\d+/);return n?Number(n[0]):0});return e.length===0?1:Math.max(...e)+1}async function B(){var A;const{type:e}=i.component,{name:s,events:n}=r.getComponentDefinition(e),j=`${s} - ${i.eventType}`,D=`${e}@${i.eventType.replace(/^wf-/,"")}_${p()}`;let w=(A=n==null?void 0:n[i.eventType])==null?void 0:A.eventPayloadExample;typeof w=="object"&&w!==null&&(w=JSON.stringify(w));const[z]=E("blueprints_root",[{type:"blueprints_blueprint",initProperties:{content:{key:D}}},{type:"blueprints_uieventtrigger",initProperties:{content:{alias:j,refComponentId:i.component.id,refEventType:i.eventType,defaultResult:w?String(w):void 0},x:96,y:96}}]);f({type:"success",message:`${j} added`,action:{label:"Go to blueprint",func:()=>{var q;return P(z,(q=I(z))==null?void 0:q.id)},icon:"wds-blueprints"}})}function I(e){return r.getComponents(e).find(s=>s.type==="blueprints_uieventtrigger"&&s.content.refComponentId===i.component.id&&s.content.refEventType===i.eventType)}function C(e){const s=[e.id];r.getComponents(e.parentId).length===1&&s.push(e.parentId),_(...s)}function M(e){var s,n;return((n=(s=r.getComponentById(e.parentId))==null?void 0:s.content)==null?void 0:n.key)||"Blueprint"}function P(e,s){r.setActivePageId(e),u.setMode("blueprints"),u.setSelection(s??e,void 0,"click")}return(e,s)=>(g(),$("div",{class:"BuilderSettingsHandlersBlueprint","aria-busy":o(t)},[b("div",pe,[l(N,{class:"BuilderSettingsHandlersBlueprint__title__btn",variant:"special",size:"icon","aria-label":"Run the attached blueprints",disabled:o(t),loading:o(t),onClick:o(v)},{default:T(()=>[l(H,{name:"play"})]),_:1},8,["disabled","loading","onClick"]),b("p",null,Z(c.value),1),y.eventDescription?(g(),F(N,{key:0,"data-writer-tooltip":y.eventDescription,variant:"neutral",size:"smallIcon","custom-size":"18px"},{default:T(()=>[l(H,{name:"circle-question-mark"})]),_:1},8,["data-writer-tooltip"])):W("",!0)]),b("div",me,[(g(!0),$(J,null,K(o(k),(n,j)=>(g(),F(G,{key:n.id,color:o(x).Blue6,"color-last":o(k).length===j+1?o(x).Blue2:o(x).Blue6},{default:T(()=>[b("div",_e,[l(V,{variant:"secondary",disabled:o(t),text:M(n),"data-writer-tooltip":M(n),"data-writer-tooltip-strategy":"overflow",onClick:D=>P(n.parentId,n.id)},null,8,["disabled","text","data-writer-tooltip","onClick"]),l(ce,{"blueprint-id":n.parentId},null,8,["blueprint-id"]),l(N,{variant:"neutral",size:"smallIcon","custom-size":"18px","aria-label":"Unlink blueprint","data-writer-tooltip":"This will remove the trigger but will not delete the blueprint",disabled:o(t),onClick:D=>C(n)},{default:T(()=>[l(H,{name:"link-2-off"})]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["color","color-last"]))),128)),l(G,{"is-last":"",color:o(x).Blue2},{default:T(()=>[b("div",ve,[l(V,{variant:"primary",weight:"semibold",disabled:o(t),"left-icon":"plus",text:"Create blueprint",onClick:B},null,8,["disabled"])])]),_:1},8,["color"])])],8,de))}}),Be=L(fe,[["__scopeId","data-v-5af57bf8"]]),be=["inert"],ge={class:"BuilderSettingsHandlers__list"},ye=O({__name:"BuilderSettingsHandlers",props:{isReadOnly:{type:Boolean}},setup(y){const r=S(h.core),u=S(h.builderManager),i=S(h.secretsManager),m=a(()=>r.getComponentById(u.firstSelectedId.value)),E=a(()=>{var v,t;return te((t=(v=u.firstSelectedItem)==null?void 0:v.value)==null?void 0:t.instancePath)}),{getEvaluatedFields:_}=se(r,i),c=a(()=>_(E.value)),d=a(()=>{if(!m.value)return{};const{type:v}=m.value,t=r.getComponentDefinition(v),f=(t==null?void 0:t.events)??{},p=Object.entries(f).filter(([I,C])=>C.enabled===void 0?!0:C.enabled({evaluatedFields:c.value})),B=Object.fromEntries(p);return Object.keys({...m.value.handlers}).forEach(I=>{B[I]||(B[I]={desc:"Custom event"})}),B}),k=a(()=>u.isSingleSelectionActive.value?Object.keys(d.value).length>0:!1);return(v,t)=>k.value?(g(),$("div",{key:0,inert:y.isReadOnly,class:"BuilderSettingsHandlers"},[l(ie,{class:"BuilderSettingsHandlers__title"},{default:T(()=>t[0]||(t[0]=[ne("Blueprints")])),_:1}),b("div",ge,[(g(!0),$(J,null,K(d.value,(f,p)=>(g(),$("div",{key:p},[l(Be,{component:m.value,"event-type":p,"event-description":f.desc},null,8,["component","event-type","event-description"])]))),128))])],8,be)):W("",!0)}}),xe=L(ye,[["__scopeId","data-v-7bb69b92"]]);export{xe as default};
