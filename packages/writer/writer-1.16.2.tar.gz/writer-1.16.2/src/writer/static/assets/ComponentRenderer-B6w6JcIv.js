import{d as K,i as M,a as p,c as v,o as k,b as Q,B as _e,e as he,f as W,g as _,t as A,h as ye,u as Ce,C as te,r as R,j as be,p as T,w as z,F as Se,k as D,l as ae,_ as Z,m as Ie,n as Pe,q as re,s as ne,v as se,x as O,y as X,z as Ee,A as Me,W as Te,D as we,E as $e,G as ie,H as ke,I as Be,J as De,K as Ae,L as Re,M as Ve,N as xe,O as Le,P as J,Q as oe}from"./index-BmyhSU9Y.js";const Oe=10,We=K({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(C){const s=M(p.core),l=C,b=(r,u)=>{const f=r.map(g=>s.getComponentDefinition(g)).map(g=>g==null?void 0:g.name);return`${f.slice(0,-1).join(", ")} ${f.length>1?u:""} ${f.at(-1)}`},c=v(()=>{const r=s.getContainableTypes(l.componentId);let u;return r.length<=Oe&&(u=`You can add ${b(r,"and")} components`),u});return(r,u)=>(k(),Q(_e,{class:"ChildlessPlaceholder","component-id":C.componentId,message:c.value},null,8,["component-id","message"]))}}),qe=["draggable"],Fe={class:"title"},He={class:"message"},je=K({__name:"RenderError",props:{componentType:{type:String,required:!0},message:{type:String,required:!0},draggable:{type:Boolean,required:!1}},setup(C){const s=M(p.core),l=M(p.componentId),b=v(()=>s.getComponentById(l)),c=v(()=>{var u;return s.getComponentById((u=b.value)==null?void 0:u.parentId)}),r=v(()=>{var u;return((u=c.value)==null?void 0:u.type)==="blueprints_blueprint"});return(u,m)=>r.value?(k(),Q(he,{key:0,draggable:!1})):(k(),W("div",{key:1,class:"RenderError",draggable:C.draggable},[_("div",Fe,[_("h2",null,"Error rendering "+A(C.componentType),1)]),_("div",He,A(C.message),1)],8,qe))}}),ze={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(C){const s=M(p.core),l=M(p.builderManager),b=M(p.secretsManager),c=C.componentId,r=v(()=>s.getComponentById(c)),u=ye(r.value.type),m=C.instancePath,f=C.instanceData,{getEvaluatedFields:I,isComponentVisible:g}=ae(s,b),S=I(m),V=Ce(s),x=v(()=>s.getComponents(c,{sortedByPosition:!0}).filter(t=>{var a;return((a=s.getComponentDefinition(t.type))==null?void 0:a.category)!=="Internal"})),w=v(()=>!!l&&l.getMode()!="preview"),N=v(()=>{var t;return w.value&&!r.value.isCodeManaged&&!te.has(r.value.type)&&((t=U.value)==null?void 0:t.toolkit)!=="blueprints"}),q=(t,a)=>(t?s.getContainableTypes(t):[...te]).includes(a),L=R(!1),e=()=>{if(!(x.value.length>0))return D(We,{componentId:r.value.id})},n=(t,a=0,i)=>D(le,{componentId:t,key:`${t}:${a}`,instancePath:[...m,{componentId:t,instanceNumber:a}],instanceData:[...f,R(null)],...i??{}}),o=t=>a=>{if(!q(c,a.type)&&t==="default")return!0;const h=s.getComponentDefinition(a.type).slot??"default";return h==="*"||h===t},d=(t=0,a="default",i=()=>!0,h=!1)=>{const P=y=>!w.value||h?[]:[D("div",{"data-writer-slot-of-id":c,"data-writer-position":y})],E=x.value.filter(o(a)).filter(i),B=E.filter(y=>!y.isCodeManaged).map(y=>n(y.id,t,{contextSlot:a})),H=E.filter(y=>y.isCodeManaged).map(y=>n(y.id,t,{contextSlot:a}));return[...P(0),...B.map((y,j)=>[y,P(j+1)]).flat(),...H]},$=be(m);T(p.evaluatedFields,S),T(p.componentId,c),T(p.isBeingEdited,w),T(p.isDisabled,L),T(p.instancePath,m),T(p.instanceData,f),T(p.renderProxiedComponent,n),T(p.getChildrenVNodes,d),T(p.flattenedInstancePath,$);const F={"data-writer-id":c,"data-writer-instance-path":$},U=v(()=>s.getComponentDefinition(r.value.type)),Y=v(()=>{var t;return(t=U.value)==null?void 0:t.fields}),G=R(!1);z(()=>l==null?void 0:l.isComponentIdSelected(c),t=>{G.value=t},{immediate:!0});const ce=v(()=>Object.entries(Y.value??{}).filter(([,t])=>t.category===Se.Style).reduce((t,[a])=>(t[a]=S[a].value,t),{}));z(ce,()=>{G.value=!1,V.track("ui_block_styles_updated")});const ee=v(()=>x.value.length==0),de=v(()=>g(c,m)),ue=(t,a)=>{if((!t||!(t!=null&&t.startsWith("$goToPage_")))&&!a)return h=>{s.forwardEvent(h,m,!0)};if(t!=null&&t.startsWith("$goToPage_")){const h=t.substring(10);return P=>s.setActivePageFromKey(h)}return null},pe=v(()=>{const t={};return Object.keys(U.value.events??{}).forEach(i=>{var E;const h=`on${i.charAt(0).toUpperCase()}${i.slice(1)}`,P=i===((E=r.value.binding)==null?void 0:E.eventType);t[h]=B=>{var y,j;P&&s.forwardEvent(B,m,!0);const H=((y=r.value.handlers)==null?void 0:y[i])??null;(j=ue(H,P))==null||j(B)}}),t}),ve=v(()=>{const t=Y.value;if(!t)return;const a={};return Object.keys(t).forEach(i=>{t[i].applyStyleVariable&&S[i]&&(a[`--${i}`]=S[i].value)}),a}),me=v(()=>{const t="cssClasses",a=Y.value;if(!a||!a[t]||!S[t])return;const i=String(S[t].value),h=i==null?void 0:i.split(" ").map(E=>E.trim()),P={};return h.forEach(E=>{P[E]=!0}),P}),fe=function(){return{class:{[`wf-type-${r.value.type}`]:!0,component:!0,childless:ee.value,selected:G.value,disabled:L.value,beingEdited:w.value,...me.value},style:{...ve.value,...de.value?{}:{display:"none"}},...F,...L.value?[]:pe.value,draggable:N.value}},ge=(t,a)=>w.value?D(je,{...t,componentType:r.value.type,message:a}):D("div");return()=>{const t=w.value?e():void 0,a=({instanceNumber:h=0,slotName:P="default",componentFilter:E=()=>!0,positionlessSlot:B=!1})=>ee.value?B?void 0:t:d(h,P,E,B),i=fe();return q(r.value.parentId,r.value.type)?D(u,i,{default:a}):ge(i,"Parent is not suitable for this component")}}},le=Z(ze,[["__scopeId","data-v-683afb33"]]),Ke={class:"counter"},Ne={class:"main"},Ue={class:"clearContainer"},Ye={class:"content"},Ge={class:"title"},Xe={class:"time"},Je={class:"message"},Qe=100,Ze=K({__name:"RendererNotifications",setup(C){const s=M(p.core),l=R(!1),b=Ie("balloon"),c=Pe([]),r=f=>{const{type:I,title:g,message:S,code:V}=f;c.unshift({type:I,title:g,message:S,code:V,timestampReceived:new Date}),c.splice(Qe),b.value.classList.remove("alert"),b.value.offsetWidth,b.value.classList.add("alert")};re(()=>{s.addMailSubscription("notification",r)});const u=()=>{c.length!=0&&(l.value=!l.value)},m=()=>{c.splice(0),l.value=!1};return(f,I)=>ne((k(),W("div",{class:"RendererNotifications colorTransformer",onClick:u},[_("div",{ref_key:"balloon",ref:b,class:"balloon",title:"Toggle notifications"},[O(X,{name:"bell"}),_("div",Ke,A(c.length),1)],512),I[1]||(I[1]=_("div",{class:"balloonFlash"},null,-1)),ne(_("div",Ne,[_("div",Ue,[O(Te,{onClick:m},{default:Ee(()=>[O(X,{name:"trash-2"}),I[0]||(I[0]=Me(" Clear all "))]),_:1})]),(k(!0),W(we,null,$e(c,(g,S)=>(k(),W("div",{key:S,class:"notification"},[_("div",{class:ie(["icon",g.type])},[O(X,{name:"triangle-alert"})],2),_("div",Ye,[_("header",null,[_("strong",Ge,A(g.title),1),_("span",Xe,A(g.timestampReceived.toLocaleTimeString()),1)]),_("div",Je,A(g.message),1)])]))),128))],512),[[se,l.value]])],512)),[[se,c.length>0]])}}),et=Z(Ze,[["__scopeId","data-v-758218e7"]]),tt={class:"rootComponentArea"},nt=K({__name:"ComponentRenderer",setup(C){const s=M(p.core),l=M(p.builderManager),b=M(p.secretsManager),c=ae(s,b),r={},u=R({}),m=v(()=>(l==null?void 0:l.activeRootId.value)??"root");z(m,(e,n)=>{var d;u.value[n]=s.activePageId;const o=(d=u.value)==null?void 0:d[e];o&&s.setActivePageId(o)});const f=c.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),I=v(()=>{var e,n,o,d,$,F;return{...ke,"--accentColor":(e=f.accentColor)==null?void 0:e.value,"--emptinessColor":(n=f.emptinessColor)==null?void 0:n.value,"--containerBackgroundColor":(o=f.parentIdBackgroundColor)==null?void 0:o.value,"--primaryTextColor":(d=f.primaryTextColor)==null?void 0:d.value,"--secondaryTextColor":($=f.secondaryTextColor)==null?void 0:$.value,"--separatorColor":(F=f.separatorColor)==null?void 0:F.value}}),g=v(()=>s.frontendMessageMap.value.size>0);z(()=>{var e;return(e=f.appName)==null?void 0:e.value},e=>{e!=""&&S(e)},{immediate:!0});function S(e){const n=s.mode.value;let o;e&&n=="edit"?o=`${e} | Writer | Builder`:!e&&n=="edit"?o="Writer | Builder":e&&n=="run"?o=`${e}`:!e&&n=="run"&&(o="Writer"),document.title=o}async function V(e,n){const o=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);o==null||o.remove();const d=document.createElement("link");d.dataset.writerStylesheetKey=e,d.setAttribute("href",J(n)),d.setAttribute("rel","stylesheet"),document.head.appendChild(d)}async function x(e,n){const o=document.querySelector(`[data-writer-script-key="${e}"]`);o==null||o.remove();const d=document.createElement("script");d.dataset.writerScriptKey=e,d.src=J(n),d.setAttribute("rel","modulepreload"),document.head.appendChild(d)}async function w(e,n){const o=J(n);r[e]=o,await oe(()=>import(o),[],import.meta.url)}async function N(e,n,o){const d=r[e],$=await oe(()=>import(d),[],import.meta.url);if(!$){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}$[n](...o)}function q(){s.addMailSubscription("fileDownload",e=>{const n=document.createElement("a");n.href=e.data,n.download=e.fileName,n.click()}),s.addMailSubscription("openUrl",e=>{const n=document.createElement("a");n.href=e,n.target="_blank",n.rel="noopener noreferrer",n.click()}),s.addMailSubscription("pageChange",async e=>{(l==null?void 0:l.getMode())==="blueprints"&&l.setMode("ui"),await Re(),Ve(e),s.setActivePageFromKey(e)}),s.addMailSubscription("routeVarsChange",e=>{xe(e)}),s.addMailSubscription("importStylesheet",({stylesheetKey:e,path:n})=>{V(e,n)}),s.addMailSubscription("importScript",({scriptKey:e,path:n})=>{x(e,n)}),s.addMailSubscription("importModule",({moduleKey:e,specifier:n})=>{w(e,n)}),s.addMailSubscription("functionCall",({moduleKey:e,functionName:n,args:o})=>{N(e,n,o)})}function L(){const e=Le(),n=new CustomEvent("wf-app-open",{detail:{payload:e}}),o={componentId:"root",instanceNumber:0};s.forwardEvent(n,[o],!0)}return Be(()=>{q()}),re(()=>{L()}),(e,n)=>(k(),W("main",{class:ie(["ComponentRenderer",{loadingActive:g.value}]),tabindex:"-1",style:Ae(I.value)},[O(et,{class:"notifications"}),n[0]||(n[0]=_("div",{class:"loadingBar"},null,-1)),_("div",tt,[(k(),Q(le,{key:m.value,"component-id":m.value,"instance-path":[{componentId:m.value,instanceNumber:0}],"instance-data":[R(null)]},null,8,["component-id","instance-path","instance-data"])),De(e.$slots,"default",{},void 0,!0)])],6))}}),ot=Z(nt,[["__scopeId","data-v-2e3a99be"]]);export{ot as default};
