{# -*- coding: utf-8 -*-

  Copyright (C) 2015-2018 CERN.
  Copyright (C) 2021-2023 TU Wien.

  Invenio is free software; you can redistribute it and/or modify it
  under the terms of the MIT License; see LICENSE file for more details.
#}

{#- base: invenio-app-rdm v9.1.2 #}
{#- changes: everything #}

<header class="ui menu container">
  {%- block staging_warning -%}
    {%- if config.THEME_TUW_HEADER_WARNING -%}
      <div class="ui staging message mb-0">
        <i class="ui inverted red circular warning icon"></i>
        <p class="mt-0">
          {{ config.THEME_TUW_HEADER_WARNING|safe }}
        </p>
      </div>
    {%- endif -%}
  {%- endblock staging_warning -%}

  {#- TODO this doesn't play quite as nice as i'd like it to #}
  <a href="#" aria-label="open sidebar menu">
    <div id="nav-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </a>

  <div class="ui menu">
    {%- if config.ACCOUNTS %}

      {#- show "log in/out", depending on the user's authentication status #}
      {%- if not current_user.is_authenticated -%}
        <a href="{{ url_for_security('login', next=request.path) }}" class="item login">
          <span><i class="ui icon sign-in"></i>{{ _('Log in') }}</span>
        </a>

      {%- elif current_user.is_authenticated -%}
        <a href="{{ url_for_security('logout', next=request.path) }}" class="item login">
          <span><i class="ui icon sign-out"></i>{{ _('Log out') }}</span>
        </a>

      {%- endif %}

    {%- endif %}

    {#- this is just here to satisfy base-theme-rdm.js, which can't handle header-search-bar not existing #}
    <div id="header-search-bar" class="invisible" data-options='{{ [] | tojson }}'></div>

    <div class="right menu">
      <a class="item" href="/">Home</a>

      {#- 'main' submenu items #}
      {%- for item in current_menu.submenu('main').children|sort(attribute='order') if item.visible recursive -%}

        {#- if the node has children #}
        {%- if item.children %}
            <div class="ui dropdown item{{ ' active' if item.active else '' }}">
              {{ item.text|safe }} <i class="dropdown icon"></i>
              <div class="menu">
                {%- for item in current_menu.submenu('main').children if item.visible %}
                  <a class="item" href="{{ item.url }}">{{ item.text|safe }}</a>
                {%- endfor %}
              </div>
            </div>

        {%- else %}
          {#- leaf nodes #}
          <a class="{{ 'item navbar-options active' if item.active and loop.depth == 0 else 'item' }}" href="{{ item.url }}">
            {{ item.text|safe }}
          </a>

        {%- endif %}

      {%- endfor %}

      {#- 'item' submenu items #}
      {%- for item in current_menu.submenu('actions').children|sort(attribute='order') if item.visible recursive -%}
        <a class="item" href="{{ item.url }}">
          {{ item.text|safe }}
        </a>
      {%- endfor %}

      {#- user profile stuff #}
      {%- if config.ACCOUNTS %}

        {%- if current_user.is_authenticated %}

          {#- 'notifications' submenu items #}
          {%- for item in current_menu.submenu('notifications').children|sort(attribute='order') if item.visible recursive %}
            <a class="item" href="{{ item.url }}">
              {{ item.text|safe }}
            </a>
          {%- endfor %}

          {#- if the user is authenticated, show the link to the profile settings #}
          <div class="ui dropdown item">
            Settings <i class="dropdown icon"></i>
            <div class="menu">
              {%- for item in current_menu.submenu('settings').children if item.visible %}
                <a class="item" href="{{ item.url }}">{{ item.text|safe }}</a>
              {%- endfor %}

              {#- Admin stuff #}
              {%- for item in current_menu.submenu('profile-admin').children if item.visible %}
                <a role="menuitem" class="item" href="{{ item.url }}" tabindex="-1">{{ item.text|safe }}</a>
              {%- endfor %}
            </div>
          </div>

        {%- endif %}

      {%- endif %}

      {#- TUW logo #}
      <div id="signet">
        <a href="/">
          <svg aria-label="TU Wien" id="tuw-logo" role="img" style="enable-background:new 0 0 97 97;" viewBox="0 0 97 97" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" y="0px">
            <g>
              <path d="M86.5,1c5.2,0,9.5,4.3,9.5,9.5l0,76c0,5.3-4.3,9.5-9.5,9.5h-76C5.3,96,1,91.7,1,86.5l0-76C1,5.3,5.3,1,10.5,1 H86.5z" style="fill:#006699;"></path>
              <path d="M21.1,23.6h10.1v33.7H21.1V23.6z M8.3,10.5h35.5v10.1H8.3V10.5z M29.7,69.6h-3.4l-2.6,10.5l-3.1-10.5h-2.4 l-3.1,10.5l-2.6-10.5H9.2l4.5,16.7h2.7l3.1-10.1l3.1,10.1h2.7L29.7,69.6z M86.3,86.3V69.6h-3.3v10.2l-6.6-10.2h-2.9v16.7h3.3V76 l6.6,10.3H86.3z M63,86.3v-2.9h-7.7v-4.1h6.6v-2.9h-6.6v-3.9H63v-2.9h-11v16.7H63z M40.8,69.6h-3.3v16.7h3.3V69.6z M65.9,57.6 l-0.5,0c-9.5-1-16.9-9-16.9-18.8V10.5h10.3l0,28c0,4.1,2.8,7.8,6.7,8.7c0.2,0,0.3,0.1,0.5,0.1L65.9,57.6z M68.9,47.3 c0.2,0,0.3,0,0.4-0.1c3.8-1,6.7-4.6,6.7-8.7l-0.1-28h10.3v28.1c0,9.8-7.4,17.9-16.9,18.9l-0.4,0L68.9,47.3z" style="fill: #FFF;"></path>
            </g>
          </svg>
        </a>
      </div>
    </div>
  </div>
</header>
