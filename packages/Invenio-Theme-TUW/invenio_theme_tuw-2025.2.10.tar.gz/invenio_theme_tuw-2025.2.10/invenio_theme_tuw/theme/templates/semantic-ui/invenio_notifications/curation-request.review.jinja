{%- set curation_request = notification.context.request %}
{%- set group = curation_request.receiver %}
{%- set creator = curation_request.created_by %}
{%- set record = curation_request.topic %}
{%- set request_id = curation_request.id %}
{%- set executing_user = notification.context.executing_user %}
{%- set message = notification.context.message | safe if notification.context.message else '' %}
{%- set record_title = record.metadata.title %}
{%- set curator_name = executing_user.username or executing_user.profile.full_name %}
{%- set request_link = invenio_url_for("invenio_app_rdm_requests.user_dashboard_request_view", request_pid_value=request_id) %}
{%- set account_settings_link = invenio_url_for("invenio_notifications_settings.index") %}

{#- Subject for emails -#}
{%- block subject -%}
       {{ _("üëÅÔ∏è Review started for '%(record_title)s'", record_title=record_title) }}
{%- endblock subject -%}

{#- HTML body for emails -#}
{%- block html_body -%}
<p>
    {%- if message %}
    {{ _("Reviewer '@%(curator_name)s' started reviewing the record '%(record_title)s' with the following message:", curator_name=curator_name, record_title=record_title) }}
    {%- else %}
    {{ _("Reviewer '@%(curator_name)s' started reviewing the record '%(record_title)s'.", curator_name=curator_name, record_title=record_title) }}
    {%- endif %}
    </td>
</p>
{%- if message %}
<p>
    <em>{{message}}</em>
</p>
{%- endif %}
<p>
    <a href="{{request_link}}" class="button">{{ _("See the curation request") }}</a>
</p>
<hr />
<p style="font-size:smaller;">
    {{ _('This is an auto-generated message. To manage notifications, visit your <a href="%(account_settings_link)s">account settings</a>.', account_settings_link=account_settings_link) }}
</p>
{%- endblock html_body %}
{#- End of HTML body -#}

{#- Plaintext body for emails -#}
{%- block plain_body -%}
{%- if not message %}
{{ _("Reviewer @%(curator_name)s started reviewing the record '%(record_title)s'", curator_name=curator_name, record_title=record_title) }}
{%- else %}
{{ _("Reviewer @%(curator_name)s started reviewing the record '%(record_title)s' with the following message:", curator_name=curator_name, record_title=record_title) }}

{{message}}
{%- endif %}

{{ _("See the curation request") }}: {{ request_link }}

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock plain_body %}
{#- End of plaintext body -#}

{#- Markdown body for Slack/Mattermost/chat -#}
{%- block md_body -%}
{%- if message %}
{{ _("Reviewer *@%(curator_name)s* started reviewing the record *%(record_title)s*", curator_name=curator_name, record_title=record_title) }}
{%- else %}
{{ _("Reviewer *@%(curator_name)s* started reviewing the record *%(record_title)s* with the following message:", curator_name=curator_name, record_title=record_title) }}

> {{message}}
{%- endif %}

[{{ _("See the curation request") }}]({{ request_link }})

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock md_body %}
{#- End of Markdown body -#}
