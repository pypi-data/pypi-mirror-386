{# -*- coding: utf-8 -*-

  Copyright (C) 2020-2021 CERN.
  Copyright (C) 2020-2021 Northwestern University.
  Copyright (C) 2020-2022 TU Wien.

  Invenio is free software; you can redistribute it and/or modify it
  under the terms of the MIT License; see LICENSE file for more details.
#}

{#- Versions #}
<div class="ui segment rdm-sidebar">
  <dt><b>{{ _('Versions')}}</b></dt>
  <hr class="thin-line">
  </hr>
  <dd class="versions">
    <div id="recordVersions" data-record='{{ record | tojson }}' data-preview='{{ is_preview | tojson }}'></div>
  </dd>
</div>

{#- DOI #}
<div class="ui segment rdm-sidebar">
  <dt><b>Digital Object Identifier</b></dt>
  <hr class="thin-line"></hr>
  <dd class="doi">
    <div class="ui padded grid">
      <div class="one column row">
        <div class="column left aligned">
          <p class="text-muted font-small">
            {%- set doi = None %}

            {%- if record and record_ui["pids"] and record_ui["pids"]["doi"] -%}
              {%- set doi = record_ui["pids"]["doi"]["identifier"] -%}
            {%- endif %}

            {%- if not doi %}
              {%- set doi = metadata.identifiers|tuw_doi_identifier -%}
            {%- endif %}

            {%- if doi -%}
              DOI: <a href="https://doi.org/{{ doi }}">{{ doi }}</a>

            {%- else %}
              No DOI available

            {%- endif %}

          </p>
        </div>
      </div>
    </div>
  </dd>
</div>

{# Cite As #}
<div class="ui segment rdm-sidebar">
  <dt><b>{{ _('Cite As')}}</b></dt>
  <hr class="thin-line"></hr>
  <div id="recordCitationTUW" data-record='{{ record | tojson }}'
       data-styles='{{ config.get("RDM_CITATION_STYLES") | tojson }}'
       data-defaultstyle='{{ config.get("RDM_CITATION_STYLES_DEFAULT") | tojson }}'>
  </div>
</div>

{#- Export As #}
{#- if no export formats are specified, don't bother showing the box #}
{%- if config.get("APP_RDM_RECORD_EXPORTERS") -%}

  <div class="ui segment rdm-sidebar exports">
    <dt><b>{{ _('Export')}}</b></dt>
    <hr class="thin-line"></hr>
    <dd class="top-bottom-padded">
      <div class="ui celled horizontal list separated-list">

        {#- dynamically create the list of export formats #}
        {%- for fmt, val in config.get("APP_RDM_RECORD_EXPORTERS", {}).items() %}
          {%- set name = val.get("name", fmt) %}

          {%- if is_preview %}
            {%- set export_url = url_for('invenio_app_rdm_records.record_export', pid_value=record_ui["id"], export_format=fmt, preview=1) %}

          {%- else %}
            {%- set export_url = url_for('invenio_app_rdm_records.record_export', pid_value=record_ui["id"], export_format=fmt) %}

          {%- endif %}

          <div class="item">
            <a href="{{ export_url }}">{{ name }}</a>
          </div>

        {%- endfor %}

      </div>
    </dd>
  </div>

{%- endif %}
