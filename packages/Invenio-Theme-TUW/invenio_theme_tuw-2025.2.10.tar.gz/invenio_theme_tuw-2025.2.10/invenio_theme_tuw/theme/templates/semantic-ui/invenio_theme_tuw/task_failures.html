{# -*- coding: utf-8 -*-

  Copyright (C) 2025 TU Wien.

  Invenio Theme TUW is free software; you can redistribute it and/or modify it
  under the terms of the MIT License; see LICENSE file for more details.
#}

{%- extends config.BASE_TEMPLATE %}

{%- block page_body %}
<main class="ui container">
  <h1>Recent background task failures</h1>
  <table class="task failures">
    <caption>Infos about recent background task failures</caption>
    <thead>
      <tr>
        <th class="timestamp">Timestamp</th>
        <th class="id">Task ID</th>
        <th class="name">Task name</th>
        <th class="args">Args</th>
        <th class="kwargs">KW Args</th>
        <th class="stack trace">Stack trace</th>
      </tr>
    </thead>
    <tbody>
    {%- for failure in failures %}
      <tr>
        <td class="timestamp">{{ failure.timestamp.strftime("%Y-%m-%d %H:%M:%S") if failure.timestamp else "-" }}</td>
        <td class="id">{{ failure.task_id }}</td>
        <td class="name">{{ failure.task_name }}</td>
        <td class="args"><pre>{{ failure.task_args or "[]" }}</pre></td>
        <td class="kwargs"><pre>{{ failure.task_kwargs or "{}" }}</pre></td>
        <td class="stack trace"><pre>{{ failure.exception_info }}</pre></td>
      </tr>
    {%- endfor -%}
    </tbody>
  </table>
</main>
{%- endblock page_body %}

{%- block css %}
  {{ super() }}
  {{ webpack['invenio-theme-tuw-task-failures.css'] }}
{%- endblock css %}
