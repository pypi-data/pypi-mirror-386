{# -*- coding: utf-8 -*-

  Copyright (C) 2019-2020 CERN.
  Copyright (C) 2019-2020 Northwestern University.
  Copyright (C) 2021 New York University.
  Copyright (C) 2020-2025 TU Wien.

  Invenio Theme TUW is free software; you can redistribute it and/or modify it
  under the terms of the MIT License; see LICENSE file for more details.
#}

{#- base: invenio-app-rdm v9.1.2 #}
{#- changes: everything, including view function #}
{%- extends config.BASE_TEMPLATE %}

{%- block page_header %}
  {% include config.THEME_HEADER_TEMPLATE %}
{%- endblock %}

{%- block page_hero %}
  <section class="frontpage no-shrink" id="hero">
    {% include "invenio_theme_tuw/search_bar.html" %}
    {#- note: the CTS logo is added here to avoid leaking into other uses of "search_bar.html" #}
    <a href="{{ config.THEME_TUW_CORETRUSTSEAL_URL }}" target="_blank">
      <img class="cts logo" src="/static/images/footer-logos/coretrustseal-logo.webp" alt="{{ _('Logo of Core Trust Seal') }}" />
    </a>
  </section>
{%- endblock page_hero %}

{%- block page_body %}
  <section id="welcome" class="ui container">
    <h1>Welcome to {{ config.THEME_SITENAME }}</h1>
    <p>
      {{ config.THEME_SITENAME }} is an institutional repository of TU Wien to enable storing, sharing and publishing of
      digital objects, in particular research data. It facilitates the funders' requirements for open access to
      research data and the FAIR principles by making research output findable, accessible, interoperable and re-usable.
      It is developed by the
      <a class="plain link" href="{{ config.THEME_TUW_CRDM_URL }}" target="_blank" rel="noopener">TU Wien Center for Research Data Management</a>
      and hosted by
      <a class="plain link" href="https://www.it.tuwien.ac.at/" target="_blank" rel="noopener">Campus IT</a>
      on servers in Vienna, Austria.
    </p>
    <p>
      The repository uses persistent identifiers and synchronises with data hubs such as
      <a class="plain link" href="https://commons.datacite.org/" target="_blank" rel="noopener">DataCite</a>,
      <a class="plain link" href="https://explore.openaire.eu/" target="_blank" rel="noopener">OpenAIRE</a>,
      <a class="plain link" href="https://www.base-search.net/" target="_blank" rel="noopener">BASE</a>,
      and search services like
      <a class="plain link" href="https://datasetsearch.research.google.com/" target="_blank" rel="noopener">Google Dataset Search</a>.
      Thus, it maximizes the visibility of the uploaded content.
      {{ config.THEME_SITENAME }} is also listed in
      <a class="plain link" href="{{ config.THEME_TUW_FAIRSHARING_URL }}" target="_blank" rel="noopener">FAIRsharing</a> and
      <a class="plain link" href="{{ config.THEME_TUW_RE3DATA_URL }}" target="_blank" rel="noopener">re3data</a> - registries many funders refer to.
    </p>
  </section>

  <section id="features" class="ui container">
    <div class="features-wrapper">
      <a href="{{ url_for('invenio_app_rdm_records.deposit_create') }}">
        <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="static/images/features/upload-file.webp"
                   alt="icon displaying a cloud and a arrow pointing upwards."/>
            </div>
            <div class="flip-card-back">
              <p>
                Deposit research outputs openly, restricted or closed. A landing page provides information on your
                digital objects, download links, license and persistent identifier.
              </p>
            </div>
          </div>
          <span class="tile-title">Deposit</span>
        </div>
      </a>

      <a href="{{ url_for('invenio_search_ui.search') }}">
        <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="static/images/features/magnifying-glass.webp" alt="icon displaying a magnifying glass"/>
            </div>
            <div class="flip-card-back">
              <p>Search datasets published by other users.</p>
            </div>
          </div>
          <span class="tile-title">Search</span>
        </div>
      </a>

      <a href="{{ config.THEME_TUW_FAQ_URL }}" target="_blank" rel="noopener">
        <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="static/images/features/faq.webp" alt="icon displaying a faq speach bubble"/>
            </div>
            <div class="flip-card-back">
              <p>For any questions regarding this service, please refer to our FAQ and our Upload Guide.</p>
            </div>
          </div>
          <span class="tile-title">FAQ</span>
        </div>
      </a>

      <a href="{{ url_for('invenio_theme_tuw.tuw_contact') }}">
        <div class="flip-card">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="static/images/features/online-chat.webp" alt="icon displaying two speach bubbles"/>
            </div>
            <div class="flip-card-back">
              <p>To get in touch with our team, please visit our 'Contact' page.</p>
            </div>
          </div>
          <span class="tile-title">Contact</span>
        </div>
      </a>
    </div>
  </section>

  <section id="recent-uploads" class="ui container">
    <h1>Recent Uploads</h1>

    <div>
      {%- for r in records %}
        {%- set creation_date = r.created|from_isodatetime -%}
        {%- set record_url = url_for('invenio_app_rdm_records.record_detail', pid_value=r.id) %}

        <article class="invenio-record">
          <h2 class="smaller-text">
            <a href="{{ record_url }}" class="no-decoration">
              {{ r.metadata.title }}
            </a>
          </h2>

          <div>
            {%- for creators in r.metadata.creators %}

              {%- if creators.identifiers and creators.identifiers.orcid %}
                <a href="{{ creators.identifiers.orcid|pid_url('orcid') }}" target="_blank" rel="noopener">
                  <img class="inline-orcid" src="{{ url_for('static', filename='extra/orcid.png') }}" alt="The ORCID logo" />
                </a>
              {%- endif %}
              <span class="text-muted" {% if creators.affiliations %} {% for affiliation in creators.affiliations %}
                    data-tooltip="{{ affiliation.name }}" data-inverted="" {%- endfor %} {% endif %}>
                {{ creators.person_or_org.name }}
              </span>
              {% if not loop.last %}; {% endif %}
            {%- endfor %}
          </div>

          <div class="badges">
            <!--Publication date/Version badge-->
            <span class="ui label blue" data-tooltip="{{ _('Publication date') }}" data-inverted="">
              {{ r.metadata.publication_date }} {{ '(' ~ r.metadata.version ~ ')' if r.metadata.version }}
            </span>

            <!--Resource type badge-->
            <span class="ui label grey" data-tooltip="{{ _('Resource type') }}" data-inverted>
              {{ r.ui.resource_type.title_l10n }}
            </span>

            <span class="ui label access-status {{ r.ui.access_status.id }}"
                  data-tooltip="{{ r.ui.access_status.description_l10n }}" data-inverted="">
              {% if r.ui.access_status.icon %}<i class="icon {{ r.ui.access_status.icon }}"></i>{% endif %}
              {{ r.ui.access_status.title_l10n }}
            </span>
          </div>

          <div>
            {{ r.metadata.description | striptags | truncate(300) }}
          </div>

          <div class="ui grid">
            <div class="two column row">
              <div class="left floated column">
                {%- for s in r.metadata.subjects %}
                  <div class="ui tiny label">{{ s.subject }}</div>
                {%- endfor %}
                <div>
                  <small>
                    {% trans user=userprofile, date=creation_date | dateformat('long') %}
                      Uploaded on {{ date }}
                    {% endtrans %}
                  </small>
                </div>
              </div>
            </div>
          </div>
        </article>

      {%- endfor %}
    </div>

    <div class="ui centered grid">
      <a href="{{ config.THEME_SEARCH_ENDPOINT }}"><button id="more-button" class="ui primary button">More</button></a>
    </div>

    {%- if not records %}
      <div class="ui visible message">
        <p>Currently no records available.</p>
      </div>
    {%- endif %}

  </section>

{%- endblock page_body %}

{%- block javascript %}
  {{ super() }}
{%- endblock javascript %}

{%- block trackingcode %}
  {% include config.THEME_TRACKINGCODE_TEMPLATE %}
{%- endblock %}
