{%- set curation_request = notification.context.request %}
{%- set group = curation_request.receiver %}
{%- set creator = curation_request.created_by %}
{%- set record = curation_request.topic %}
{%- set request_id = curation_request.id %}
{%- set creator_name = creator.username or creator.profile.full_name %}
{%- set record_title = record.metadata.title %}
{%- set message = notification.context.message | safe if notification.context.message else '' %}
{%- set request_link = invenio_url_for("invenio_app_rdm_requests.user_dashboard_request_view", request_pid_value=request_id) %}
{%- set account_settings_link = invenio_url_for("invenio_notifications_settings.index") %}

{#- Subject for emails -#}
{%- block subject -%}
       {{ _("ðŸ“¥ New curation request submitted") }}
{%- endblock subject -%}

{#- HTML body for emails -#}
{%- block html_body -%}
<p>
    {%- if message %}
    {{ _("The record '%(record_title)s' was submitted for curation by '@%(creator_name)s' with the following message:", record_title=record_title, creator_name=creator_name) }}
    {%- else %}
    {{ _("The record '%(record_title)s' was submitted for curation by '@%(creator_name)s'.", record_title=record_title, creator_name=creator_name) }}
    {%- endif %}
    </td>
</p>
{%- if message %}
<p>
    <em>{{message}}</em>
</p>
{%- endif %}
<p>
    <a href="{{request_link}}" class="button">{{ _("See the curation request") }}</a>
</p>
<hr />
<p style="font-size:smaller;">
    {{ _('This is an auto-generated message. To manage notifications, visit your <a href="%(account_settings_link)s">account settings</a>.', account_settings_link=account_settings_link) }}
</p>
{%- endblock html_body %}
{#- End of HTML body -#}

{#- Plaintext body for emails -#}
{%- block plain_body -%}
{%- if not message %}
{{ _("The record '%(record_title)s' was submitted for curation by '@%(creator_name)s'.", record_title=record_title, creator_name=creator_name) }}
{%- else %}
{{ _("The record '%(record_title)s' was submitted for curation by '@%(creator_name)s' with the following message:", record_title=record_title, creator_name=creator_name) }}

{{message}}
{%- endif %}

{{ _("See the curation request") }}: {{ request_link }}

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock plain_body %}
{#- End of plaintext body -#}

{#- Markdown body for Slack/Mattermost/chat -#}
{%- block md_body -%}
{%- if not message %}
{{ _("The record *'%(record_title)s'* was submitted for curation by *'@%(creator_name)s'*.", record_title=record_title, creator_name=creator_name) }}
{%- else %}
{{ _("The record *'%(record_title)s'* was submitted for curation by *'@%(creator_name)s'* with the following message:", record_title=record_title, creator_name=creator_name) }}

> {{message}}
{%- endif %}

[{{ _("See the curation request") }}]({{ request_link }})

{{ _("This is an auto-generated message. To manage notifications, visit your account settings")}}
{%- endblock md_body %}
{#- End of Markdown body -#}
