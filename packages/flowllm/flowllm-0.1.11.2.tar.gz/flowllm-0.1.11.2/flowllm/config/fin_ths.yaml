import_config: default
backend: mcp

flow:
  crawl_ths_company:
#    flow_content: ths_company_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_company_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取公司资料信息，例如：详细情况，高管介绍，发行相关，参控股公司，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_holder:
#    flow_content: ths_holder_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_holder_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取股东研究信息，例如：股东人数、十大流通股东、十大股东、十大债券持有人、控股层级关系，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_operate:
#    flow_content: ths_operate_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_operate_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取经营分析信息，例如：主营介绍、运营业务数据、主营构成分析、主要客户及供应商、董事会经营评述、产品价格，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_equity:
#    flow_content: ths_equity_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_equity_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取股本结构信息，例如：解禁时间表、总股本构成、A股结构图、历次股本变动，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_capital:
#    flow_content: ths_capital_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_capital_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取资本运作信息，例如：募集资金来源、项目投资、收购兼并、股权投资、参股IPO、股权转让、关联交易、质押解冻，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_worth:
#    flow_content: ths_worth_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_worth_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取盈利预测信息，例如：业绩预测、业绩预测详表、研报评级，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_news:
#    flow_content: ths_news_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_news_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取新闻公告信息，例如：新闻与股价联动、公告列表、热点新闻列表、研报列表，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_concept:
#    flow_content: ths_concept_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_concept_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取概念题材信息，例如：常规概念、其他概念、题材要点、概念对比，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_position:
#    flow_content: ths_position_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_position_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取主力持仓信息，例如：机构持股汇总、机构持股明细、被举牌情况、IPO获配机构，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_finance:
#    flow_content: ths_finance_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_finance_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取财务分析信息，例如：财务诊断、财务指标、指标变动说明、资产负债构成、财务报告、杜邦分析，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_bonus:
#    flow_content: ths_bonus_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_bonus_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取分红融资信息，例如：分红诊断、分红情况、增发机构获配明细、增发概况、配股概况，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_event:
#    flow_content: ths_event_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_event_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取公司大事信息，例如：高管持股变动、股东持股变动、担保明细、违规处理、机构调研、投资者互动，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

  crawl_ths_field:
#    flow_content: ths_field_op >> bailian_web_parser_op >> extract_long_text_op
    flow_content: ths_field_op >> crawl4ai_op >> extract_long_text_op
    description: "通过股票代码获取行业对比信息，例如：行业地位、行业新闻，最后返回和query相关的信息。"
    input_schema:
      query:
        type: string
        description: "user query"
        required: true
      code:
        type: string
        description: "stock code"
        required: true

op:
  ths_company_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/company.html#stockpage"

  ths_holder_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/holder.html#stockpage"

  ths_operate_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/operate.html#stockpage"

  ths_equity_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/equity.html#stockpage"

  ths_capital_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/capital.html#stockpage"

  ths_worth_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/worth.html#stockpage"

  ths_news_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/news.html#stockpage"

  ths_concept_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/concept.html#stockpage"

  ths_position_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/position.html#stockpage"

  ths_finance_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/finance.html#stockpage"

  ths_bonus_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/bonus.html#stockpage"

  ths_event_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/event.html#stockpage"

  ths_field_op:
    backend: ths_url_op
    params:
      url_template: "https://basic.10jqka.com.cn/{code}/field.html#stockpage"

  bailian_web_parser_op:
    backend: base_mcp_op
    params:
      mcp_name: tongyi_web_parser
      tool_name: bailian_web_parser
      input_schema_optional:
        - format
      output_schema_mapping:
        bailian_web_parser_result: long_text
      enable_cache: true

  # 可以使用crawl4ai_op 代替 bailian_web_parser_op
  crawl4ai_op:
    backend: crawl4ai_op
    params:
      output_schema_mapping:
        crawl4ai_result: long_text
      enable_cache: true

  extract_long_text_op:
    backend: extract_long_text_op
    params:
      save_answer: true

external_mcp:
  tongyi_web_parser:
    type: sse
    url: "https://dashscope.aliyuncs.com/api/v1/mcps/WebParser/sse"
    headers:
      Authorization: "Bearer {FLOW_BAILIAN_API_KEY}"