{%- set context = notification.context -%}
{%- set publisher = context.publisher -%}
{%- set receiver = recipient.data -%}
{%- set record_url = invenio_url_for("invenio_app_rdm_records.record_detail", pid_value=context.recid) -%}
{%- set account_settings_link = invenio_url_for("invenio_notifications_settings.index") %}

{#- Subject line for emails #}
{%- block subject -%}
    {{ context.subject }}
{%- endblock subject %}

{#- HTML body for emails #}
{%- block html_body -%}
{%- if context.description_diff_table %}
<style>
.diff_sub{
  background-color: orangered;
}
.diff_add {
  background-color: yellowgreen;
}
.diff_next /* hide links */ {
  display: none
}
.diff_header {
  min-width: 2em; text-align: center;
}
[nowrap] /* for diff lines */ {
  padding: 0 0.5em;
}
</style>
{%- endif %}
<p>
    Hey, {{ receiver.profile.given_name or receiver.profile.full_name or receiver.username }}!
</p>
<p>
    A new edit for your record "{{ context.record.metadata.title }}" was just published by @{{ publisher.username }}.
</p>
{%- if context.updated_access_settings %}
<p>
    The access/visibility settings were updated.
</p>
{%- endif %}
{%- if context.updated_metadata_fields %}
<p>
    The following metadata fields were updated:
    <ul>
        {%- for field_name in context.updated_metadata_fields %}
        <li>{{ field_name }}</li>
        {%- endfor %}
    </ul>
</p>
{%- endif %}
{%- if context.description_diff_table %}
<p>
    The description has changed as follows:

    {{ context.description_diff_table|safe }}
</p>
{%- endif %}
<p>
    See the new revision on its landing page: <a href="{{ record_url }}">{{ record_url}}</a>
</p>
<hr />
<p style="font-size:smaller;">
    {%- trans account_settings_link=account_settings_link -%}
    This is an auto-generated message. To manage notifications, visit your <a href="{{ account_settings_link }}">account settings</a>.
    {%- endtrans -%}
</p>
{%- endblock html_body -%}

{#- Plaintext body for emails #}
{%- block plain_body -%}
Hey, {{ receiver.profile.given_name or receiver.profile.full_name or receiver.username }}!

A new edit for your record "{{ context.record.metadata.title }}" was just published by @{{ publisher.username }}.

{%- if context.updated_access_settings %}
The access/visibility settings were updated.
{%- endif %}
{%- if context.updated_metadata_fields %}
The following metadata fields were updated:
{%- for field_name in context.updated_metadata_fields %}
* {{ field_name }}
{%- endfor %}
{%- endif %}

See the new revision on its landing page: {{ record_url }}

{%- trans account_settings_link=account_settings_link -%}
This is an auto-generated message. To manage notifications, visit your account settings: {{ account_settings_link }}
{%- endtrans -%}
{%- endblock plain_body -%}

{#- Markdown body for chat #}
{%- block md_body -%}
Hey, {{ receiver.profile.given_name or receiver.profile.full_name or receiver.username }}!

A new edit for your record "{{ context.record.metadata.title }}" was just published by @{{ publisher.username }}.

{%- if context.updated_access_settings %}
The access/visibility settings were updated.
{%- endif %}
{%- if context.updated_metadata_fields %}
The following metadata fields were updated:
{%- for field_name in context.updated_metadata_fields %}
* {{ field_name }}
{%- endfor %}
{%- endif %}

See the new revision on its landing page: [{{ record_url }}]({{ record_url }})

{%- trans account_settings_link=account_settings_link -%}
This is an auto-generated message. To manage notifications, visit your [account settings]({{ account_settings_link }}).
{%- endtrans -%}
{%- endblock md_body -%}
