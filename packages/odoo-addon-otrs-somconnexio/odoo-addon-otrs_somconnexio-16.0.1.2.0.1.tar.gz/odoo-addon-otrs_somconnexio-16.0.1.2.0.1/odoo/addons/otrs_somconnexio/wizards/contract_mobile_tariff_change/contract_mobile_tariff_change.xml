<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>
    <record id="contract_mobile_simplified" model="ir.ui.view">
      <field name="name">contract mobile simplified tree view</field>
      <field name="model">contract.contract</field>
      <field name="arch" type="xml">
        <tree>
          <field name="phone_number"/>
          <field name="current_tariff_product"/>
          <field name="date_start"/>
        </tree>
      </field>
    </record>
    <record id="view_form_contract_mobile_tariff_change_wizard" model="ir.ui.view">
      <field name="name">Contract Mobile Tariff Change Wizard</field>
      <field name="model">contract.mobile.tariff.change.wizard</field>
      <field name="arch" type="xml">
        <form>
          <group>
            <field name="contract_id" invisible="1"/>
            <field name="available_products" invisible="1"/>
            <field name="available_fiber_contracts" invisible="1"/>
            <field name="mobile_contracts_available_to_pack" invisible="1"/>
            <field name="mobile_products" invisible="1"/>
            <field name="exceptional_change"/>
            <field name="send_notification" attrs="{'invisible': [('exceptional_change','=',False)]}"/>
            <separator/>
            <field name="pack_options"/>
            <field name="current_tariff_product" options="{'no_open': True,'no_create': 1,'no_create_edit': 1}"/>
            <field name="fiber_contract_to_link" attrs="{                            'invisible': [                               ('pack_options', '=', False)                             ],                            'required': [                               ('pack_options', '!=', False)                             ],                           }" options="{'no_create_edit':True}" domain="[('id', 'in', available_fiber_contracts)]"/>
            <field name="mobile_contracts_in_pack" attrs="{                            'invisible': [                               ('pack_options', 'in', [False, 'pinya_mobile_tariff'])                             ],                            'required': [                               ('pack_options', 'not in', [False, 'pinya_mobile_tariff'])                             ],                             'readonly': [                               ('pack_options', 'in', ['existing_shared_bond_pack', 'existing_pinya_pack'])                             ]                           }" context="{'tree_view_ref':'somconnexio.contract_mobile_simplified'}" domain="[('id', 'in', mobile_contracts_available_to_pack)]"/>
            <field name="new_tariff_product_id" attrs="{                             'readonly': [('pack_options', 'in', ['existing_shared_bond_pack', 'existing_pinya_pack'])]                           }" domain="[('id', 'in', available_products)]" options="{'no_create_edit':True}" required="1"/>
            <field name="is_pack_full" invisible="1"/>
            <field name="phone_to_exchange" attrs="{                             'invisible': ['|',                               ('is_pack_full', '=', False),                               ('pack_options', 'not in', ['existing_shared_bond_pack', 'existing_pinya_pack'])                             ],                             'required': [('is_pack_full', '=', True), ('pack_options', 'not in', ['existing_shared_bond_pack', 'existing_pinya_pack'])]                            }" domain="[('id', 'in', mobile_contracts_in_pack), ('id', '!=', contract_id)]"/>
            <field name="new_tariff_product_id_exchanged_phone" options="{'no_create_edit':True}" domain="[('id', 'in', mobile_products),                              ('public', '=', True),                              ('product_template_attribute_value_ids.product_attribute_value_id', 'not in', [%(somconnexio.IsInPack)d]),                             ('product_tmpl_id', '=', %(somconnexio.Mobile_product_template)d)]" attrs="{                       'invisible': [('phone_to_exchange', '=', False)],                       'required': [('phone_to_exchange', '!=', False)]                   }"/>
            <field name="note"/>
            <!-- TODO: Remove confirm logic if check is done in OTRs-->
            <label style="color:Red;font-weight:bold;" for="otrs_checked"/>
            <field nolabel="1" name="otrs_checked"/>
          </group>
          <field name="will_force_other_mobiles_to_quit_pack" invisible="1"/>
          <footer>
            <button type="object" name="button_change" string="Change" attrs="{'invisible': [('will_force_other_mobiles_to_quit_pack', '=', False)]}" confirm="Change tariff will create a ticket in OTRS and break packs. At 6pm, changes will be made to mobile lines that are no longer in packs. Are you sure?"/>
            <button type="object" name="button_change" string="Change" attrs="{'invisible': [('will_force_other_mobiles_to_quit_pack', '=', True)]}"/>
            <button special="cancel" string="Cancel" class="btn-secondary"/>
          </footer>
        </form>
      </field>
    </record>
    <record id="action_contract_mobile_tariff_change_wizard" model="ir.actions.act_window">
      <field name="name">Change Mobile Tariff</field>
      <field name="res_model">contract.mobile.tariff.change.wizard</field>
      <field name="view_mode">form</field>
      <field name="view_id" ref="view_form_contract_mobile_tariff_change_wizard"/>
      <field name="target">new</field>
    </record>
    <record id="view_contract_form_mobile_tariff_change_wizard_button" model="ir.ui.view">
      <field name="name">contract.form.mobile.tariff.change.wizard.button</field>
      <field name="model">contract.contract</field>
      <field name="inherit_id" ref="contract.contract_contract_form_view"/>
      <field name="arch" type="xml">
        <button name="action_contract_send" position="after">
          <field name="is_broadband" invisible="1"/>
          <button name="%(action_contract_mobile_tariff_change_wizard)d" string="Change Tariff Mobile" type="action" context="{'default_active_id': active_id}" attrs="{'invisible': [('is_broadband', '=', True)]}"/>
        </button>
      </field>
    </record>
  </data>
</odoo>
