Metadata-Version: 2.4
Name: libimobiledevice-wrapper
Version: 1.1.0
Summary: Python wrapper for libimobiledevice with async support and CLI tools
Author-email: Huang-Jacky <hjc853@gmail.com>
License: MIT
Project-URL: Homepage, https://github.com/Huang-Jacky/libimobiledevice-wrapper
Project-URL: Repository, https://github.com/Huang-Jacky/libimobiledevice-wrapper
Project-URL: Issues, https://github.com/Huang-Jacky/libimobiledevice-wrapper/issues
Keywords: ios,libimobiledevice,mobile,automation,testing
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Testing
Classifier: Topic :: System :: Hardware
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: click>=8.0.0
Requires-Dist: aiofiles>=23.0.0
Requires-Dist: rich>=13.0.0
Requires-Dist: aiohttp>=3.8.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: flake8>=6.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Dynamic: license-file

# libimobiledevice-wrapper

ä¸€ä¸ªåŸºäº libimobiledevice çš„ Python å°è£…å·¥å…·ï¼Œæ”¯æŒ iOS è®¾å¤‡ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ“ä½œã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”§ å®Œæ•´çš„ libimobiledevice å‘½ä»¤å°è£…
- âš¡ å¼‚æ­¥æ”¯æŒï¼ˆasyncioï¼‰
- ğŸ›¡ï¸ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ğŸ–¥ï¸ å‘½ä»¤è¡Œå·¥å…·ï¼ˆCLIï¼‰
- ğŸš€ WebDriverAgent æ¥å£æ”¯æŒ
- ğŸ“± iOS è®¾å¤‡ç®¡ç†
- ğŸ” è®¾å¤‡ä¿¡æ¯è·å–
- ğŸ“¦ åº”ç”¨å®‰è£…å’Œç®¡ç†

## å®‰è£…

### å‰ç½®è¦æ±‚

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… libimobiledeviceï¼š

```bash
# macOS
brew install libimobiledevice

# Ubuntu/Debian
sudo apt-get install libimobiledevice6 libimobiledevice-utils

# CentOS/RHEL
sudo yum install libimobiledevice
```

### Python åŒ…å®‰è£…

```bash
pip install libimobiledevice-wrapper
```

æˆ–ä»æºç å®‰è£…ï¼š

```bash
git clone https://github.com/Huang-Jacky/libimobiledevice-wrapper.git
cd libimobiledevice-wrapper
pip install -e .
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from libimobiledevice_wrapper import LibiMobileDevice

# åŒæ­¥ä½¿ç”¨
device = LibiMobileDevice()
devices = device.list_devices()
print(f"è¿æ¥çš„è®¾å¤‡: {devices}")

# å¼‚æ­¥ä½¿ç”¨
import asyncio

async def main():
    device = LibiMobileDevice()
    devices = await device.list_devices_async()
    print(f"è¿æ¥çš„è®¾å¤‡: {devices}")

asyncio.run(main())
```

### å‘½ä»¤è¡Œå·¥å…·ï¼ˆä¸¤ç§ç”¨æ³•ï¼‰

1) å…¨å±€å‘½ä»¤ï¼ˆæ¨èï¼‰

å®‰è£…åä¼šæä¾›å¯æ‰§è¡Œå‘½ä»¤ `libidevice`ï¼š

```bash
# åˆ—å‡ºè¿æ¥çš„è®¾å¤‡
libidevice list-devices

# è·å–è®¾å¤‡ä¿¡æ¯
libidevice info --udid <device_udid>

# å®‰è£…åº”ç”¨
libidevice install --udid <device_udid> /path/to/app.ipa

# è·å–åº”ç”¨ä¿¡æ¯
libidevice app-info --udid <device_udid> --bundle-id com.example.app

# æˆªå–å±å¹•æˆªå›¾
libidevice screenshot --udid <device_udid> --output screenshot.png

**æ³¨æ„ï¼šæˆªå±åŠŸèƒ½éœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒ**
- å¦‚æœé‡åˆ° "Could not start screenshotr service!" é”™è¯¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•æŒ‚è½½å¼€å‘è€…ç£ç›˜é•œåƒ
- å¦‚æœè‡ªåŠ¨æŒ‚è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ Xcode
- æˆ–æ‰‹åŠ¨æŒ‚è½½ï¼š`ideviceimagemounter -u <udid> <path_to_DeveloperDiskImage.dmg>`

# ç®€æ´æ—¥å¿—æ•è·
device = LibiMobileDevice()
monitor = device.monitor_device_logs(
    udid="<device_udid>",
    keywords=["error", "MTG"],
    log_file_path="logs.txt",
    duration=60  # 60ç§’åè‡ªåŠ¨åœæ­¢
)
monitor.start()
time.sleep(30)  # æ•è·30ç§’
monitor.stop()  # è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶

# æˆ–ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with device.monitor_device_logs(udid="<device_udid>", keywords=["error"], log_file_path="logs.txt") as monitor:
    time.sleep(30)
# è‡ªåŠ¨åœæ­¢å¹¶ä¿å­˜

# å¯åŠ¨åº”ç”¨
libidevice launch --udid <device_udid> --bundle-id com.example.app
```

**æ³¨æ„ï¼šå¯åŠ¨åº”ç”¨åŠŸèƒ½éœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒ**
- å¦‚æœé‡åˆ° "Could not start com.apple.debugserver!" é”™è¯¯
- éœ€è¦å…ˆæŒ‚è½½å¼€å‘è€…ç£ç›˜é•œåƒï¼š`ideviceimagemounter -u <udid> <path_to_DeveloperDiskImage.dmg>`
- æˆ–è€…æ‰‹åŠ¨åœ¨è®¾å¤‡ä¸Šå¯åŠ¨åº”ç”¨ï¼Œç„¶åä½¿ç”¨æ—¥å¿—ç›‘æ§åŠŸèƒ½

é‡åˆ°æ‰¾ä¸åˆ°å‘½ä»¤æ—¶ï¼š
- ä½¿ç”¨ PyPI å®‰è£…ï¼š`python3 -m pip install libimobiledevice-wrapper`ï¼ˆç„¶åæ‰§è¡Œ `pyenv rehash` å¦‚ä½¿ç”¨ pyenvï¼‰
- æˆ–ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ï¼š`~/.pyenv/versions/3.10.6/bin/libidevice list-devices`
- æˆ–å‚è€ƒç¬¬ 2 ç§ç”¨æ³•ï¼ˆæ¨¡å—æ–¹å¼ï¼‰

2) æ¨¡å—æ–¹å¼ï¼ˆå¤‡ç”¨ï¼‰

```bash
# åˆ—å‡ºè¿æ¥çš„è®¾å¤‡
python3 -m libimobiledevice_wrapper.cli list-devices

# è·å–è®¾å¤‡ä¿¡æ¯
python3 -m libimobiledevice_wrapper.cli info --udid <device_udid>

# å®‰è£…åº”ç”¨
python3 -m libimobiledevice_wrapper.cli install --udid <device_udid> /path/to/app.ipa

# è·å–åº”ç”¨ä¿¡æ¯
python3 -m libimobiledevice_wrapper.cli app-info --udid <device_udid> --bundle-id com.example.app

# è·å–è®¾å¤‡æ—¥å¿—
python3 -m libimobiledevice_wrapper.cli device-logs --udid <device_udid> --duration 60 --keywords "error,exception"

# å®æ—¶ç›‘æ§è®¾å¤‡æ—¥å¿—
python3 -m libimobiledevice_wrapper.cli device-logs --udid <device_udid> --keywords "error"

# æˆªå–å±å¹•æˆªå›¾
python3 -m libimobiledevice_wrapper.cli screenshot --udid <device_udid> --output screenshot.png

# å¯åŠ¨åº”ç”¨
python3 -m libimobiledevice_wrapper.cli launch --udid <device_udid> --bundle-id com.example.app
```

**æ³¨æ„ï¼šæˆªå±å’Œå¯åŠ¨åº”ç”¨åŠŸèƒ½éœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒ**
- æˆªå±åŠŸèƒ½ï¼šå¦‚æœé‡åˆ° "Could not start screenshotr service!" é”™è¯¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•æŒ‚è½½å¼€å‘è€…ç£ç›˜é•œåƒ
- å¯åŠ¨åº”ç”¨åŠŸèƒ½ï¼šå¦‚æœé‡åˆ° "Could not start com.apple.debugserver!" é”™è¯¯ï¼Œéœ€è¦å…ˆæŒ‚è½½å¼€å‘è€…ç£ç›˜é•œåƒ
- æ‰‹åŠ¨æŒ‚è½½ï¼š`ideviceimagemounter -u <udid> <path_to_DeveloperDiskImage.dmg>`
- ç¡®ä¿å·²å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ Xcode ä»¥è·å¾—æ­£ç¡®çš„å¼€å‘è€…ç£ç›˜é•œåƒ

## API æ–‡æ¡£

### LibiMobileDevice ç±»

ä¸»è¦çš„è®¾å¤‡ç®¡ç†ç±»ï¼Œæä¾›æ‰€æœ‰ libimobiledevice åŠŸèƒ½çš„å°è£…ã€‚

#### è®¾å¤‡ç®¡ç†

- `list_devices()` - åˆ—å‡ºè¿æ¥çš„è®¾å¤‡
- `get_device_info(udid)` - è·å–è®¾å¤‡ä¿¡æ¯
- `get_device_props(udid)` - è·å–è®¾å¤‡å±æ€§

#### åº”ç”¨ç®¡ç†

- `install_app(udid, app_path)` - å®‰è£…åº”ç”¨
- `uninstall_app(udid, bundle_id)` - å¸è½½åº”ç”¨
- `list_apps(udid)` - åˆ—å‡ºå·²å®‰è£…åº”ç”¨
- `get_app_info(udid, bundle_id)` - è·å–æŒ‡å®šåº”ç”¨çš„è¯¦ç»†ä¿¡æ¯
- `launch_app(udid, bundle_id)` - å¯åŠ¨åº”ç”¨ï¼ˆéœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒï¼‰

#### æ–‡ä»¶æ“ä½œ

- `pull_file(udid, remote_path, local_path)` - ä»è®¾å¤‡æ‹‰å–æ–‡ä»¶
- `push_file(udid, local_path, remote_path)` - æ¨é€æ–‡ä»¶åˆ°è®¾å¤‡

#### ç³»ç»Ÿæ“ä½œ

- `reboot_device(udid)` - é‡å¯è®¾å¤‡
- `shutdown_device(udid)` - å…³æœºè®¾å¤‡

#### æˆªå±

- `take_screenshot(udid, output_path)` - æˆªå–è®¾å¤‡å±å¹•æˆªå›¾ï¼ˆéœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒï¼‰
- `take_screenshot_async(udid, output_path)` - å¼‚æ­¥æˆªå–è®¾å¤‡å±å¹•æˆªå›¾ï¼ˆéœ€è¦å¼€å‘è€…ç£ç›˜é•œåƒæ”¯æŒï¼‰

#### æ—¥å¿—ç®¡ç†

- `get_device_logs(udid, duration, keywords)` - è·å–è®¾å¤‡æ—¥å¿—
- `monitor_device_logs(udid, keywords, callback, log_file_path, duration)` - å®æ—¶ç›‘æ§è®¾å¤‡æ—¥å¿—
  - è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ save_logs
  - æ”¯æŒå…³é”®å­—è¿‡æ»¤
  - æ”¯æŒæŒ‡å®šæ—¶é•¿è‡ªåŠ¨åœæ­¢
  - æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†å™¨

## é”™è¯¯å¤„ç†

æ‰€æœ‰æ–¹æ³•éƒ½åŒ…å«ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ï¼š

```python
from libimobiledevice_wrapper import LibiMobileDeviceError

try:
    device = LibiMobileDevice()
    devices = device.list_devices()
except LibiMobileDeviceError as e:
    print(f"è®¾å¤‡æ“ä½œå¤±è´¥: {e}")
```

## å¼‚æ­¥æ”¯æŒ

æ‰€æœ‰æ–¹æ³•éƒ½æä¾›å¼‚æ­¥ç‰ˆæœ¬ï¼š

```python
import asyncio
from libimobiledevice_wrapper import LibiMobileDevice

async def main():
    device = LibiMobileDevice()
    
    # å¼‚æ­¥æ–¹æ³•ä»¥ _async ç»“å°¾
    devices = await device.list_devices_async()
    info = await device.get_device_info_async(devices[0])
    
asyncio.run(main())
```

## WebDriverAgent æ”¯æŒ

```python
from libimobiledevice_wrapper import WebDriverAgent

wda = WebDriverAgent(device_udid="<device_udid>")
await wda.start()
session = await wda.create_session()
```


## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
