{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://gdsfactory.com/.pic.yml",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "pdk": { "$ref": "#/definitions/pdk" },
    "default_settings": { "$ref": "#/definitions/settings" },
    "instances": { "$ref": "#/definitions/instances" },
    "connections": { "$ref": "#/definitions/links" },
    "placements": { "$ref": "#/definitions/placements" },
    "routes": { "$ref": "#/definitions/routes" },
    "ports": { "$ref": "#/definitions/ports" },
    "info": { "$ref": "#/definitions/info" }
  },
  "definitions": {
    "pdk": { "type": "string", "description": "active pdk" },
    "settings": { "type": "object", "description": "settings" },
    "instances": {
      "description": "instances",
      "additionalProperties": { "$ref": "#/definitions/instance" }
    },
    "instance": {
      "additionalProperties": false,
      "properties": {
        "component": { "$ref": "#/definitions/component" },
        "settings": { "$ref": "#/definitions/settings" }
      },
      "allOf": []
    },
    "placements": {
      "type": "object",
      "description": "placements",
      "additionalProperties": { "$ref": "#/definitions/placement" }
    },
    "routes": {
      "type": "object",
      "description": "routes",
      "additionalProperties": { "$ref": "#/definitions/route" }
    },
    "route": {
      "additionalProperties": false,
      "properties": {
        "routing_strategy": { "$ref": "#/definitions/routing_strategy" },
        "settings": { "$ref": "#/definitions/route_settings" },
        "links": { "$ref": "#/definitions/links" }
      }
    },
    "links": {
      "type": "object",
      "properties": {
        "mzi_sc,o1": { "$ref": "#/definitions/instanceport" },
        "mzi_sc,o2": { "$ref": "#/definitions/instanceport" }
      },
      "patternProperties": {
        "^[a-zA-Z_]\\w*,[a-zA-Z_]\\w*(:[0-9]+)*$": {
          "$ref": "#/definitions/instanceport"
        }
      },
      "additionalProperties": false
    },
    "cross_section": {
      "type": "string",
      "anyOf": [{ "enum": ["xs_sc", "xs_so"] }],
      "description": "cross section"
    },
    "ports": {
      "type": "object",
      "description": "ports",
      "patternProperties": {
        "^[a-zA-Z_]\\w*$": { "$ref": "#/definitions/instanceport" }
      },
      "additionalProperties": false
    },
    "route_settings": {
      "type": "object",
      "description": "route settings",
      "properties": {
        "cross_section": { "$ref": "#/definitions/cross_section" },
        "separation": {
          "type": "number",
          "description": "waveguide separation within bundle"
        },
        "turns": {
          "type": "array",
          "description": "where to take turns in the route"
        }
      }
    },
    "routing_strategy": {
      "type": "string",
      "anyOf": [{ "enum": ["auto", "custom"] }, { "type": "string" }]
    },
    "placement": {
      "type": "object",
      "description": "placement",
      "additionalProperties": false,
      "properties": {
        "x": {
          "description": "x-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "xmin": {
          "description": "x-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "xmax": {
          "description": "x-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "y": {
          "description": "y-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "ymin": {
          "description": "y-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "ymax": {
          "description": "y-placement",
          "anyOf": [
            { "type": "number" },
            { "$ref": "#/definitions/instanceport" }
          ]
        },
        "port": {
          "type": "string",
          "description": "which port or location of the component to place",
          "anyOf": [
            { "$ref": "#/definitions/instanceport" },
            { "type": "string" },
            {
              "enum": [
                "ne",
                "nc",
                "nw",
                "se",
                "sc",
                "sw",
                "ce",
                "cw",
                "cc",
                "center"
              ]
            }
          ]
        },
        "rotation": { "type": "number", "description": "rotation" },
        "dx": { "type": "number", "description": "x-offset" },
        "dy": { "type": "number", "description": "y-offset" },
        "mirror": {
          "oneOf": [
            { "type": "boolean", "description": "horizontal flip" },
            {
              "type": "number",
              "description": "numeric value for mirror setting"
            }
          ],
          "description": "horizontal flip can be a boolean or a number"
        }
      }
    },
    "component": {
      "description": "component",
      "anyOf": [{ "enum": ["mmi1x2_sc", "mzi_sc", "straight_sc", "bend_sc"] }]
    },
    "instanceport": {
      "description": "link value",
      "anyOf": [
        { "enum": [] },
        {
          "type": "string",
          "pattern": "^[a-zA-Z_]\\w*,[a-zA-Z_]\\w*(:[0-9]+)*$"
        }
      ]
    },
    "info": { "type": "object", "description": "extra info" }
  }
}
