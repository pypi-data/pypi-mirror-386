[project]
# https://packaging.python.org/en/latest/guides/writing-pyproject-toml/
# https://packaging.python.org/en/latest/specifications/declaring-project-metadata/
name = "everysk-lib"
description = "Generic lib to share python code on Everysk."
requires-python = ">=3.11"

license = "LicenseRef-Proprietary"
license-files = ["LICENSE.txt"]

readme = "README.md"
# Do not remove/change version here, change on run.sh build section
dynamic = ["version"]

keywords = [
    "python",
    "development",
    "lib"
]

classifiers = [
    # How mature is this project? Common values are
    #   3 - Alpha
    #   4 - Beta
    #   5 - Production/Stable
    "Development Status :: 5 - Production/Stable",

    # Indicate who your project is intended for
    "Intended Audience :: Developers",
    "Topic :: Software Development :: Build Tools",

    # Pick your license as you wish (see also "license" above)
    # "License :: OSI Approved :: MIT License",

    # Specify the Python versions you support here.
    "Programming Language :: Python :: 3.11",
]

# These are the assumed default dependencies from pip
dependencies = [
    "python-dateutil==2.8.2",
    "holidays==0.51",
    "tzdata==2024.1"
]

[project.urls]
Homepage = "https://everysk.com/"
# Documentation = "https://readthedocs.org"
# Repository = "https://github.com/me/spam.git"
# Issues = "https://github.com/me/spam/issues"
# Changelog = "https://github.com/me/spam/blob/master/CHANGELOG.md"

# Remember to keep these in requirements.txt too
[project.optional-dependencies]
requests = [
    "certifi==2025.01.31",
    "charset-normalizer==3.3.2",
    "idna==3.6",
    "urllib3==2.5.0",
    "requests==2.32.4"
]

firestore = [
    "certifi==2025.01.31",
    "charset-normalizer==3.3.2",
    "idna==3.6",
    "urllib3==2.5.0",
    "requests==2.32.4",
    "pyasn1==0.5.1",
    "pyasn1-modules==0.3.0",
    "cachetools==5.3.2",
    "rsa==4.9",
    "google-auth==2.28.1",
    "googleapis-common-protos==1.62.0",
    "grpcio==1.60.1",
    "grpcio-status==1.60.1",
    "google-api-core[grpc]==2.17.1",
    "google-cloud-core==2.4.1",
    "proto-plus==1.23.0",
    "protobuf==4.25.8",
    "google-cloud-firestore==2.15.0"
]

redis = [
    "hiredis==3.2.1",
    "redis==6.4.0"
]

tasks = [
    "certifi==2025.01.31",
    "charset-normalizer==3.3.2",
    "idna==3.6",
    "urllib3==2.5.0",
    "requests==2.32.4",
    "pyasn1==0.5.1",
    "pyasn1-modules==0.3.0",
    "cachetools==5.3.2",
    "rsa==4.9",
    "google-auth==2.28.1",
    "googleapis-common-protos==1.62.0",
    "grpcio==1.60.1",
    "grpcio-status==1.60.1",
    "google-api-core[grpc]==2.17.1",
    "google-cloud-core==2.4.1",
    "proto-plus==1.23.0",
    "protobuf==4.25.8",
    "grpc-google-iam-v1==0.13.0",
    "google-cloud-tasks==2.16.1"
]

flask = [
    "MarkupSafe==2.1.5",
    "blinker==1.8.2",
    "click==8.1.7",
    "itsdangerous==2.2.0",
    "Jinja2==3.1.6",
    "Werkzeug==3.0.3",
    "flask==3.0.3"
]

starlette = [
    # anyio dependencies
    "idna==3.10",
    "sniffio==1.3.1",
    "typing-extensions==4.14.1",
    "anyio==4.9.0",
    # httpx dependencies
    "certifi==2025.7.14",
    "h11==0.16.0",
    "httpcore==1.0.9",
    "hpack==4.1.0",
    "hyperframe==6.1.0",
    "h2==4.2.0",
    "httpx==0.28.1",
    # jinja2 dependencies
    "MarkupSafe==3.0.2",
    "jinja2==3.1.6",
    # starlette dependencies
    "itsdangerous==2.2.0",
    "python-multipart==0.0.20",
    "pyyaml==6.0.2",
    "uvloop==0.21.0",
    "starlette==0.47.2",
    # uvicorn dependencies
    "click==8.2.1",
    "uvicorn==0.35.0",
]

httpx = [
    # anyio dependencies
    "idna==3.10",
    "sniffio==1.3.1",
    "typing-extensions==4.14.1",
    "anyio==4.9.0",
    # httpx dependencies
    "certifi==2025.7.14",
    "h11==0.16.0",
    "httpcore==1.0.9",
    "hpack==4.1.0",
    "hyperframe==6.1.0",
    "h2==4.2.0",
    "httpx==0.28.1",
]

paramiko = [
    "bcrypt==4.2.0",
    "pycparser==2.22",
    "cffi==1.17.1",
    "cryptography==44.0.1",
    "pynacl==1.5.0",
    "paramiko==3.5.0"
]

everysk-orjson = [
    "everysk-orjson==3.11.3"
]

expression = [
    "lark==1.2.2",
    "numpy==1.26.4",
    "pandas==2.1.4"
]

[build-system]
requires = ["setuptools>=70", "wheel", "cibuildwheel", "versioneer[toml]"]
build-backend = "setuptools.build_meta"

[tool.setuptools]
include-package-data = true
package-dir = { "" = "src" }

[tool.setuptools.packages.find]
where = ["src"]
exclude = [
    "everysk.sdk.engines.helpers",
    "everysk.sdk.engines.expression",
    "everysk.sdk.engines.expression.functions",
    "everysk.*.tests",
    "everysk.*._tests",
    "*.tests",
    "*.tests.*",
]

[tool.setuptools.package-data]
# Include .so and .json files in all subpackages
"everysk.sdk.engines" = ["*.so", "*.pyd", "*.pyi"]
"*" = ["*.json"]

[tool.cibuildwheel]
skip = "cp36-* cp37-* cp38-* cp39-* cp310-* pp* *_i686 *_ppc64le *_s390x"
build-verbosity = 3
environment = { LDFLAGS = "-Wl,--strip-all" }

[[tool.cibuildwheel.overrides]]
select = "*-musllinux*"
before-test = "apk update && apk add musl-locales"

[[tool.cibuildwheel.overrides]]
# Don't strip wheels on macOS.
# macOS doesn't support stripping wheels with linker
# https://github.com/MacPython/numpy-wheels/pull/87#issuecomment-624878264
select = "*-macosx*"
environment = {CFLAGS="-g0"}

[tool.versioneer]
VCS = "git"
style = "pep440"
versionfile_source = "src/everysk/_version.py"
tag_prefix = ""
parentdir_prefix_version = "everysk-lib-"
