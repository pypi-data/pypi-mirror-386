# Knowledge Base Configuration
# Automagik Hive Multi-Agent Framework - Comprehensive RAG Configuration
# Co-located with knowledge components for better modularity

knowledge:
  # ===========================================
  # DATA SOURCE CONFIGURATION
  # ===========================================
  
  # CSV file path (relative to knowledge folder or absolute path)
  csv_file_path: "data/knowledge_rag.csv"
  
  # CSV reader configuration
  csv_reader:
    # Primary content column containing answers/solutions
    content_column: "answer"
    
    # Metadata columns for context and filtering
    # First column is used as primary context (question/problem)
    metadata_columns:
      - "question"      # Primary context column
      - "category"      # Categorization for filtering
      - "tags"          # Additional tags for filtering
    
    # File encoding settings
    encoding: "utf-8"
    
    # Schema flexibility - supports both question/answer and problem/solution schemas
    schema_support:
      primary_schema: "question_answer"    # question/answer
      fallback_schema: "problem_solution"  # problem/solution
      auto_detect: true                    # Auto-detect schema type
  
  # Hot reload configuration
  hot_reload:
    enabled: true                    # Enable real-time CSV file watching
    check_interval: 1.0              # File watch check interval (seconds)
    debounce_delay: 2.0             # Delay after file change before reload (seconds)
    recursive_watch: false          # Watch subdirectories
    
  # ===========================================
  # VECTOR DATABASE CONFIGURATION
  # ===========================================
  
  vector_db:
    # Database table and schema settings
    table_name: "knowledge_base"
    schema: "agno"                   # PostgreSQL schema name
    
    # Embedder model configuration
    embedder: "text-embedding-3-small"  # OpenAI embedding model
    embedding_config:
      model_name: "text-embedding-3-small"
      dimensions: 1536               # Model-specific dimension size
      batch_size: 100               # Batch size for embedding generation
      max_retries: 3                # Retry attempts for failed embeddings
      timeout: 30                   # Timeout per embedding request (seconds)
      
    # Vector similarity configuration
    distance: "cosine"              # Distance metric (cosine, euclidean, dot_product)
    
    # Index configuration for performance
    index_config:
      type: "hnsw"                  # HNSW (Hierarchical Navigable Small World)
      ef_construction: 200          # HNSW construction parameter
      m: 16                         # HNSW connections per node
      ef_search: 100               # HNSW search parameter
      
    # Database operation settings
    batch_size: 50                  # Batch size for database operations
    connection_pool_size: 10        # Database connection pool size
    max_overflow: 20               # Maximum overflow connections
    
  # ===========================================
  # SEARCH CONFIGURATION
  # ===========================================
  
  search_config:
    # Result limits and thresholds
    max_results: 5                  # Maximum documents returned
    similarity_top_k: 10           # Top K for similarity search before reranking
    relevance_threshold: 0.7       # Minimum similarity score (0.0-1.0)
    
    # Search mode configuration
    enable_hybrid_search: true      # Combine semantic and keyword search
    use_semantic_search: true       # Enable semantic vector search
    use_keyword_search: true        # Enable full-text keyword search
    
    # Hybrid search weights
    semantic_weight: 0.7           # Weight for semantic search (0.0-1.0)
    keyword_weight: 0.3            # Weight for keyword search (0.0-1.0)
    
    # Reranking configuration
    enable_reranking: false         # Enable result reranking (requires reranker model)
    reranker_model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
    rerank_top_k: 20              # Documents to consider for reranking
    
    # Query processing
    query_expansion: false          # Expand queries with synonyms
    min_query_length: 3            # Minimum query length in characters
    max_query_length: 1000         # Maximum query length in characters
    
  # ===========================================
  # FILTERING CONFIGURATION
  # ===========================================
  
  filters:
    # Valid metadata fields for filtering
    valid_metadata_fields:
      - "category"
      - "tags"
      - "business_unit"
      - "typification"
      - "schema_type"
      - "has_question"
      - "has_answer"
      - "row_index"
    
    # Default filters applied to all searches
    default_filters: {}
    
    # Business unit mappings (if used)
    business_unit_mappings:
      enable: false                 # Enable business unit filtering
      default_unit: "general"       # Default business unit
      
    # Category-based filtering
    category_config:
      enable_strict_matching: false # Require exact category matches
      case_sensitive: false         # Case-sensitive category matching
      
  # ===========================================
  # INCREMENTAL LOADING CONFIGURATION
  # ===========================================
  
  incremental_loading:
    # Enable smart incremental updates
    enable_incremental: true
    
    # Hash-based change detection
    hash_columns:                   # Columns used for change detection hashing
      - "question"                  # Primary context
      - "answer"                    # Main content
      - "category"                  # Categorization
      - "tags"                      # Tags
    
    # Orphan detection and cleanup
    orphan_detection:
      enabled: true                 # Enable orphaned entry detection
      cleanup_strategy: "remove"    # Strategy: remove, archive, mark
      retention_days: 30           # Days to retain orphaned entries
      
    # Change analysis settings
    change_analysis:
      deep_compare: true           # Compare content beyond hashes
      track_modifications: true    # Track what changed in each row
      log_changes: true           # Log detected changes
      
  # ===========================================
  # PERFORMANCE SETTINGS
  # ===========================================
  
  performance:
    # Caching configuration
    enable_caching: true            # Enable result caching
    cache_ttl: 300                 # Cache time-to-live (seconds)
    cache_max_size: 1000           # Maximum cached entries
    cache_strategy: "lru"          # Cache eviction strategy (lru, fifo, random)
    
    # Processing configuration
    batch_size: 50                 # Default batch size for operations
    chunk_size: 1000              # Document chunking size (characters)
    max_workers: 4                # Maximum parallel workers
    
    # Memory optimization
    memory_optimization:
      enable_streaming: true       # Stream large datasets
      max_memory_usage: "2GB"     # Maximum memory usage limit
      garbage_collection: true    # Enable aggressive garbage collection
      
    # Connection pooling
    connection_pooling:
      min_connections: 2          # Minimum database connections
      max_connections: 20         # Maximum database connections
      connection_timeout: 30      # Connection timeout (seconds)
      
  # ===========================================
  # QUALITY ASSURANCE SETTINGS
  # ===========================================
  
  quality_assurance:
    # Content validation
    content_validation:
      min_content_length: 10       # Minimum content length (characters)
      max_content_length: 10000    # Maximum content length (characters)
      reject_empty_content: true   # Reject documents with empty content
      
    # Duplicate detection
    duplicate_detection:
      enabled: true                # Enable duplicate detection
      similarity_threshold: 0.95   # Similarity threshold for duplicates
      merge_strategy: "newest"     # How to handle duplicates (newest, oldest, merge)
      
    # Quality scoring
    quality_scoring:
      enabled: false               # Enable content quality scoring
      min_quality_score: 0.5      # Minimum quality score (0.0-1.0)
      quality_factors:            # Factors for quality assessment
        - "length"
        - "coherence"
        - "completeness"
        
  # ===========================================
  # LOGGING AND DEBUG SETTINGS
  # ===========================================
  
  logging:
    # Verbosity levels
    verbose_mode: false            # Enable verbose logging
    log_level: "INFO"             # Log level (DEBUG, INFO, WARN, ERROR)
    
    # Component-specific logging
    component_logging:
      vector_operations: "INFO"    # Vector database operations
      csv_processing: "INFO"      # CSV file processing
      search_operations: "INFO"   # Search and retrieval
      incremental_loading: "INFO" # Incremental update operations
      
    # Debug features
    debug_mode:
      enabled: false              # Enable debug mode
      debug_sql: false           # Log SQL queries
      debug_embeddings: false    # Debug embedding generation
      debug_search: false        # Debug search operations
      profile_performance: false # Enable performance profiling
      
    # Query logging
    query_logging:
      enabled: false             # Log all search queries
      log_results: false         # Log search results
      log_filters: true         # Log applied filters
      
  # ===========================================
  # EXPERIMENTAL FEATURES
  # ===========================================
  
  experimental:
    # Advanced search features
    enable_fuzzy_search: false     # Enable fuzzy string matching
    enable_semantic_clustering: false  # Group similar documents
    
    # AI-powered features
    enable_query_understanding: false  # AI query interpretation
    enable_answer_synthesis: false     # Generate synthesized answers
    
    # Advanced filtering
    enable_temporal_filtering: false   # Filter by time-based metadata
    enable_geo_filtering: false       # Geographic filtering (if location data present)
    
    # Performance experiments
    enable_async_operations: false    # Async database operations
    enable_result_streaming: false    # Stream search results
    
  # ===========================================
  # MONITORING AND METRICS
  # ===========================================
  
  monitoring:
    # Usage metrics
    track_usage_metrics: true      # Track search and usage patterns
    metrics_retention_days: 90     # Days to retain metrics data
    
    # Performance monitoring
    track_performance_metrics: true # Track query performance
    slow_query_threshold: 2.0     # Slow query threshold (seconds)
    
    # Health checks
    health_checks:
      enabled: true               # Enable health monitoring
      check_interval: 60         # Health check interval (seconds)
      alert_thresholds:
        max_response_time: 5.0   # Maximum acceptable response time
        min_success_rate: 0.95   # Minimum success rate
        
    # Alerting
    alerting:
      enabled: false             # Enable alerting system
      channels: []               # Alert channels (email, slack, etc.)