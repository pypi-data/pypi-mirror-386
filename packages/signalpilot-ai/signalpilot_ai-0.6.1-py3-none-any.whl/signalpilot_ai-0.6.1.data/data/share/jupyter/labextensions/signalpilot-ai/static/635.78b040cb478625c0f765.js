"use strict";(self.webpackChunksignalpilot_ai=self.webpackChunksignalpilot_ai||[]).push([[635],{67635:(e,t,n)=>{n.r(t),n.d(t,{Change:()=>m,Chunk:()=>X,MergeView:()=>Oe,acceptAllChunks:()=>$e,acceptChunk:()=>Ye,applyGeneratedCode:()=>Ue,diff:()=>_,generateCodeEffect:()=>Pe,getChunks:()=>$,getOriginalDoc:()=>Ie,goToNextChunk:()=>K,goToPreviousChunk:()=>Q,originalDocChangeEffect:()=>He,presentableDiff:()=>W,rejectAllChunks:()=>Je,rejectChunk:()=>Ze,uncollapseUnchanged:()=>we,unifiedMergeView:()=>Ne,updateOriginalDoc:()=>Ge});var r=n(45024),o=n(60195);const i="undefined"==typeof Symbol?"__ͼ":Symbol.for("ͼ"),s="undefined"==typeof Symbol?"__styleSet"+Math.floor(1e8*Math.random()):Symbol("styleSet"),l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:{};class a{constructor(e,t){this.rules=[];let{finish:n}=t||{};function r(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function o(e,t,i,s){let l=[],a=/^@(\w+)\b/.exec(e[0]),c=a&&"keyframes"==a[1];if(a&&null==t)return i.push(e[0]+";");for(let n in t){let s=t[n];if(/&/.test(n))o(n.split(/,\s*/).map(t=>e.map(e=>t.replace(/&/,e))).reduce((e,t)=>e.concat(t)),s,i);else if(s&&"object"==typeof s){if(!a)throw new RangeError("The value of a property ("+n+") should be a primitive value.");o(r(n),s,l,c)}else null!=s&&l.push(n.replace(/_.*/,"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())+": "+s+";")}(l.length||c)&&i.push((!n||a||s?e:e.map(n)).join(", ")+" {"+l.join(" ")+"}")}for(let t in e)o(r(t),e[t],this.rules)}getRules(){return this.rules.join("\n")}static newName(){let e=l[i]||1;return l[i]=e+1,"ͼ"+e.toString(36)}static mount(e,t,n){let r=e[s],o=n&&n.nonce;r?o&&r.setNonce(o):r=new f(e,o),r.mount(Array.isArray(t)?t:[t],e)}}let c=new Map;class f{constructor(e,t){let n=e.ownerDocument||e,r=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&r.CSSStyleSheet){let t=c.get(n);if(t)return e[s]=t;this.sheet=new r.CSSStyleSheet,c.set(n,this)}else this.styleTag=n.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[s]=this}mount(e,t){let n=this.sheet,r=0,o=0;for(let t=0;t<e.length;t++){let i=e[t],s=this.modules.indexOf(i);if(s<o&&s>-1&&(this.modules.splice(s,1),o--,s=-1),-1==s){if(this.modules.splice(o++,0,i),n)for(let e=0;e<i.rules.length;e++)n.insertRule(i.rules[e],r++)}else{for(;o<s;)r+=this.modules[o++].rules.length;r+=i.rules.length,o++}}if(n)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let e="";for(let t=0;t<this.modules.length;t++)e+=this.modules[t].getRules()+"\n";this.styleTag.textContent=e;let n=t.head||t;this.styleTag.parentNode!=n&&n.insertBefore(this.styleTag,n.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var h=n(44353),d=n(72084),u=n(51839);class m{constructor(e,t,n,r){this.fromA=e,this.toA=t,this.fromB=n,this.toB=r}offset(e,t=e){return new m(this.fromA+e,this.toA+e,this.fromB+t,this.toB+t)}}function g(e,t,n,r,o,i){if(e==r)return[];let s=x(e,t,n,r,o,i),l=S(e,t+s,n,r,o+s,i),a=(n-=l)-(t+=s),c=(i-=l)-(o+=s);if(!a||!c)return[new m(t,n,o,i)];if(a>c){let s=e.slice(t,n).indexOf(r.slice(o,i));if(s>-1)return[new m(t,t+s,o,o),new m(t+s+c,n,i,i)]}else if(c>a){let s=r.slice(o,i).indexOf(e.slice(t,n));if(s>-1)return[new m(t,t,o,o+s),new m(n,n,o+s+a,i)]}if(1==a||1==c)return[new m(t,n,o,i)];let f=D(e,t,n,r,o,i);if(f){let[s,l,a]=f;return g(e,t,s,r,o,l).concat(g(e,s+a,n,r,l+a,i))}return function(e,t,n,r,o,i){let s=n-t,l=i-o;if(p<1e9&&Math.min(s,l)>16*p||A>0&&Date.now()>A)return Math.min(s,l)>64*p?[new m(t,n,o,i)]:E(e,t,n,r,o,i);let a=Math.ceil((s+l)/2);b.reset(a),C.reset(a);let c=(n,i)=>e.charCodeAt(t+n)==r.charCodeAt(o+i),f=(t,o)=>e.charCodeAt(n-t-1)==r.charCodeAt(i-o-1),h=(s-l)%2!=0?C:null,d=h?null:b;for(let u=0;u<a;u++){if(u>p||A>0&&!(63&u)&&Date.now()>A)return E(e,t,n,r,o,i);let m=b.advance(u,s,l,a,h,!1,c)||C.advance(u,s,l,a,d,!0,f);if(m)return w(e,t,n,t+m[0],r,o,i,o+m[1])}return[new m(t,n,o,i)]}(e,t,n,r,o,i)}let p=1e9,A=0,v=!1;class B{constructor(){this.vec=[]}reset(e){this.len=e<<1;for(let e=0;e<this.len;e++)this.vec[e]=-1;this.vec[e+1]=0,this.start=this.end=0}advance(e,t,n,r,o,i,s){for(let l=-e+this.start;l<=e-this.end;l+=2){let a=r+l,c=l==-e||l!=e&&this.vec[a-1]<this.vec[a+1]?this.vec[a+1]:this.vec[a-1]+1,f=c-l;for(;c<t&&f<n&&s(c,f);)c++,f++;if(this.vec[a]=c,c>t)this.end+=2;else if(f>n)this.start+=2;else if(o){let e=r+(t-n)-l;if(e>=0&&e<this.len&&-1!=o.vec[e])if(i){let n=o.vec[e];if(n>=t-c)return[n,r+n-e]}else if(c>=t-o.vec[e])return[c,f]}}return null}}const b=new B,C=new B;function w(e,t,n,r,o,i,s,l){let a=!1;return U(e,r)||++r!=n||(a=!0),U(o,l)||++l!=s||(a=!0),a?[new m(t,n,i,s)]:g(e,t,r,o,i,l).concat(g(e,r,n,o,l,s))}function k(e,t){let n=1,r=Math.min(e,t);for(;n<r;)n<<=1;return n}function x(e,t,n,r,o,i){if(t==n||t==i||e.charCodeAt(t)!=r.charCodeAt(o))return 0;let s=k(n-t,i-o);for(let l=t,a=o;;){let o=l+s,c=a+s;if(o>n||c>i||e.slice(l,o)!=r.slice(a,c)){if(1==s)return l-t-(U(e,l)?0:1);s>>=1}else{if(o==n||c==i)return o-t;l=o,a=c}}}function S(e,t,n,r,o,i){if(t==n||o==i||e.charCodeAt(n-1)!=r.charCodeAt(i-1))return 0;let s=k(n-t,i-o);for(let l=n,a=i;;){let i=l-s,c=a-s;if(i<t||c<o||e.slice(i,l)!=r.slice(c,a)){if(1==s)return n-l-(U(e,l)?0:1);s>>=1}else{if(i==t||c==o)return n-i;l=i,a=c}}}function M(e,t,n,r,o,i,s,l){let a=r.slice(o,i),c=null;for(;;){if(c||s<l)return c;for(let l=t+s;;){U(e,l)||l++;let f=l+s;if(U(e,f)||(f+=f==l+1?1:-1),f>=n)break;let h=e.slice(l,f),d=-1;for(;-1!=(d=a.indexOf(h,d+1));){let s=x(e,f,n,r,o+d+h.length,i),a=S(e,t,l,r,o,o+d),u=h.length+s+a;(!c||c[2]<u)&&(c=[l-a,o+d-a,u])}l=f}if(l<0)return c;s>>=1}}function D(e,t,n,r,o,i){let s=n-t,l=i-o;if(s<l){let s=D(r,o,i,e,t,n);return s&&[s[1],s[0],s[2]]}return s<4||2*l<s?null:M(e,t,n,r,o,i,Math.floor(s/4),-1)}function E(e,t,n,r,o,i){v=!0;let s,l=n-t,a=i-o;if(l<a){let a=M(r,o,i,e,t,n,Math.floor(l/6),50);s=a&&[a[1],a[0],a[2]]}else s=M(e,t,n,r,o,i,Math.floor(a/6),50);if(!s)return[new m(t,n,o,i)];let[c,f,h]=s;return g(e,t,c,r,o,f).concat(g(e,c+h,n,r,f+h,i))}function y(e,t){for(let n=1;n<e.length;n++){let r=e[n-1],o=e[n];r.toA>o.fromA-t&&r.toB>o.fromB-t&&(e[n-1]=new m(r.fromA,o.toA,r.fromB,o.toB),e.splice(n--,1))}}let T;try{T=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch(e){}function O(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function L(e,t){if(t==e.length)return 0;let n=e.charCodeAt(t);return n<192?O(n)?1:0:T?P(n)&&t!=e.length-1?T.test(e.slice(t,t+2))?2:0:T.test(String.fromCharCode(n))?1:0:0}function R(e,t){if(!t)return 0;let n=e.charCodeAt(t-1);return n<192?O(n)?1:0:T?H(n)&&1!=t?T.test(e.slice(t-2,t))?2:0:T.test(String.fromCharCode(n))?1:0:0}const V=8;function N(e,t,n){if(t==e.length||!R(e,t))return t;for(let r=t,o=t+n,i=0;i<V;i++){let t=L(e,r);if(!t||r+t>o)return r;r+=t}return t}function G(e,t,n){if(!t||!L(e,t))return t;for(let r=t,o=t-n,i=0;i<V;i++){let t=R(e,r);if(!t||r-t<o)return r;r-=t}return t}function F(e,t,n){for(;t!=n;t--)if(10==e.charCodeAt(t-1))return t;return-1}function j(e,t,n){for(;t!=n;t++)if(10==e.charCodeAt(t))return t;return-1}const P=e=>e>=55296&&e<=56319,H=e=>e>=56320&&e<=57343;function U(e,t){return!t||t==e.length||!P(e.charCodeAt(t-1))||!H(e.charCodeAt(t))}function _(e,t,n){var r;return p=(null!==(r=null==n?void 0:n.scanLimit)&&void 0!==r?r:1e9)>>1,A=(null==n?void 0:n.timeout)?Date.now()+n.timeout:0,v=!1,function(e,t,n){for(;;){y(n,1);let r=!1;for(let o=0;o<n.length;o++){let i,s,l=n[o];(i=x(e,l.fromA,l.toA,t,l.fromB,l.toB))&&(l=n[o]=new m(l.fromA+i,l.toA,l.fromB+i,l.toB)),(s=S(e,l.fromA,l.toA,t,l.fromB,l.toB))&&(l=n[o]=new m(l.fromA,l.toA-s,l.fromB,l.toB-s));let a=l.toA-l.fromA,c=l.toB-l.fromB;if(a&&c)continue;let f=l.fromA-(o?n[o-1].toA:0),h=(o<n.length-1?n[o+1].fromA:e.length)-l.toA;if(!f||!h)continue;let d=a?e.slice(l.fromA,l.toA):t.slice(l.fromB,l.toB);f<=d.length&&e.slice(l.fromA-f,l.fromA)==d.slice(d.length-f)?(n[o]=new m(l.fromA-f,l.toA-f,l.fromB-f,l.toB-f),r=!0):h<=d.length&&e.slice(l.toA,l.toA+h)==d.slice(0,h)&&(n[o]=new m(l.fromA+h,l.toA+h,l.fromB+h,l.toB+h),r=!0)}if(!r)break}return n}(e,t,g(e,0,e.length,t,0,t.length))}function I(){return!v}function W(e,t,n){return function(e,t,n){for(let r=0,o=0;o<e.length;o++){let i=e[o],s=i.toA-i.fromA,l=i.toB-i.fromB;if(s&&l||s>3||l>3){let a=o==e.length-1?t.length:e[o+1].fromA,c=i.fromA-r,f=a-i.toA,h=G(t,i.fromA,c),d=N(t,i.toA,f),u=i.fromA-h,g=d-i.toA;if((!s||!l)&&u&&g){let c=Math.max(s,l),[f,p,A]=s?[t,i.fromA,i.toA]:[n,i.fromB,i.toB];c>u&&t.slice(h,i.fromA)==f.slice(A-u,A)?(i=e[o]=new m(h,h+s,i.fromB-u,i.toB-u),h=i.fromA,d=N(t,i.toA,a-i.toA)):c>g&&t.slice(i.toA,d)==f.slice(p,p+g)&&(i=e[o]=new m(d-s,d,i.fromB+g,i.toB+g),d=i.toA,h=G(t,i.fromA,i.fromA-r)),u=i.fromA-h,g=d-i.toA}if(u||g)i=e[o]=new m(i.fromA-u,i.toA+g,i.fromB-u,i.toB+g);else if(s){if(!l){let n,r=j(t,i.fromA,i.toA),s=r<0?-1:F(t,i.toA,i.fromA);r>-1&&(n=r-i.fromA)<=f&&t.slice(i.fromA,r)==t.slice(i.toA,i.toA+n)?i=e[o]=i.offset(n):s>-1&&(n=i.toA-s)<=c&&t.slice(i.fromA-n,i.fromA)==t.slice(s,i.toA)&&(i=e[o]=i.offset(-n))}}else{let t,r=j(n,i.fromB,i.toB),s=r<0?-1:F(n,i.toB,i.fromB);r>-1&&(t=r-i.fromB)<=f&&n.slice(i.fromB,r)==n.slice(i.toB,i.toB+t)?i=e[o]=i.offset(t):s>-1&&(t=i.toB-s)<=c&&n.slice(i.fromB-t,i.fromB)==n.slice(s,i.toB)&&(i=e[o]=i.offset(-t))}}r=i.toA}return y(e,3),e}(_(e,t,n),e,t)}const q=o.Facet.define({combine:e=>e[0]}),z=o.StateEffect.define(),Y=o.Facet.define(),Z=o.StateField.define({create:e=>null,update(e,t){for(let n of t.effects)n.is(z)&&(e=n.value);for(let n of t.state.facet(Y))e=n(e,t);return e}});function $(e){let t=e.field(Z,!1);if(!t)return null;let n=e.facet(q);return{chunks:t,side:n?n.side:null}}let J=e=>({state:t,dispatch:n})=>{let i=t.field(Z,!1),s=t.facet(q);if(!i||!i.length||!s)return!1;let{head:l}=t.selection.main,a=0;for(let t=i.length-1;t>=0;t--){let n=i[t],[r,o]="b"==s.side?[n.fromB,n.toB]:[n.fromA,n.toA];if(o<l){a=t+1;break}if(r<=l){if(1==i.length)return!1;a=t+(e<0?0:1);break}}let c=i[(a+(e<0?i.length-1:0))%i.length],[f,h]="b"==s.side?[c.fromB,c.toB]:[c.fromA,c.toA];return n(t.update({selection:{anchor:f},userEvent:"select.byChunk",effects:r.EditorView.scrollIntoView(o.EditorSelection.range(h,f))})),!0};const K=J(1),Q=J(-1);class X{constructor(e,t,n,r,o,i=!0){this.changes=e,this.fromA=t,this.toA=n,this.fromB=r,this.toB=o,this.precise=i}offset(e,t){return e||t?new X(this.changes,this.fromA+e,this.toA+e,this.fromB+t,this.toB+t,this.precise):this}get endA(){return Math.max(this.fromA,this.toA-1)}get endB(){return Math.max(this.fromB,this.toB-1)}static build(e,t,n){return ne(W(e.toString(),t.toString(),n),e,t,0,0,I())}static updateA(e,t,n,r,o){return se(ie(e,r,!0,n.length),e,t,n,o)}static updateB(e,t,n,r,o){return se(ie(e,r,!1,t.length),e,t,n,o)}}function ee(e,t,n,r){let o=n.lineAt(e),i=r.lineAt(t);return o.to==e&&i.to==t&&e<n.length&&t<r.length?[e+1,t+1]:[o.from,i.from]}function te(e,t,n,r){let o=n.lineAt(e),i=r.lineAt(t);return o.from==e&&i.from==t?[e,t]:[o.to+1,i.to+1]}function ne(e,t,n,r,o,i){let s=[];for(let l=0;l<e.length;l++){let a=e[l],[c,f]=ee(a.fromA+r,a.fromB+o,t,n),[h,d]=te(a.toA+r,a.toB+o,t,n),u=[a.offset(-c+r,-f+o)];for(;l<e.length-1;){let i=e[l+1],[s,a]=ee(i.fromA+r,i.fromB+o,t,n);if(s>h+1&&a>d+1)break;u.push(i.offset(-c+r,-f+o)),[h,d]=te(i.toA+r,i.toB+o,t,n),l++}s.push(new X(u,c,Math.max(c,h),f,Math.max(f,d),i))}return s}const re=1e3;function oe(e,t,n,r){let o=0,i=e.length;for(;;){if(o==i){let r=0,i=0;o&&({toA:r,toB:i}=e[o-1]);let s=t-(n?r:i);return[r+s,i+s]}let s=o+i>>1,l=e[s],[a,c]=n?[l.fromA,l.toA]:[l.fromB,l.toB];if(a>t)i=s;else{if(!(c<=t))return r?[l.fromA,l.fromB]:[l.toA,l.toB];o=s+1}}}function ie(e,t,n,r){let o=[];return t.iterChangedRanges((i,s,l,a)=>{let c=0,f=n?t.length:r,h=0,d=n?r:t.length;i>re&&([c,h]=oe(e,i-re,n,!0)),s<t.length-re&&([f,d]=oe(e,s+re,n,!1));let u,m=a-l-(s-i),[g,p]=n?[m,0]:[0,m];o.length&&(u=o[o.length-1]).toA>=c?o[o.length-1]={fromA:u.fromA,fromB:u.fromB,toA:f,toB:d,diffA:u.diffA+g,diffB:u.diffB+p}:o.push({fromA:c,toA:f,fromB:h,toB:d,diffA:g,diffB:p})}),o}function se(e,t,n,r,o){if(!e.length)return t;let i=[];for(let s=0,l=0,a=0,c=0;;s++){let f=s==e.length?null:e[s],h=f?f.fromA+l:n.length,d=f?f.fromB+a:r.length;for(;c<t.length;){let e=t[c];if(e.toA+l>h||e.toB+a>d)break;i.push(e.offset(l,a)),c++}if(!f)break;let u=f.toA+l+f.diffA,m=f.toB+a+f.diffB,g=W(n.sliceString(h,u),r.sliceString(d,m),o);for(let e of ne(g,n,r,h,d,I()))i.push(e);for(l+=f.diffA,a+=f.diffB;c<t.length;){let e=t[c];if(e.fromA+l>u&&e.fromB+a>m)break;c++}}return i}const le={scanLimit:500},ae=r.ViewPlugin.fromClass(class{constructor(e){({deco:this.deco,gutter:this.gutter}=pe(e))}update(e){var t,n;(e.docChanged||e.viewportChanged||(t=e.startState,n=e.state,t.field(Z,!1)!=n.field(Z,!1))||function(e,t){return e.facet(q)!=t.facet(q)}(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=pe(e.view))}},{decorations:e=>e.deco}),ce=o.Prec.low((0,r.gutter)({class:"cm-changeGutter",markers:e=>{var t;return(null===(t=e.plugin(ae))||void 0===t?void 0:t.gutter)||o.RangeSet.empty}})),fe=r.Decoration.line({class:"cm-changedLine"}),he=r.Decoration.mark({class:"cm-changedText"}),de=r.Decoration.mark({tagName:"ins",class:"cm-insertedLine"}),ue=r.Decoration.mark({tagName:"del",class:"cm-deletedLine"}),me=new class extends r.GutterMarker{constructor(){super(...arguments),this.elementClass="cm-changedLineGutter"}};function ge(e,t,n,r,o,i){let s=n?e.fromA:e.fromB,l=n?e.toA:e.toB,a=0;if(s!=l){o.add(s,s,fe),o.add(s,l,n?ue:de),i&&i.add(s,s,me);for(let c=t.iterRange(s,l-1),f=s;!c.next().done;){if(c.lineBreak){f++,o.add(f,f,fe),i&&i.add(f,f,me);continue}let t=f+c.value.length;if(r)for(;a<e.changes.length;){let r=e.changes[a],i=s+(n?r.fromA:r.fromB),l=s+(n?r.toA:r.toB),c=Math.max(f,i),h=Math.min(t,l);if(c<h&&o.add(c,h,he),!(l<t))break;a++}f=t}}}function pe(e){let t=e.state.field(Z),{side:n,highlightChanges:r,markGutter:i,overrideChunk:s}=e.state.facet(q),l="a"==n,a=new o.RangeSetBuilder,c=i?new o.RangeSetBuilder:null,{from:f,to:h}=e.viewport;for(let n of t){if((l?n.fromA:n.fromB)>=h)break;(l?n.toA:n.toB)>f&&(s&&s(e.state,n,a,c)||ge(n,e.state.doc,l,r,a,c))}return{deco:a.finish(),gutter:c&&c.finish()}}class Ae extends r.WidgetType{constructor(e){super(),this.height=e}eq(e){return this.height==e.height}toDOM(){let e=document.createElement("div");return e.className="cm-mergeSpacer",e.style.height=this.height+"px",e}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}const ve=o.StateEffect.define({map:(e,t)=>e.map(t)}),Be=o.StateField.define({create:()=>r.Decoration.none,update:(e,t)=>{for(let e of t.effects)if(e.is(ve))return e.value;return e.map(t.changes)},provide:e=>r.EditorView.decorations.from(e)}),be=.01;function Ce(e,t){if(e.size!=t.size)return!1;let n=e.iter(),r=t.iter();for(;n.value;){if(n.from!=r.from||Math.abs(n.value.spec.widget.height-r.value.spec.widget.height)>1)return!1;n.next(),r.next()}return!0}const we=o.StateEffect.define({map:(e,t)=>t.mapPos(e)});class ke extends r.WidgetType{constructor(e){super(),this.lines=e}eq(e){return this.lines==e.lines}toDOM(e){let t=document.createElement("div");return t.className="cm-collapsedLines",t.textContent=e.state.phrase("$ unchanged lines",this.lines),t.addEventListener("click",t=>{let n=e.posAtDOM(t.target);e.dispatch({effects:we.of(n)});let{side:r,sibling:o}=e.state.facet(q);o&&o().dispatch({effects:we.of(xe(n,e.state.field(Z),"a"==r))})}),t}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}get type(){return"collapsed-unchanged-code"}}function xe(e,t,n){let r=0,o=0;for(let i=0;;i++){let s=i<t.length?t[i]:null;if(!s||(n?s.fromA:s.fromB)>=e)return o+(e-r);[r,o]=n?[s.toA,s.toB]:[s.toB,s.toA]}}const Se=o.StateField.define({create:e=>r.Decoration.none,update(e,t){e=e.map(t.changes);for(let n of t.effects)n.is(we)&&(e=e.update({filter:e=>e!=n.value}));return e},provide:e=>r.EditorView.decorations.from(e)});function Me({margin:e=3,minSize:t=4}){return Se.init(n=>function(e,t,n){let i=new o.RangeSetBuilder,s="a"==e.facet(q).side,l=e.field(Z),a=1;for(let o=0;;o++){let c=o<l.length?l[o]:null,f=o?a+t:1,h=c?e.doc.lineAt(s?c.fromA:c.fromB).number-1-t:e.doc.lines,d=h-f+1;if(d>=n&&i.add(e.doc.line(f).from,e.doc.line(h).to,r.Decoration.replace({widget:new ke(d),block:!0})),!c)break;a=e.doc.lineAt(Math.min(e.doc.length,s?c.toA:c.toB)).number}return i.finish()}(n,e,t))}const De=r.EditorView.styleModule.of(new a({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}})),Ee=r.EditorView.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&.cm-merge-a .cm-changedLine, .cm-deletedChunk":{backgroundColor:"rgba(160, 128, 100, .08)"},"&.cm-merge-b .cm-changedLine, .cm-inlineChangedLine":{backgroundColor:"rgba(100, 160, 128, .08)"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb22aa, #22bb22aa) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff88aa, #88ff88aa) bottom/100% 2px no-repeat"},"&.cm-merge-b .cm-deletedText":{background:"#ff000033"},".cm-insertedLine, .cm-deletedLine, .cm-deletedLine del":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer","&:before":{content:'"⦚"',marginInlineEnd:"7px"},"&:after":{content:'"⦚"',marginInlineStart:"7px"}},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"},".cm-inlineChangedLineGutter":{background:"#75d"}}),ye=new o.Compartment,Te=new o.Compartment;class Oe{constructor(e){this.revertDOM=null,this.revertToA=!1,this.revertToLeft=!1,this.measuring=-1,this.diffConf=e.diffConfig||le;let t=[o.Prec.low(ae),Ee,De,Be,r.EditorView.updateListener.of(e=>{this.measuring<0&&(e.heightChanged||e.viewportChanged)&&!e.transactions.some(e=>e.effects.some(e=>e.is(ve)))&&this.measure()})],n=[q.of({side:"a",sibling:()=>this.b,highlightChanges:!1!==e.highlightChanges,markGutter:!1!==e.gutter})];!1!==e.gutter&&n.push(ce);let i=o.EditorState.create({doc:e.a.doc,selection:e.a.selection,extensions:[e.a.extensions||[],r.EditorView.editorAttributes.of({class:"cm-merge-a"}),Te.of(n),t]}),s=[q.of({side:"b",sibling:()=>this.a,highlightChanges:!1!==e.highlightChanges,markGutter:!1!==e.gutter})];!1!==e.gutter&&s.push(ce);let l=o.EditorState.create({doc:e.b.doc,selection:e.b.selection,extensions:[e.b.extensions||[],r.EditorView.editorAttributes.of({class:"cm-merge-b"}),Te.of(s),t]});this.chunks=X.build(i.doc,l.doc,this.diffConf);let a=[Z.init(()=>this.chunks),ye.of(e.collapseUnchanged?Me(e.collapseUnchanged):[])];i=i.update({effects:o.StateEffect.appendConfig.of(a)}).state,l=l.update({effects:o.StateEffect.appendConfig.of(a)}).state,this.dom=document.createElement("div"),this.dom.className="cm-mergeView",this.editorDOM=this.dom.appendChild(document.createElement("div")),this.editorDOM.className="cm-mergeViewEditors";let c=e.orientation||"a-b",f=document.createElement("div");f.className="cm-mergeViewEditor";let h=document.createElement("div");h.className="cm-mergeViewEditor",this.editorDOM.appendChild("a-b"==c?f:h),this.editorDOM.appendChild("a-b"==c?h:f),this.a=new r.EditorView({state:i,parent:f,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.a)}),this.b=new r.EditorView({state:l,parent:h,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.b)}),this.setupRevertControls(!!e.revertControls,"b-to-a"==e.revertControls,e.renderRevertControl),e.parent&&e.parent.appendChild(this.dom),this.scheduleMeasure()}dispatch(e,t){if(e.some(e=>e.docChanged)){let n=e[e.length-1],r=e.reduce((e,t)=>e.compose(t.changes),o.ChangeSet.empty(e[0].startState.doc.length));this.chunks=t==this.a?X.updateA(this.chunks,n.newDoc,this.b.state.doc,r,this.diffConf):X.updateB(this.chunks,this.a.state.doc,n.newDoc,r,this.diffConf),t.update([...e,n.state.update({effects:z.of(this.chunks)})]);let i=t==this.a?this.b:this.a;i.update([i.state.update({effects:z.of(this.chunks)})]),this.scheduleMeasure()}else t.update(e)}reconfigure(e){if("diffConfig"in e&&(this.diffConf=e.diffConfig),"orientation"in e){let t="b-a"!=e.orientation;if(t!=(this.editorDOM.firstChild==this.a.dom.parentNode)){let e=this.a.dom.parentNode,n=this.b.dom.parentNode;e.remove(),n.remove(),this.editorDOM.insertBefore(t?e:n,this.editorDOM.firstChild),this.editorDOM.appendChild(t?n:e),this.revertToLeft=!this.revertToLeft,this.revertDOM&&(this.revertDOM.textContent="")}}if("revertControls"in e||"renderRevertControl"in e){let t=!!this.revertDOM,n=this.revertToA,r=this.renderRevert;"revertControls"in e&&(t=!!e.revertControls,n="b-to-a"==e.revertControls),"renderRevertControl"in e&&(r=e.renderRevertControl),this.setupRevertControls(t,n,r)}let t="highlightChanges"in e,n="gutter"in e,r="collapseUnchanged"in e;if(t||n||r){let o=[],i=[];if(t||n){let r=this.a.state.facet(q),s=n?!1!==e.gutter:r.markGutter,l=t?!1!==e.highlightChanges:r.highlightChanges;o.push(Te.reconfigure([q.of({side:"a",sibling:()=>this.b,highlightChanges:l,markGutter:s}),s?ce:[]])),i.push(Te.reconfigure([q.of({side:"b",sibling:()=>this.a,highlightChanges:l,markGutter:s}),s?ce:[]]))}if(r){let t=ye.reconfigure(e.collapseUnchanged?Me(e.collapseUnchanged):[]);o.push(t),i.push(t)}this.a.dispatch({effects:o}),this.b.dispatch({effects:i})}this.scheduleMeasure()}setupRevertControls(e,t,n){this.revertToA=t,this.revertToLeft=this.revertToA==(this.editorDOM.firstChild==this.a.dom.parentNode),this.renderRevert=n,!e&&this.revertDOM?(this.revertDOM.remove(),this.revertDOM=null):e&&!this.revertDOM?(this.revertDOM=this.editorDOM.insertBefore(document.createElement("div"),this.editorDOM.firstChild.nextSibling),this.revertDOM.addEventListener("mousedown",e=>this.revertClicked(e)),this.revertDOM.className="cm-merge-revert"):this.revertDOM&&(this.revertDOM.textContent="")}scheduleMeasure(){if(this.measuring<0){let e=this.dom.ownerDocument.defaultView||window;this.measuring=e.requestAnimationFrame(()=>{this.measuring=-1,this.measure()})}}measure(){!function(e,t,n){let i=new o.RangeSetBuilder,s=new o.RangeSetBuilder,l=e.state.field(Be).iter(),a=t.state.field(Be).iter(),c=0,f=0,h=0,d=0,u=e.viewport,m=t.viewport;for(let o=0;;o++){let g=o<n.length?n[o]:null,p=g?g.fromA:e.state.doc.length,A=g?g.fromB:t.state.doc.length;if(c<p){let n=e.lineBlockAt(c).top+h-(t.lineBlockAt(f).top+d);n<-.01?(h-=n,i.add(c,c,r.Decoration.widget({widget:new Ae(-n),block:!0,side:-1}))):n>be&&(d+=n,s.add(f,f,r.Decoration.widget({widget:new Ae(n),block:!0,side:-1})))}if(p>c+1e3&&c<u.from&&p>u.from&&f<m.from&&A>m.from){let e=Math.min(u.from-c,m.from-f);c+=e,f+=e,o--}else{if(!g)break;c=g.toA,f=g.toB}for(;l.value&&l.from<c;)h-=l.value.spec.widget.height,l.next();for(;a.value&&a.from<f;)d-=a.value.spec.widget.height,a.next()}for(;l.value;)h-=l.value.spec.widget.height,l.next();for(;a.value;)d-=a.value.spec.widget.height,a.next();let g=e.contentHeight+h-(t.contentHeight+d);g<be?i.add(e.state.doc.length,e.state.doc.length,r.Decoration.widget({widget:new Ae(-g),block:!0,side:1})):g>be&&s.add(t.state.doc.length,t.state.doc.length,r.Decoration.widget({widget:new Ae(g),block:!0,side:1}));let p=i.finish(),A=s.finish();Ce(p,e.state.field(Be))||e.dispatch({effects:ve.of(p)}),Ce(A,t.state.field(Be))||t.dispatch({effects:ve.of(A)})}(this.a,this.b,this.chunks),this.revertDOM&&this.updateRevertButtons()}updateRevertButtons(){let e=this.revertDOM,t=e.firstChild,n=this.a.viewport,r=this.b.viewport;for(let o=0;o<this.chunks.length;o++){let i=this.chunks[o];if(i.fromA>n.to||i.fromB>r.to)break;if(i.fromA<n.from||i.fromB<r.from)continue;let s=this.a.lineBlockAt(i.fromA).top+"px";for(;t&&+t.dataset.chunk<o;)t=Le(t);t&&t.dataset.chunk==String(o)?(t.style.top!=s&&(t.style.top=s),t=t.nextSibling):e.insertBefore(this.renderRevertButton(s,o),t)}for(;t;)t=Le(t)}renderRevertButton(e,t){let n;if(this.renderRevert)n=this.renderRevert();else{n=document.createElement("button");let e=this.a.state.phrase("Revert this chunk");n.setAttribute("aria-label",e),n.setAttribute("title",e),n.textContent=this.revertToLeft?"⇜":"⇝"}return n.style.top=e,n.setAttribute("data-chunk",String(t)),n}revertClicked(e){let t,n=e.target;for(;n&&n.parentNode!=this.revertDOM;)n=n.parentNode;if(n&&(t=this.chunks[n.dataset.chunk])){let[n,r,o,i,s,l]=this.revertToA?[this.b,this.a,t.fromB,t.toB,t.fromA,t.toA]:[this.a,this.b,t.fromA,t.toA,t.fromB,t.toB],a=n.state.sliceDoc(o,Math.max(o,i-1));o!=i&&l<=r.state.doc.length&&(a+=n.state.lineBreak),r.dispatch({changes:{from:s,to:Math.min(r.state.doc.length,l),insert:a},userEvent:"revert"}),e.preventDefault()}}destroy(){this.a.destroy(),this.b.destroy(),this.measuring>-1&&(this.dom.ownerDocument.defaultView||window).cancelAnimationFrame(this.measuring),this.dom.remove()}}function Le(e){let t=e.nextSibling;return e.remove(),t}const Re=new class extends r.GutterMarker{constructor(){super(...arguments),this.elementClass="cm-deletedLineGutter"}},Ve=o.Prec.low((0,r.gutter)({class:"cm-changeGutter",markers:e=>{var t;return(null===(t=e.plugin(ae))||void 0===t?void 0:t.gutter)||o.RangeSet.empty},widgetMarker:(e,t)=>t instanceof qe?Re:null}));function Ne(e){var t;let n="string"==typeof e.original?o.Text.of(e.original.split(/\r?\n/)):e.original,i=e.diffConfig||le;const s=(e.invertedEffects||h.g_).of(e=>{let t=[];for(let n of e.effects)if(n.is(Fe))t.push(Ge.of({doc:n.value.originalDoc,changes:n.value.changes.invert(e.startState.field(_e))}));else if(n.is(Ge)){const r=e.startState.field(_e);t.push(Ge.of({doc:r,changes:n.value.changes.invert(r)}))}else n.is(je)&&t.push(je.of({chunkFromA:n.value.chunkFromA,chunkToA:n.value.chunkToA,chunkFromB:n.value.chunkFromB,chunkToB:n.value.chunkToB,originalContent:n.value.currentContent,currentContent:n.value.originalContent,changes:n.value.changes.invert(e.startState.doc)}));return t});return[o.Prec.low(ae),Qe,Ee,s,r.EditorView.editorAttributes.of({class:"cm-merge-b"}),Y.of((e,t)=>{let n=t.effects.find(e=>e.is(Ge)),r=t.effects.find(e=>e.is(Fe)),o=t.effects.find(e=>e.is(je)),s=t.effects.find(e=>e.is(Pe));return n&&(e=X.updateA(e,n.value.doc,t.startState.doc,n.value.changes,i)),r&&(e=X.updateA(e,r.value.changes.apply(t.startState.field(_e)),t.startState.doc,r.value.changes,i)),s&&(e=X.build(t.state.field(_e),t.newDoc,i)),(o||e.length&&t.docChanged)&&(e=X.updateB(e,t.state.field(_e),t.newDoc,t.changes,i)),e}),q.of({highlightChanges:!1!==e.highlightChanges,markGutter:!1!==e.gutter,syntaxHighlightDeletions:!1!==e.syntaxHighlightDeletions,syntaxHighlightDeletionsMaxLength:3e3,mergeControls:null===(t=e.mergeControls)||void 0===t||t,overrideChunk:e.allowInlineDiffs?ot:void 0,side:"b"}),_e.init(()=>n),!1!==e.gutter?Ve:[],e.collapseUnchanged?Me(e.collapseUnchanged):[],Z.init(e=>X.build(n,e.doc,i))]}const Ge=o.StateEffect.define(),Fe=o.StateEffect.define({map:(e,t)=>{let n=t.mapPos(e.chunkFromB),r=t.mapPos(e.chunkToB);return n<r?Object.assign(Object.assign({},e),{chunkFromB:n,chunkToB:r}):void 0}}),je=o.StateEffect.define({map:(e,t)=>{let n=t.mapPos(e.chunkFromB),r=t.mapPos(e.chunkToB);return n<r?Object.assign(Object.assign({},e),{chunkFromB:n,chunkToB:r}):void 0}}),Pe=o.StateEffect.define();function He(e,t){return Ge.of({doc:t.apply(Ie(e)),changes:t})}function Ue(e,t,n={}){const{replaceAll:r=!0,insertAt:o}=n;let i;if(r)i={from:0,to:e.state.doc.length,insert:t};else if(void 0!==o)i={from:o,to:o,insert:t};else{const n=e.state.selection.main.head;i={from:n,to:n,insert:t}}e.dispatch({changes:i,effects:Pe.of({generatedCode:t,replaceAll:r,insertAt:o}),userEvent:"generate.code"})}const _e=o.StateField.define({create:()=>o.Text.empty,update(e,t){for(let n of t.effects)n.is(Ge)?e=n.value.doc:n.is(Fe)?e=n.value.changes.apply(e):n.is(je);return e}});function Ie(e){return e.field(_e)}const We=new WeakMap;class qe extends r.WidgetType{constructor(e){super(),this.buildDOM=e,this.dom=null}eq(e){return this.dom==e.dom}toDOM(e){return this.dom||(this.dom=this.buildDOM(e))}}function ze(e,t,n){let o=We.get(t.changes);if(o)return o;let i=r.Decoration.widget({block:!0,side:-1,widget:new qe(r=>{let{highlightChanges:o,syntaxHighlightDeletions:i,syntaxHighlightDeletionsMaxLength:s,mergeControls:l}=e.facet(q),a=document.createElement("div");if(a.className="cm-deletedChunk",l){let t=a.appendChild(document.createElement("div"));t.className="cm-chunkButtons";let n=e=>{e.preventDefault(),Ye(r,r.posAtDOM(a))},o=e=>{e.preventDefault(),Ze(r,r.posAtDOM(a))};if("function"==typeof l)t.appendChild(l("accept",n)),t.appendChild(l("reject",o));else{let r=t.appendChild(document.createElement("button"));r.name="accept",r.textContent=e.phrase("Accept"),r.onmousedown=n;let i=t.appendChild(document.createElement("button"));i.name="reject",i.textContent=e.phrase("Reject"),i.onmousedown=o}}if(n||t.fromA>=t.toA)return a;let c=r.state.field(_e).sliceString(t.fromA,t.endA),f=i&&e.facet(d.language),h=A(),m=t.changes,g=0,p=!1;function A(){let e=a.appendChild(document.createElement("div"));return e.className="cm-deletedLine",e.appendChild(document.createElement("del"))}function v(e,t,n){for(let r=e;r<t;){if("\n"==c.charAt(r)){h.firstChild||h.appendChild(document.createElement("br")),h=A(),r++;continue}let e=t,i=n+(p?" cm-deletedText":""),s=!1,l=c.indexOf("\n",r);if(l>-1&&l<t&&(e=l),o&&g<m.length){let t=Math.max(0,p?m[g].toA:m[g].fromA);t<=e&&(e=t,p&&g++,s=!0)}if(e>r){let t=document.createTextNode(c.slice(r,e));if(i){let e=h.appendChild(document.createElement("span"));e.className=i,e.appendChild(t)}else h.appendChild(t);r=e}s&&(p=!p)}}if(f&&t.toA-t.fromA<=s){let t=f.parser.parse(c),n=0;(0,u.highlightTree)(t,{style:t=>(0,d.highlightingFor)(e,t)},(e,t,r)=>{e>n&&v(n,e,""),v(e,t,r),n=t}),v(n,c.length,"")}else v(0,c.length,"");return h.firstChild||h.appendChild(document.createElement("br")),a})});return We.set(t.changes,i),i}function Ye(e,t){let{state:n}=e,r=null!=t?t:n.selection.main.head,i=e.state.field(Z).find(e=>e.fromB<=r&&e.endB>=r);if(!i)return!1;let s=e.state.sliceDoc(i.fromB,Math.max(i.fromB,i.toB-1)),l=e.state.field(_e);i.fromB!=i.toB&&i.toA<=l.length&&(s+=e.state.lineBreak);let a=o.ChangeSet.of({from:i.fromA,to:Math.min(l.length,i.toA),insert:s},l.length);return e.dispatch({effects:Fe.of({chunkFromA:i.fromA,chunkToA:i.toA,chunkFromB:i.fromB,chunkToB:i.toB,originalDoc:l,currentContent:s,changes:a}),userEvent:"accept"}),!0}function Ze(e,t){let{state:n}=e,r=null!=t?t:n.selection.main.head,i=n.field(Z).find(e=>e.fromB<=r&&e.endB>=r);if(!i)return!1;let s=n.field(_e).sliceString(i.fromA,Math.max(i.fromA,i.toA-1));i.fromA!=i.toA&&i.toB<=n.doc.length&&(s+=n.lineBreak);let l=n.sliceDoc(i.fromB,Math.max(i.fromB,i.toB-1)),a=o.ChangeSet.of({from:i.fromB,to:Math.min(n.doc.length,i.toB),insert:s},n.doc.length);return e.dispatch({changes:{from:i.fromB,to:Math.min(n.doc.length,i.toB),insert:s},effects:je.of({chunkFromA:i.fromA,chunkToA:i.toA,chunkFromB:i.fromB,chunkToB:i.toB,originalContent:s,currentContent:l,changes:a}),userEvent:"revert"}),!0}function $e(e){const t=e.state,n=t.field(_e),r=t.doc.toString(),i=o.ChangeSet.of({from:0,to:n.length,insert:r},n.length);return e.dispatch({effects:Ge.of({doc:i.apply(n),changes:i}),userEvent:"accept.all"}),!0}function Je(e){const t=e.state,n=t.field(_e).toString();return e.dispatch({changes:{from:0,to:t.doc.length,insert:n},userEvent:"revert.all"}),!0}function Ke(e){let t=new o.RangeSetBuilder;for(let n of e.field(Z)){let r=e.facet(q).overrideChunk&&et(e,n);t.add(n.fromB,n.fromB,ze(e,n,!!r))}return t.finish()}const Qe=o.StateField.define({create:e=>Ke(e),update:(e,t)=>t.state.field(Z,!1)!=t.startState.field(Z,!1)?Ke(t.state):e,provide:e=>r.EditorView.decorations.from(e)}),Xe=new WeakMap;function et(e,t){let n=Xe.get(t);if(void 0!==n)return n;n=null;let o=e.field(_e),i=e.doc,s=o.lineAt(t.endA).number-o.lineAt(t.fromA).number+1;e:if(s==i.lineAt(t.endB).number-i.lineAt(t.fromB).number+1&&s<10){let e=[],i=0,l=t.fromA,a=t.fromB;for(let n of t.changes){if(n.fromA<n.toA){i+=n.toA-n.fromA;let t=o.sliceString(l+n.fromA,l+n.toA);if(/\n/.test(t))break e;e.push(r.Decoration.widget({widget:new tt(t),side:-1}).range(a+n.fromB))}n.fromB<n.toB&&e.push(he.range(a+n.fromB,a+n.toB))}i<t.endA-t.fromA-2*s&&(n=e)}return Xe.set(t,n),n}class tt extends r.WidgetType{constructor(e){super(),this.text=e}eq(e){return this.text==e.text}toDOM(e){let t=document.createElement("del");return t.className="cm-deletedText",t.textContent=this.text,t}}const nt=new class extends r.GutterMarker{constructor(){super(...arguments),this.elementClass="cm-inlineChangedLineGutter"}},rt=r.Decoration.line({class:"cm-inlineChangedLine"});function ot(e,t,n,r){let o=et(e,t),i=0;if(!o)return!1;for(let s=e.doc.lineAt(t.fromB);;){for(r&&r.add(s.from,s.from,nt),n.add(s.from,s.from,rt);i<o.length&&o[i].to<=s.to;){let e=o[i++];n.add(e.from,e.to,e.value)}if(s.to>=t.endB)break;s=e.doc.lineAt(s.to+1)}return!0}}}]);