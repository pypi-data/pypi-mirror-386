"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[155],{2155:(e,t,n)=>{n.r(t),n.d(t,{VERSION:()=>_,createMistral:()=>w,mistral:()=>I});var o=n(2100),s=n(116),a=n(6097);function i(e){const t=[];for(let n=0;n<e.length;n++){const{role:a,content:i}=e[n],l=n===e.length-1;switch(a){case"system":t.push({role:"system",content:i});break;case"user":t.push({role:"user",content:i.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,s.convertToBase64)(e.data)}`}}if("application/pdf"===e.mediaType)return{type:"document_url",document_url:e.data.toString()};throw new o.b8({functionality:"Only images and PDF file parts are supported"})}})});break;case"assistant":{let e="";const n=[];for(const t of i)switch(t.type){case"text":case"reasoning":e+=t.text;break;case"tool-call":n.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break;default:throw new Error(`Unsupported content type in assistant message: ${t.type}`)}t.push({role:"assistant",content:e,prefix:!!l||void 0,tool_calls:n.length>0?n:void 0});break}case"tool":for(const e of i){const n=e.output;let o;switch(n.type){case"text":case"error-text":o=n.value;break;case"content":case"json":case"error-json":o=JSON.stringify(n.value)}t.push({role:"tool",name:e.toolName,tool_call_id:e.toolCallId,content:o})}break;default:throw new Error(`Unsupported role: ${a}`)}}return t}function l({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function r(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var u=a.Ik({safePrompt:a.zM().optional(),documentImageLimit:a.ai().optional(),documentPageLimit:a.ai().optional(),structuredOutputs:a.zM().optional(),strictJsonSchema:a.zM().optional(),parallelToolCalls:a.zM().optional()}),c=a.Ik({object:a.eu("error"),message:a.Yj(),type:a.Yj(),param:a.Yj().nullable(),code:a.Yj().nullable()}),d=(0,s.createJsonErrorResponseHandler)({errorSchema:c,errorToMessage:e=>e.message}),p=class{constructor(e,t){var n;this.specificationVersion="v2",this.supportedUrls={"application/pdf":[/^https:\/\/.*$/]},this.modelId=e,this.config=t,this.generateId=null!=(n=t.generateId)?n:s.generateId}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:a,topK:l,frequencyPenalty:r,presencePenalty:c,stopSequences:d,responseFormat:p,seed:h,providerOptions:m,tools:g,toolChoice:f}){var y,k,b,v;const _=[],w=null!=(y=await(0,s.parseProviderOptions)({provider:"mistral",providerOptions:m,schema:u}))?y:{};null!=l&&_.push({type:"unsupported-setting",setting:"topK"}),null!=r&&_.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=c&&_.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=d&&_.push({type:"unsupported-setting",setting:"stopSequences"});const I=null==(k=w.structuredOutputs)||k,x=null!=(b=w.strictJsonSchema)&&b;"json"!==(null==p?void 0:p.type)||(null==p?void 0:p.schema)||(e=(0,s.injectJsonInstructionIntoMessages)({messages:e,schema:p.schema}));const j={model:this.modelId,safe_prompt:w.safePrompt,max_tokens:t,temperature:n,top_p:a,random_seed:h,response_format:"json"===(null==p?void 0:p.type)?I&&null!=(null==p?void 0:p.schema)?{type:"json_schema",json_schema:{schema:p.schema,strict:x,name:null!=(v=p.name)?v:"response",description:p.description}}:{type:"json_object"}:void 0,document_image_limit:w.documentImageLimit,document_page_limit:w.documentPageLimit,messages:i(e)},{tools:Y,toolChoice:T,toolWarnings:C}=function({tools:e,toolChoice:t}){const n=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:n};const s=[];for(const t of e)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):s.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(null==t)return{tools:s,toolChoice:void 0,toolWarnings:n};const a=t.type;switch(a){case"auto":case"none":return{tools:s,toolChoice:a,toolWarnings:n};case"required":return{tools:s,toolChoice:"any",toolWarnings:n};case"tool":return{tools:s.filter(e=>e.function.name===t.toolName),toolChoice:"any",toolWarnings:n};default:{const e=a;throw new o.b8({functionality:`tool choice type: ${e}`})}}}({tools:g,toolChoice:f});return{args:{...j,tools:Y,tool_choice:T,...null!=Y&&void 0!==w.parallelToolCalls?{parallel_tool_calls:w.parallelToolCalls}:{}},warnings:[..._,...C]}}async doGenerate(e){const{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:o,value:a,rawValue:i}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:t,failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(y),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=a.choices[0],c=[];if(null!=u.message.content&&Array.isArray(u.message.content))for(const e of u.message.content)if("thinking"===e.type){const t=h(e.thinking);t.length>0&&c.push({type:"reasoning",text:t})}else"text"===e.type&&e.text.length>0&&c.push({type:"text",text:e.text});else{const e=m(u.message.content);null!=e&&e.length>0&&c.push({type:"text",text:e})}if(null!=u.message.tool_calls)for(const e of u.message.tool_calls)c.push({type:"tool-call",toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});return{content:c,finishReason:r(u.finish_reason),usage:{inputTokens:a.usage.prompt_tokens,outputTokens:a.usage.completion_tokens,totalTokens:a.usage.total_tokens},request:{body:t},response:{...l(a),headers:o,body:i},warnings:n}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),o={...t,stream:!0},{responseHeaders:a,value:i}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:d,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(k),abortSignal:e.abortSignal,fetch:this.config.fetch});let u="unknown";const c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let p=!0,g=!1,f=null;const y=this.generateId;return{stream:i.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});const o=t.value;p&&(p=!1,n.enqueue({type:"response-metadata",...l(o)})),null!=o.usage&&(c.inputTokens=o.usage.prompt_tokens,c.outputTokens=o.usage.completion_tokens,c.totalTokens=o.usage.total_tokens);const s=o.choices[0],a=s.delta,i=m(a.content);if(null!=a.content&&Array.isArray(a.content))for(const e of a.content)if("thinking"===e.type){const t=h(e.thinking);t.length>0&&(null==f&&(g&&(n.enqueue({type:"text-end",id:"0"}),g=!1),f=y(),n.enqueue({type:"reasoning-start",id:f})),n.enqueue({type:"reasoning-delta",id:f,delta:t}))}if(null!=i&&i.length>0&&(g||(null!=f&&(n.enqueue({type:"reasoning-end",id:f}),f=null),n.enqueue({type:"text-start",id:"0"}),g=!0),n.enqueue({type:"text-delta",id:"0",delta:i})),null!=(null==a?void 0:a.tool_calls))for(const e of a.tool_calls){const t=e.id,o=e.function.name,s=e.function.arguments;n.enqueue({type:"tool-input-start",id:t,toolName:o}),n.enqueue({type:"tool-input-delta",id:t,delta:s}),n.enqueue({type:"tool-input-end",id:t}),n.enqueue({type:"tool-call",toolCallId:t,toolName:o,input:s})}null!=s.finish_reason&&(u=r(s.finish_reason))},flush(e){null!=f&&e.enqueue({type:"reasoning-end",id:f}),g&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:u,usage:c})}})),request:{body:o},response:{headers:a}}}};function h(e){return e.filter(e=>"text"===e.type).map(e=>e.text).join("")}function m(e){if("string"==typeof e)return e;if(null==e)return;const t=[];for(const n of e){const{type:e}=n;switch(e){case"text":t.push(n.text);break;case"thinking":case"image_url":case"reference":break;default:throw new Error(`Unsupported type: ${e}`)}}return t.length?t.join(""):void 0}var g=a.KC([a.Yj(),a.YO(a.gM("type",[a.Ik({type:a.eu("text"),text:a.Yj()}),a.Ik({type:a.eu("image_url"),image_url:a.KC([a.Yj(),a.Ik({url:a.Yj(),detail:a.Yj().nullable()})])}),a.Ik({type:a.eu("reference"),reference_ids:a.YO(a.ai())}),a.Ik({type:a.eu("thinking"),thinking:a.YO(a.Ik({type:a.eu("text"),text:a.Yj()}))})]))]).nullish(),f=a.Ik({prompt_tokens:a.ai(),completion_tokens:a.ai(),total_tokens:a.ai()}),y=a.Ik({id:a.Yj().nullish(),created:a.ai().nullish(),model:a.Yj().nullish(),choices:a.YO(a.Ik({message:a.Ik({role:a.eu("assistant"),content:g,tool_calls:a.YO(a.Ik({id:a.Yj(),function:a.Ik({name:a.Yj(),arguments:a.Yj()})})).nullish()}),index:a.ai(),finish_reason:a.Yj().nullish()})),object:a.eu("chat.completion"),usage:f}),k=a.Ik({id:a.Yj().nullish(),created:a.ai().nullish(),model:a.Yj().nullish(),choices:a.YO(a.Ik({delta:a.Ik({role:a.k5(["assistant"]).optional(),content:g,tool_calls:a.YO(a.Ik({id:a.Yj(),function:a.Ik({name:a.Yj(),arguments:a.Yj()})})).nullish()}),finish_reason:a.Yj().nullish(),index:a.ai()})),usage:f.nullish()}),b=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=32,this.supportsParallelCalls=!1,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new o.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:a,value:i,rawValue:l}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/embeddings`,headers:(0,s.combineHeaders)(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(v),abortSignal:t,fetch:this.config.fetch});return{embeddings:i.data.map(e=>e.embedding),usage:i.usage?{tokens:i.usage.prompt_tokens}:void 0,response:{headers:a,body:l}}}},v=a.Ik({data:a.YO(a.Ik({embedding:a.YO(a.ai())})),usage:a.Ik({prompt_tokens:a.ai()}).nullish()}),_="2.0.17";function w(e={}){var t;const n=null!=(t=(0,s.withoutTrailingSlash)(e.baseURL))?t:"https://api.mistral.ai/v1",a=()=>(0,s.withUserAgentSuffix)({Authorization:`Bearer ${(0,s.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers},`ai-sdk/mistral/${_}`),i=t=>new p(t,{provider:"mistral.chat",baseURL:n,headers:a,fetch:e.fetch,generateId:e.generateId}),l=t=>new b(t,{provider:"mistral.embedding",baseURL:n,headers:a,fetch:e.fetch}),r=function(e){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return i(e)};return r.languageModel=i,r.chat=i,r.embedding=l,r.textEmbedding=l,r.textEmbeddingModel=l,r.imageModel=e=>{throw new o.eM({modelId:e,modelType:"imageModel"})},r}var I=w()}}]);