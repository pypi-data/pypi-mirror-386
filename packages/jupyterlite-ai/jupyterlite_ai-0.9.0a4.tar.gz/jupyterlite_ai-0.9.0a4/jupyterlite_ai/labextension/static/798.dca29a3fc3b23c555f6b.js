"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[798],{9798:(e,t,n)=>{n.r(t),n.d(t,{VERSION:()=>ve,createGoogleGenerativeAI:()=>Ue,google:()=>Fe});var a=n(2100),o=n(1408),r=n(6019),s=n(6190),i=n(2665),l=n(5606);function u(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function c(e){return Object.fromEntries([...e.headers])}var d=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{const r=()=>{const e=n.length,a=new Array(t);for(let o=0;o<t;o++)a[o]=n[Math.random()*e|0];return a.join("")};if(null==e)return r;if(n.includes(o))throw new a.Di({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`})();function p(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var h=["fetch failed","failed to fetch"];function g(e=globalThis){var t,n,a;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(a=null==(n=e.process)?void 0:n.versions)?void 0:a.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function f(e,...t){const n=(a=null!=e?e:{},Object.fromEntries(Object.entries(a).filter(([e,t])=>null!=t)));var a;const o=new Headers(n),r=o.get("user-agent")||"";return o.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(o)}function m({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:o}){if("string"==typeof e)return e;if(null!=e)throw new a.Kq({message:`${o} API key must be a string.`});if(void 0===l)throw new a.Kq({message:`${o} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=l.env[t]))throw new a.Kq({message:`${o} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new a.Kq({message:`${o} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var y=/"__proto__"\s*:/,v=/"constructor"\s*:/;function b(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return function(e){const t=JSON.parse(e);return null===t||"object"!=typeof t||!1===y.test(e)&&!1===v.test(e)?t:function(e){let t=[e];for(;t.length;){const e=t;t=[];for(const n of e){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const e in n){const a=n[e];a&&"object"==typeof a&&t.push(a)}}}return e}(t)}(e)}finally{Error.stackTraceLimit=t}}var k=Symbol.for("vercel.ai.validator");async function I({value:e,schema:t}){const n=function(e){return function(e){return"object"==typeof e&&null!==e&&k in e&&!0===e[k]&&"validate"in e}(e)?e:"function"==typeof e?e():(t=e,n=async e=>{const n=await t["~standard"].validate(e);return null==n.issues?{success:!0,value:n.value}:{success:!1,error:new a.iM({value:e,cause:n.issues})}},{[k]:!0,validate:n});var t,n}(t);try{if(null==n.validate)return{success:!0,value:e,rawValue:e};const t=await n.validate(e);return t.success?{success:!0,value:t.value,rawValue:e}:{success:!1,error:a.iM.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:a.iM.wrap({value:e,cause:t}),rawValue:e}}}async function w({text:e,schema:t}){try{const n=b(e);return null==t?{success:!0,value:n,rawValue:n}:await I({value:n,schema:t})}catch(t){return{success:!1,error:a.u6.isInstance(t)?t:new a.u6({text:e,cause:t}),rawValue:void 0}}}function O({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new o.Z).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await w({text:e,schema:t}))}}))}async function S({provider:e,providerOptions:t,schema:n}){if(null==(null==t?void 0:t[e]))return;const o=await I({value:t[e],schema:n});if(!o.success)throw new a.Di({argument:"providerOptions",message:`invalid ${e} provider options`,cause:o.error});return o.value}var x=()=>globalThis.fetch,C=async({url:e,headers:t,body:n,failedResponseHandler:a,successfulResponseHandler:o,abortSignal:r,fetch:s})=>T({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:a,successfulResponseHandler:o,abortSignal:r,fetch:s}),T=async({url:e,headers:t={},body:n,successfulResponseHandler:o,failedResponseHandler:r,abortSignal:s,fetch:i=x()})=>{try{const l=await i(e,{method:"POST",headers:f(t,"ai-sdk/provider-utils/3.0.11",g()),body:n.content,signal:s}),u=c(l);if(!l.ok){let t;try{t=await r({response:l,url:e,requestBodyValues:n.values})}catch(t){if(p(t)||a.hL.isInstance(t))throw t;throw new a.hL({message:"Failed to process error response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw t.value}try{return await o({response:l,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(p(t)||a.hL.isInstance(t)))throw t;throw new a.hL({message:"Failed to process successful response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(p(e))return e;if(e instanceof TypeError&&h.includes(e.message.toLowerCase())){const o=e.cause;if(null!=o)return new a.hL({message:`Cannot connect to API: ${o.message}`,cause:o,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}};function _({id:e,name:t,inputSchema:n}){return({execute:a,outputSchema:o,toModelOutput:r,onInputStart:s,onInputDelta:i,onInputAvailable:l,...u})=>({type:"provider-defined",id:e,name:t,args:u,inputSchema:n,outputSchema:o,execute:a,toModelOutput:r,onInputStart:s,onInputDelta:i,onInputAvailable:l})}async function E(e){return"function"==typeof e&&(e=e()),Promise.resolve(e)}var A=e=>async({response:t})=>{const n=c(t);if(null==t.body)throw new a.Tt({});return{responseHeaders:n,value:O({stream:t.body,schema:e})}},R=e=>async({response:t,url:n,requestBodyValues:o})=>{const r=await t.text(),s=await w({text:r,schema:e}),i=c(t);if(!s.success)throw new a.hL({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:r,url:n,requestBodyValues:o});return{responseHeaders:i,value:s.value,rawValue:s.rawValue}},P=(e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")},M=Symbol("Let zodToJsonSchema decide on which parser to use"),Y={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function N(e,t){return se(e.type._def,t)}function j(e,t,n){const a=null!=n?n:t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((n,a)=>j(e,t,n))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return L(e)}}var L=e=>{const t={type:"integer",format:"unix-time"};for(const n of e.checks)switch(n.kind){case"min":t.minimum=n.value;break;case"max":t.maximum=n.value}return t},$=void 0,Z=/^[cC][^\s-]{8,}$/,D=/^[0-9a-z]+$/,H=/^[0-9A-HJKMNP-TV-Z]{26}$/,U=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,F=()=>(void 0===$&&($=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),$),q=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,V=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,B=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,z=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,G=/^[a-zA-Z0-9_-]{21}$/,K=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function W(e,t){const n={type:"string"};if(e.checks)for(const a of e.checks)switch(a.kind){case"min":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,a.value):a.value;break;case"max":n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,a.value):a.value;break;case"email":switch(t.emailStrategy){case"format:email":X(n,"email",a.message,t);break;case"format:idn-email":X(n,"idn-email",a.message,t);break;case"pattern:zod":ee(n,U,a.message,t)}break;case"url":X(n,"uri",a.message,t);break;case"uuid":X(n,"uuid",a.message,t);break;case"regex":ee(n,a.regex,a.message,t);break;case"cuid":ee(n,Z,a.message,t);break;case"cuid2":ee(n,D,a.message,t);break;case"startsWith":ee(n,RegExp(`^${J(a.value,t)}`),a.message,t);break;case"endsWith":ee(n,RegExp(`${J(a.value,t)}$`),a.message,t);break;case"datetime":X(n,"date-time",a.message,t);break;case"date":X(n,"date",a.message,t);break;case"time":X(n,"time",a.message,t);break;case"duration":X(n,"duration",a.message,t);break;case"length":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,a.value):a.value,n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,a.value):a.value;break;case"includes":ee(n,RegExp(J(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&X(n,"ipv4",a.message,t),"v4"!==a.version&&X(n,"ipv6",a.message,t);break;case"base64url":ee(n,z,a.message,t);break;case"jwt":ee(n,K,a.message,t);break;case"cidr":"v6"!==a.version&&ee(n,q,a.message,t),"v4"!==a.version&&ee(n,V,a.message,t);break;case"emoji":ee(n,F(),a.message,t);break;case"ulid":ee(n,H,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":X(n,"binary",a.message,t);break;case"contentEncoding:base64":n.contentEncoding="base64";break;case"pattern:zod":ee(n,B,a.message,t)}break;case"nanoid":ee(n,G,a.message,t)}return n}function J(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)Q.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}var Q=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function X(e,t,n,a){var o;e.format||(null==(o=e.anyOf)?void 0:o.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&a.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function ee(e,t,n,a){var o;e.pattern||(null==(o=e.allOf)?void 0:o.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:te(t,a),...n&&a.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=te(t,a)}function te(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;const a=e.flags.includes("i"),o=e.flags.includes("m"),r=e.flags.includes("s"),s=a?e.source.toLowerCase():e.source;let i="",l=!1,u=!1,c=!1;for(let e=0;e<s.length;e++)if(l)i+=s[e],l=!1;else{if(a)if(u){if(s[e].match(/[a-z]/)){c?(i+=s[e],i+=`${s[e-2]}-${s[e]}`.toUpperCase(),c=!1):"-"===s[e+1]&&(null==(n=s[e+2])?void 0:n.match(/[a-z]/))?(i+=s[e],c=!0):i+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){i+=`[${s[e]}${s[e].toUpperCase()}]`;continue}if(o){if("^"===s[e]){i+="(^|(?<=[\r\n]))";continue}if("$"===s[e]){i+="($|(?=[\r\n]))";continue}}r&&"."===s[e]?i+=u?`${s[e]}\r\n`:`[${s[e]}\r\n]`:(i+=s[e],"\\"===s[e]?l=!0:u&&"]"===s[e]?u=!1:u||"["!==s[e]||(u=!0))}try{new RegExp(i)}catch(n){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function ne(e,t){var n,a,o,r,s,l;const u={type:"object",additionalProperties:null!=(n=se(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?n:t.allowedAdditionalProperties};if((null==(a=e.keyType)?void 0:a._def.typeName)===i.kY.ZodString&&(null==(o=e.keyType._def.checks)?void 0:o.length)){const{type:n,...a}=W(e.keyType._def,t);return{...u,propertyNames:a}}if((null==(r=e.keyType)?void 0:r._def.typeName)===i.kY.ZodEnum)return{...u,propertyNames:{enum:e.keyType._def.values}};if((null==(s=e.keyType)?void 0:s._def.typeName)===i.kY.ZodBranded&&e.keyType._def.type._def.typeName===i.kY.ZodString&&(null==(l=e.keyType._def.type._def.checks)?void 0:l.length)){const{type:n,...a}=N(e.keyType._def,t);return{...u,propertyNames:a}}return u}var ae={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function oe(e){try{return e.isOptional()}catch(e){return!0}}var re=(e,t,n)=>{switch(t){case i.kY.ZodString:return W(e,n);case i.kY.ZodNumber:return function(e){const t={type:"number"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"int":t.type="integer";break;case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value}return t}(e);case i.kY.ZodObject:return function(e,t){const n={type:"object",properties:{}},a=[],o=e.shape();for(const e in o){let r=o[e];if(void 0===r||void 0===r._def)continue;const s=oe(r),i=se(r._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==i&&(n.properties[e]=i,s||a.push(e))}a.length&&(n.required=a);const r=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return se(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==r&&(n.additionalProperties=r),n}(e,n);case i.kY.ZodBigInt:return function(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const n of e.checks)switch(n.kind){case"min":n.inclusive?t.minimum=n.value:t.exclusiveMinimum=n.value;break;case"max":n.inclusive?t.maximum=n.value:t.exclusiveMaximum=n.value;break;case"multipleOf":t.multipleOf=n.value}return t}(e);case i.kY.ZodBoolean:return{type:"boolean"};case i.kY.ZodDate:return j(e,n);case i.kY.ZodUndefined:return{not:{}};case i.kY.ZodNull:return{type:"null"};case i.kY.ZodArray:return function(e,t){var n,a,o;const r={type:"array"};return(null==(n=e.type)?void 0:n._def)&&(null==(o=null==(a=e.type)?void 0:a._def)?void 0:o.typeName)!==i.kY.ZodAny&&(r.items=se(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(r.minItems=e.minLength.value),e.maxLength&&(r.maxItems=e.maxLength.value),e.exactLength&&(r.minItems=e.exactLength.value,r.maxItems=e.exactLength.value),r}(e,n);case i.kY.ZodUnion:case i.kY.ZodDiscriminatedUnion:return function(e,t){const n=e.options instanceof Map?Array.from(e.options.values()):e.options;if(n.every(e=>e._def.typeName in ae&&(!e._def.checks||!e._def.checks.length))){const e=n.reduce((e,t)=>{const n=ae[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(n.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){const e=n.reduce((e,t)=>{const n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===n.length){const t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:n.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(n.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:n.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return((e,t)=>{const n=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,n)=>se(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${n}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return n.length?{anyOf:n}:void 0})(e,t)}(e,n);case i.kY.ZodIntersection:return function(e,t){const n=[se(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),se(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a=[];return n.forEach(e=>{if("type"in(t=e)&&"string"===t.type||!("allOf"in t)){let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){const{additionalProperties:n,...a}=e;t=a}a.push(t)}else a.push(...e.allOf);var t}),a.length?{allOf:a}:void 0}(e,n);case i.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,n)=>se(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:se(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,n)=>se(e._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,n);case i.kY.ZodRecord:return ne(e,n);case i.kY.ZodLiteral:return function(e){const t=typeof e.value;return"bigint"!==t&&"number"!==t&&"boolean"!==t&&"string"!==t?{type:Array.isArray(e.value)?"array":"object"}:{type:"bigint"===t?"integer":t,const:e.value}}(e);case i.kY.ZodEnum:return function(e){return{type:"string",enum:Array.from(e.values)}}(e);case i.kY.ZodNativeEnum:return function(e){const t=e.values,n=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(n.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:n}}(e);case i.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[ae[e.innerType._def.typeName],"null"]};const n=se(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}(e,n);case i.kY.ZodOptional:return((e,t)=>{var n;if(t.currentPath.toString()===(null==(n=t.propertyPath)?void 0:n.toString()))return se(e.innerType._def,t);const a=se(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return a?{anyOf:[{not:{}},a]}:{}})(e,n);case i.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?ne(e,t):{type:"array",maxItems:125,items:{type:"array",items:[se(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},se(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,n);case i.kY.ZodSet:return function(e,t){const n={type:"array",uniqueItems:!0,items:se(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}(e,n);case i.kY.ZodLazy:return()=>e.getter()._def;case i.kY.ZodPromise:return function(e,t){return se(e.type._def,t)}(e,n);case i.kY.ZodNaN:case i.kY.ZodNever:return{not:{}};case i.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?se(e.schema._def,t):{}}(e,n);case i.kY.ZodAny:case i.kY.ZodUnknown:return{};case i.kY.ZodDefault:return function(e,t){return{...se(e.innerType._def,t),default:e.defaultValue()}}(e,n);case i.kY.ZodBranded:return N(e,n);case i.kY.ZodReadonly:case i.kY.ZodCatch:return((e,t)=>se(e.innerType._def,t))(e,n);case i.kY.ZodPipeline:return((e,t)=>{if("input"===t.pipeStrategy)return se(e.in._def,t);if("output"===t.pipeStrategy)return se(e.out._def,t);const n=se(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]});return{allOf:[n,se(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",n?"1":"0"]})].filter(e=>void 0!==e)}})(e,n);case i.kY.ZodFunction:case i.kY.ZodVoid:case i.kY.ZodSymbol:default:return}};function se(e,t,n=!1){var a;const o=t.seen.get(e);if(t.override){const r=null==(a=t.override)?void 0:a.call(t,e,t,o,n);if(r!==M)return r}if(o&&!n){const e=ie(o,t);if(void 0!==e)return e}const r={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,r);const s=re(e,e.typeName,t),i="function"==typeof s?se(s(),t):s;if(i&&le(e,t,i),t.postProcess){const n=t.postProcess(i,e,t);return r.jsonSchema=i,n}return r.jsonSchema=i,i}var ie=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:P(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{}):"seen"===t.$refStrategy?{}:void 0}},le=(e,t,n)=>(e.description&&(n.description=e.description),n),ue=(e,t)=>{var n;const a=(e=>{const t=(e=>"string"==typeof e?{...Y,name:e}:{...Y,...e})(e),n=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,n])=>[n._def,{def:n._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}})(t);let o="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var o;return{...e,[t]:null!=(o=se(n._def,{...a,currentPath:[...a.basePath,a.definitionPath,t]},!0))?o:{}}},{}):void 0;const r="string"==typeof t?t:"title"===(null==t?void 0:t.nameStrategy)||null==t?void 0:t.name,s=null!=(n=se(e._def,void 0===r?a:{...a,currentPath:[...a.basePath,a.definitionPath,r]},!1))?n:{},i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(s.title=i);const l=void 0===r?o?{...s,[a.definitionPath]:o}:s:{$ref:[..."relative"===a.$refStrategy?[]:a.basePath,a.definitionPath,r].join("/"),[a.definitionPath]:{...o,[r]:s}};return l.$schema="http://json-schema.org/draft-07/schema#",l};function ce(e,t){return function(e){return"_zod"in e}(e)?function(e,t){var n;const a=null!=(n=null==t?void 0:t.useReferences)&&n;return he(()=>r.b(e,{target:"draft-7",io:"output",reused:a?"ref":"inline"}),{validate:async t=>{const n=await s.bp(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}(e,t):function(e,t){var n;const a=null!=(n=null==t?void 0:t.useReferences)&&n;return he(()=>ue(e,{$refStrategy:a?"root":"none"}),{validate:async t=>{const n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}(e,t)}var de=Symbol.for("vercel.ai.schema");function pe(e){let t;return()=>(null==t&&(t=e()),t)}function he(e,{validate:t}={}){return{[de]:!0,_type:void 0,[k]:!0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}var{btoa:ge,atob:fe}=globalThis;function me(e){return e instanceof Uint8Array?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return ge(t)}(e):e}var ye=n(6097),ve="2.0.19",be=(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:o,url:r,requestBodyValues:s})=>{const i=await o.text(),l=c(o);if(""===i.trim())return{responseHeaders:l,value:new a.hL({message:o.statusText,url:r,requestBodyValues:s,statusCode:o.status,responseHeaders:l,responseBody:i,isRetryable:null==n?void 0:n(o)})};try{const u=await async function({text:e,schema:t}){try{const n=b(e);return null==t?n:async function({value:e,schema:t}){const n=await I({value:e,schema:t});if(!n.success)throw a.iM.wrap({value:e,cause:n.error});return n.value}({value:n,schema:t})}catch(t){if(a.u6.isInstance(t)||a.iM.isInstance(t))throw t;throw new a.u6({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:l,value:new a.hL({message:t(u),url:r,requestBodyValues:s,statusCode:o.status,responseHeaders:l,responseBody:i,data:u,isRetryable:null==n?void 0:n(o,u)})}}catch(e){return{responseHeaders:l,value:new a.hL({message:o.statusText,url:r,requestBodyValues:s,statusCode:o.status,responseHeaders:l,responseBody:i,isRetryable:null==n?void 0:n(o)})}}})({errorSchema:pe(()=>ce(ye.Ik({error:ye.Ik({code:ye.ai().nullable(),message:ye.Yj(),status:ye.Yj()})}))),errorToMessage:e=>e.error.message}),ke=pe(()=>ce(ye.Ik({outputDimensionality:ye.ai().optional(),taskType:ye.k5(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}))),Ie=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:o}){const r=await S({provider:"google",providerOptions:o,schema:ke});if(e.length>this.maxEmbeddingsPerCall)throw new a.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const s=u(await E(this.config.headers),t);if(1===e.length){const{responseHeaders:t,value:a,rawValue:o}=await C({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:s,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:null==r?void 0:r.outputDimensionality,taskType:null==r?void 0:r.taskType},failedResponseHandler:be,successfulResponseHandler:R(Oe),abortSignal:n,fetch:this.config.fetch});return{embeddings:[a.embedding.values],usage:void 0,response:{headers:t,body:o}}}const{responseHeaders:i,value:l,rawValue:c}=await C({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:s,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:e}]},outputDimensionality:null==r?void 0:r.outputDimensionality,taskType:null==r?void 0:r.taskType}))},failedResponseHandler:be,successfulResponseHandler:R(we),abortSignal:n,fetch:this.config.fetch});return{embeddings:l.embeddings.map(e=>e.values),usage:void 0,response:{headers:i,body:c}}}},we=pe(()=>ce(ye.Ik({embeddings:ye.YO(ye.Ik({values:ye.YO(ye.ai())}))}))),Oe=pe(()=>ce(ye.Ik({embedding:ye.Ik({values:ye.YO(ye.ai())})})));function Se(e){if(null==e||function(e){return null!=e&&"object"==typeof e&&"object"===e.type&&(null==e.properties||0===Object.keys(e.properties).length)&&!e.additionalProperties}(e))return;if("boolean"==typeof e)return{type:"boolean",properties:{}};const{type:t,description:n,required:a,properties:o,items:r,allOf:s,anyOf:i,oneOf:l,format:u,const:c,minLength:d,enum:p}=e,h={};if(n&&(h.description=n),a&&(h.required=a),u&&(h.format=u),void 0!==c&&(h.enum=[c]),t&&(Array.isArray(t)?t.includes("null")?(h.type=t.filter(e=>"null"!==e)[0],h.nullable=!0):h.type=t:h.type="null"===t?"null":t),void 0!==p&&(h.enum=p),null!=o&&(h.properties=Object.entries(o).reduce((e,[t,n])=>(e[t]=Se(n),e),{})),r&&(h.items=Array.isArray(r)?r.map(Se):Se(r)),s&&(h.allOf=s.map(Se)),i)if(i.some(e=>"object"==typeof e&&"null"===(null==e?void 0:e.type))){const e=i.filter(e=>!("object"==typeof e&&"null"===(null==e?void 0:e.type)));if(1===e.length){const t=Se(e[0]);"object"==typeof t&&(h.nullable=!0,Object.assign(h,t))}else h.anyOf=e.map(Se),h.nullable=!0}else h.anyOf=i.map(Se);return l&&(h.oneOf=l.map(Se)),void 0!==d&&(h.minLength=d),h}function xe(e){return e.includes("/")?e:`models/${e}`}var Ce=pe(()=>ce(ye.Ik({responseModalities:ye.YO(ye.k5(["TEXT","IMAGE"])).optional(),thinkingConfig:ye.Ik({thinkingBudget:ye.ai().optional(),includeThoughts:ye.zM().optional()}).optional(),cachedContent:ye.Yj().optional(),structuredOutputs:ye.zM().optional(),safetySettings:ye.YO(ye.Ik({category:ye.k5(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:ye.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:ye.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:ye.zM().optional(),labels:ye.g1(ye.Yj(),ye.Yj()).optional(),mediaResolution:ye.k5(["MEDIA_RESOLUTION_UNSPECIFIED","MEDIA_RESOLUTION_LOW","MEDIA_RESOLUTION_MEDIUM","MEDIA_RESOLUTION_HIGH"]).optional()})));function Te({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var _e=class{constructor(e,t){var n;this.specificationVersion="v2",this.modelId=e,this.config=t,this.generateId=null!=(n=t.generateId)?n:d}get provider(){return this.config.provider}get supportedUrls(){var e,t,n;return null!=(n=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:o,topK:r,frequencyPenalty:s,presencePenalty:i,stopSequences:l,responseFormat:u,seed:c,tools:d,toolChoice:p,providerOptions:h}){var g,f;const m=[],y=await S({provider:"google",providerOptions:h,schema:Ce});!0!==(null==(g=null==y?void 0:y.thinkingConfig)?void 0:g.includeThoughts)||this.config.provider.startsWith("google.vertex.")||m.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const v=this.modelId.toLowerCase().startsWith("gemma-"),{contents:b,systemInstruction:k}=function(e,t){var n;const o=[],r=[];let s=!0;const i=null!=(n=null==t?void 0:t.isGemmaModel)&&n;for(const{role:t,content:n}of e)switch(t){case"system":if(!s)throw new a.b8({functionality:"system messages are only supported at the beginning of the conversation"});o.push({text:n});break;case"user":{s=!1;const e=[];for(const t of n)switch(t.type){case"text":e.push({text:t.text});break;case"file":{const n="image/*"===t.mediaType?"image/jpeg":t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:n,fileUri:t.data.toString()}}:{inlineData:{mimeType:n,data:me(t.data)}});break}}r.push({role:"user",parts:e});break}case"assistant":s=!1,r.push({role:"model",parts:n.map(e=>{var t,n,o,r,s,i;switch(e.type){case"text":return 0===e.text.length?void 0:{text:e.text,thoughtSignature:null==(n=null==(t=e.providerOptions)?void 0:t.google)?void 0:n.thoughtSignature};case"reasoning":return 0===e.text.length?void 0:{text:e.text,thought:!0,thoughtSignature:null==(r=null==(o=e.providerOptions)?void 0:o.google)?void 0:r.thoughtSignature};case"file":if("image/png"!==e.mediaType)throw new a.b8({functionality:"Only PNG images are supported in assistant messages"});if(e.data instanceof URL)throw new a.b8({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:e.mediaType,data:me(e.data)}};case"tool-call":return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:null==(i=null==(s=e.providerOptions)?void 0:s.google)?void 0:i.thoughtSignature}}}).filter(e=>void 0!==e)});break;case"tool":{s=!1;const e=[];for(const t of n){const n=t.output;if("content"===n.type)for(const a of n.value)switch(a.type){case"text":e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:a.text}}});break;case"media":e.push({inlineData:{mimeType:a.mediaType,data:a.data}},{text:"Tool executed successfully and returned this image as a response"});break;default:e.push({text:JSON.stringify(a)})}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.value}}})}r.push({role:"user",parts:e});break}}if(i&&o.length>0&&r.length>0&&"user"===r[0].role){const e=o.map(e=>e.text).join("\n\n");r[0].parts.unshift({text:e+"\n\n"})}return{systemInstruction:o.length>0&&!i?{parts:o}:void 0,contents:r}}(e,{isGemmaModel:v}),{tools:I,toolConfig:w,toolWarnings:O}=function({tools:e,toolChoice:t,modelId:n}){var o;e=(null==e?void 0:e.length)?e:void 0;const r=[],s=n.includes("gemini-2"),i=n.includes("gemini-1.5-flash")&&!n.includes("-8b");if(null==e)return{tools:void 0,toolConfig:void 0,toolWarnings:r};const l=e.some(e=>"function"===e.type),u=e.some(e=>"provider-defined"===e.type);if(l&&u&&r.push({type:"unsupported-tool",tool:e.find(e=>"function"===e.type),details:"Cannot mix function tools with provider-defined tools in the same request. Please use either function tools or provider-defined tools, but not both."}),u){const t={};return e.filter(e=>"provider-defined"===e.type).forEach(e=>{switch(e.id){case"google.google_search":s?t.googleSearch={}:t.googleSearchRetrieval=i?{dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}:{};break;case"google.url_context":s?t.urlContext={}:r.push({type:"unsupported-tool",tool:e,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":s?t.codeExecution={}:r.push({type:"unsupported-tool",tool:e,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;default:r.push({type:"unsupported-tool",tool:e})}}),{tools:Object.keys(t).length>0?t:void 0,toolConfig:void 0,toolWarnings:r}}const c=[];for(const t of e)"function"===t.type?c.push({name:t.name,description:null!=(o=t.description)?o:"",parameters:Se(t.inputSchema)}):r.push({type:"unsupported-tool",tool:t});if(null==t)return{tools:{functionDeclarations:c},toolConfig:void 0,toolWarnings:r};const d=t.type;switch(d){case"auto":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:r};case"none":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:r};case"required":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:r};case"tool":return{tools:{functionDeclarations:c},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[t.toolName]}},toolWarnings:r};default:{const e=d;throw new a.b8({functionality:`tool choice type: ${e}`})}}}({tools:d,toolChoice:p,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:n,topK:r,topP:o,frequencyPenalty:s,presencePenalty:i,stopSequences:l,seed:c,responseMimeType:"json"===(null==u?void 0:u.type)?"application/json":void 0,responseSchema:"json"!==(null==u?void 0:u.type)||null==u.schema||null!=(f=null==y?void 0:y.structuredOutputs)&&!f?void 0:Se(u.schema),...(null==y?void 0:y.audioTimestamp)&&{audioTimestamp:y.audioTimestamp},responseModalities:null==y?void 0:y.responseModalities,thinkingConfig:null==y?void 0:y.thinkingConfig},contents:b,systemInstruction:v?void 0:k,safetySettings:null==y?void 0:y.safetySettings,tools:I,toolConfig:w,cachedContent:null==y?void 0:y.cachedContent,labels:null==y?void 0:y.labels},warnings:[...m,...O]}}async doGenerate(e){var t,n,a,o,r,s,i,l,c,d,p,h,g;const{args:f,warnings:m}=await this.getArgs(e),y=JSON.stringify(f),v=u(await E(this.config.headers),e.headers),{responseHeaders:b,value:k,rawValue:I}=await C({url:`${this.config.baseURL}/${xe(this.modelId)}:generateContent`,headers:v,body:f,failedResponseHandler:be,successfulResponseHandler:R(Ne),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=k.candidates[0],O=[],S=null!=(n=null==(t=w.content)?void 0:t.parts)?n:[],x=k.usageMetadata;let T;for(const e of S)if("executableCode"in e&&(null==(a=e.executableCode)?void 0:a.code)){const t=this.config.generateId();T=t,O.push({type:"tool-call",toolCallId:t,toolName:"code_execution",input:JSON.stringify(e.executableCode),providerExecuted:!0})}else"codeExecutionResult"in e&&e.codeExecutionResult?(O.push({type:"tool-result",toolCallId:T,toolName:"code_execution",result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output},providerExecuted:!0}),T=void 0):"text"in e&&null!=e.text&&e.text.length>0?O.push({type:!0===e.thought?"reasoning":"text",text:e.text,providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):"functionCall"in e?O.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}):"inlineData"in e&&O.push({type:"file",data:e.inlineData.data,mediaType:e.inlineData.mimeType});const _=null!=(o=Ee({groundingMetadata:w.groundingMetadata,generateId:this.config.generateId}))?o:[];for(const e of _)O.push(e);return{content:O,finishReason:Te({finishReason:w.finishReason,hasToolCalls:O.some(e=>"tool-call"===e.type)}),usage:{inputTokens:null!=(r=null==x?void 0:x.promptTokenCount)?r:void 0,outputTokens:null!=(s=null==x?void 0:x.candidatesTokenCount)?s:void 0,totalTokens:null!=(i=null==x?void 0:x.totalTokenCount)?i:void 0,reasoningTokens:null!=(l=null==x?void 0:x.thoughtsTokenCount)?l:void 0,cachedInputTokens:null!=(c=null==x?void 0:x.cachedContentTokenCount)?c:void 0},warnings:m,providerMetadata:{google:{promptFeedback:null!=(d=k.promptFeedback)?d:null,groundingMetadata:null!=(p=w.groundingMetadata)?p:null,urlContextMetadata:null!=(h=w.urlContextMetadata)?h:null,safetyRatings:null!=(g=w.safetyRatings)?g:null,usageMetadata:null!=x?x:null}},request:{body:y},response:{headers:b,body:I}}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),a=JSON.stringify(t),o=u(await E(this.config.headers),e.headers),{responseHeaders:r,value:s}=await C({url:`${this.config.baseURL}/${xe(this.modelId)}:streamGenerateContent?alt=sse`,headers:o,body:t,failedResponseHandler:be,successfulResponseHandler:A(je),abortSignal:e.abortSignal,fetch:this.config.fetch});let i="unknown";const l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let c;const d=this.config.generateId;let p=!1,h=null,g=null,f=0;const m=new Set;let y;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var a,o,r,s,u,v,b,k,I,w,O,S;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});const x=t.value,C=x.usageMetadata;null!=C&&(l.inputTokens=null!=(a=C.promptTokenCount)?a:void 0,l.outputTokens=null!=(o=C.candidatesTokenCount)?o:void 0,l.totalTokens=null!=(r=C.totalTokenCount)?r:void 0,l.reasoningTokens=null!=(s=C.thoughtsTokenCount)?s:void 0,l.cachedInputTokens=null!=(u=C.cachedContentTokenCount)?u:void 0);const T=null==(v=x.candidates)?void 0:v[0];if(null==T)return;const _=T.content,E=Ee({groundingMetadata:T.groundingMetadata,generateId:d});if(null!=E)for(const e of E)"url"!==e.sourceType||m.has(e.url)||(m.add(e.url),n.enqueue(e));if(null!=_){const e=null!=(b=_.parts)?b:[];for(const t of e)if("executableCode"in t&&(null==(k=t.executableCode)?void 0:k.code)){const e=d();y=e,n.enqueue({type:"tool-call",toolCallId:e,toolName:"code_execution",input:JSON.stringify(t.executableCode),providerExecuted:!0}),p=!0}else if("codeExecutionResult"in t&&t.codeExecutionResult){const e=y;e&&(n.enqueue({type:"tool-result",toolCallId:e,toolName:"code_execution",result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output},providerExecuted:!0}),y=void 0)}else"text"in t&&null!=t.text&&t.text.length>0&&(!0===t.thought?(null!==h&&(n.enqueue({type:"text-end",id:h}),h=null),null===g&&(g=String(f++),n.enqueue({type:"reasoning-start",id:g,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:"reasoning-delta",id:g,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})):(null!==g&&(n.enqueue({type:"reasoning-end",id:g}),g=null),null===h&&(h=String(f++),n.enqueue({type:"text-start",id:h,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})),n.enqueue({type:"text-delta",id:h,delta:t.text,providerMetadata:t.thoughtSignature?{google:{thoughtSignature:t.thoughtSignature}}:void 0})));const t=function(e){return null==e?void 0:e.filter(e=>"inlineData"in e)}(_.parts);if(null!=t)for(const e of t)n.enqueue({type:"file",mediaType:e.inlineData.mimeType,data:e.inlineData.data});const a=function({parts:e,generateId:t}){const n=null==e?void 0:e.filter(e=>"functionCall"in e);return null==n||0===n.length?void 0:n.map(e=>({type:"tool-call",toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{google:{thoughtSignature:e.thoughtSignature}}:void 0}))}({parts:_.parts,generateId:d});if(null!=a)for(const e of a)n.enqueue({type:"tool-input-start",id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),n.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),n.enqueue({type:"tool-input-end",id:e.toolCallId,providerMetadata:e.providerMetadata}),n.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),p=!0}null!=T.finishReason&&(i=Te({finishReason:T.finishReason,hasToolCalls:p}),c={google:{promptFeedback:null!=(I=x.promptFeedback)?I:null,groundingMetadata:null!=(w=T.groundingMetadata)?w:null,urlContextMetadata:null!=(O=T.urlContextMetadata)?O:null,safetyRatings:null!=(S=T.safetyRatings)?S:null}},null!=C&&(c.google.usageMetadata=C))},flush(e){null!==h&&e.enqueue({type:"text-end",id:h}),null!==g&&e.enqueue({type:"reasoning-end",id:g}),e.enqueue({type:"finish",finishReason:i,usage:l,providerMetadata:c})}})),response:{headers:r},request:{body:a}}}};function Ee({groundingMetadata:e,generateId:t}){var n;return null==(n=null==e?void 0:e.groundingChunks)?void 0:n.filter(e=>null!=e.web).map(e=>({type:"source",sourceType:"url",id:t(),url:e.web.uri,title:e.web.title}))}var Ae=()=>ye.Ik({webSearchQueries:ye.YO(ye.Yj()).nullish(),retrievalQueries:ye.YO(ye.Yj()).nullish(),searchEntryPoint:ye.Ik({renderedContent:ye.Yj()}).nullish(),groundingChunks:ye.YO(ye.Ik({web:ye.Ik({uri:ye.Yj(),title:ye.Yj()}).nullish(),retrievedContext:ye.Ik({uri:ye.Yj(),title:ye.Yj()}).nullish()})).nullish(),groundingSupports:ye.YO(ye.Ik({segment:ye.Ik({startIndex:ye.ai().nullish(),endIndex:ye.ai().nullish(),text:ye.Yj().nullish()}),segment_text:ye.Yj().nullish(),groundingChunkIndices:ye.YO(ye.ai()).nullish(),supportChunkIndices:ye.YO(ye.ai()).nullish(),confidenceScores:ye.YO(ye.ai()).nullish(),confidenceScore:ye.YO(ye.ai()).nullish()})).nullish(),retrievalMetadata:ye.KC([ye.Ik({webDynamicRetrievalScore:ye.ai()}),ye.Ik({})]).nullish()}),Re=()=>ye.Ik({parts:ye.YO(ye.KC([ye.Ik({functionCall:ye.Ik({name:ye.Yj(),args:ye.L5()}),thoughtSignature:ye.Yj().nullish()}),ye.Ik({inlineData:ye.Ik({mimeType:ye.Yj(),data:ye.Yj()})}),ye.Ik({executableCode:ye.Ik({language:ye.Yj(),code:ye.Yj()}).nullish(),codeExecutionResult:ye.Ik({outcome:ye.Yj(),output:ye.Yj()}).nullish(),text:ye.Yj().nullish(),thought:ye.zM().nullish(),thoughtSignature:ye.Yj().nullish()})])).nullish()}),Pe=()=>ye.Ik({category:ye.Yj().nullish(),probability:ye.Yj().nullish(),probabilityScore:ye.ai().nullish(),severity:ye.Yj().nullish(),severityScore:ye.ai().nullish(),blocked:ye.zM().nullish()}),Me=ye.Ik({cachedContentTokenCount:ye.ai().nullish(),thoughtsTokenCount:ye.ai().nullish(),promptTokenCount:ye.ai().nullish(),candidatesTokenCount:ye.ai().nullish(),totalTokenCount:ye.ai().nullish()}),Ye=()=>ye.Ik({urlMetadata:ye.YO(ye.Ik({retrievedUrl:ye.Yj(),urlRetrievalStatus:ye.Yj()}))}),Ne=pe(()=>ce(ye.Ik({candidates:ye.YO(ye.Ik({content:Re().nullish().or(ye.Ik({}).strict()),finishReason:ye.Yj().nullish(),safetyRatings:ye.YO(Pe()).nullish(),groundingMetadata:Ae().nullish(),urlContextMetadata:Ye().nullish()})),usageMetadata:Me.nullish(),promptFeedback:ye.Ik({blockReason:ye.Yj().nullish(),safetyRatings:ye.YO(Pe()).nullish()}).nullish()}))),je=pe(()=>ce(ye.Ik({candidates:ye.YO(ye.Ik({content:Re().nullish(),finishReason:ye.Yj().nullish(),safetyRatings:ye.YO(Pe()).nullish(),groundingMetadata:Ae().nullish(),urlContextMetadata:Ye().nullish()})).nullish(),usageMetadata:Me.nullish(),promptFeedback:ye.Ik({blockReason:ye.Yj().nullish(),safetyRatings:ye.YO(Pe()).nullish()}).nullish()}))),Le=function({id:e,name:t,inputSchema:n,outputSchema:a}){return({execute:o,toModelOutput:r,onInputStart:s,onInputDelta:i,onInputAvailable:l,...u})=>({type:"provider-defined",id:e,name:t,args:u,inputSchema:n,outputSchema:a,execute:o,toModelOutput:r,onInputStart:s,onInputDelta:i,onInputAvailable:l})}({id:"google.code_execution",name:"code_execution",inputSchema:ye.Ik({language:ye.Yj().describe("The programming language of the code."),code:ye.Yj().describe("The code to be executed.")}),outputSchema:ye.Ik({outcome:ye.Yj().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:ye.Yj().describe("The output from the code execution.")})}),$e={googleSearch:_({id:"google.google_search",name:"google_search",inputSchema:pe(()=>ce(ye.Ik({mode:ye.k5(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:ye.ai().default(1)})))}),urlContext:_({id:"google.url_context",name:"url_context",inputSchema:pe(()=>ce(ye.Ik({})))}),codeExecution:Le},Ze=class{constructor(e,t,n){this.modelId=e,this.settings=t,this.config=n,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=this.settings.maxImagesPerCall)?e:4}get provider(){return this.config.provider}async doGenerate(e){var t,n,a;const{prompt:o,n:r=1,size:s="1024x1024",aspectRatio:i="1:1",seed:l,providerOptions:c,headers:d,abortSignal:p}=e,h=[];null!=s&&h.push({type:"unsupported-setting",setting:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),null!=l&&h.push({type:"unsupported-setting",setting:"seed",details:"This model does not support the `seed` option through this provider."});const g=await S({provider:"google",providerOptions:c,schema:He}),f=null!=(a=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?a:new Date,m={sampleCount:r};null!=i&&(m.aspectRatio=i),g&&Object.assign(m,g);const y={instances:[{prompt:o}],parameters:m},{responseHeaders:v,value:b}=await C({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:u(await E(this.config.headers),d),body:y,failedResponseHandler:be,successfulResponseHandler:R(De),abortSignal:p,fetch:this.config.fetch});return{images:b.predictions.map(e=>e.bytesBase64Encoded),warnings:null!=h?h:[],providerMetadata:{google:{images:b.predictions.map(e=>({}))}},response:{timestamp:f,modelId:this.modelId,headers:v}}}},De=pe(()=>ce(ye.Ik({predictions:ye.YO(ye.Ik({bytesBase64Encoded:ye.Yj()})).default([])}))),He=pe(()=>ce(ye.Ik({personGeneration:ye.k5(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:ye.k5(["1:1","3:4","4:3","9:16","16:9"]).nullish()})));function Ue(e={}){var t;const n=null!=(t=null==(a=e.baseURL)?void 0:a.replace(/\/$/,""))?t:"https://generativelanguage.googleapis.com/v1beta";var a;const o=()=>f({"x-goog-api-key":m({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers},`ai-sdk/google/${ve}`),r=t=>{var a;return new _e(t,{provider:"google.generative-ai",baseURL:n,headers:o,generateId:null!=(a=e.generateId)?a:d,supportedUrls:()=>({"*":[new RegExp(`^${n}/files/.*$`),new RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),new RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:e.fetch})},s=t=>new Ie(t,{provider:"google.generative-ai",baseURL:n,headers:o,fetch:e.fetch}),i=(t,a={})=>new Ze(t,a,{provider:"google.generative-ai",baseURL:n,headers:o,fetch:e.fetch}),l=function(e){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return r(e)};return l.languageModel=r,l.chat=r,l.generativeAI=r,l.embedding=s,l.textEmbedding=s,l.textEmbeddingModel=s,l.image=i,l.imageModel=i,l.tools=$e,l}var Fe=Ue()}}]);