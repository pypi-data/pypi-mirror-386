from typing import List

from uspto_data.data_model import Facets, SearchRoot
from uspto_data.response import response_interface
from uspto_data.response.patent_file_wrapper.application import ResponseParser as ApplicationResponseParser


class ResponseParser(response_interface.ResponseParser):
    @staticmethod
    def parse_facets(data) -> List[Facets]:
        return [Facets(applicationStatusCode=item.get("applicationStatusCode", [])) for item in data]

    @staticmethod
    def parse_response(json_data) -> SearchRoot:
        return SearchRoot(
            patentFileWrapperDataBag=[
                ApplicationResponseParser.parse_patent_file_wrapper_data_bag(patent_fw_data_bag)
                for patent_fw_data_bag in json_data.get("patentFileWrapperDataBag", [])
            ],
            facets=ResponseParser.parse_facets(json_data.get("facets", [])),
            count=json_data.get("count")
        )



endpoint = "/api/v1/patent/applications/search"

#  EXAMPLE JSON RESPONSE

example_json = {'count': 1, 'patentFileWrapperDataBag': [{'applicationNumberText': '14104993', 'nationalStageIndicator': True, 'smallEntityStatusIndicator': True, 'publicationDateBag': [{'publicationDate': '2014-06-19T00:00:00.000Z', 'publicationCategory': ['Granted/Issued', 'Pre-Grant Publications - PGPub']}], 'docketNumber': '12GR10425US01/859063.688', 'firstInventorToFileIndicator': 'Y', 'firstApplicantName': 'STMicroelectronics S.A.', 'firstInventorName': 'Pascal Chevalier', 'applicationConfirmationNumber': '1061', 'applicationStatusDate': '2016-05-18T00:00:00.000Z', 'applicationStatusDescriptionText': 'Patented Case', 'filingDate': '2012-12-19T00:00:00.000Z', 'effectiveFilingDate': '2013-12-12T00:00:00.000Z', 'grantDate': '2016-06-07T00:00:00.000Z', 'groupArtUnitNumber': 2895, 'applicationTypeCode': 'UTL', 'applicationTypeLabelName': 'Utility', 'applicationTypeCategory': 'electronics', 'inventionTitle': 'HETEROJUNCTION BIPOLAR TRANSISTOR', 'patentNumber': '9362380', 'applicationStatusCode': 150, 'businessEntityStatusCategory': 'Undiscounted', 'earliestPublicationNumber': 'US 2014-0167116 A1', 'earliestPublicationDate': '2014-06-19T00:00:00.000Z', 'publicationSequenceNumberBag': ['61006'], 'wipoReferenceNumber': 'WO 2009/064413', 'pctPublicationDate': '2016-12-16T00:00:00.000Z', 'internationalRegistrationPublicationDate': '2016-12-16T00:00:00.000Z', 'internationalRegistrationNumber': 'DM/091304', 'examinerNameText': 'HUI TSAI JEY', 'class': '257', 'subclass': '197000', 'class/subclass': '257/197000', 'correspondenceAddressBag': [{'nameLineOneText': 'Seed IP Law Group LLP/ST (EP ORIGINATING)', 'nameLineTwoText': 'Attn- IP Docket', 'addressLineOneText': '701 FIFTH AVENUE, SUITE 5400', 'addressLineTwoText': 'Suite 501', 'geographicRegionName': 'WASHINGTON', 'geographicRegionCode': 'WA', 'postalCode': '98104-7092', 'cityName': 'SEATTLE', 'countryCode': 'US', 'countryName': 'USA', 'postalAddressCategory': 'commercial'}], 'customerNumber': 38106, 'cpcClassificationBag': ['H01L29/66325', 'H01L27/0623', 'H01L29/7378', 'H01L21/8249', 'H01L29/737', 'H01L29/66242'], 'applicantBag': [{'firstName': 'John', 'middleName': 'P', 'lastName': 'Smith', 'preferredName': 'John Smith', 'namePrefix': 'Mr.', 'nameSuffix': 'Jr.', 'countryCode': 'US', 'correspondenceAddressBag': [{'nameLineOneText': 'STMicroelectronics S.A.', 'nameLineTwoText': 'Name Line Two', 'addressLineOneText': 'Address Line 1', 'addressLineTwoText': 'Address Line 2', 'geographicRegionName': 'MN', 'geographicRegionCode': 'Region Code', 'postalCode': '10012', 'cityName': 'Montrouge', 'countryCode': 'FR', 'countryName': 'FRANCE', 'postalAddressCategory': 'commercial'}], 'applicant': 'John Smith'}], 'inventorBag': [{'firstName': 'John', 'middleName': 'K', 'lastName': 'Smith', 'namePrefix': 'Mr.', 'nameSuffix': 'Sr.', 'preferredName': 'John Smith', 'countryCode': 'US', 'inventorNameText': 'Pascal Chevalier', 'correspondenceAddressBag': [{'nameLineOneText': 'Pascal  Chevalier', 'nameLineTwoText': 'Name Two', 'addressLineOneText': '197 Chemin de la Meuniere', 'addressLineTwoText': 'Line Two', 'geographicRegionName': 'Region Name', 'geographicRegionCode': 'FR', 'postalCode': '20125', 'cityName': 'Chapareillan', 'countryCode': 'FR', 'countryName': 'FRANCE', 'postalAddressCategory': 'commercial'}]}], 'assignmentBag': [{'reelNumber': '60620', 'frameNumber': '769', 'reelNumber/frameNumber': '60620/769', 'pageNumber': 16, 'assignmentReceivedDate': '2022-07-11T00:00:00.000Z', 'assignmentRecordedDate': '2022-07-11T00:00:00.000Z', 'assignmentMailedDate': '2022-07-28T00:00:00.000Z', 'conveyanceText': 'ASSIGNMENT OF ASSIGNORS INTEREST (SEE DOCUMENT FOR DETAILS).', 'assignorBag': [{'assignorName': 'STMICROELECTRONICS SA', 'executionDate': '2022-06-30T00:00:00.000Z'}], 'assigneeBag': [{'assigneeNameText': 'STMICROELECTRONICS SA', 'assigneeAddress': {'addressLineOneText': 'CHEMIN DU CHAMP-DES-FILLES 39', 'addressLineTwoText': '1228 PLAN-LES-OUATES', 'cityName': 'GENEVA', 'geographicRegionName': 'CHX', 'geographicRegionCode': 'string', 'countryName': 'Switzerland', 'postalCode': '20123'}}], 'correspondenceAddressBag': {'correspondentNameText': 'STMICROELECTRONICS, INC.', 'addressLineOneText': '750 CANYON DRIVE', 'addressLineTwoText': 'SUITE 300', 'addressLineThreeText': 'COPPELL, TX 75019', 'addressLineFourText': 'Address Line Four'}}], 'recordAttorney': {'customerNumber': [{'patronIdentifier': 'string', 'organizationStandardName': 'string', 'powerOfAttorneyAddressBag': [{'nameLineOneText': 'Seed IP Law Group LLP/ST (EP ORIGINATING)', 'addressLineOneText': '701 FIFTH AVENUE, SUITE 5400', 'addressLineTwoText': 'Sample Line Two', 'geographicRegionName': 'ST', 'geographicRegionCode': 'string', 'postalCode': '98104-7092', 'cityName': 'SEATTLE', 'countryCode': 'US', 'countryName': 'UNITED STATES'}], 'telecommunicationAddressBag': [{'telecommunicationNumber': 'string', 'extensionNumber': 'string', 'usageTypeCategory': 'string'}]}], 'attorneyBag': [{'firstName': 'DANIEL', 'lastName': "O'BRIEN", 'registrationNumber': '65545', 'activeIndicator': 'ACTIVE', 'telecommunicationAddressBag': [{'telecommunicationNumber': '206-622-4900', 'extensionNumber': '243', 'usageTypeCategory': 'TEL'}]}]}, 'foreignPriorityBag': [{'countryName': 'FRANCE', 'filingDate': '2012-12-19T00:00:00.000Z', 'priorityNumberText': '1262321'}], 'continuityBag': [{'prentContinuityBag': [{'aiaIndicator': True, 'applicationStatusCode': 159, 'patentNumber': '8968299', 'applicationStatusDescriptionText': 'Patent Expired Due to NonPayment of Maintenance Fees Under 37 CFR 1.362', 'filingDate': '2012-05-23T00:00:00.000Z', 'parentApplicationNumberText': '123123133', 'childApplicationNumberText': 'string', 'claimParentageTypeCode': 'CODE', 'claimParentageTypeCodeDescription': 'some description'}], 'childContinuityBag': [{'applicationStatusCode': 150, 'parentApplicationNumberText': '14104993', 'childApplicationNumberText': '14853719', 'applicationStatusDescriptionText': 'Patented Case', 'filingDate': '2015-09-14T00:00:00.000Z', 'aiaIndicator': False, 'patentNumber': '9704967', 'claimParentageTypeCode': 'DIV', 'claimParentageTypeCodeDescription': 'some desc'}]}], 'patentTermAdjustmentData': {'aDelayQuantity': 0, 'adjustmentTotalQuantity': 0, 'applicantDayDelayQuantity': 28, 'bDelayQuantity': 0, 'cDelayQuantity': 0, 'filingDate': '2013-12-12T00:00:00.000Z', 'grantDate': '2016-06-07T00:00:00.000Z', 'nonOverlappingDayQuantity': 0, 'overlappingDayQuantity': 0, 'ipOfficeDayDelayQuantity': 0, 'patentTermAdjustmentHistoryDataBag': [{'actionDate': '2016-06-07T00:00:00.000Z', 'applicantDays': 4, 'caseActionDescriptionText': 'Patent Issue Date Used in PTA Calculation', 'caseActionSequenceNumber': 65, 'ipOfficeDayDelayQuantity': 0, 'startSequenceNumber': 0}]}, 'eventDataBag': [{'eventCode': 'ELC_RVW', 'eventDescriptionText': 'Electronic Review', 'eventDate': '2018-10-18T00:00:00.000Z'}], 'pgpubDocumentMetaData': {'zipFileName': 'ipa240801.zip', 'productIdentifier': 'APPXML', 'fileLocationURI': 'https://bulkdata.uspto.gov/data/patent/application/redbook/fulltext/2024/ipa240104.zip', 'fileCreateDateTime': '2024-08-09:11:30:00', 'xmlFileName': 'ipa240801.xml'}, 'grantDocumentMetaData': {'zipFileName': 'ipg240102.zip', 'productIdentifier': 'PTGRXML', 'fileLocationURI': 'https://bulkdata.uspto.gov/data/patent/grant/redbook/fulltext/2016/ipg160405.zip', 'fileCreateDateTime': '2024-08-09:11:30:00', 'xmlFileName': 'ipg160405.xml'}, 'lastIngestionTime': '2024-09-15T21:19:01'}], 'facets': [{'applicationStatusCode': [{'value': 'Utility', 'count': 44673}]}], 'requestIdentifier': 'df5b5478-ad3e-4ad2-b3bc-611838ccb56c'}


# if __name__ == "__main__":
#     parsed_response = ResponseParser.parse_response(example_json)
#     print(json.dumps(asdict(parsed_response), indent=2))
