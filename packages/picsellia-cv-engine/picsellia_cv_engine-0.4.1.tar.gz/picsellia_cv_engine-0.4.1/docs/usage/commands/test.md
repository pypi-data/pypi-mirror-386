# ðŸ§ª pxl-pipeline test

The `test` command runs a pipeline **locally** in a virtual environment, using the same logic that will later run on Picsellia.
It uses the unified entrypoint `pipeline.py` with `--mode local`.

---

## Usage

```bash
pxl-pipeline test PIPELINE_NAME [OPTIONS]
```

Example:

```bash
pxl-pipeline test yolov8 --run-config-file runs/run_config.toml
```

This runs:
```bash
python pipeline.py --mode local --config-file runs/run_config.toml
```

### Options

| Option              | Description                                                                                                                                                                           | Default  |
|---------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| `--run-config-file` | Path to a TOML file containing pipeline inputs, outputs, and parameters. If omitted, youâ€™ll be prompted for required values, and a `run_config.toml` will be generated automatically. | None     |
| `--reuse-dir`       | Reuse the **last run directory** instead of creating a new one. This avoids re-downloading datasets and models.                                                                                                                              | `False`  |
| `--organization`    | Picsellia organization name (will be inferred from environment if missing).                                                                                                           | Prompted |
| `--env`             | Picsellia environment: `PROD`, `STAGING`, `LOCAL`.                                                                                                                                    | `PROD`   |


## Run directories and configs

### At initialization

When you create a pipeline with `pxl-pipeline init`, a template `run_config.toml` is generated under `runs/`.
This file acts as a starting point you can edit to configure inputs, outputs, and parameters.

### At each test run

Each time you run `pxl-pipeline test`:

- A new run directory is created under `runs/runX/` (unless `--reuse-dir` is used).
- A fresh `run_config.toml` is copied or generated in that folder.
- Required values are auto-filled or prompted if missing.
- Datasets and model versions are downloaded inside the run folder.
- Outputs generated by the pipeline are written there as well.
- The `run_config.toml` is **updated at launch and completion** with extra metadata (IDs, URLs to datasets, outputs, etc.).


#### Example structure:

```
my_pipeline/
â”œâ”€â”€ runs/
â”‚   â”œâ”€â”€ run1/
â”‚   â”‚   â”œâ”€â”€ run_config.toml
â”‚   â”‚   â”œâ”€â”€ dataset/        # downloaded dataset files
â”‚   â”‚   â”œâ”€â”€ model/          # downloaded model weights
â”‚   â”‚   â””â”€â”€ outputs/        # generated results
â”‚   â”œâ”€â”€ run2/
â”‚   â”‚   â””â”€â”€ run_config.toml
â”‚   â””â”€â”€ run3/
â”‚       â””â”€â”€ run_config.toml
```

ðŸ’¡ This makes each run self-contained and reproducible.
