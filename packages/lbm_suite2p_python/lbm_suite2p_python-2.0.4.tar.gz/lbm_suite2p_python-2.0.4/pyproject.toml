[build-system]
requires = ["setuptools>=61", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "lbm_suite2p_python"
version = "2.0.4"
description = "Light Beads Microscopy Pipeline using Suite2p"
readme = "README.md"
license = "BSD-3-Clause"
requires-python = ">=3.12.7, <3.12.10"
keywords = ["Pipeline", "Numpy", "Microscopy", "ScanImage", "Suite2p", "tiff"]
urls = {homepage = "https://github.com/MillerBrainObservatory/LBM-Suite2p-Python"}
scripts = {lsp="lbm_suite2p_python.__main__:main"}
classifiers=[
	"Development Status :: 3 - Alpha",
	"Intended Audience :: Science/Research",
	"Programming Language :: Python :: 3 :: Only",
]
dependencies = [
	"mbo_utilities>=2.0.4",
]

[project.optional-dependencies]
cpsam = ["cellpose==4.0.6", "pytorch", "torchaudio"]
cpu = [
  "torch>=2.7.0",
  "torchvision>=0.22.0",
]
cu126 = [
  "torch>=2.7.0",
  "torchvision>=0.22.0",
]

[tool.uv.sources]
torch = [
  { index = "pytorch-cu126", extra = "cu126" }, # default
  { index = "pytorch-cpu", extra = "cpu" },
]
torchvision = [
  { index = "pytorch-cu126", extra = "cu126" }, # default
  { index = "pytorch-cpu", extra = "cpu" },
]

[[tool.uv.index]]
name = "pytorch-cpu"
url = "https://download.pytorch.org/whl/cpu"
explicit = true

[[tool.uv.index]]
name = "pytorch-cu126"
url = "https://download.pytorch.org/whl/cu126"
explicit = true

[[tool.uv.index]]
name = "pytorch-cu128"
url = "https://download.pytorch.org/whl/cu128"
explicit = true

[tool.uv]
default-groups = ["all"]
conflicts = [
  [
    { extra = "cpu" },
    { extra = "cu126" },
  ],
]

[dependency-groups]
all = [
	"rastermap",
	"cellpose==4.0.6",
	"torch>=2.7.0",
	"torchvision>=0.22.0",
]
docs = [
	"docutils>=0.21.2",
	"myst-nb>=1.2.0",
	"sphinx>=8.1.3",
	"sphinx-autodoc2>=0.5.0",
	"sphinx-copybutton>=0.5.2",
	"sphinx_togglebutton",
	"sphinx-design>=0.6.1",
	"sphinxcontrib-bibtex",
	"sphinx-tippy",
	"sphinx_book_theme",
	"numpydoc",
	"ipykernel",
	"sphinxcontrib-images",
	"sphinxcontrib-video",
	"jupytext",
	"scikit-image",
	"scipy",
	"pandas",
	"suite2p_mbo",
]

# https://github.com/charliermarsh/ruff
[tool.ruff]
line-length = 88
src = ["lbm_suite2p_python"]
exclude = ["docs", "exclude", "demos", "scripts"]

[tool.ruff.lint]
pydocstyle = { convention = "numpy" }
select = ["ALL"]
ignore = [
	"D401",   # First line should be in imperative mood (remove to opt in)
	"COM812", # Missing trailing comma (conflicts with ruff format)
	"ISC001", # Import sorting (conflicts with ruff format)
	"FIX002", # Fixable issue
	"DOC201", # TODO enable in follow-up PR; no doc for return type.
	"FBT",    # TODO: enable in follow-up PR; require bool options to be keyword-only.
]

[tool.ruff.lint.per-file-ignores]
"docs/*.py" = ["D"]

[tool.setuptools.exclude-package-data]
"*" = ["data/*"]

[tool.setuptools.packages.find]
where = ["."]
include = ["lbm_suite2p_python*"]

[tool.coverage.report]
exclude_lines = [
	"pragma: no cover",
	"if TYPE_CHECKING:",
	"@overload",
	"except ImportError",
	"\\.\\.\\.",
	"raise NotImplementedError()"
]
#
#[tool.setuptools.dynamic]
#version = {file = ["lbm_suite2p_python/VERSION"]}
