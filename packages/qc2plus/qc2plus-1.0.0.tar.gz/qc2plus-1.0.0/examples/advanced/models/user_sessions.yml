models:
  - name: user_sessions
    description: "Full coverage for session integrity, freshness and behavioral analytics"
    sample:
      method: random
      size: 3
      partitioned_by: session_date
      partition_strategy: latest
      partition_count: 2

    qc2plus_tests:
      level1:
        - unique:
            column_name: session_id
            severity: critical

        - not_null:
            column_name: user_id
            severity: critical

        - future_date:
            column_name: session_date
            severity: high

        - range_check:
            column_name: page_views
            min_value: 1
            max_value: 200
            severity: medium

        - freshness:
            column_name: session_date
            max_age_days: 3
            severity: critical


        - custom_sql: 
            custom_sql: |
              SELECT 
                'page_views_outlier' AS column_name,
                COUNT(*) AS failed_rows,
                (SELECT COUNT(*) FROM demo.user_sessions) AS total_rows,
                'Sessions with abnormally high page_views (> 80)' AS message
              FROM demo.user_sessions
              WHERE page_views > 80
              HAVING COUNT(*) > 0


      level2:
        temporal_analysis:
            date_column: session_date
            metrics: [count, sum_page_views]
            anomaly_detection: true
            seasonality_check: false
            window_days: 7
            frequency: daily
            severity: medium
            explanation: "Surveillance quotidienne du NOMBRE de sessions et du TOTAL de pages vues pour détecter les anomalies"

        distribution_analysis:
            segments: [user_id]
            metrics: [count, sum_page_views]
            date_column: session_date
            reference_period: 7
            comparison_period: 2
            behavior_change_threshold: 100
            severity: medium
            explanation: "Est-ce que mes utilisateurs se comportent normalement au fil du temps?
                          Pour chaque utilisateur, surveille : son NOMBRE de sessions et son TOTAL de pages vues"

        correlation_analysis:
            variables: [page_views, session_date]
            expected_correlation: 0.0
            threshold: 0.5
            severity: low
            explanation: "Est-ce que Le nombre de pages vues est corrélé avec la date de session"
