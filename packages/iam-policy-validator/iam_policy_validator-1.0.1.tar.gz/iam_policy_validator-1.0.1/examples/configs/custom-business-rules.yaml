# Custom Business Rules Configuration Example
# This file demonstrates how to configure the built-in enforcement checks
# with your organization's specific security and compliance requirements.

# NOTE: action_condition_enforcement and action_tag_enforcement are now BUILT-IN checks
# They are configured in the main iam-validator.yaml file under the "checks:" section

# ============================================================================
# USAGE
# ============================================================================
# These checks are already registered as built-in checks and can be enabled
# directly in your main iam-validator.yaml configuration file.
#
# See the main iam-validator.yaml for complete configuration examples of:
# - action_condition_enforcement (enforce specific IAM conditions for actions)
# - action_tag_enforcement (enforce tagging requirements for actions)

# This configuration demonstrates using these checks together
settings:
  enable_builtin_checks: true
  parallel_execution: true

checks:
  # ============================================================================
  # Action Condition Enforcement
  # ============================================================================
  # Enforce specific IAM condition requirements for actions
  # See main iam-validator.yaml for full configuration examples

  action_condition_enforcement:
    enabled: true
    severity: error
    description: "Enforce specific IAM condition requirements"

    action_condition_requirements:
      # iam:PassRole MUST specify which services can use the role
      - actions:
          - "iam:PassRole"
        required_conditions:
          - condition_key: "iam:PassedToService"
            description: "Specify which AWS services are allowed to use the passed role to prevent privilege escalation"
            expected_value: ["lambda.amazonaws.com", "ecs-tasks.amazonaws.com"]

      # Sensitive IAM actions require MFA
      - action_patterns:
          - "^iam:Delete.*"
          - "^iam:Put.*Policy$"
        required_conditions:
          - condition_key: "aws:MultiFactorAuthPresent"
            description: "Require MFA authentication for sensitive IAM operations"
            expected_value: true

  # ============================================================================
  # Tag Enforcement
  # ============================================================================
  # Ensure resources are properly tagged for cost allocation and compliance

  action_tag_enforcement:
    enabled: true
    severity: error
    description: "Enforce specific tags for specific actions"

    action_tag_requirements:
      # EC2 instances must have cost allocation tags
      - actions:
          - "ec2:RunInstances"
        required_tags:
          - "Environment"
          - "Owner"
          - "CostCenter"

      # RDS databases need data classification
      - action_patterns:
          - "^rds:Create.*"
        required_tags:
          - "DataClassification"
          - "Owner"

# ============================================================================
# TESTING
# ============================================================================
# Test your configuration:
#   iam-validator validate --path ./policies --config examples/custom-business-rules.yaml
