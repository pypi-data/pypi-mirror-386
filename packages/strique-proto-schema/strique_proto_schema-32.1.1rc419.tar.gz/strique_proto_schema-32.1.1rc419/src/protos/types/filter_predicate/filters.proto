syntax = "proto3";

package strique.types;

import "google/protobuf/timestamp.proto";
import "options/strique_enum_options.proto";

option java_outer_classname = "WhereClauseFiltersProto";
option java_package = "com.strique.types.WhereClauseFilters";

// Next ID : 6
// Enum for supported operators.
enum NumericOperatorType {
    NUMERIC_EQUAL = 0
    [(options.label) = '=' ]; 

    NUMERIC_NOT_EQUAL = 1
    [(options.label) = '<>'];   

    NUMERIC_GREATER_THAN = 2 
    [(options.label) = '>'];

    NUMERIC_LESS_THAN = 3
    [(options.label) = '<'];

    NUMERIC_GREATER_EQUAL = 4
    [(options.label) = '>='];

    NUMERIC_LESS_EQUAL = 5
    [(options.label) = '<='];
}

// Next ID : 7
// Enum for supported operators.
enum StringOperatorType {
    STRING_EQUAL = 0 
    [(options.label) = "ilike '%s'"];  

    STRING_NOT_EQUAL = 1 
    [(options.label) = "not ilike '%s'"]; 

    STRING_CONTAINS = 2 
    [(options.label) = "ilike '%%s%'"];

    STRING_NOT_CONTAINS = 3 
    [(options.label) = "not ilike '%%s%'"]; 

    STRING_START_WITH = 4 
    [(options.label) = "ilike '%s%'"];

    STRING_END_WITH = 5 
    [(options.label) = "ilike '%%s'"];

    STRING_EMPTY = 6 
    [(options.label) = "coalesce(%s, '') = ''"];
    
    STRING_NOT_EMPTY = 7 
    [(options.label) = "coalesce(%s, '') <> ''"];
}

// Next ID : 7
// Enum for supported operators.
enum DateOperatorType {
  DATE_EQUAL = 0
  [(options.label) = '=' ]; 

  DATE_NOT_EQUAL = 1
  [(options.label) = '<>'];   

  DATE_GREATER_THAN = 2 
  [(options.label) = '>'];

  DATE_LESS_THAN = 3
  [(options.label) = '<'];

  DATE_GREATER_EQUAL = 4
  [(options.label) = '>='];

  DATE_LESS_EQUAL = 5
  [(options.label) = '<='];

  DATE_BETWEEN = 6
  [(options.label) = 'between %s and %s'];
}

// Next ID : 2
// Enum for supported operators.
enum BooleanOperatorType {
  BOOLEAN_EQUAL = 0
  [(options.label) = "="];

  BOOLEAN_NOT_EQUAL = 1
  [(options.label) = "<>"];
}

// Next ID : 2
// Enum for supported operators.
enum ListOperatorType {
  LIST_IN = 0
  [(options.label) = "%s = any(%s)"];

  LIST_NOT_IN = 1
  [(options.label) = "%s <> any(%s)"];
}

// Next ID : 6
message OperatorType {
  oneof operator_type {
    NumericOperatorType numeric_operator_type = 1;
    StringOperatorType string_operator_type = 2;
    BooleanOperatorType boolean_operator_type = 3;
    DateOperatorType date_operator_type = 4;
    ListOperatorType list_operator_type = 5;
  }
}

// Next ID : 7
message ValueType {
  oneof value {
    double double_value = 1;
    string string_value = 2;
    int64 number_value = 3;
    uint64 unsigned_value = 4;
    float float_value = 5;
    bool boolean_value = 6;
    DateInput date_value = 7;
  }
}

// Next ID : 4
// A single condition in the WHERE clause.
message Predicate {
  uint32 column_no = 1;
	
  OperatorType operator = 2;
	
  optional ValueType filter_value_type = 3; 
}

// Next ID : 2
message Expressions {
  repeated Expression expression = 1;
}

// Next ID : 4
message Expression {
  oneof predicate_type {
    // A group of predicates combined by a logical operator 'AND'.
    Expressions all_of = 1;
    
    // A group of predicates combined by a logical operator 'OR'.
    Expressions any_of = 2;
    
    Predicate predicate = 3;
  }
}

// Next ID : 3
// A date range filter.
message DateInput {
  // The start date of the date range.
  google.protobuf.Timestamp start_date = 1;

  // The end date of the date range.
  optional google.protobuf.Timestamp end_date = 2;
}
