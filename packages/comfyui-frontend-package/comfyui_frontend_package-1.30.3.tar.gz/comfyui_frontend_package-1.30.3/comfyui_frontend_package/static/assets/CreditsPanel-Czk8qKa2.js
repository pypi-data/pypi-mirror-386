var q=Object.defineProperty;var s=(u,_)=>q(u,"name",{value:_,configurable:!0});import{ref as E,defineComponent as F,computed as P,resolveDirective as V,openBlock as m,createElementBlock as x,createVNode as a,unref as r,withCtx as g,createTextVNode as L,toDisplayString as i,createBlock as D,createElementVNode as d,createCommentVNode as B,withDirectives as H,watch as z,normalizeClass as G}from"vue";import k from"primevue/button";import S from"primevue/column";import M from"primevue/datatable";import R from"primevue/divider";import j from"primevue/skeleton";import J from"primevue/tabpanel";import{aD as K,cJ as N,aE as Y,r as Q,D as W,b as X,E as Z,cK as ee}from"./index-CQX5zsr-.js";import te from"primevue/badge";import oe from"primevue/message";import re from"primevue/progressspinner";import{aE as O}from"./vendor-other-_cjyrTf6.js";import{useI18n as se}from"vue-i18n";import"@primevue/themes";import"@primevue/themes/aura";import"./vendor-vue-CQiO0HWB.js";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/checkbox";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/multiselect";import"primevue/inputtext";import"primevue/select";import"./vendor-visualization-Cs6-EN8c.js";import"primevue/iconfield";import"primevue/inputicon";import"primevue/chip";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/progressbar";import"primevue/popover";import"primevue";import"primevue/slider";import"primevue/tieredmenu";import"primevue/chart";import"primevue/colorpicker";import"primevue/galleria";import"primevue/imagecompare";import"primevue/inputnumber";import"primevue/textarea";import"primevue/toggleswitch";import"primevue/treeselect";import"primevue/selectbutton";import"primevue/tag";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/tabpanels";import"primevue/tabs";import"primevue/radiobutton";import"primevue/knob";import"primevue/panel";import"primevue/tabmenu";import"primevue/tab";import"primevue/tablist";import"primevue/autocomplete";import"primevue/dropdown";import"./vendor-tiptap-BrIJ4TxO.js";import"primevue/blockui";var I=(u=>(u.CREDIT_ADDED="credit_added",u.ACCOUNT_CREATED="account_created",u.API_USAGE_STARTED="api_usage_started",u.API_USAGE_COMPLETED="api_usage_completed",u))(I||{});const ae=O.create({baseURL:K,headers:{"Content-Type":"application/json"}}),ie=s(()=>{const u=E(!1),_=E(null),{d:v}=se(),C=s((e,t,l)=>{if(Y(e))return;let h;if(!O.isAxiosError(e))h=`${t} failed: ${e instanceof Error?e.message:String(e)}`;else{const f=e,w=f.response?.status;w&&l?.[w]?h=l[w]:h=f.response?.data?.message??`${t} failed with status ${w}`}_.value=h},"handleRequestError"),y=s(async(e,t)=>{const{errorContext:l,routeSpecificErrors:h}=t;u.value=!0,_.value=null;try{return(await e()).data}catch(f){return C(f,l,h),null}finally{u.value=!1}},"executeRequest");function c(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}s(c,"formatEventType");function n(e){const t=new Date(e);return v(t,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}s(n,"formatDate");function b(e){return e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}s(b,"formatJsonKey");function A(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}s(A,"formatJsonValue");function $(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}s($,"getEventSeverity");function T(e){const{amount:t,api_name:l,model:h,...f}=e.params||{};return Object.keys(f).length>0}s(T,"hasAdditionalInfo");function U(e){const{...t}=e.params||{};return Object.entries(t).map(([l,h])=>{const f=b(l),w=A(h);return`<strong>${f}:</strong> ${w}`}).join("<br>")}s(U,"getTooltipContent");function o(e){return e?(e/100).toFixed(2):"0.00"}s(o,"formatAmount");async function p({page:e=1,limit:t=10}={}){const l="Fetching customer events",h={400:"Invalid input, object invalid",404:"Not found"},f=await N().getAuthHeader();return f?y(()=>ae.get("/customers/events",{params:{page:e,limit:t},headers:f}),{errorContext:l,routeSpecificErrors:h}):(_.value="Authentication header is missing",null)}return s(p,"getMyEvents"),{isLoading:u,error:_,getMyEvents:p,formatEventType:c,getEventSeverity:$,formatAmount:o,hasAdditionalInfo:T,formatDate:n,formatJsonKey:b,formatJsonValue:A,getTooltipContent:U}},"useCustomerEventsService"),ne={key:0,class:"flex items-center justify-center p-8"},le={key:1,class:"p-4"},ce={class:"event-details"},de={key:0,class:"font-semibold text-green-500"},me={key:1},ue={key:2,class:"flex flex-col gap-1"},pe={class:"font-semibold"},fe={class:"text-sm text-gray-400"},ve=F({__name:"UsageLogsTable",setup(u,{expose:_}){const v=E([]),C=E(!0),y=E(null),c=ie(),n=E({page:1,limit:7,total:0,totalPages:0}),b=P(()=>(n.value.page-1)*n.value.limit),A=P(()=>{const o=new Map;return v.value.forEach(p=>{c.hasAdditionalInfo(p)&&p.event_id&&o.set(p.event_id,c.getTooltipContent(p))}),o}),$=s(async()=>{C.value=!0,y.value=null;try{const o=await c.getMyEvents({page:n.value.page,limit:n.value.limit});o?(o.events&&(v.value=o.events),o.page&&(n.value.page=o.page),o.limit&&(n.value.limit=o.limit),o.total&&(n.value.total=o.total),o.totalPages&&(n.value.totalPages=o.totalPages)):y.value=c.error.value||"Failed to load events"}catch(o){y.value=o instanceof Error?o.message:"Unknown error",console.error("Error loading events:",o)}finally{C.value=!1}},"loadEvents"),T=s(o=>{n.value.page=o.page+1,$().catch(p=>{console.error("Error loading events:",p)})},"onPageChange");return _({refresh:s(async()=>{n.value.page=1,await $()},"refresh")}),(o,p)=>{const e=V("tooltip");return m(),x("div",null,[C.value?(m(),x("div",ne,[a(r(re))])):y.value?(m(),x("div",le,[a(r(oe),{severity:"error",closable:!1},{default:g(()=>[L(i(y.value),1)]),_:1})])):(m(),D(r(M),{key:2,value:v.value,paginator:!0,rows:n.value.limit,"total-records":n.value.total,first:b.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:T},{default:g(()=>[a(r(S),{field:"event_type",header:o.$t("credits.eventType")},{body:g(({data:t})=>[a(r(te),{value:r(c).formatEventType(t.event_type),severity:r(c).getEventSeverity(t.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),a(r(S),{field:"details",header:o.$t("credits.details")},{body:g(({data:t})=>[d("div",ce,[t.event_type===r(I).CREDIT_ADDED?(m(),x("div",de,i(o.$t("credits.added"))+" $"+i(r(c).formatAmount(t.params?.amount)),1)):t.event_type===r(I).ACCOUNT_CREATED?(m(),x("div",me,i(o.$t("credits.accountInitialized")),1)):t.event_type===r(I).API_USAGE_COMPLETED?(m(),x("div",ue,[d("div",pe,i(t.params?.api_name||"API"),1),d("div",fe,i(o.$t("credits.model"))+": "+i(t.params?.model||"-"),1)])):B("",!0)])]),_:1},8,["header"]),a(r(S),{field:"createdAt",header:o.$t("credits.time")},{body:g(({data:t})=>[L(i(r(c).formatDate(t.createdAt)),1)]),_:1},8,["header"]),a(r(S),{field:"params",header:o.$t("credits.additionalInfo")},{body:g(({data:t})=>[r(c).hasAdditionalInfo(t)?H((m(),D(r(k),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:A.value.get(t.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):B("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),he={class:"flex h-full flex-col"},_e={class:"mb-2 text-2xl font-bold"},ge={class:"flex flex-col gap-2"},ye={class:"text-sm font-medium text-muted"},Ce={class:"flex items-center justify-between"},be={class:"flex flex-row items-center"},xe={key:1,class:"text-xs text-muted"},Ee={class:"flex items-center justify-between"},Ae={key:0,class:"grow"},$e={class:"text-sm font-medium"},we={class:"text-xs text-muted"},ke={class:"flex flex-row gap-2"},zt=F({__name:"CreditsPanel",setup(u){const _=Q(),v=N(),C=W(),y=X(),c=P(()=>v.loading),n=P(()=>v.isFetchingBalance),b=E(null),A=P(()=>v.lastBalanceUpdateTime?v.lastBalanceUpdateTime.toLocaleString():"");z(()=>v.lastBalanceUpdateTime,(e,t)=>{e&&e!==t&&b.value&&b.value.refresh()});const $=s(()=>{_.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),T=s(async()=>{await C.accessBillingPortal()},"handleCreditsHistoryClick"),U=s(async()=>{await y.execute("Comfy.ContactSupport")},"handleMessageSupport"),o=s(()=>{window.open("https://docs.comfy.org/tutorials/api-nodes/faq","_blank")},"handleFaqClick"),p=E([]);return(e,t)=>(m(),D(r(J),{value:"Credits",class:"credits-container h-full"},{default:g(()=>[d("div",he,[d("h2",_e,i(e.$t("credits.credits")),1),a(r(R)),d("div",ge,[d("h3",ye,i(e.$t("credits.yourCreditBalance")),1),d("div",Ce,[a(Z,{"text-class":"text-3xl font-bold"}),c.value?(m(),D(r(j),{key:0,width:"2rem",height:"2rem"})):(m(),D(r(k),{key:1,label:e.$t("credits.purchaseCredits"),loading:c.value,onClick:$},null,8,["label","loading"]))]),d("div",be,[n.value?(m(),D(r(j),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):A.value?(m(),x("div",xe,i(e.$t("credits.lastUpdated"))+": "+i(A.value),1)):B("",!0),a(r(k),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:t[0]||(t[0]=()=>r(C).fetchBalance())})])]),d("div",Ee,[d("h3",null,i(e.$t("credits.activity")),1),a(r(k),{label:e.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:c.value,onClick:T},null,8,["label","loading"])]),p.value.length>0?(m(),x("div",Ae,[a(r(M),{value:p.value,"show-headers":!1},{default:g(()=>[a(r(S),{field:"title",header:e.$t("g.name")},{body:g(({data:l})=>[d("div",$e,i(l.title),1),d("div",we,i(l.timestamp),1)]),_:1},8,["header"]),a(r(S),{field:"amount",header:e.$t("g.amount")},{body:g(({data:l})=>[d("div",{class:G(["text-center text-base font-medium",l.isPositive?"text-sky-500":"text-red-400"])},i(l.isPositive?"+":"-")+"$"+i(r(ee)(l.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):B("",!0),a(r(R)),a(ve,{ref_key:"usageLogsTableRef",ref:b},null,512),d("div",ke,[a(r(k),{label:e.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:o},null,8,["label"]),a(r(k),{label:e.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:U},null,8,["label"])])])]),_:1}))}});export{zt as default};
//# sourceMappingURL=CreditsPanel-Czk8qKa2.js.map
