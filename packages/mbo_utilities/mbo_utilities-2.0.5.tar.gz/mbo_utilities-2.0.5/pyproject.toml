[build-system]
requires = ["setuptools>=61", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "mbo_utilities"
version = "2.0.5"
description = "Various utilities for the Miller Brain Observatory"
readme = "README.md"
license = "BSD-3-Clause"
requires-python = ">=3.12.7, <3.12.10"
keywords = ["Microscopy", "ScanImage", "multiROI", "Tiff"]
dependencies = [
	"numpy>=2.2.5,<3.0",
	"numba>=0.60.0",
	"pandas",
	"tifffile>=2025.3.30",
	"scikit-image",
	"zarr>=3.1.3",
	"dask>=2025.3.0",
	"imageio[ffmpeg]",
	"ffmpeg-python",
	"matplotlib>=3.10.1",
	"seaborn>=0.13.2",
	"opencv-python-headless",
	"h5py",
	"tqdm",
	"jupyterlab==4.2.6",
	"ipykernel",
	"ipywidgets>=8.0.0,<9",
	"icecream>=2.1.4",
	"cupy-cuda12x",
	"torch",
	"torchvision",
	"glfw",
	"wgpu[imgui]",
	"pygfx>=0.14.0",
	"jupyter_rfb>=0.5.1",
	"suite2p_mbo>=1.0.6",
	"mbo-suite3d>=0.0.4",
	"lbm-suite2p-python>=2.0.4",
	"mbo-fpl",
	"llvmlite>=0.43.0",
	"mkl_fft>=2.0.0",
]

[project.scripts]
mbo = "mbo_utilities.graphics.run_gui:run_gui"  # alias
pollen = "pollen.pollen_calibration_mbo:main"
assemble = "mbo_utilities.assembly:main"

[project.urls]
Homepage = "https://github.com/millerbrainobservatory/mbo_utilities"
Documentation = "https://millerbrainobservatory.github.io/mbo_utilities/index.html"
Repository = "https://github.com/millerbrainobservatory/mbo_utilities"
Issues = "https://github.com/MillerBrainObservatory/mbo_utilities/issues"

[project.optional-dependencies]
all = [
]
docs = [
	"sphinx>=6.1.3",
	"docutils>=0.19",
	"nbsphinx",
	"numpydoc",
	"ipykernel",
	"sphinx-autodoc2",
	"sphinx_tippy",
	"sphinx_gallery",
	"sphinx-togglebutton",
	"sphinx-copybutton",
	"sphinx_book_theme",
	"sphinx_design",
	"sphinxcontrib-images",
	"sphinxcontrib-video",
	"sphinxcontrib-bibtex",
	"jupytext",
	"myst_nb",
	"scipy",
	"scikit-image",
	"suite2p_mbo",
	"cellpose",
	"pygfx>=0.14.0",
]

[[tool.uv.index]]
name = "pytorch-cu126"
url = "https://download.pytorch.org/whl/cu126"
explicit = true

[tool.uv.sources]
lbm_suite2p_python = { git = "https://github.com/MillerBrainObservatory/LBM-Suite2p-Python.git", branch = "master"}
mbo-fpl = { git = "https://github.com/MillerBrainObservatory/mbo_fastplotlib.git", branch = "main"}
mbo-suite3d = { git = "https://github.com/MillerBrainObservatory/suite3d.git", branch = "main"}
torch = [
  { index = "pytorch-cu126", marker = "sys_platform == 'linux' or sys_platform == 'win32'" },
]
torchvision = [
  { index = "pytorch-cu126", marker = "sys_platform == 'linux' or sys_platform == 'win32'" },
]

[tool.ruff]
line-length = 88
src = ["mbo_utilities", "pollen"]
exclude = ["docs", "exclude", "demos", "scripts"]

[tool.ruff.lint]
pydocstyle = { convention = "numpy" }
select = ["ALL"]
ignore = [
	"D401",   # First line should be in imperative mood (remove to opt in)
	"COM812", # Missing trailing comma (conflicts with ruff format)
	"ISC001", # Import sorting (conflicts with ruff format)
	"FIX002", # Fixable issue
	"DOC201", # TODO enable in follow-up PR; no doc for return type.
	"FBT",    # TODO: enable in follow-up PR; require bool options to be keyword-only.
]

[tool.ruff.lint.per-file-ignores]
"docs/*.py" = ["D"]


[tool.setuptools]
package-dir = {"" = "."}

[tool.setuptools.packages.find]
where = ["."]
include = ["mbo_utilities*", "pollen*"]
exclude = ["dev*", "gists*", "slurm*", "demos*", "assets*", "docs*", "tests*"]

[tool.setuptools.exclude-package-data]
"*" = ["data/*"]

[tool.coverage.report]
exclude_lines = [
	"pragma: no cover",
	"if TYPE_CHECKING:",
	"@overload",
	"except ImportError",
	"\\.\\.\\.",
	"raise NotImplementedError()"
]

