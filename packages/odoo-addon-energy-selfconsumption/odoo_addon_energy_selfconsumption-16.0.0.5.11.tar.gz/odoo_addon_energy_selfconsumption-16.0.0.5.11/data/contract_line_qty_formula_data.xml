<?xml version="1.0" encoding="utf-8"?>
<!--
Contract Line Quantity Formula Data
===================================

This file defines the quantity calculation formulas used in contract lines
for different billing modes in self-consumption projects.

Main formulas:
- Power Acquired Formula: Calculates power billing based on days and coefficients
- Energy Delivered Formula: Calculates energy billing based on delivered energy
- Energy Delivered Variable Formula: Placeholder for variable energy calculations
- Active Monitoring Members Formula: Counts active monitoring members

These formulas are used in contract templates to automatically calculate
quantities for invoicing based on different billing modes.
-->
<odoo>
    <data>
        
        <!-- Formula: Power Acquired Calculation -->
        <record id="power_acquired_formula" model="contract.line.qty.formula">
            <field name="name">Power Acquired Formula</field>
            <field name="code">
days_timedelta = contract.next_period_date_end - contract.next_period_date_start
if days_timedelta:
  # Add one so it counts the same day too (month = 29 + 1)
  days_between = days_timedelta.days + 1
else:
  days_between = 0
result = contract.supply_point_assignation_id.distribution_table_id.selfconsumption_project_id.power * contract.supply_point_assignation_id.coefficient *  days_between
            </field>
            <field name="company_id" eval="False" />
        </record>
        
        <!-- Formula: Energy Delivered Calculation -->
        <record id="energy_delivered_formula" model="contract.line.qty.formula">
            <field name="name">Energy Delivered Formula</field>
            <field name="code">
energy_delivered = 0
if 'energy_delivered' in context:
  energy_delivered = context['energy_delivered']
result = energy_delivered * contract.supply_point_assignation_id.coefficient
            </field>
            <field name="company_id" eval="False" />
        </record>
        
        <!-- Formula: Energy Delivered Variable (Placeholder) -->
        <record id="energy_delivered_variable_formula" model="contract.line.qty.formula">
            <field name="name">Energy Delivered Variable Formula</field>
            <field name="code">
result = 0
            </field>
            <field name="company_id" eval="False" />
        </record>
        
        <!-- Formula: Active Monitoring Members Count -->
        <record id="active_monitoring_members_formula" model="contract.line.qty.formula">
            <field name="name">Active monitoring members</field>
            <field name="code">
result = contract.get_active_monitoring_members()
            </field>
            <field name="company_id" ref="base.main_company" />
        </record>
        
    </data>
</odoo>
