var Yr=Object.defineProperty;var Zr=(D,h,b)=>h in D?Yr(D,h,{enumerable:!0,configurable:!0,writable:!0,value:b}):D[h]=b;var ge=(D,h,b)=>Zr(D,typeof h!="symbol"?h+"":h,b);import{l as tt,r as en,a as tn,e as Ue,m as rn,P as tr,R as yt,S as nn,U as mt}from"./monaco-core.js";import{l as on}from"./vendor.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))R(C);new MutationObserver(C=>{for(const U of C)if(U.type==="childList")for(const H of U.addedNodes)H.tagName==="LINK"&&H.rel==="modulepreload"&&R(H)}).observe(document,{childList:!0,subtree:!0});function b(C){const U={};return C.integrity&&(U.integrity=C.integrity),C.referrerPolicy&&(U.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?U.credentials="include":C.crossOrigin==="anonymous"?U.credentials="omit":U.credentials="same-origin",U}function R(C){if(C.ep)return;C.ep=!0;const U=b(C);fetch(C.href,U)}})();const rr=[{label:"for loop",kind:tt.CompletionItemKind.Snippet,insertText:["for ${1:var} in ${2:iterable}:","	${0:pass}"].join(`
`),insertTextRules:tt.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Python for loop snippet"}];function an(D=""){const h=D.toLowerCase();return(D?rr.filter(R=>R.label.toLowerCase().startsWith(h)||R.label.toLowerCase().includes(h)):rr).map(R=>({label:R.label,kind:R.kind,insertText:R.insertText,insertTextRules:R.insertTextRules,documentation:typeof R.documentation=="string"?{value:R.documentation,isTrusted:!1}:R.documentation,sortText:R.label,filterText:R.label,range:{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0}}))}function bt(D,h){let b=D.lineNumber-1;if(h){const R=h.split(`
`).length-1;b+=R}return b}function Mt(D,h,b){const R=h.uri.toString();return D.sendNotification("textDocument/didOpen",{textDocument:{uri:R,languageId:"python",version:1,text:b(h)}}),R}function sn(D,h,b,R,C){return tt.registerCompletionItemProvider("python",{triggerCharacters:["."],provideCompletionItems:async(U,H)=>{const F=D();if(!h(F))return console.warn("No valid LSP connection available for completion"),{suggestions:[]};const K=F,x=U.getWordUntilPosition(H),A=x?x.word:"";console.log("Current word for snippet filtering:",A);const N=bt(H,R),P=H.column-1,J=Mt(K,U,b);try{const O=await K.sendRequest("textDocument/completion",{textDocument:{uri:J},position:{line:N,character:P},context:{triggerKind:1}}),G=Array.isArray(O)?O:O.items;G.forEach(te=>{console.log("Inserting snippet:",JSON.stringify(te))});const Q=G.map(te=>({...te})),me=an(A).map(te=>(te.range&&(te.range={startLineNumber:H.lineNumber,startColumn:x.startColumn,endLineNumber:H.lineNumber,endColumn:x.endColumn}),te));return{suggestions:[...Q,...me]}}catch(O){return console.error("LSP completion failed:",O),O instanceof Error&&(O.message.includes("disposed")||O.message.includes("closed"))&&(console.warn("Connection was disposed during completion request, forcing reconnection"),C()),{suggestions:[]}}}})}function ln(D,h,b,R,C,U){return tt.registerSignatureHelpProvider("python",{signatureHelpTriggerCharacters:["(",",","="],provideSignatureHelp:async(H,F,K,x)=>{var G;const A=D();if(!h(A))return console.warn("No valid LSP connection available for signature help"),{value:{signatures:[],activeSignature:0,activeParameter:0},dispose:()=>{}};const N=A,P=bt(F,R),J=F.column-1,O=Mt(N,H,b);try{const Q=await N.sendRequest("textDocument/signatureHelp",{textDocument:{uri:O},position:{line:P,character:J},context:{triggerKind:x.triggerKind,triggerCharacter:x.triggerCharacter}});if(!Q||!((G=Q.signatures)!=null&&G.length))return{value:{signatures:[],activeSignature:0,activeParameter:0},dispose:()=>{}};const me={signatures:Q.signatures.map(te=>{var Te;return{label:te.label,documentation:te.documentation?typeof te.documentation=="string"?{value:te.documentation}:te.documentation:void 0,parameters:((Te=te.parameters)==null?void 0:Te.map(ce=>({label:typeof ce.label=="string"?ce.label:ce.label[0]+"-"+ce.label[1],documentation:ce.documentation?typeof ce.documentation=="string"?{value:ce.documentation}:ce.documentation:void 0})))||[]}}),activeSignature:Q.activeSignature??0,activeParameter:Q.activeParameter??0};return U&&U(me),{value:me,dispose:()=>{}}}catch(Q){return console.error("LSP signature help failed:",Q),Q instanceof Error&&(Q.message.includes("disposed")||Q.message.includes("closed"))&&(console.warn("Connection was disposed during signature help request, forcing reconnection"),C()),{value:{signatures:[],activeSignature:0,activeParameter:0},dispose:()=>{}}}}})}function un(D,h,b,R,C){return tt.registerHoverProvider("python",{provideHover:async(U,H)=>{const F=D();if(!h(F))return console.warn("No valid LSP connection available for hover"),null;const K=F,x=bt(H,R),A=H.column-1,N=Mt(K,U,b);try{const P=await K.sendRequest("textDocument/hover",{textDocument:{uri:N},position:{line:x,character:A}});if(P!=null&&P.contents)return{contents:Array.isArray(P.contents)?P.contents.map(J=>({value:J.value||J})):[{value:P.contents.value||P.contents}],range:P.range}}catch(P){console.error("LSP hover failed:",P),P instanceof Error&&(P.message.includes("disposed")||P.message.includes("closed"))&&(console.warn("Connection was disposed during hover request, forcing reconnection"),C())}return null}})}class fn{constructor(h="localhost:1234"){ge(this,"currentConnection",null);ge(this,"reconnectAttempts",0);ge(this,"baseReconnectDelay",1e3);ge(this,"maxReconnectDelay",1e4);ge(this,"providersRegistered",!1);ge(this,"pylspUrl","localhost:1234");ge(this,"providerDisposables",[]);ge(this,"reconnectTimeoutId",null);ge(this,"isDestroyed",!1);ge(this,"healthCheckInterval",null);ge(this,"webSocket",null);ge(this,"prependedData",null);ge(this,"onSignatureHelp",null);ge(this,"settings",null);this.pylspUrl=h,this.connect()}connect(){if(this.isDestroyed){console.log("LSP client has been destroyed, skipping connection attempt");return}this.webSocket=new WebSocket("ws://"+this.pylspUrl);const h=this.webSocket;h.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0,this.onConnectionOpened()},h.onerror=b=>{console.error("WebSocket error:",b)},h.onclose=b=>{if(console.log("WebSocket disconnected:",b.code,b.reason),this.currentConnection=null,this.stopHealthCheck(),this.isDestroyed){console.log("LSP client has been destroyed, skipping reconnection");return}this.reconnectTimeoutId!==null&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null);const R=Math.min(this.baseReconnectDelay*Math.min(Math.pow(1.5,this.reconnectAttempts),10),this.maxReconnectDelay);this.reconnectAttempts++,console.log(`Attempting to reconnect in ${R}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimeoutId=window.setTimeout(()=>{this.reconnectTimeoutId=null,this.connect()},R)},on({webSocket:h,onConnection:b=>{this.currentConnection=b,b.listen();const R={processId:null,rootUri:null,capabilities:{}};b.sendRequest("initialize",R).then(()=>{b.sendNotification("initialized",{}),console.log("LSP connection initialized successfully"),this.startHealthCheck(),this.onConnectionOpened()}).catch(C=>{console.error("Failed to initialize LSP:",C),this.currentConnection===b&&(this.currentConnection=null,b.dispose(),h.close())}),this.registerMonacoProviders()}})}onConnectionOpened(){console.log("LSP connection opened"),this.settings&&this.updateWorkspaceConfiguration(this.settings).catch(h=>{console.error("Failed to update workspace configuration on connection open:",h)})}prependModelData(h){return this.prependedData?this.prependedData+h.getValue():h.getValue()}registerMonacoProviders(){this.providersRegistered&&(console.log("Disposing existing Monaco providers before re-registering"),this.providerDisposables.forEach(C=>C.dispose()),this.providerDisposables=[],this.providersRegistered=!1);const h=sn(()=>this.currentConnection,this.isConnectionValid.bind(this),this.prependModelData.bind(this),this.prependedData,this.forceReconnect.bind(this)),b=ln(()=>this.currentConnection,this.isConnectionValid.bind(this),this.prependModelData.bind(this),this.prependedData,this.forceReconnect.bind(this),this.onSignatureHelp),R=un(()=>this.currentConnection,this.isConnectionValid.bind(this),this.prependModelData.bind(this),this.prependedData,this.forceReconnect.bind(this));this.providerDisposables.push(h,b,R),this.providersRegistered=!0,console.log("Monaco language providers registered successfully")}isConnectionValid(h){var b;if(!h)return!1;try{if(h._disposed||(b=h.isDisposed)!=null&&b.call(h))return console.warn("Detected disposed connection via disposal flags"),this.currentConnection===h&&(this.currentConnection=null,this.forceReconnect()),!1;const R=h.state||h._state;return R==="closed"||R==="disposed"||R===3?(console.warn("Detected closed connection via state check"),this.currentConnection===h&&(this.currentConnection=null,this.forceReconnect()),!1):!0}catch(R){return console.warn("Error checking connection validity, treating as invalid:",R),this.currentConnection===h&&(this.currentConnection=null,this.forceReconnect()),!1}}forceReconnect(){this.isDestroyed||(console.log("Forcing reconnection due to disposed connection"),this.reconnectTimeoutId!==null&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null),this.reconnectTimeoutId=window.setTimeout(()=>{this.reconnectTimeoutId=null,this.connect()},100))}startHealthCheck(){this.stopHealthCheck(),this.healthCheckInterval=window.setInterval(async()=>{var h;if(this.isDestroyed){this.stopHealthCheck();return}if(this.currentConnection&&!this.isConnectionValid(this.currentConnection)){console.log("Health check detected invalid connection via basic checks");return}if(((h=this.webSocket)==null?void 0:h.readyState)!==WebSocket.OPEN){console.log("Health check detected invalid connection via WebSocket state"),this.forceReconnect();return}},5e3)}stopHealthCheck(){this.healthCheckInterval!==null&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}isConnected(){return this.isConnectionValid(this.currentConnection)}getConnection(){return this.currentConnection}setLspUrl(h){if(this.isDestroyed){console.warn("Cannot change URL: LSP client has been destroyed");return}console.log(`Changing LSP URL from ${this.pylspUrl} to ${h}`),this.pylspUrl=h,this.reconnectTimeoutId!==null&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null),this.currentConnection&&(this.currentConnection.dispose(),this.currentConnection=null),this.reconnectAttempts=0,this.connect()}async updateWorkspaceConfiguration(h){if(!this.isConnectionValid(this.currentConnection))throw console.warn("Cannot update workspace configuration: No valid LSP connection"),new Error("No valid LSP connection available");try{console.log("Updating workspace configuration:",h),await this.currentConnection.sendNotification("workspace/didChangeConfiguration",{settings:h}),console.log("Workspace configuration updated successfully")}catch(b){throw console.error("Failed to update workspace configuration:",b),b}}destroy(){this.isDestroyed=!0,this.stopHealthCheck(),this.reconnectTimeoutId!==null&&(clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=null),this.providerDisposables.forEach(h=>h.dispose()),this.providerDisposables=[],this.providersRegistered=!1,this.currentConnection&&(this.currentConnection.dispose(),this.currentConnection=null),console.log("LSP client destroyed")}}var Ct={},kt={},wt={},nr;function cn(){return nr||(nr=1,function(D){Object.defineProperty(D,"__esModule",{value:!0}),D.default=void 0;var h=en,b=tn;function R(y,d){return K(y)||F(y,d)||U(y,d)||C()}function C(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U(y,d){if(y){if(typeof y=="string")return H(y,d);var f={}.toString.call(y).slice(8,-1);return f==="Object"&&y.constructor&&(f=y.constructor.name),f==="Map"||f==="Set"?Array.from(y):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?H(y,d):void 0}}function H(y,d){(d==null||d>y.length)&&(d=y.length);for(var f=0,p=Array(d);f<d;f++)p[f]=y[f];return p}function F(y,d){var f=y==null?null:typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(f!=null){var p,g,S,E,W=[],z=!0,j=!1;try{if(S=(f=f.call(y)).next,d!==0)for(;!(z=(p=S.call(f)).done)&&(W.push(p.value),W.length!==d);z=!0);}catch(ee){j=!0,g=ee}finally{try{if(!z&&f.return!=null&&(E=f.return(),Object(E)!==E))return}finally{if(j)throw g}}return W}}function K(y){if(Array.isArray(y))return y}function x(y){"@babel/helpers - typeof";return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},x(y)}function A(y,d){if(!(y instanceof d))throw new TypeError("Cannot call a class as a function")}function N(y,d){for(var f=0;f<d.length;f++){var p=d[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,J(p.key),p)}}function P(y,d,f){return d&&N(y.prototype,d),Object.defineProperty(y,"prototype",{writable:!1}),y}function J(y){var d=O(y,"string");return x(d)=="symbol"?d:d+""}function O(y,d){if(x(y)!="object"||!y)return y;var f=y[Symbol.toPrimitive];if(f!==void 0){var p=f.call(y,d);if(x(p)!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(y)}var G={Bottom:4},Q={readOnly:65,cursorWidth:20,fontInfo:32},me=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function te(y){return/\w/.test(y)||y>""&&(y.toUpperCase()!=y.toLowerCase()||me.test(y))}function Te(y,d){if(!(this instanceof Te))return new Te(y,d);this.line=y,this.ch=d}function ce(y,d,f){y.dispatch(d,f)}function Be(y){return function(){}}var je=function(d,f){this.pos=this.start=0,this.string=d,this.tabSize=f||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};je.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(d){var f=this.string.charAt(this.pos);if(typeof d=="string")var p=f==d;else var p=f&&(d.test?d.test(f):d(f));if(p)return++this.pos,f},eatWhile:function(d){for(var f=this.pos;this.eat(d););return this.pos>f},eatSpace:function(){for(var d=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>d},skipToEnd:function(){this.pos=this.string.length},skipTo:function(d){var f=this.string.indexOf(d,this.pos);if(f>-1)return this.pos=f,!0},backUp:function(d){this.pos-=d},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(d,f,p){if(typeof d=="string"){var g=function(z){return p?z.toLowerCase():z},S=this.string.substr(this.pos,d.length);if(g(S)==g(d))return f!==!1&&(this.pos+=d.length),!0}else{var E=this.string.slice(this.pos).match(d);return E&&E.index>0?null:(E&&f!==!1&&(this.pos+=E[0].length),E)}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(d,f){this.lineStart+=d;try{return f()}finally{this.lineStart-=d}}};function de(y){return new Te(y.lineNumber-1,y.column-1)}function ne(y){return new h.Position(y.line+1,y.ch+1)}var rt=function(){function y(d,f,p,g){A(this,y),this.cm=d,this.id=f,this.lineNumber=p+1,this.column=g+1,d.marks[this.id]=this}return P(y,[{key:"clear",value:function(){delete this.cm.marks[this.id]}},{key:"find",value:function(){return de(this)}}])}();function nt(y){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=!0,p=h.KeyCode[y.keyCode];y.key&&(p=y.key,f=!1);var g=p,S=d;switch(y.keyCode){case h.KeyCode.Shift:case h.KeyCode.Meta:case h.KeyCode.Alt:case h.KeyCode.Ctrl:return g;case h.KeyCode.Escape:S=!0,g="Esc";break;case h.KeyCode.Space:S=!0;break}return p.startsWith("Key")||p.startsWith("KEY_")?g=p[p.length-1].toLowerCase():p.startsWith("Digit")?g=p.slice(5,6):p.startsWith("Numpad")?g=p.slice(6,7):p.endsWith("Arrow")?(S=!0,g=p.substring(0,p.length-5)):(p.startsWith("US_")||p.startsWith("Bracket")||!g)&&(g=y.browserEvent.key),!S&&!y.altKey&&!y.ctrlKey&&!y.metaKey?g=y.key||y.browserEvent.key:(y.altKey&&(g="Alt-".concat(g)),y.ctrlKey&&(g="Ctrl-".concat(g)),y.metaKey&&(g="Meta-".concat(g)),y.shiftKey&&(g="Shift-".concat(g))),g.length===1&&f&&(g="'".concat(g,"'")),g}var X=function(){function y(d){A(this,y),qe.call(this),this.editor=d,this.state={keyMap:"vim"},this.marks={},this.$uid=0,this.disposables=[],this.listeners={},this.curOp={},this.attached=!1,this.statusBar=null,this.options={},this.addLocalListeners(),this.ctxInsert=this.editor.createContextKey("insertMode",!0)}return P(y,[{key:"attach",value:function(){y.keyMap.vim.attach(this)}},{key:"addLocalListeners",value:function(){this.disposables.push(this.editor.onDidChangeCursorPosition(this.handleCursorChange),this.editor.onDidChangeModelContent(this.handleChange),this.editor.onKeyDown(this.handleKeyDown))}},{key:"handleReplaceMode",value:function(f,p){var g=!1,S=f,E=this.editor.getPosition(),W=new h.Range(E.lineNumber,E.column,E.lineNumber,E.column+1),z=!0;if(f.startsWith("'"))S=f[1];else if(S==="Enter")S=`
`;else if(S==="Backspace"){var j=this.replaceStack.pop();if(!j)return;g=!0,S=j,W=new h.Range(E.lineNumber,E.column,E.lineNumber,E.column-1)}else return;p.preventDefault(),p.stopPropagation(),this.replaceStack||(this.replaceStack=[]),g||this.replaceStack.push(this.editor.getModel().getValueInRange(W)),this.editor.executeEdits("vim",[{text:S,range:W,forceMoveMarkers:z}]),g&&this.editor.setPosition(W.getStartPosition())}},{key:"setOption",value:function(f,p){this.state[f]=p,f==="theme"&&h.editor.setTheme(p)}},{key:"getConfiguration",value:function(){var f=this.editor,p=Q;return typeof f.getConfiguration=="function"?f.getConfiguration():("EditorOption"in h.editor&&(p=h.editor.EditorOption),{readOnly:f.getOption(p.readOnly),viewInfo:{cursorWidth:f.getOption(p.cursorWidth)},fontInfo:f.getOption(p.fontInfo)})}},{key:"getOption",value:function(f){return f==="readOnly"?this.getConfiguration().readOnly:f==="firstLineNumber"?this.firstLine()+1:f==="indentWithTabs"?!this.editor.getModel().getOptions().insertSpaces:typeof this.editor.getConfiguration=="function"?this.editor.getRawConfiguration()[f]:this.editor.getRawOptions()[f]}},{key:"dispatch",value:function(f){for(var p=arguments.length,g=new Array(p>1?p-1:0),S=1;S<p;S++)g[S-1]=arguments[S];var E=this.listeners[f];E&&E.forEach(function(W){return W.apply(void 0,g)})}},{key:"on",value:function(f,p){this.listeners[f]||(this.listeners[f]=[]),this.listeners[f].push(p)}},{key:"off",value:function(f,p){var g=this.listeners[f];g&&(this.listeners[f]=g.filter(function(S){return S!==p}))}},{key:"firstLine",value:function(){return 0}},{key:"lastLine",value:function(){return this.lineCount()-1}},{key:"lineCount",value:function(){return this.editor.getModel().getLineCount()}},{key:"defaultTextHeight",value:function(){return 1}},{key:"getLine",value:function(f){if(f<0)return"";var p=this.editor.getModel(),g=p.getLineCount();return f+1>g&&(f=g-1),this.editor.getModel().getLineContent(f+1)}},{key:"getAnchorForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var p=f.getDirection();return p===h.SelectionDirection.LTR?f.getStartPosition():f.getEndPosition()}},{key:"getHeadForSelection",value:function(f){if(f.isEmpty())return f.getPosition();var p=f.getDirection();return p===h.SelectionDirection.LTR?f.getEndPosition():f.getStartPosition()}},{key:"getCursor",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(!f)return de(this.editor.getPosition());var p=this.editor.getSelection(),g;return p.isEmpty()?g=p.getPosition():f==="anchor"?g=this.getAnchorForSelection(p):g=this.getHeadForSelection(p),de(g)}},{key:"getRange",value:function(f,p){var g=ne(f),S=ne(p);return this.editor.getModel().getValueInRange(h.Range.fromPositions(g,S))}},{key:"getSelection",value:function(){var f=[],p=this.editor;return p.getSelections().map(function(g){f.push(p.getModel().getValueInRange(g))}),f.join(`
`)}},{key:"replaceRange",value:function(f,p,g){var S=ne(p),E=g?ne(g):S;this.editor.executeEdits("vim",[{text:f,range:h.Range.fromPositions(S,E)}]),this.pushUndoStop()}},{key:"pushUndoStop",value:function(){this.editor.pushUndoStop()}},{key:"setCursor",value:function(f,p){var g=f;x(f)!=="object"&&(g={},g.line=f,g.ch=p);var S=this.editor.getModel().validatePosition(ne(g));this.editor.setPosition(ne(g)),this.editor.revealPosition(S)}},{key:"somethingSelected",value:function(){return!this.editor.getSelection().isEmpty()}},{key:"operation",value:function(f,p){return f()}},{key:"listSelections",value:function(){var f=this,p=this.editor.getSelections();return!p.length||this.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:p.map(function(g){return g.getPosition(),g.getStartPosition(),g.getEndPosition(),{anchor:f.clipPos(de(f.getAnchorForSelection(g))),head:f.clipPos(de(f.getHeadForSelection(g)))}})}},{key:"focus",value:function(){this.editor.focus()}},{key:"setSelections",value:function(f,p){var g=!!this.editor.getSelections().length,S=f.map(function(z,j){var ee=z.anchor,fe=z.head;return g?h.Selection.fromPositions(ne(ee),ne(fe)):h.Selection.fromPositions(ne(fe),ne(ee))});if(p&&S[p]&&S.push(S.splice(p,1)[0]),!!S.length){var E=S[0],W;E.getDirection()===h.SelectionDirection.LTR?W=E.getEndPosition():W=E.getStartPosition(),this.editor.setSelections(S),this.editor.revealPosition(W)}}},{key:"setSelection",value:function(f,p){var g=h.Range.fromPositions(ne(f),ne(p));this.editor.setSelection(g)}},{key:"getSelections",value:function(){var f=this.editor;return f.getSelections().map(function(p){return f.getModel().getValueInRange(p)})}},{key:"replaceSelections",value:function(f){var p=this.editor;p.getSelections().forEach(function(g,S){p.executeEdits("vim",[{range:g,text:f[S],forceMoveMarkers:!1}])})}},{key:"toggleOverwrite",value:function(f){f?(this.enterVimMode(),this.replaceMode=!0):(this.leaveVimMode(),this.replaceMode=!1,this.replaceStack=[])}},{key:"charCoords",value:function(f,p){return{top:f.line,left:f.ch}}},{key:"coordsChar",value:function(f,p){}},{key:"clipPos",value:function(f){var p=this.editor.getModel().validatePosition(ne(f));return de(p)}},{key:"setBookmark",value:function(f,p){var g=new rt(this,this.$uid++,f.line,f.ch);return(!p||!p.insertLeft)&&(g.$insertRight=!0),this.marks[g.id]=g,g}},{key:"getScrollInfo",value:function(){var f=this.editor,p=f.getVisibleRanges(),g=R(p,1),S=g[0];return{left:0,top:S.startLineNumber-1,height:f.getModel().getLineCount(),clientHeight:S.endLineNumber-S.startLineNumber+1}}},{key:"triggerEditorAction",value:function(f){this.editor.trigger("vim",f)}},{key:"dispose",value:function(){this.dispatch("dispose"),this.removeOverlay(),y.keyMap.vim&&y.keyMap.vim.detach(this),this.disposables.forEach(function(f){return f.dispose()})}},{key:"getInputField",value:function(){}},{key:"getWrapperElement",value:function(){}},{key:"enterVimMode",value:function(){this.ctxInsert.set(!1);var f=this.getConfiguration();this.initialCursorWidth=f.viewInfo.cursorWidth||0,this.editor.updateOptions({cursorWidth:f.fontInfo.typicalFullwidthCharacterWidth,cursorBlinking:"solid",cursorStyle:"block"})}},{key:"leaveVimMode",value:function(){this.ctxInsert.set(!0),this.editor.updateOptions({cursorWidth:this.initialCursorWidth||0,cursorBlinking:"blink",cursorStyle:"line"})}},{key:"virtualSelectionMode",value:function(){return this.inVirtualSelectionMode}},{key:"markText",value:function(){return{clear:function(){},find:function(){}}}},{key:"getUserVisibleLines",value:function(){var f=this.editor.getVisibleRanges();if(!f.length)return{top:0,bottom:0};var p={top:1/0,bottom:0};return f.reduce(function(g,S){return S.startLineNumber<g.top&&(g.top=S.startLineNumber),S.endLineNumber>g.bottom&&(g.bottom=S.endLineNumber),g},p),p.top-=1,p.bottom-=1,p}},{key:"findPosV",value:function(f,p,g){var S=this.editor,E=p,W=g,z=ne(f);if(g==="page"){var j=S.getLayoutInfo().height,ee=this.getConfiguration().fontInfo.lineHeight;E=E*Math.floor(j/ee),W="line"}return W==="line"&&(z.lineNumber+=E),de(z)}},{key:"findMatchingBracket",value:function(f){var p=ne(f),g=this.editor.getModel(),S;if(g.bracketPairs)S=g.bracketPairs.matchBracket(p);else{var E;S=(E=g.matchBracket)===null||E===void 0?void 0:E.call(g,p)}return!S||S.length!==2?{to:null}:{to:de(S[1].getStartPosition())}}},{key:"findFirstNonWhiteSpaceCharacter",value:function(f){return this.editor.getModel().getLineFirstNonWhitespaceColumn(f+1)-1}},{key:"scrollTo",value:function(f,p){!f&&!p||f||(p<0&&(p=this.editor.getPosition().lineNumber-p),this.editor.setScrollTop(this.editor.getTopForLineNumber(p+1)))}},{key:"moveCurrentLineTo",value:function(f){var p,g=this.editor,S=g.getPosition(),E=h.Range.fromPositions(S,S);switch(f){case"top":g.revealRangeAtTop(E);return;case"center":g.revealRangeInCenter(E);return;case"bottom":(p=g._revealRange)===null||p===void 0||p.call(g,E,G.Bottom);return}}},{key:"getSearchCursor",value:function(f,p){var g=!1,S=!1;f instanceof RegExp&&!f.global&&(g=!f.ignoreCase,f=f.source,S=!0),p.ch==null&&(p.ch=Number.MAX_VALUE);var E=ne(p),W=this,z=this.editor,j=null,ee=z.getModel(),fe=ee.findMatches(f,!1,S,g)||[];return{getMatches:function(){return fe},findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},jumpTo:function(Ie){if(!fe||!fe.length)return!1;var se=fe[Ie];return j=se.range,W.highlightRanges([j],"currentFindMatch"),W.highlightRanges(fe.map(function(I){return I.range}).filter(function(I){return!I.equalsRange(j)})),j},find:function(Ie){if(!fe||!fe.length)return!1;var se;if(Ie){var I=j?j.getStartPosition():E;if(se=ee.findPreviousMatch(f,I,S,g),!se||!se.range.getStartPosition().isBeforeOrEqual(I))return!1}else{var He=j?ee.getPositionAt(ee.getOffsetAt(j.getEndPosition())+1):E;if(se=ee.findNextMatch(f,He,S,g),!se||!He.isBeforeOrEqual(se.range.getStartPosition()))return!1}return j=se.range,W.highlightRanges([j],"currentFindMatch"),W.highlightRanges(fe.map(function(Ae){return Ae.range}).filter(function(Ae){return!Ae.equalsRange(j)})),j},from:function(){return j&&de(j.getStartPosition())},to:function(){return j&&de(j.getEndPosition())},replace:function(Ie){j&&(z.executeEdits("vim",[{range:j,text:Ie,forceMoveMarkers:!0}],function(se){var I=se[0].range,He=I.endLineNumber,Ae=I.endColumn;j=j.setEndPosition(He,Ae)}),z.setPosition(j.getStartPosition()))}}}},{key:"highlightRanges",value:function(f){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"findMatch",g="decoration".concat(p);return this[g]=this.editor.deltaDecorations(this[g]||[],f.map(function(S){return{range:S,options:{stickiness:h.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,zIndex:13,className:p,showIfCollapsed:!0}}})),this[g]}},{key:"addOverlay",value:function(f,p,g){var S=f.query,E=!1,W=!1;S&&S instanceof RegExp&&!S.global&&(W=!0,E=!S.ignoreCase,S=S.source);var z=this.editor.getModel().findNextMatch(S,this.editor.getPosition(),W,E);!z||!z.range||this.highlightRanges([z.range])}},{key:"removeOverlay",value:function(){var f=this;["currentFindMatch","findMatch"].forEach(function(p){f.editor.deltaDecorations(f["decoration".concat(p)]||[],[])})}},{key:"scrollIntoView",value:function(f){f&&this.editor.revealPosition(ne(f))}},{key:"moveH",value:function(f,p){if(p==="char"){var g=this.editor.getPosition();this.editor.setPosition(new h.Position(g.lineNumber,g.column+f))}}},{key:"scanForBracket",value:function(f,p,g,S){for(var E=S.bracketRegex,W=ne(f),z=this.editor.getModel(),j=(p===-1?z.findPreviousMatch:z.findNextMatch).bind(z),ee=[],fe=0;;){if(fe>10)return;var he=j(E.source,W,!0,!0,null,!0),Ie=he.matches[0];if(he===void 0)return;var se=y.matchingBrackets[Ie];if(se&&se.charAt(1)===">"==p>0)ee.push(Ie);else if(ee.length===0){var I=he.range.getStartPosition();return{pos:de(I)}}else ee.pop();W=z.getPositionAt(z.getOffsetAt(he.range.getStartPosition())+p),fe+=1}}},{key:"indexFromPos",value:function(f){return this.editor.getModel().getOffsetAt(ne(f))}},{key:"posFromIndex",value:function(f){return de(this.editor.getModel().getPositionAt(f))}},{key:"indentLine",value:function(f){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,g=this.editor,S;g._getViewModel?S=g._getViewModel().cursorConfig:S=g._getCursors().context.config;var E=new h.Position(f+1,1),W=h.Selection.fromPositions(E,E);g.executeCommand("vim",new b.ShiftCommand(W,{isUnshift:!p,tabSize:S.tabSize,indentSize:S.indentSize,insertSpaces:S.insertSpaces,useTabStops:S.useTabStops,autoIndent:S.autoIndent}))}},{key:"setStatusBar",value:function(f){this.statusBar=f}},{key:"openDialog",value:function(f,p,g){if(this.statusBar)return this.statusBar.setSec(f,p,g)}},{key:"openNotification",value:function(f){this.statusBar&&this.statusBar.showNotification(f)}},{key:"smartIndent",value:function(){this.editor.getAction("editor.action.formatSelection").run()}},{key:"moveCursorTo",value:function(f){var p=this.editor.getPosition();f==="start"?p.column=1:f==="end"&&(p.column=this.editor.getModel().getLineMaxColumn(p.lineNumber)),this.editor.setPosition(p)}},{key:"execCommand",value:function(f){switch(f){case"goLineLeft":this.moveCursorTo("start");break;case"goLineRight":this.moveCursorTo("end");break;case"indentAuto":this.smartIndent();break}}}])}();X.Pos=Te,X.signal=ce,X.on=Be(),X.off=Be(),X.addClass=Be(),X.rmClass=Be(),X.defineOption=Be(),X.keyMap={default:function(d){return function(f){return!0}}},X.matchingBrackets={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},X.isWordChar=te,X.keyName=nt,X.StringStream=je,X.e_stop=function(y){return y.stopPropagation?y.stopPropagation():y.cancelBubble=!0,X.e_preventDefault(y),!1},X.e_preventDefault=function(y){return y.preventDefault?(y.preventDefault(),y.browserEvent&&y.browserEvent.preventDefault()):y.returnValue=!1,!1},X.commands={redo:function(d){d.editor.getModel().redo()},undo:function(d){d.editor.getModel().undo()},newlineAndIndent:function(d){d.triggerEditorAction("editor.action.insertLineAfter")}},X.lookupKey=function y(d,f,p){typeof f=="string"&&(f=X.keyMap[f]);var g=typeof f=="function"?f(d):f[d];if(g===!1)return"nothing";if(g==="...")return"multi";if(g!=null&&p(g))return"handled";if(f.fallthrough){if(!Array.isArray(f.fallthrough))return y(d,f.fallthrough,p);for(var S=0;S<f.fallthrough.length;S++){var E=y(d,f.fallthrough[S],p);if(E)return E}}},X.defineExtension=function(y,d){X.prototype[y]=d};var qe=function(){var d=this;this.handleKeyDown=function(f){if(!(f.browserEvent.defaultPrevented&f.keyCode!==h.KeyCode.Escape)&&d.attached){var p=nt(f);if(d.replaceMode&&d.handleReplaceMode(p,f),!!p){var g=d.state.keyMap;if(X.keyMap[g]&&X.keyMap[g].call){var S=X.keyMap[g].call(p,d);if(S){f.preventDefault(),f.stopPropagation();try{S()}catch(E){console.error(E)}}}}}},this.handleCursorChange=function(f){var p=f.position;f.source;var g=d.editor,S=g.getSelection();if(!d.ctxInsert.get()&&f.source==="mouse"&&S.isEmpty()){var E=g.getModel().getLineMaxColumn(p.lineNumber);if(f.position.column===E){g.setPosition(new h.Position(f.position.lineNumber,E-1));return}}d.dispatch("cursorActivity",d,f)},this.handleChange=function(f){var p=f.changes,g={text:p.reduce(function(E,W){return E.push(W.text),E},[]),origin:"+input"},S=d.curOp=d.curOp||{};S.changeHandlers||(S.changeHandlers=d.listeners.change&&d.listeners.change.slice()),!d.virtualSelectionMode()&&(S.lastChange?S.lastChange.next=S.lastChange=g:S.lastChange=S.change=g,d.dispatch("change",d,g))}};D.default=X}(wt)),wt}var ir;function dn(){return ir||(ir=1,function(D){Object.defineProperty(D,"__esModule",{value:!0}),D.default=D.Vim=void 0;var h=b(cn());function b(A){return A&&A.__esModule?A:{default:A}}function R(A){"@babel/helpers - typeof";return R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},R(A)}var C=h.default.Pos;function U(A,N){var P=A.state.vim;if(!P||P.insertMode)return N.head;var J=P.sel.head;if(!J)return N.head;if(!(P.visualBlock&&N.head.line!=J.line))return N.from()==N.anchor&&!N.empty()&&N.head.line==J.line&&N.head.ch!=J.ch?new C(N.head.line,N.head.ch-1):N.head}var H=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!0}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:!1}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],F=H.length,K=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"vglobal",shortName:"v"},{name:"global",shortName:"g"}],x=D.Vim=function(){function N(n){n.setOption("disableInput",!0),n.setOption("showCursorWhenSelecting",!1),h.default.signal(n,"vim-mode-change",{mode:"normal"}),n.on("cursorActivity",Xt),se(n),n.enterVimMode()}function P(n){n.setOption("disableInput",!1),n.off("cursorActivity",Xt),n.state.vim=null,lt&&clearTimeout(lt),n.leaveVimMode()}function J(n,e){n.attached=!1,this==h.default.keyMap.vim&&(n.options.$customCursor=null),(!e||e.attach!=O)&&P(n)}function O(n,e){this==h.default.keyMap.vim&&(n.attached=!0,n.curOp&&(n.curOp.selectionChanged=!0),n.options.$customCursor=U),(!e||e.attach!=O)&&N(n)}h.default.defineOption("vimMode",!1,function(n,e,t){e&&n.getOption("keyMap")!="vim"?n.setOption("keyMap","vim"):!e&&t!=h.default.Init&&/^vim/.test(n.getOption("keyMap"))&&n.setOption("keyMap","default")});function G(n,e){if(e){if(this[n])return this[n];var t=te(n);if(!t)return!1;var r=$e.findKey(e,t);return typeof r=="function"&&h.default.signal(e,"vim-keypress",t),r}}var Q={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A",CapsLock:""},me={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"};function te(n){if(n.charAt(0)=="'")return n.charAt(1);if(n==="AltGraph")return!1;var e=n.split(/-(?!$)/),t=e[e.length-1];if(e.length==1&&e[0].length==1)return!1;if(e.length==2&&e[0]=="Shift"&&t.length==1)return!1;for(var r=!1,i=0;i<e.length;i++){var o=e[i];o in Q?e[i]=Q[o]:r=!0,o in me&&(e[i]=me[o])}return r?(p(t)&&(e[e.length-1]=t.toLowerCase()),"<"+e.join("-")+">"):!1}var Te=/[\d]/,ce=[h.default.isWordChar,function(n){return n&&!h.default.isWordChar(n)&&!/\s/.test(n)}],Be=[function(n){return/\S/.test(n)}];function je(n,e){for(var t=[],r=n;r<n+e;r++)t.push(String.fromCharCode(r));return t}var de=je(65,26),ne=je(97,26),rt=je(48,10),nt=[].concat(de,ne,rt,["<",">"]),X=[].concat(de,ne,rt,["-",'"',".",":","_","/"]),qe;try{qe=new RegExp("^[\\p{Lu}]$","u")}catch{qe=/^[A-Z]$/}function y(n,e){return e>=n.firstLine()&&e<=n.lastLine()}function d(n){return/^[a-z]$/.test(n)}function f(n){return Te.test(n)}function p(n){return qe.test(n)}function g(n){return/^\s*$/.test(n)}function S(n){return".?!".indexOf(n)!=-1}function E(n,e){for(var t=0;t<e.length;t++)if(e[t]==n)return!0;return!1}var W={};function z(n,e,t,r,i){if(e===void 0&&!i)throw Error("defaultValue is required unless callback is provided");if(t||(t="string"),W[n]={type:t,defaultValue:e,callback:i},r)for(var o=0;o<r.length;o++)W[r[o]]=W[n];e&&j(n,e)}function j(n,e,t,r){var i=W[n];r=r||{};var o=r.scope;if(!i)return new Error("Unknown option: "+n);if(i.type=="boolean"){if(e&&e!==!0)return new Error("Invalid argument: "+n+"="+e);e!==!1&&(e=!0)}i.callback?(o!=="local"&&i.callback(e,void 0),o!=="global"&&t&&i.callback(e,t)):(o!=="local"&&(i.value=i.type=="boolean"?!!e:e),o!=="global"&&t&&(t.state.vim.options[n]={value:e}))}function ee(n,e,t){var r=W[n];t=t||{};var i=t.scope;if(!r)return new Error("Unknown option: "+n);if(r.callback){var o=e&&r.callback(void 0,e);return i!=="global"&&o!==void 0?o:i!=="local"?r.callback():void 0}else{var o=i!=="global"&&e&&e.state.vim.options[n];return(o||i!=="local"&&r||{}).value}}z("filetype",void 0,"string",["ft"],function(n,e){if(e!==void 0)if(n===void 0){var t=e.getOption("mode");return t=="null"?"":t}else{var t=n==""?"null":n;e.setOption("mode",t)}});var fe=function(){var e=100,t=-1,r=0,i=0,o=new Array(e);function a(u,c,v){var w=t%e,k=o[w];function m(T){var M=++t%e,V=o[M];V&&V.clear(),o[M]=u.setBookmark(T)}if(k){var L=k.find();L&&!xe(L,c)&&m(c)}else m(c);m(v),r=t,i=t-e+1,i<0&&(i=0)}function s(u,c){t+=c,t>r?t=r:t<i&&(t=i);var v=o[(e+t)%e];if(v&&!v.find()){var w=c>0?1:-1,k,m=u.getCursor();do if(t+=w,v=o[(e+t)%e],v&&(k=v.find())&&!xe(m,k))break;while(t<r&&t>i)}return v}function l(u,c){var v=t,w=s(u,c);return t=v,w&&w.find()}return{cachedCursor:void 0,add:a,find:l,move:s}},he=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};function Ie(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=he()}Ie.prototype={exitMacroRecordMode:function(){var e=I.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var r=I.registerController.getRegister(t);r&&(r.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog(document.createTextNode("(recording)["+t+"]"),null,{bottom:!0})),this.isRecording=!0)}};function se(n){return n.state.vim||(n.state.vim={inputState:new it,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),n.state.vim}var I;function He(){I={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:fe(),macroModeState:new Ie,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new xt({}),searchHistoryController:new ut,exCommandHistoryController:new ut};for(var n in W){var e=W[n];e.value=e.defaultValue}}var Ae,$e={buildKeyMap:function(){},getRegisterController:function(){return I.registerController},resetVimGlobalState_:He,getVimGlobalState_:function(){return I},maybeInitVimState_:se,suppressErrorLogging:!1,InsertModeKey:gt,map:function(e,t,r){_e.map(e,t,r)},unmap:function(e,t){return _e.unmap(e,t)},noremap:function(e,t,r){function i(k){return k?[k]:["normal","insert","visual"]}for(var o=i(r),a=H.length,s=F,l=a-s;l<a&&o.length;l++){var u=H[l];if(u.keys==t&&(!r||!u.context||u.context===r)&&u.type.substr(0,2)!=="ex"&&u.type.substr(0,3)!=="key"){var c={};for(var v in u)c[v]=u[v];c.keys=e,r&&!c.context&&(c.context=r),this._mapCommand(c);var w=i(u.context);o=o.filter(function(k){return w.indexOf(k)===-1})}}},mapclear:function(e){var t=H.length,r=F,i=H.slice(0,t-r);if(H=H.slice(t-r),e)for(var o=i.length-1;o>=0;o--){var a=i[o];if(e!==a.context)if(a.context)this._mapCommand(a);else{var s=["normal","insert","visual"];for(var l in s)if(s[l]!==e){var u={};for(var c in a)u[c]=a[c];u.context=s[l],this._mapCommand(u)}}}},setOption:j,getOption:ee,defineOption:z,defineEx:function(e,t,r){if(!t)t=e;else if(e.indexOf(t)!==0)throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered');Qt[e]=r,_e.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,r){var i=this.findKey(e,t,r);if(typeof i=="function")return i()},findKey:function(e,t,r){var i=se(e);function o(){var v=I.macroModeState;if(v.isRecording){if(t=="q")return v.exitMacroRecordMode(),be(e),!0;r!="mapping"&&Qr(v,t)}}function a(){if(t=="<Esc>"){if(i.visualMode)Pe(e);else if(i.insertMode)Xe(e);else return;return be(e),!0}}function s(v){for(var w;v;)w=/<\w+-.+?>|<\w+>|./.exec(v),t=w[0],v=v.substring(w.index+t.length),$e.handleKey(e,t,"mapping")}function l(){if(a())return!0;for(var v=i.inputState.keyBuffer=i.inputState.keyBuffer+t,w=t.length==1,k=De.matchCommand(v,H,i.inputState,"insert");v.length>1&&k.type!="full";){var v=i.inputState.keyBuffer=v.slice(1),m=De.matchCommand(v,H,i.inputState,"insert");m.type!="none"&&(k=m)}if(k.type=="none")return be(e),!1;if(k.type=="partial")return Ae&&window.clearTimeout(Ae),Ae=window.setTimeout(function(){i.insertMode&&i.inputState.keyBuffer&&be(e)},ee("insertModeEscKeysTimeout")),!w;if(Ae&&window.clearTimeout(Ae),w){for(var L=e.listSelections(),T=0;T<L.length;T++){var M=L[T].head;e.replaceRange("",Ce(M,0,-(v.length-1)),M,"+input")}I.macroModeState.lastInsertModeChanges.changes.pop()}return be(e),k.command}function u(){if(o()||a())return!0;var v=i.inputState.keyBuffer=i.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(v))return!0;var L=/^(\d*)(.*)$/.exec(v);if(!L)return be(e),!1;var w=i.visualMode?"visual":"normal",k=L[2]||L[1];i.inputState.operatorShortcut&&i.inputState.operatorShortcut.slice(-1)==k&&(k=i.inputState.operatorShortcut);var m=De.matchCommand(k,H,i.inputState,w);if(m.type=="none")return be(e),!1;if(m.type=="partial")return!0;i.inputState.keyBuffer="";var L=/^(\d*)(.*)$/.exec(v);return L[1]&&L[1]!="0"&&i.inputState.pushRepeatDigit(L[1]),m.command}var c;return i.insertMode?c=l():c=u(),c===!1?!i.insertMode&&t.length===1?function(){return!0}:void 0:c===!0?function(){return!0}:function(){return e.operation(function(){e.curOp.isVimOp=!0;try{c.type=="keyToKey"?s(c.toKeys):De.processCommand(e,i,c)}catch(v){throw e.state.vim=void 0,se(e),$e.suppressErrorLogging||console.log(v),v}return!0})}},handleEx:function(e,t){_e.processCommand(e,t)},defineMotion:fr,defineAction:dr,defineOperator:cr,mapCommand:zr,_mapCommand:qt,defineRegister:ur,exitVisualMode:Pe,exitInsertMode:Xe};function it(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}it.prototype.pushRepeatDigit=function(n){this.operator?this.motionRepeat=this.motionRepeat.concat(n):this.prefixRepeat=this.prefixRepeat.concat(n)},it.prototype.getRepeat=function(){var n=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(n=1,this.prefixRepeat.length>0&&(n*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(n*=parseInt(this.motionRepeat.join(""),10))),n};function be(n,e){n.state.vim.inputState=new it,h.default.signal(n,"vim-command-done",e)}function Re(n,e,t){this.clear(),this.keyBuffer=[n||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!e,this.blockwise=!!t}Re.prototype={setText:function(e,t,r){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!r},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push(`
`),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(he(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};function ur(n,e){var t=I.registerController.registers;if(!n||n.length!=1)throw Error("Register name must be 1 character");if(t[n])throw Error("Register already defined "+n);t[n]=e,X.push(n)}function xt(n){this.registers=n,this.unnamedRegister=n['"']=new Re,n["."]=new Re,n[":"]=new Re,n["/"]=new Re}xt.prototype={pushText:function(e,t,r,i,o){if(e!=="_"){i&&r.charAt(r.length-1)!==`
`&&(r+=`
`);var a=this.isValidRegister(e)?this.getRegister(e):null;if(!a){switch(t){case"yank":this.registers[0]=new Re(r,i,o);break;case"delete":case"change":r.indexOf(`
`)==-1?this.registers["-"]=new Re(r,i):(this.shiftNumericRegisters_(),this.registers[1]=new Re(r,i));break}this.unnamedRegister.setText(r,i,o);return}var s=p(e);s?a.pushText(r,i):a.setText(r,i,o),this.unnamedRegister.setText(a.toString(),i)}},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new Re),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&E(e,X)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}};function ut(){this.historyBuffer=[],this.iterator=0,this.initialPrefix=null}ut.prototype={nextMatch:function(e,t){var r=this.historyBuffer,i=t?-1:1;this.initialPrefix===null&&(this.initialPrefix=e);for(var o=this.iterator+i;t?o>=0:o<r.length;o+=i)for(var a=r[o],s=0;s<=a.length;s++)if(this.initialPrefix==a.substring(0,s))return this.iterator=o,a;if(o>=r.length)return this.iterator=r.length,this.initialPrefix;if(o<0)return e},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var De={matchCommand:function(e,t,r,i){var o=hr(e,t,i,r);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial"};for(var a,s=0;s<o.full.length;s++){var l=o.full[s];a||(a=l)}if(a.keys.slice(-11)=="<character>"){var u=vr(e);if(!u)return{type:"none"};r.selectedCharacter=u}return{type:"full",command:a}},processCommand:function(e,t,r){switch(t.inputState.repeatOverride=r.repeatOverride,r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break}},processMotion:function(e,t,r){t.inputState.motion=r.motion,t.inputState.motionArgs=ot(r.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,r){var i=t.inputState;if(i.operator)if(i.operator==r.operator){i.motion="expandToLine",i.motionArgs={linewise:!0},this.evalInput(e,t);return}else be(e);i.operator=r.operator,i.operatorArgs=ot(r.operatorArgs),r.keys.length>1&&(i.operatorShortcut=r.keys),r.exitVisualBlock&&(t.visualBlock=!1,ze(e)),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,r){var i=t.visualMode,o=ot(r.operatorMotionArgs);o&&i&&o.visualLine&&(t.visualLine=!0),this.processOperator(e,t,r),i||this.processMotion(e,t,r)},processAction:function(e,t,r){var i=t.inputState,o=i.getRepeat(),a=!!o,s=ot(r.actionArgs)||{};i.selectedCharacter&&(s.selectedCharacter=i.selectedCharacter),r.operator&&this.processOperator(e,t,r),r.motion&&this.processMotion(e,t,r),(r.motion||r.operator)&&this.evalInput(e,t),s.repeat=o||1,s.repeatIsExplicit=a,s.registerName=i.registerName,be(e),t.lastMotion=null,r.isEdit&&this.recordLastEdit(t,i,r),ft[r.action](e,s,t)},processSearch:function(e,t,r){if(!e.getSearchCursor)return;var i=r.searchArgs.forward,o=r.searchArgs.wholeWordOnly;Oe(e).setReversed(!i);var a=i?"/":"?",s=Oe(e).getQuery(),l=e.getScrollInfo();function u(M,V,_){I.searchHistoryController.pushInput(M),I.searchHistoryController.reset();try{Ge(e,M,V,_)}catch{Y(e,"Invalid regex: "+M),be(e);return}De.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:r.searchArgs.toJumplist}})}function c(M){e.scrollTo(l.left,l.top),u(M,!0,!0);var V=I.macroModeState;V.isRecording&&Gr(V,M)}function v(M,V,_){var B=h.default.keyName(M),Z,ke;B=="Up"||B=="Down"?(Z=B=="Up",ke=M.target?M.target.selectionEnd:0,V=I.searchHistoryController.nextMatch(V,Z)||"",_(V),ke&&M.target&&(M.target.selectionEnd=M.target.selectionStart=Math.min(ke,M.target.value.length))):B!="Left"&&B!="Right"&&B!="Ctrl"&&B!="Alt"&&B!="Shift"&&I.searchHistoryController.reset();var ie;try{ie=Ge(e,V,!0,!0)}catch{}ie?e.scrollIntoView(jt(e,!i,ie),30):(pt(e),e.scrollTo(l.left,l.top))}function w(M,V,_){var B=h.default.keyName(M);B=="Esc"||B=="Ctrl-C"||B=="Ctrl-["||B=="Backspace"&&V==""?(I.searchHistoryController.pushInput(V),I.searchHistoryController.reset(),Ge(e,s),pt(e),e.scrollTo(l.left,l.top),h.default.e_stop(M),be(e),_(),e.focus()):B=="Up"||B=="Down"?h.default.e_stop(M):B=="Ctrl-U"&&(h.default.e_stop(M),_(""))}switch(r.searchArgs.querySrc){case"prompt":var k=I.macroModeState;if(k.isPlaying){var T=k.replaySearchQueries.shift();u(T,!0,!1)}else st(e,{onClose:c,prefix:a,desc:"(JavaScript regexp)",onKeyUp:v,onKeyDown:w});break;case"wordUnderCursor":var m=at(e,!1,!0,!1,!0),L=!0;if(m||(m=at(e,!1,!0,!1,!1),L=!1),!m)return;var T=e.getLine(m.start.line).substring(m.start.ch,m.end.ch);L&&o?T="\\b"+T+"\\b":T=gr(T),I.jumpList.cachedCursor=e.getCursor(),e.setCursor(m.start),u(T,!0,!1);break}},processEx:function(e,t,r){function i(a){I.exCommandHistoryController.pushInput(a),I.exCommandHistoryController.reset(),_e.processCommand(e,a)}function o(a,s,l){var u=h.default.keyName(a),c,v;(u=="Esc"||u=="Ctrl-C"||u=="Ctrl-["||u=="Backspace"&&s=="")&&(I.exCommandHistoryController.pushInput(s),I.exCommandHistoryController.reset(),h.default.e_stop(a),be(e),l(),e.focus()),u=="Up"||u=="Down"?(h.default.e_stop(a),c=u=="Up",v=a.target?a.target.selectionEnd:0,s=I.exCommandHistoryController.nextMatch(s,c)||"",l(s),v&&a.target&&(a.target.selectionEnd=a.target.selectionStart=Math.min(v,a.target.value.length))):u=="Ctrl-U"?(h.default.e_stop(a),l("")):u!="Left"&&u!="Right"&&u!="Ctrl"&&u!="Alt"&&u!="Shift"&&I.exCommandHistoryController.reset()}r.type=="keyToEx"?_e.processCommand(e,r.exArgs.input):t.visualMode?st(e,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:o,selectValueOnOpen:!1}):st(e,{onClose:i,prefix:":",onKeyDown:o})},evalInput:function(e,t){var r=t.inputState,i=r.motion,o=r.motionArgs||{},a=r.operator,s=r.operatorArgs||{},l=r.registerName,u=t.sel,c=re(t.visualMode?Me(e,u.head):e.getCursor("head")),v=re(t.visualMode?Me(e,u.anchor):e.getCursor("anchor")),w=re(c),k=re(v),m,L,T;if(a&&this.recordLastEdit(t,r),r.repeatOverride!==void 0?T=r.repeatOverride:T=r.getRepeat(),T>0&&o.explicitRepeat?o.repeatIsExplicit=!0:(o.noRepeat||!o.explicitRepeat&&T===0)&&(T=1,o.repeatIsExplicit=!1),r.selectedCharacter&&(o.selectedCharacter=s.selectedCharacter=r.selectedCharacter),o.repeat=T,be(e),i){var M=Ne[i](e,c,o,t,r);if(t.lastMotion=Ne[i],!M)return;if(o.toJumplist){var V=I.jumpList,_=V.cachedCursor;_?(Ot(e,_,M),delete V.cachedCursor):Ot(e,c,M)}M instanceof Array?(L=M[0],m=M[1]):m=M,m||(m=re(c)),t.visualMode?(t.visualBlock&&m.ch===1/0||(m=Me(e,m)),L&&(L=Me(e,L)),L=L||k,u.anchor=L,u.head=m,ze(e),Ke(e,t,"<",oe(L,m)?L:m),Ke(e,t,">",oe(L,m)?m:L)):a||(m=Me(e,m),e.setCursor(m.line,m.ch))}if(a){if(s.lastSel){L=k;var B=s.lastSel,Z=Math.abs(B.head.line-B.anchor.line),ke=Math.abs(B.head.ch-B.anchor.ch);B.visualLine?m=new C(k.line+Z,k.ch):B.visualBlock?m=new C(k.line+Z,k.ch+ke):B.head.line==B.anchor.line?m=new C(k.line,k.ch+ke):m=new C(k.line+Z,k.ch),t.visualMode=!0,t.visualLine=B.visualLine,t.visualBlock=B.visualBlock,u=t.sel={anchor:L,head:m},ze(e)}else t.visualMode&&(s.lastSel={anchor:re(u.anchor),head:re(u.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var ie,pe,q,$,ue;if(t.visualMode){if(ie=Le(u.head,u.anchor),pe=We(u.head,u.anchor),q=t.visualLine||s.linewise,$=t.visualBlock?"block":q?"line":"char",ue=dt(e,{anchor:ie,head:pe},$),q){var we=ue.ranges;if($=="block")for(var ve=0;ve<we.length;ve++)we[ve].head.ch=le(e,we[ve].head.line);else $=="line"&&(we[0].head=new C(we[0].head.line+1,0))}}else{if(ie=re(L||k),pe=re(m||w),oe(pe,ie)){var Ve=ie;ie=pe,pe=Ve}q=o.linewise||s.linewise,q?br(e,ie,pe):o.forward&&Sr(e,ie,pe),$="char";var Ye=!o.inclusive||q;ue=dt(e,{anchor:ie,head:pe},$,Ye)}e.setSelections(ue.ranges,ue.primary),t.lastMotion=null,s.repeat=T,s.registerName=l,s.linewise=q;var Ze=Tt[a](e,s,ue.ranges,k,m);t.visualMode&&Pe(e,Ze!=null),Ze&&e.setCursor(Ze)}},recordLastEdit:function(e,t,r){var i=I.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=r,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1,i.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0)}},Ne={moveToTopLine:function(e,t,r){var i=vt(e).top+r.repeat-1;return new C(i,Ee(e.getLine(i)))},moveToMiddleLine:function(e){var t=vt(e),r=Math.floor((t.top+t.bottom)*.5);return new C(r,Ee(e.getLine(r)))},moveToBottomLine:function(e,t,r){var i=vt(e).bottom-r.repeat+1;return new C(i,Ee(e.getLine(i)))},expandToLine:function(e,t,r){var i=t;return new C(i.line+r.repeat-1,1/0)},findNext:function(e,t,r){var i=Oe(e),o=i.getQuery();if(o){var a=!r.forward;return a=i.isReversed()?!a:a,Ut(e,o),jt(e,a,o,r.repeat)}},findAndSelectNextInclusive:function(e,t,r,i,o){var a=Oe(e),s=a.getQuery();if(s){var l=!r.forward;l=a.isReversed()?!l:l;var u=Ur(e,l,s,r.repeat,i);if(u){if(o.operator)return u;var c=u[0],v=new C(u[1].line,u[1].ch-1);if(i.visualMode){(i.visualLine||i.visualBlock)&&(i.visualLine=!1,i.visualBlock=!1,h.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""}));var w=i.sel.anchor;if(w)return a.isReversed()?r.forward?[w,c]:[w,v]:r.forward?[w,v]:[w,c]}else i.visualMode=!0,i.visualLine=!1,i.visualBlock=!1,h.default.signal(e,"vim-mode-change",{mode:"visual",subMode:""});return l?[v,c]:[c,v]}}},goToMark:function(e,t,r,i){var o=$t(e,i,r.selectedCharacter);return o?r.linewise?{line:o.line,ch:Ee(e.getLine(o.line))}:o:null},moveToOtherHighlightedEnd:function(e,t,r,i){if(i.visualBlock&&r.sameLine){var o=i.sel;return[Me(e,new C(o.anchor.line,o.head.ch)),Me(e,new C(o.head.line,o.anchor.ch))]}else return[i.sel.head,i.sel.anchor]},jumpToMark:function(e,t,r,i){for(var o=t,a=0;a<r.repeat;a++){var s=o;for(var l in i.marks)if(d(l)){var u=i.marks[l].find(),c=r.forward?oe(u,s):oe(s,u);if(!c&&!(r.linewise&&u.line==s.line)){var v=xe(s,o),w=r.forward?At(s,u,o):At(o,u,s);(v||w)&&(o=u)}}}return r.linewise&&(o=new C(o.line,Ee(e.getLine(o.line)))),o},moveByCharacters:function(e,t,r){var i=t,o=r.repeat,a=r.forward?i.ch+o:i.ch-o;return new C(i.line,a)},moveByLines:function(e,t,r,i){var o=t,a=o.ch;switch(i.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=i.lastHPos;break;default:i.lastHPos=a}var s=r.repeat+(r.repeatOffset||0),l=r.forward?o.line+s:o.line-s,u=e.firstLine(),c=e.lastLine(),v=e.findPosV(o,r.forward?s:-s,"line",i.lastHSPos),w=r.forward?v.line>l:v.line<l;return w&&(l=v.line,a=v.ch),l<u&&o.line==u?this.moveToStartOfLine(e,t,r,i):l>c&&o.line==c?Nt(e,t,r,i,!0):(r.toFirstChar&&(a=Ee(e.getLine(l)),i.lastHPos=a),i.lastHSPos=e.charCoords(new C(l,a),"div").left,new C(l,a))},moveByDisplayLines:function(e,t,r,i){var o=t;switch(i.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:i.lastHSPos=e.charCoords(o,"div").left}var a=r.repeat,s=e.findPosV(o,r.forward?a:-a,"line",i.lastHSPos);if(s.hitSide)if(r.forward)var l=e.charCoords(s,"div"),u={top:l.top+8,left:i.lastHSPos},s=e.coordsChar(u,"div");else{var c=e.charCoords(new C(e.firstLine(),0),"div");c.left=i.lastHSPos,s=e.coordsChar(c,"div")}return i.lastHPos=s.ch,s},moveByPage:function(e,t,r){var i=t,o=r.repeat;return e.findPosV(i,r.forward?o:-o,"page")},moveByParagraph:function(e,t,r){var i=r.forward?1:-1;return Kt(e,t,r.repeat,i)},moveBySentence:function(e,t,r){var i=r.forward?1:-1;return Pr(e,t,r.repeat,i)},moveByScroll:function(e,t,r,i){var o=e.getScrollInfo(),l=null,a=r.repeat;a||(a=o.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");r.repeat=a;var l=Ne.moveByDisplayLines(e,t,r,i);if(!l)return null;var u=e.charCoords(l,"local");return e.scrollTo(null,o.top+u.top-s.top),l},moveByWords:function(e,t,r){return Ir(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var i=r.repeat,o=ht(e,i,r.forward,r.selectedCharacter),a=r.forward?-1:1;return _t(a,r),o?(o.ch+=a,o):null},moveToCharacter:function(e,t,r){var i=r.repeat;return _t(0,r),ht(e,i,r.forward,r.selectedCharacter)||t},moveToSymbol:function(e,t,r){var i=r.repeat;return Lr(e,i,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,i){var o=r.repeat;return i.lastHPos=o-1,i.lastHSPos=e.charCoords(t,"div").left,Ar(e,o)},moveToEol:function(e,t,r,i){return Nt(e,t,r,i,!1)},moveToFirstNonWhiteSpaceCharacter:function(e,t){var r=t;return new C(r.line,Ee(e.getLine(r.line)))},moveToMatchedSymbol:function(e,t){var r=t,i=r.line,o=r.ch,a=e.getLine(i);if(o<a.length){var s=o==="<"||o===">"?/[(){}[\]<>]/:/[(){}[\]]/,l=e.findMatchingBracket(new C(i,o),{bracketRegex:s});return l.to}else return r},moveToStartOfLine:function(e,t){return new C(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,r){var i=r.forward?e.lastLine():e.firstLine();return r.repeatIsExplicit&&(i=r.repeat-e.getOption("firstLineNumber")),new C(i,Ee(e.getLine(i)))},moveToStartOfDisplayLine:function(e){return e.execCommand("goLineLeft"),e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();return t.sticky=="before"&&t.ch--,t},textObjectManipulation:function(e,t,r,i){var o={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"},a={"'":!0,'"':!0,"`":!0},s=r.selectedCharacter;s=="b"?s="(":s=="B"&&(s="{");var l=!r.textObjectInner,u;if(o[s])u=Er(e,t,s,l);else if(a[s])u=Or(e,t,s,l);else if(s==="W")u=at(e,l,!0,!0);else if(s==="w")u=at(e,l,!0,!1);else if(s==="p")if(u=Kt(e,t,r.repeat,0,l),r.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var c=i.inputState.operatorArgs;c&&(c.linewise=!0),u.end.line--}else if(s==="t")u=Mr(e,t,l);else return null;return e.state.vim.visualMode?kr(e,u.start,u.end):[u.start,u.end]},repeatLastCharacterSearch:function(e,t,r){var i=I.lastCharacterSearch,o=r.repeat,a=r.forward===i.forward,s=(i.increment?1:0)*(a?-1:1);e.moveH(-s,"char"),r.inclusive=!!a;var l=ht(e,o,a,i.selectedCharacter);return l?(l.ch+=s,l):(e.moveH(s,"char"),t)}};function fr(n,e){Ne[n]=e}function Lt(n,e){for(var t=[],r=0;r<e;r++)t.push(n);return t}var Tt={change:function(e,t,r){var i,o,a=e.state.vim,s=r[0].anchor,l=r[0].head;if(a.visualMode)if(t.fullLine)l.ch=Number.MAX_VALUE,l.line--,e.setSelection(s,l),o=e.getSelection(),e.replaceSelections(""),i=s;else{o=e.getSelection();var k=Lt("",r.length);e.replaceSelections(k),i=Le(r[0].head,r[0].anchor)}else{o=e.getRange(s,l);var u=a.lastEditInputState||{};if(u.motion=="moveByWords"&&!g(o)){var c=/\s+$/.exec(o);c&&u.motionArgs&&u.motionArgs.forward&&(l=Ce(l,0,-c[0].length),o=o.slice(0,-c[0].length))}var v=new C(s.line-1,Number.MAX_VALUE),w=e.firstLine()==e.lastLine();l.line>e.lastLine()&&t.linewise&&!w?e.replaceRange("",v,l):e.replaceRange("",s,l),t.linewise&&(w||(e.setCursor(v),h.default.commands.newlineAndIndent(e)),s.ch=Number.MAX_VALUE),i=s}I.registerController.pushText(t.registerName,"change",o,t.linewise,r.length>1),ft.enterInsertMode(e,{head:i},e.state.vim)},delete:function(e,t,r){e.pushUndoStop();var i,o,a=e.state.vim;if(a.visualBlock){o=e.getSelection();var u=Lt("",r.length);e.replaceSelections(u),i=Le(r[0].head,r[0].anchor)}else{var s=r[0].anchor,l=r[0].head;t.linewise&&l.line!=e.firstLine()&&s.line==e.lastLine()&&s.line==l.line-1&&(s.line==e.firstLine()?s.ch=0:s=new C(s.line-1,le(e,s.line-1))),o=e.getRange(s,l),e.replaceRange("",s,l),i=s,t.linewise&&(i=Ne.moveToFirstNonWhiteSpaceCharacter(e,s))}return I.registerController.pushText(t.registerName,"delete",o,t.linewise,a.visualBlock),Me(e,i)},indent:function(e,t,r){var i=e.state.vim,o=r[0].anchor.line,a=i.visualBlock?r[r.length-1].anchor.line:r[0].head.line,s=i.visualMode?t.repeat:1;t.linewise&&a--,e.pushUndoStop();for(var l=o;l<=a;l++)for(var u=0;u<s;u++)e.indentLine(l,t.indentRight);return e.pushUndoStop(),Ne.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){return e.execCommand("indentAuto"),Ne.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},changeCase:function(e,t,r,i,o){for(var a=e.getSelections(),s=[],l=t.toLower,u=0;u<a.length;u++){var c=a[u],v="";if(l===!0)v=c.toLowerCase();else if(l===!1)v=c.toUpperCase();else for(var w=0;w<c.length;w++){var k=c.charAt(w);v+=p(k)?k.toLowerCase():k.toUpperCase()}s.push(v)}return e.replaceSelections(s),t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?Ne.moveToFirstNonWhiteSpaceCharacter(e,i):t.linewise?i:Le(r[0].anchor,r[0].head)},yank:function(e,t,r,i){var o=e.state.vim,a=e.getSelection(),s=o.visualMode?Le(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):i;return I.registerController.pushText(t.registerName,"yank",a,t.linewise,o.visualBlock),s}};function cr(n,e){Tt[n]=e}var ft={jumpListWalk:function(e,t,r){if(!r.visualMode){var i=t.repeat,o=t.forward,a=I.jumpList,s=a.move(e,o?i:-i),l=s?s.find():void 0;l=l||e.getCursor(),e.setCursor(l)}},scroll:function(e,t,r){if(!r.visualMode){var i=t.repeat||1,o=e.defaultTextHeight(),a=e.getScrollInfo().top,s=o*i,l=t.forward?a+s:a-s,u=re(e.getCursor()),c=e.charCoords(u,"local");if(t.forward)l>c.top?(u.line+=(l-c.top)/o,u.line=Math.ceil(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.top)):e.scrollTo(null,l);else{var v=l+e.getScrollInfo().clientHeight;v<c.bottom?(u.line-=(c.bottom-v)/o,u.line=Math.floor(u.line),e.setCursor(u),c=e.charCoords(u,"local"),e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,l)}}},scrollToCursor:function(e,t){var r=e.getCursor().line,i=e.charCoords(new C(r,0),"local"),o=e.getScrollInfo().clientHeight,a=i.top,s=i.bottom-a;switch(t.position){case"center":a=a-o/2+s;break;case"bottom":a=a-o+s;break}e.moveCurrentLineTo(a)},replayMacro:function(e,t,r){var i=t.selectedCharacter,o=t.repeat,a=I.macroModeState;for(i=="@"?i=a.latestRegister:a.latestRegister=i;o--;)Jr(e,r,a,i)},enterMacroRecordMode:function(e,t){var r=I.macroModeState,i=t.selectedCharacter;I.registerController.isValidRegister(i)&&r.enterMacroRecordMode(e,i)},toggleOverwrite:function(e){e.state.overwrite?(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),h.default.signal(e,"vim-mode-change",{mode:"insert"})):(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),h.default.signal(e,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0,r.insertModeRepeat=t&&t.repeat||1;var i=t?t.insertAt:null,o=r.sel,a=t.head||e.getCursor("head"),s=e.listSelections().length;if(i=="eol")a=new C(a.line,le(e,a.line));else if(i=="bol")a=new C(a.line,0);else if(i=="charAfter")a=Ce(a,0,1);else if(i=="firstNonBlank")a=Ne.moveToFirstNonWhiteSpaceCharacter(e,a);else if(i=="startOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new C(Math.min(o.head.line,o.anchor.line),Math.min(o.head.ch,o.anchor.ch)),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line<o.anchor.line?a=o.head:a=new C(o.anchor.line,0)}else if(i=="endOfSelectedArea"){if(!r.visualMode)return;r.visualBlock?(a=new C(Math.min(o.head.line,o.anchor.line),Math.max(o.head.ch,o.anchor.ch)+1),s=Math.abs(o.head.line-o.anchor.line)+1):o.head.line>=o.anchor.line?a=Ce(o.head,0,1):a=new C(o.anchor.line,0)}else if(i=="inplace"){if(r.visualMode)return}else i=="lastEdit"&&(a=zt(e)||a);e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),h.default.signal(e,"vim-mode-change",{mode:"replace"})):(e.toggleOverwrite(!1),e.setOption("keyMap","vim-insert"),h.default.signal(e,"vim-mode-change",{mode:"insert"})),I.macroModeState.isPlaying||(e.on("change",Gt),h.default.on(e.getInputField(),"keydown",Yt)),r.visualMode&&Pe(e),Pt(e,a,s)}},toggleVisualMode:function(e,t,r){var i=t.repeat,o=e.getCursor(),a;r.visualMode?r.visualLine^t.linewise||r.visualBlock^t.blockwise?(r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,h.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),ze(e)):Pe(e):(r.visualMode=!0,r.visualLine=!!t.linewise,r.visualBlock=!!t.blockwise,a=Me(e,new C(o.line,o.ch+i-1)),r.sel={anchor:o,head:a},h.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""}),ze(e),Ke(e,r,"<",Le(o,a)),Ke(e,r,">",We(o,a)))},reselectLastSelection:function(e,t,r){var i=r.lastSelection;if(r.visualMode&&Et(e,r),i){var o=i.anchorMark.find(),a=i.headMark.find();if(!o||!a)return;r.sel={anchor:o,head:a},r.visualMode=!0,r.visualLine=i.visualLine,r.visualBlock=i.visualBlock,ze(e),Ke(e,r,"<",Le(o,a)),Ke(e,r,">",We(o,a)),h.default.signal(e,"vim-mode-change",{mode:"visual",subMode:r.visualLine?"linewise":r.visualBlock?"blockwise":""})}},joinLines:function(e,t,r){var i,o;if(r.visualMode){if(i=e.getCursor("anchor"),o=e.getCursor("head"),oe(o,i)){var a=o;o=i,i=a}o.ch=le(e,o.line)-1}else{var s=Math.max(t.repeat,2);i=e.getCursor(),o=Me(e,new C(i.line+s-1,1/0))}for(var l=0,u=i.line;u<o.line;u++){l=le(e,i.line);var a=new C(i.line+1,le(e,i.line+1)),c=e.getRange(i,a);c=t.keepSpaces?c.replace(/\n\r?/g,""):c.replace(/\n\s*/g," "),e.replaceRange(c,i,a)}var v=new C(i.line,l);r.visualMode&&Pe(e,!1),e.setCursor(v)},newLineAndEnterInsertMode:function(e,t,r){if(!e.getOption("readOnly")){r.insertMode=!0;var i=re(e.getCursor());if(i.line===e.firstLine()&&!t.after)e.replaceRange(`
`,new C(e.firstLine(),0)),e.setCursor(e.firstLine(),0);else{i.line=t.after?i.line:i.line-1,i.ch=le(e,i.line),e.setCursor(i);var o=h.default.commands.newlineAndIndentContinueComment||h.default.commands.newlineAndIndent;o(e)}this.enterInsertMode(e,{repeat:t.repeat},r)}},paste:function(e,t,r){var i=re(e.getCursor()),o=I.registerController.getRegister(t.registerName),a=o.toString();if(a){if(t.matchIndent){var s=e.getOption("tabSize"),l=function(Ve){var Ye=Ve.split("	").length-1,Ze=Ve.split(" ").length-1;return Ye*s+Ze*1},u=e.getLine(e.getCursor().line),c=l(u.match(/^\s*/)[0]),v=a.replace(/\n$/,""),w=a!==v,k=l(a.match(/^\s*/)[0]),a=v.replace(/^\s*/gm,function(ve){var Ve=c+(l(ve)-k);if(Ve<0)return"";if(e.getOption("indentWithTabs")){var Ye=Math.floor(Ve/s);return Array(Ye+1).join("	")}else return Array(Ve+1).join(" ")});a+=w?`
`:""}if(t.repeat>1)var a=Array(t.repeat+1).join(a);var m=o.linewise,L=o.blockwise;if(L){a=a.split(`
`),m&&a.pop();for(var T=0;T<a.length;T++)a[T]=a[T]==""?" ":a[T];i.ch+=t.after?1:0,i.ch=Math.min(le(e,i.line),i.ch)}else m?r.visualMode?a=r.visualLine?a.slice(0,-1):`
`+a.slice(0,a.length-1)+`
`:t.after?(a=`
`+a.slice(0,a.length-1),i.ch=le(e,i.line)):i.ch=0:i.ch+=t.after?1:0;var M,V;if(r.visualMode){r.lastPastedText=a;var _,B=Cr(e,r),Z=B[0],ke=B[1],ie=e.getSelection(),pe=e.listSelections(),q=new Array(pe.length).join("1").split("1");r.lastSelection&&(_=r.lastSelection.headMark.find()),I.registerController.unnamedRegister.setText(ie),L?(e.replaceSelections(q),ke=new C(Z.line+a.length-1,Z.ch),e.setCursor(Z),Rt(e,ke),e.replaceSelections(a),M=Z):r.visualBlock?(e.replaceSelections(q),e.setCursor(Z),e.replaceRange(a,Z,Z),M=Z):(e.replaceRange(a,Z,ke),M=e.posFromIndex(e.indexFromPos(Z)+a.length-1)),_&&(r.lastSelection.headMark=e.setBookmark(_)),m&&(M.ch=0)}else if(L){e.setCursor(i);for(var T=0;T<a.length;T++){var $=i.line+T;$>e.lastLine()&&e.replaceRange(`
`,new C($,0));var ue=le(e,$);ue<i.ch&&yr(e,$,i.ch)}e.setCursor(i),Rt(e,new C(i.line+a.length-1,i.ch)),e.replaceSelections(a),M=i}else e.replaceRange(a,i),m&&t.after?M=new C(i.line+1,Ee(e.getLine(i.line+1))):m&&!t.after?M=new C(i.line,Ee(e.getLine(i.line))):!m&&t.after?(V=e.indexFromPos(i),M=e.posFromIndex(V+a.length-1)):(V=e.indexFromPos(i),M=e.posFromIndex(V+a.length));r.visualMode&&Pe(e,!1),e.setCursor(M)}},undo:function(e,t){e.operation(function(){It(e,h.default.commands.undo,t.repeat)(),e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){It(e,h.default.commands.redo,t.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},setMark:function(e,t,r){var i=t.selectedCharacter;Ke(e,r,i,e.getCursor())},replace:function(e,t,r){var i=t.selectedCharacter,o=e.getCursor(),a,s,l=e.listSelections();if(r.visualMode)o=e.getCursor("start"),s=e.getCursor("end");else{var u=e.getLine(o.line);a=o.ch+t.repeat,a>u.length&&(a=u.length),s=new C(o.line,a)}if(i==`
`)r.visualMode||e.replaceRange("",o,s),(h.default.commands.newlineAndIndentContinueComment||h.default.commands.newlineAndIndent)(e);else{var c=e.getRange(o,s);if(c=c.replace(/[^\n]/g,i),r.visualBlock){var v=new Array(e.getOption("tabSize")+1).join(" ");c=e.getSelection(),c=c.replace(/\t/g,v).replace(/[^\n]/g,i).split(`
`),e.replaceSelections(c)}else e.replaceRange(c,o,s);r.visualMode?(o=oe(l[0].anchor,l[0].head)?l[0].anchor:l[0].head,e.setCursor(o),Pe(e,!1)):e.setCursor(Ce(s,0,-1))}},incrementNumberToken:function(e,t){for(var r=e.getCursor(),i=e.getLine(r.line),o=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,a,s,l,u;(a=o.exec(i))!==null&&(s=a.index,l=s+a[0].length,!(r.ch<l)););if(!(!t.backtrack&&l<=r.ch)){if(a){var c=a[2]||a[4],v=a[3]||a[5],w=t.increase?1:-1,k={"0b":2,0:8,"":10,"0x":16}[c.toLowerCase()],m=parseInt(a[1]+v,k)+w*t.repeat;u=m.toString(k);var L=c?new Array(v.length-u.length+1+a[1].length).join("0"):"";u.charAt(0)==="-"?u="-"+c+L+u.substr(1):u=c+L+u;var T=new C(r.line,s),M=new C(r.line,l);e.replaceRange(u,T,M)}else return;e.setCursor(new C(r.line,s+u.length-1))}},repeatLastEdit:function(e,t,r){var i=r.lastEditInputState;if(i){var o=t.repeat;o&&t.repeatIsExplicit?r.lastEditInputState.repeatOverride=o:o=r.lastEditInputState.repeatOverride||o,Zt(e,r,o,!1)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:Xe};function dr(n,e){ft[n]=e}function Me(n,e){var t=n.state.vim,r=t.insertMode||t.visualMode,i=Math.min(Math.max(n.firstLine(),e.line),n.lastLine()),o=le(n,i)-1+!!r,a=Math.min(Math.max(0,e.ch),o);return new C(i,a)}function ot(n){var e={};for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function Ce(n,e,t){return R(e)==="object"&&(t=e.ch,e=e.line),new C(n.line+e,n.ch+t)}function hr(n,e,t,r){for(var i,o=[],a=[],s=0;s<e.length;s++){var l=e[s];t=="insert"&&l.context!="insert"||l.context&&l.context!=t||r.operator&&l.type=="action"||!(i=pr(n,l.keys))||(i=="partial"&&o.push(l),i=="full"&&a.push(l))}return{partial:o.length&&o,full:a.length&&a}}function pr(n,e){if(e.slice(-11)=="<character>"){var t=e.length-11,r=n.slice(0,t),i=e.slice(0,t);return r==i&&n.length>t?"full":i.indexOf(r)==0?"partial":!1}else return n==e?"full":e.indexOf(n)==0?"partial":!1}function vr(n){var e=/^.*(<[^>]+>)$/.exec(n),t=e?e[1]:n.slice(-1);if(t.length>1)switch(t){case"<CR>":t=`
`;break;case"<Space>":t=" ";break;default:t="";break}return t}function It(n,e,t){return function(){for(var r=0;r<t;r++)e(n)}}function re(n){return new C(n.line,n.ch)}function xe(n,e){return n.ch==e.ch&&n.line==e.line}function oe(n,e){return n.line<e.line||n.line==e.line&&n.ch<e.ch}function Le(n,e){return arguments.length>2&&(e=Le.apply(void 0,Array.prototype.slice.call(arguments,1))),oe(n,e)?n:e}function We(n,e){return arguments.length>2&&(e=We.apply(void 0,Array.prototype.slice.call(arguments,1))),oe(n,e)?e:n}function At(n,e,t){var r=oe(n,e),i=oe(e,t);return r&&i}function le(n,e){return n.getLine(e).length}function ct(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function gr(n){return n.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function yr(n,e,t){var r=le(n,e),i=new Array(t-r+1).join(" ");n.setCursor(new C(e,r)),n.replaceRange(i,n.getCursor())}function Rt(n,e){var t=[],r=n.listSelections(),i=re(n.clipPos(e)),o=!xe(e,i),a=n.getCursor("head"),s=mr(r,a),l=xe(r[s].head,r[s].anchor),u=r.length-1,c=u-s>s?u:0,v=r[c].anchor,w=Math.min(v.line,i.line),k=Math.max(v.line,i.line),m=v.ch,L=i.ch,T=r[c].head.ch-m,M=L-m;T>0&&M<=0?(m++,o||L--):T<0&&M>=0?(m--,l||L++):T<0&&M==-1&&(m--,L++);for(var V=w;V<=k;V++){var _={anchor:new C(V,m),head:new C(V,L)};t.push(_)}return n.setSelections(t),e.ch=L,v.ch=m,v}function Pt(n,e,t){for(var r=[],i=0;i<t;i++){var o=Ce(e,i,0);r.push({anchor:o,head:o})}n.setSelections(r,0)}function mr(n,e,t){for(var r=0;r<n.length;r++){var i=xe(n[r].anchor,e),o=xe(n[r].head,e);if(i||o)return r}return-1}function Cr(n,e){var t=e.lastSelection,r=function(){var a=n.listSelections(),s=a[0],l=a[a.length-1],u=oe(s.anchor,s.head)?s.anchor:s.head,c=oe(l.anchor,l.head)?l.head:l.anchor;return[u,c]},i=function(){var a=n.getCursor(),s=n.getCursor(),l=t.visualBlock;if(l){var u=l.width,c=l.height;s=new C(a.line+c,a.ch+u);for(var v=[],w=a.line;w<s.line;w++){var k=new C(w,a.ch),m=new C(w,s.ch),L={anchor:k,head:m};v.push(L)}n.setSelections(v)}else{var T=t.anchorMark.find(),M=t.headMark.find(),V=M.line-T.line,_=M.ch-T.ch;s={line:s.line+V,ch:V?s.ch:_+s.ch},t.visualLine&&(a=new C(a.line,0),s=new C(s.line,le(n,s.line))),n.setSelection(a,s)}return[a,s]};return e.visualMode?r():i()}function Et(n,e){var t=e.sel.anchor,r=e.sel.head;e.lastPastedText&&(r=n.posFromIndex(n.indexFromPos(t)+e.lastPastedText.length),e.lastPastedText=null),e.lastSelection={anchorMark:n.setBookmark(t),headMark:n.setBookmark(r),anchor:re(t),head:re(r),visualMode:e.visualMode,visualLine:e.visualLine,visualBlock:e.visualBlock}}function kr(n,e,t){var r=n.state.vim.sel,i=r.head,o=r.anchor,a;return oe(t,e)&&(a=t,t=e,e=a),oe(i,o)?(i=Le(e,i),o=We(o,t)):(o=Le(e,o),i=We(i,t),i=Ce(i,0,-1),i.ch==-1&&i.line!=n.firstLine()&&(i=new C(i.line-1,le(n,i.line-1)))),[o,i]}function ze(n,e,i){var r=n.state.vim;e=e||r.sel;var i=i||r.visualLine?"line":r.visualBlock?"block":"char",o=dt(n,e,i);n.setSelections(o.ranges,o.primary)}function dt(n,e,t,r){var i=re(e.head),o=re(e.anchor);if(t=="char"){var a=!r&&!oe(e.head,e.anchor)?1:0,s=oe(e.head,e.anchor)?1:0;return i=Ce(e.head,0,a),o=Ce(e.anchor,0,s),{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="line"){if(oe(e.head,e.anchor))i.ch=0,o.ch=le(n,o.line);else{o.ch=0;var l=n.lastLine();i.line>l&&(i.line=l),i.ch=le(n,i.line)}return{ranges:[{anchor:o,head:i}],primary:0}}else if(t=="block"){var u=Math.min(o.line,i.line),c=o.ch,v=Math.max(o.line,i.line),w=i.ch;c<w?w+=1:c+=1;for(var k=v-u+1,m=i.line==u?0:k-1,L=[],T=0;T<k;T++)L.push({anchor:new C(u+T,c),head:new C(u+T,w)});return{ranges:L,primary:m}}}function wr(n){var e=n.getCursor("head");return n.getSelection().length==1&&(e=Le(e,n.getCursor("anchor"))),e}function Pe(n,e){var t=n.state.vim;e!==!1&&n.setCursor(Me(n,t.sel.head)),Et(n,t),t.visualMode=!1,t.visualLine=!1,t.visualBlock=!1,t.insertMode||h.default.signal(n,"vim-mode-change",{mode:"normal"})}function Sr(n,e,t){var r=n.getRange(e,t);if(/\n\s*$/.test(r)){var i=r.split(`
`);i.pop();for(var o,o=i.pop();i.length>0&&o&&g(o);o=i.pop())t.line--,t.ch=0;o?(t.line--,t.ch=le(n,t.line)):t.ch=0}}function br(n,e,t){e.ch=0,t.ch=0,t.line++}function Ee(n){if(!n)return 0;var e=n.search(/\S/);return e==-1?n.length:e}function at(n,e,t,r,i){for(var o=wr(n),a=n.getLine(o.line),s=o.ch,l=i?ce[0]:Be[0];!l(a.charAt(s));)if(s++,s>=a.length)return null;r?l=Be[0]:(l=ce[0],l(a.charAt(s))||(l=ce[1]));for(var u=s,c=s;l(a.charAt(u))&&u<a.length;)u++;for(;l(a.charAt(c))&&c>=0;)c--;if(c++,e){for(var v=u;/\s/.test(a.charAt(u))&&u<a.length;)u++;if(v==u){for(var w=c;/\s/.test(a.charAt(c-1))&&c>0;)c--;c||(c=w)}}return{start:new C(o.line,c),end:new C(o.line,u)}}function Mr(n,e,t){var r=e;if(!h.default.findMatchingTag||!h.default.findEnclosingTag)return{start:r,end:r};var i=h.default.findMatchingTag(n,e)||h.default.findEnclosingTag(n,e);return!i||!i.open||!i.close?{start:r,end:r}:t?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}}function Ot(n,e,t){xe(e,t)||I.jumpList.add(n,e,t)}function _t(n,e){I.lastCharacterSearch.increment=n,I.lastCharacterSearch.forward=e.forward,I.lastCharacterSearch.selectedCharacter=e.selectedCharacter}var xr={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},Bt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}",e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0)return!0;e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0)return!0;e.depth--}if(t==="else"&&e.depth===0)return!0}return!1}}};function Lr(n,e,t,r){var i=re(n.getCursor()),o=t?1:-1,a=t?n.lineCount():-1,s=i.ch,l=i.line,u=n.getLine(l),c={lineText:u,nextCh:u.charAt(s),lastCh:null,index:s,symb:r,reverseSymb:(t?{")":"(","}":"{"}:{"(":")","{":"}"})[r],forward:t,depth:0,curMoveThrough:!1},v=xr[r];if(!v)return i;var w=Bt[v].init,k=Bt[v].isComplete;for(w&&w(c);l!==a&&e;){if(c.index+=o,c.nextCh=c.lineText.charAt(c.index),!c.nextCh){if(l+=o,c.lineText=n.getLine(l)||"",o>0)c.index=0;else{var m=c.lineText.length;c.index=m>0?m-1:0}c.nextCh=c.lineText.charAt(c.index)}k(c)&&(i.line=l,i.ch=c.index,e--)}return c.nextCh||c.curMoveThrough?new C(l,c.index):i}function Tr(n,e,t,r,i){var o=e.line,a=e.ch,s=n.getLine(o),l=t?1:-1,u=r?Be:ce;if(i&&s==""){if(o+=l,s=n.getLine(o),!y(n,o))return null;a=t?0:s.length}for(;;){if(i&&s=="")return{from:0,to:0,line:o};for(var c=l>0?s.length:-1,v=c,w=c;a!=c;){for(var k=!1,m=0;m<u.length&&!k;++m)if(u[m](s.charAt(a))){for(v=a;a!=c&&u[m](s.charAt(a));)a+=l;if(w=a,k=v!=w,v==e.ch&&o==e.line&&w==v+l)continue;return{from:Math.min(v,w+1),to:Math.max(v,w),line:o}}k||(a+=l)}if(o+=l,!y(n,o))return null;s=n.getLine(o),a=l>0?0:s.length}}function Ir(n,e,t,r,i,o){var a=re(e),s=[];(r&&!i||!r&&i)&&t++;for(var l=!(r&&i),u=0;u<t;u++){var c=Tr(n,e,r,o,l);if(!c){var v=le(n,n.lastLine());s.push(r?{line:n.lastLine(),from:v,to:v}:{line:0,from:0,to:0});break}s.push(c),e=new C(c.line,r?c.to-1:c.from)}var w=s.length!=t,k=s[0],m=s.pop();return r&&!i?(!w&&(k.from!=a.ch||k.line!=a.line)&&(m=s.pop()),new C(m.line,m.from)):r&&i?new C(m.line,m.to-1):!r&&i?(!w&&(k.to!=a.ch||k.line!=a.line)&&(m=s.pop()),new C(m.line,m.to)):new C(m.line,m.from)}function Nt(n,e,t,r,i){var o=e,a=new C(o.line+t.repeat-1,1/0),s=n.clipPos(a);return s.ch--,i||(r.lastHPos=1/0,r.lastHSPos=n.charCoords(s,"div").left),a}function ht(n,e,t,r){for(var i=n.getCursor(),o=i.ch,a,s=0;s<e;s++){var l=n.getLine(i.line);if(a=Rr(o,l,r,t),a==-1)return null;o=a}return new C(n.getCursor().line,a)}function Ar(n,e){var t=n.getCursor().line;return Me(n,new C(t,e-1))}function Ke(n,e,t,r){E(t,nt)&&(e.marks[t]&&e.marks[t].clear(),e.marks[t]=n.setBookmark(r))}function Rr(n,e,t,r,i){var o;return r?o=e.indexOf(t,n+1):o=e.lastIndexOf(t,n-1),o}function Kt(n,e,t,r,i){var o=e.line,a=n.firstLine(),s=n.lastLine(),l,u,c=o;function v(T){return!n.getLine(T)}function w(T,M,V){return V?v(T)!=v(T+M):!v(T)&&v(T+M)}if(r){for(;a<=c&&c<=s&&t>0;)w(c,r)&&t--,c+=r;return new C(c,0)}var k=n.state.vim;if(k.visualLine&&w(o,1,!0)){var m=k.sel.anchor;w(m.line,-1,!0)&&(!i||m.line!=o)&&(o+=1)}var L=v(o);for(c=o;c<=s&&t;c++)w(c,1,!0)&&(!i||v(c)!=L)&&t--;for(u=new C(c,0),c>s&&!L?L=!0:i=!1,c=o;c>a&&!((!i||v(c)==L||c==o)&&w(c,-1,!0));c--);return l=new C(c,0),{start:l,end:u}}function Pr(n,e,t,r){function i(l,u){if(u.pos+u.dir<0||u.pos+u.dir>=u.line.length){if(u.ln+=u.dir,!y(l,u.ln)){u.line=null,u.ln=null,u.pos=null;return}u.line=l.getLine(u.ln),u.pos=u.dir>0?0:u.line.length-1}else u.pos+=u.dir}function o(l,u,c,v){var T=l.getLine(u),w=T==="",k={line:T,ln:u,pos:c,dir:v},m={ln:k.ln,pos:k.pos},L=k.line==="";for(i(l,k);k.line!==null;){if(m.ln=k.ln,m.pos=k.pos,k.line===""&&!L)return{ln:k.ln,pos:k.pos};if(w&&k.line!==""&&!g(k.line[k.pos]))return{ln:k.ln,pos:k.pos};S(k.line[k.pos])&&!w&&(k.pos===k.line.length-1||g(k.line[k.pos+1]))&&(w=!0),i(l,k)}var T=l.getLine(m.ln);m.pos=0;for(var M=T.length-1;M>=0;--M)if(!g(T[M])){m.pos=M;break}return m}function a(l,u,c,v){var L=l.getLine(u),w={line:L,ln:u,pos:c,dir:v},k={ln:w.ln,pos:null},m=w.line==="";for(i(l,w);w.line!==null;){if(w.line===""&&!m)return k.pos!==null?k:{ln:w.ln,pos:w.pos};if(S(w.line[w.pos])&&k.pos!==null&&!(w.ln===k.ln&&w.pos+1===k.pos))return k;w.line!==""&&!g(w.line[w.pos])&&(m=!1,k={ln:w.ln,pos:w.pos}),i(l,w)}var L=l.getLine(k.ln);k.pos=0;for(var T=0;T<L.length;++T)if(!g(L[T])){k.pos=T;break}return k}for(var s={ln:e.line,pos:e.ch};t>0;)r<0?s=a(n,s.ln,s.pos,r):s=o(n,s.ln,s.pos,r),t--;return new C(s.ln,s.pos)}function Er(n,e,t,r){var i=e,o,a,s={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[t],l={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[t],u=n.getLine(i.line).charAt(i.ch),c=u===l?1:0;if(o=n.scanForBracket(new C(i.line,i.ch+c),-1,void 0,{bracketRegex:s}),a=n.scanForBracket(new C(i.line,i.ch+c),1,void 0,{bracketRegex:s}),!o||!a)return{start:i,end:i};if(o=o.pos,a=a.pos,o.line==a.line&&o.ch>a.ch||o.line>a.line){var v=o;o=a,a=v}return r?a.ch+=1:o.ch+=1,{start:o,end:a}}function Or(n,e,t,r){var i=re(e),o=n.getLine(i.line),a=o.split(""),s,l,u,c,v=a.indexOf(t);if(i.ch<v?i.ch=v:v<i.ch&&a[i.ch]==t&&(l=i.ch,--i.ch),a[i.ch]==t&&!l)s=i.ch+1;else for(u=i.ch;u>-1&&!s;u--)a[u]==t&&(s=u+1);if(s&&!l)for(u=s,c=a.length;u<c&&!l;u++)a[u]==t&&(l=u);return!s||!l?{start:i,end:i}:(r&&(--s,++l),{start:new C(i.line,s),end:new C(i.line,l)})}z("pcre",!0,"boolean");function Dt(){}Dt.prototype={getQuery:function(){return I.query},setQuery:function(e){I.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return I.isReversed},setReversed:function(e){I.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};function Oe(n){var e=n.state.vim;return e.searchState_||(e.searchState_=new Dt)}function _r(n){return Vt(n,"/")}function Br(n){return Ht(n,"/")}function Vt(n,e){var t=Ht(n,e)||[];if(!t.length)return[];var r=[];if(t[0]===0){for(var i=0;i<t.length;i++)typeof t[i]=="number"&&r.push(n.substring(t[i]+1,t[i+1]));return r}}function Ht(n,e){e||(e="/");for(var t=!1,r=[],i=0;i<n.length;i++){var o=n.charAt(i);!t&&o==e&&r.push(i),t=!t&&o=="\\"}return r}function Nr(n){for(var e="|(){",t="}",r=!1,i=[],o=-1;o<n.length;o++){var a=n.charAt(o)||"",s=n.charAt(o+1)||"",l=s&&e.indexOf(s)!=-1;r?((a!=="\\"||!l)&&i.push(a),r=!1):a==="\\"?(r=!0,s&&t.indexOf(s)!=-1&&(l=!0),(!l||s==="\\")&&i.push(a)):(i.push(a),l&&s!=="\\"&&i.push("\\"))}return i.join("")}var Wt={"\\n":`
`,"\\r":"\r","\\t":"	"};function Kr(n){for(var e=!1,t=[],r=-1;r<n.length;r++){var i=n.charAt(r)||"",o=n.charAt(r+1)||"";Wt[i+o]?(t.push(Wt[i+o]),r++):e?(t.push(i),e=!1):i==="\\"?(e=!0,f(o)||o==="$"?t.push("$"):o!=="/"&&o!=="\\"&&t.push("\\")):(i==="$"&&t.push("$"),t.push(i),o==="/"&&t.push("\\"))}return t.join("")}var Ft={"\\/":"/","\\\\":"\\","\\n":`
`,"\\r":"\r","\\t":"	","\\&":"&"};function Dr(n){for(var e=new h.default.StringStream(n),t=[];!e.eol();){for(;e.peek()&&e.peek()!="\\";)t.push(e.next());var r=!1;for(var i in Ft)if(e.match(i,!0)){r=!0,t.push(Ft[i]);break}r||t.push(e.next())}return t.join("")}function Vr(n,e,t){var r=I.registerController.getRegister("/");if(r.setText(n),n instanceof RegExp)return n;var i=Br(n),o,a;if(!i.length)o=n;else{o=n.substring(0,i[0]);var s=n.substring(i[0]);a=s.indexOf("i")!=-1}if(!o)return null;ee("pcre")||(o=Nr(o)),t&&(e=/^[^A-Z]*$/.test(o));var l=new RegExp(o,e||a?"im":"m");return l}function Fe(n){typeof n=="string"&&(n=document.createElement(n));for(var e,t=1;t<arguments.length;t++)if(e=arguments[t])if(R(e)!=="object"&&(e=document.createTextNode(e)),e.nodeType)n.appendChild(e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(r[0]==="$"?n.style[r.slice(1)]=e[r]:n.setAttribute(r,e[r]));return n}function Y(n,e){var t=Fe("pre",{$color:"red",class:"cm-vim-message"},e);n.openNotification?n.openNotification(t,{bottom:!0,duration:5e3}):alert(t.innerText)}function Hr(n,e){return Fe(document.createDocumentFragment(),Fe("span",{$fontFamily:"monospace",$whiteSpace:"pre"},n,Fe("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false"})),e&&Fe("span",{$color:"#888"},e))}function st(n,e){var t=Hr(e.prefix,e.desc);if(n.openDialog)n.openDialog(t,e.onClose,{onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,bottom:!0,selectValueOnOpen:!1,value:e.value});else{var r="";typeof e.prefix!="string"&&e.prefix&&(r+=e.prefix.textContent),e.desc&&(r+=" "+e.desc),e.onClose(prompt(r,""))}}function Wr(n,e){if(n instanceof RegExp&&e instanceof RegExp){for(var t=["global","multiline","ignoreCase","source"],r=0;r<t.length;r++){var i=t[r];if(n[i]!==e[i])return!1}return!0}return!1}function Ge(n,e,t,r){if(e){var i=Oe(n),o=Vr(e,!!t,!!r);if(o)return Ut(n,o),Wr(o,i.getQuery())||i.setQuery(o),o}}function Fr(n){if(n.source.charAt(0)=="^")var e=!0;return{token:function(r){if(e&&!r.sol()){r.skipToEnd();return}var i=r.match(n,!1);if(i)return i[0].length==0?(r.next(),"searching"):!r.sol()&&(r.backUp(1),!n.exec(r.next()+i[0]))?(r.next(),null):(r.match(n),"searching");for(;!r.eol()&&(r.next(),!r.match(n,!1)););},query:n}}var lt=0;function Ut(n,e){clearTimeout(lt),lt=setTimeout(function(){if(n.state.vim){var t=Oe(n),r=t.getOverlay();(!r||e!=r.query)&&(r&&n.removeOverlay(r),r=Fr(e),n.addOverlay(r),n.showMatchesOnScrollbar&&(t.getScrollbarAnnotate()&&t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(n.showMatchesOnScrollbar(e))),t.setOverlay(r))}},50)}function jt(n,e,t,r){return r===void 0&&(r=1),n.operation(function(){for(var i=n.getCursor(),o=n.getSearchCursor(t,i),a=0;a<r;a++){var s=o.find(e);if(a==0&&s&&xe(o.from(),i)){var l=e?o.from():o.to();s=o.find(e),s&&!s[0]&&xe(o.from(),l)&&n.getLine(l.line).length==l.ch&&(s=o.find(e))}if(!s&&(o=n.getSearchCursor(t,e?new C(n.lastLine()):new C(n.firstLine(),0)),!o.find(e)))return}return o.from()})}function Ur(n,e,t,r,i){return r===void 0&&(r=1),n.operation(function(){var o=n.getCursor(),a=n.getSearchCursor(t,o),s=a.find(!e);!i.visualMode&&s&&xe(a.from(),o)&&a.find(!e);for(var l=0;l<r;l++)if(s=a.find(e),!s&&(a=n.getSearchCursor(t,e?new C(n.lastLine()):new C(n.firstLine(),0)),!a.find(e)))return;return[a.from(),a.to()]})}function pt(n){var e=Oe(n);n.removeOverlay(Oe(n).getOverlay()),e.setOverlay(null),e.getScrollbarAnnotate()&&(e.getScrollbarAnnotate().clear(),e.setScrollbarAnnotate(null))}function jr(n,e,t){return typeof n!="number"&&(n=n.line),e instanceof Array?E(n,e):typeof t=="number"?n>=e&&n<=t:n==e}function vt(n){var e=n.getScrollInfo(),t=6,r=10,i=n.coordsChar({left:0,top:t+e.top},"local"),o=e.clientHeight-r+e.top,a=n.coordsChar({left:0,top:o},"local");return{top:i.line,bottom:a.line}}function $t(n,e,t){if(t=="'"||t=="`")return I.jumpList.find(n,-1)||new C(0,0);if(t==".")return zt(n);var r=e.marks[t];return r&&r.find()}function zt(n){for(var e=n.doc.history.done,t=e.length;t--;)if(e[t].changes)return re(e[t].changes[0].to)}var Jt=function(){this.buildCommandMap_()};Jt.prototype={processCommand:function(e,t,r){var i=this;e.operation(function(){e.curOp.isVimOp=!0,i._processCommand(e,t,r)})},_processCommand:function(e,t,r){var i=e.state.vim,o=I.registerController.getRegister(":"),a=o.toString();i.visualMode&&Pe(e);var s=new h.default.StringStream(t);o.setText(t);var l=r||{};l.input=t;try{this.parseInput_(e,s,l)}catch(w){throw Y(e,w.toString()),w}var u,c;if(!l.commandName)l.line!==void 0&&(c="move");else if(u=this.matchCommand_(l.commandName),u){if(c=u.name,u.excludeFromCommandHistory&&o.setText(a),this.parseCommandArgs_(s,l,u),u.type=="exToKey"){for(var v=0;v<u.toKeys.length;v++)$e.handleKey(e,u.toKeys[v],"mapping");return}else if(u.type=="exToEx"){this.processCommand(e,u.toInput);return}}if(!c){Y(e,'Not an editor command ":'+t+'"');return}try{Qt[c](e,l),(!u||!u.possiblyAsync)&&l.callback&&l.callback()}catch(w){throw Y(e,w.toString()),w}},parseInput_:function(e,t,r){t.eatWhile(":"),t.eat("%")?(r.line=e.firstLine(),r.lineEnd=e.lastLine()):(r.line=this.parseLineSpec_(e,t),r.line!==void 0&&t.eat(",")&&(r.lineEnd=this.parseLineSpec_(e,t)));var i=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);return i?r.commandName=i[1]:r.commandName=t.match(/.*/)[0],r},parseLineSpec_:function(e,t){var r=t.match(/^(\d+)/);if(r)return parseInt(r[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var i=t.next(),o=$t(e,e.state.vim,i);if(!o)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":return t.backUp(1),this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return}},parseLineSpecOffset_:function(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var i=parseInt(r[2],10);r[1]=="-"?t-=i:t+=i}return t},parseCommandArgs_:function(e,t,r){if(!e.eol()){t.argString=e.match(/.*/)[0];var i=r.argDelimiter||/\s+/,o=ct(t.argString).split(i);o.length&&o[0]&&(t.args=o)}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var i=this.commandMap_[r];if(i.name.indexOf(e)===0)return i}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<K.length;e++){var t=K[e],r=t.shortName||t.name;this.commandMap_[r]=t}},map:function(e,t,r){if(e!=":"&&e.charAt(0)==":"){if(r)throw Error("Mode not supported for ex mappings");var i=e.substring(1);t!=":"&&t.charAt(0)==":"?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else if(t!=":"&&t.charAt(0)==":"){var o={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)}};r&&(o.context=r),H.unshift(o)}else{var o={keys:e,type:"keyToKey",toKeys:t};r&&(o.context=r),H.unshift(o)}},unmap:function(e,t){if(e!=":"&&e.charAt(0)==":"){if(t)throw Error("Mode not supported for ex mappings");var r=e.substring(1);if(this.commandMap_[r]&&this.commandMap_[r].user)return delete this.commandMap_[r],!0}else for(var i=e,o=0;o<H.length;o++)if(i==H[o].keys&&H[o].context===t)return H.splice(o,1),!0}};var Qt={colorscheme:function(e,t){if(!t.args||t.args.length<1){Y(e,e.getOption("theme"));return}e.setOption("theme",t.args[0])},map:function(e,t,r){var i=t.args;if(!i||i.length<2){e&&Y(e,"Invalid mapping: "+t.input);return}_e.map(i[0],i[1],r)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,r){var i=t.args;(!i||i.length<1||!_e.unmap(i[0],r))&&e&&Y(e,"No such mapping: "+t.input)},move:function(e,t){De.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var r=t.args,i=t.setCfg||{};if(!r||r.length<1){e&&Y(e,"Invalid mapping: "+t.input);return}var o=r[0].split("="),a=o[0],s=o[1],l=!1;if(a.charAt(a.length-1)=="?"){if(s)throw Error("Trailing characters: "+t.argString);a=a.substring(0,a.length-1),l=!0}s===void 0&&a.substring(0,2)=="no"&&(a=a.substring(2),s=!1);var u=W[a]&&W[a].type=="boolean";if(u&&s==null&&(s=!0),!u&&s===void 0||l){var c=ee(a,e,i);c instanceof Error?Y(e,c.message):c===!0||c===!1?Y(e," "+(c?"":"no")+a):Y(e,"  "+a+"="+c)}else{var v=j(a,s,e,i);v instanceof Error&&Y(e,v.message)}},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var r=t.args,i=I.registerController.registers,o=`----------Registers----------

`;if(r){var a;r=r.join("");for(var l=0;l<r.length;l++)if(a=r.charAt(l),!!I.registerController.isValidRegister(a)){var u=i[a]||new Re;o+='"'+a+"    "+u.toString()+`
`}}else for(var a in i){var s=i[a].toString();s.length&&(o+='"'+a+"    "+s+`
`)}Y(e,o)},sort:function(e,t){var r,i,o,a,s;function l(){if(t.argString){var q=new h.default.StringStream(t.argString);if(q.eat("!")&&(r=!0),q.eol())return;if(!q.eatSpace())return"Invalid arguments";var $=q.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!$&&!q.eol())return"Invalid arguments";if($[1]){i=$[1].indexOf("i")!=-1,o=$[1].indexOf("u")!=-1;var ue=$[1].indexOf("d")!=-1||$[1].indexOf("n")!=-1&&1,we=$[1].indexOf("x")!=-1&&1,ve=$[1].indexOf("o")!=-1&&1;if(ue+we+ve>1)return"Invalid arguments";a=ue&&"decimal"||we&&"hex"||ve&&"octal"}$[2]&&(s=new RegExp($[2].substr(1,$[2].length-2),i?"i":""))}}var u=l();if(u){Y(e,u+": "+t.argString);return}var c=t.line||e.firstLine(),v=t.lineEnd||t.line||e.lastLine();if(c==v)return;var w=new C(c,0),k=new C(v,le(e,v)),m=e.getRange(w,k).split(`
`),L=s||(a=="decimal"?/(-?)([\d]+)/:a=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:a=="octal"?/([0-7]+)/:null),T=a=="decimal"?10:a=="hex"?16:a=="octal"?8:null,M=[],V=[];if(a||s)for(var _=0;_<m.length;_++){var B=s?m[_].match(s):null;B&&B[0]!=""?M.push(B):!s&&L.exec(m[_])?M.push(m[_]):V.push(m[_])}else V=m;function Z(q,$){if(r){var ue;ue=q,q=$,$=ue}i&&(q=q.toLowerCase(),$=$.toLowerCase());var we=a&&L.exec(q),ve=a&&L.exec($);return we?(we=parseInt((we[1]+we[2]).toLowerCase(),T),ve=parseInt((ve[1]+ve[2]).toLowerCase(),T),we-ve):q<$?-1:1}function ke(q,$){if(r){var ue;ue=q,q=$,$=ue}return i&&(q[0]=q[0].toLowerCase(),$[0]=$[0].toLowerCase()),q[0]<$[0]?-1:1}if(M.sort(s?ke:Z),s)for(var _=0;_<M.length;_++)M[_]=M[_].input;else a||V.sort(Z);if(m=r?M.concat(V):V.concat(M),o){var ie=m,pe;m=[];for(var _=0;_<ie.length;_++)ie[_]!=pe&&m.push(ie[_]),pe=ie[_]}e.replaceRange(m.join(`
`),w,k)},vglobal:function(e,t){this.global(e,t)},global:function(e,t){var r=t.argString;if(!r){Y(e,"Regular Expression missing from global");return}var i=t.commandName[0]==="v",o=t.line!==void 0?t.line:e.firstLine(),a=t.lineEnd||t.line||e.lastLine(),s=_r(r),l=r,u;if(s.length&&(l=s[0],u=s.slice(1,s.length).join("/")),l)try{Ge(e,l,!0,!0)}catch{Y(e,"Invalid regex: "+l);return}for(var c=Oe(e).getQuery(),v=[],w=o;w<=a;w++){var k=e.getLineHandle(w),m=c.test(k.text);m!==i&&v.push(u?k:k.text)}if(!u){Y(e,v.join(`
`));return}var L=0,T=function(){if(L<v.length){var V=v[L++],_=e.getLineNumber(V);if(_==null){T();return}var B=_+1+u;_e.processCommand(e,B,{callback:T})}};T()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var r=t.argString,i=r?Vt(r,r[0]):[],o,a="",s,l,u,c=!1,v=!1;if(i.length)o=i[0],ee("pcre")&&o!==""&&(o=new RegExp(o).source),a=i[1],a!==void 0&&(ee("pcre")?a=Dr(a.replace(/([^\\])&/g,"$1$$&")):a=Kr(a),I.lastSubstituteReplacePart=a),s=i[2]?i[2].split(" "):[];else if(r&&r.length){Y(e,"Substitutions should be of the form :s/pattern/replace/");return}if(s&&(l=s[0],u=parseInt(s[1]),l&&(l.indexOf("c")!=-1&&(c=!0),l.indexOf("g")!=-1&&(v=!0),ee("pcre")?o=o+"/"+l:o=o.replace(/\//g,"\\/")+"/"+l)),o)try{Ge(e,o,!0,!0)}catch{Y(e,"Invalid regex: "+o);return}if(a=a||I.lastSubstituteReplacePart,a===void 0){Y(e,"No previous substitute regular expression");return}var w=Oe(e),k=w.getQuery(),m=t.line!==void 0?t.line:e.getCursor().line,L=t.lineEnd||m;m==e.firstLine()&&L==e.lastLine()&&(L=1/0),u&&(m=L,L=m+u-1);var T=Me(e,new C(m,0)),M=e.getSearchCursor(k,T);e.pushUndoStop(),$r(e,c,v,m,L,M,k,a,t.callback)},redo:h.default.commands.redo,undo:h.default.commands.undo,write:function(e){h.default.commands.save?h.default.commands.save(e):e.save&&e.save()},nohlsearch:function(e){pt(e)},yank:function(e){var t=re(e.getCursor()),r=t.line,i=e.getLine(r);I.registerController.pushText("0","yank",i,!0,!0)},delmarks:function(e,t){if(!t.argString||!ct(t.argString)){Y(e,"Argument required");return}for(var r=e.state.vim,i=new h.default.StringStream(ct(t.argString));!i.eol();){i.eatSpace();var o=i.pos;if(!i.match(/[a-zA-Z]/,!1)){Y(e,"Invalid argument: "+t.argString.substring(o));return}var a=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1)){Y(e,"Invalid argument: "+t.argString.substring(o));return}var s=a,l=i.next();if(d(s)&&d(l)||p(s)&&p(l)){var u=s.charCodeAt(0),c=l.charCodeAt(0);if(u>=c){Y(e,"Invalid argument: "+t.argString.substring(o));return}for(var v=0;v<=c-u;v++){var w=String.fromCharCode(u+v);delete r.marks[w]}}else{Y(e,"Invalid argument: "+s+"-");return}}else delete r.marks[a]}}},_e=new Jt;function $r(n,e,t,r,i,o,a,s,l){n.state.vim.exMode=!0;var u=!1,c,v,w;function k(){n.operation(function(){for(;!u;)m(),T();M()})}function m(){var _=n.getRange(o.from(),o.to()),B=_.replace(a,s),Z=o.to().line;o.replace(B),v=o.to().line,i+=v-Z,w=v<Z}function L(){var _=c&&re(o.to()),B=o.findNext();return B&&!B[0]&&_&&xe(o.from(),_)&&(B=o.findNext()),B}function T(){for(;L()&&jr(o.from(),r,i);)if(!(!t&&o.from().line==v&&!w)){n.scrollIntoView(o.from(),30),n.setSelection(o.from(),o.to()),c=o.from(),u=!1;return}u=!0}function M(_){if(_&&_(),n.focus(),c){n.setCursor(c);var B=n.state.vim;B.exMode=!1,B.lastHPos=B.lastHSPos=c.ch}l&&l()}function V(_,B,Z){h.default.e_stop(_);var ke=h.default.keyName(_);switch(ke){case"Y":m(),T();break;case"N":T();break;case"A":var ie=l;l=void 0,n.operation(k),l=ie;break;case"L":m();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":M(Z);break}return u&&M(Z),!0}if(T(),u){Y(n,"No matches for "+a.source);return}if(!e){k(),l&&l();return}st(n,{prefix:Fe("span","replace with ",Fe("strong",s)," (y/n/a/q/l)"),onKeyDown:V})}h.default.keyMap.vim={attach:O,detach:J,call:G};function Xe(n){var e=n.state.vim,t=I.macroModeState,r=I.registerController.getRegister("."),i=t.isPlaying,o=t.lastInsertModeChanges;i||(n.off("change",Gt),h.default.off(n.getInputField(),"keydown",Yt)),!i&&e.insertModeRepeat>1&&(Zt(n,e,e.insertModeRepeat-1,!0),e.lastEditInputState.repeatOverride=e.insertModeRepeat),delete e.insertModeRepeat,e.insertMode=!1,n.setCursor(n.getCursor().line,n.getCursor().ch-1),n.setOption("keyMap","vim"),n.setOption("disableInput",!0),n.toggleOverwrite(!1),r.setText(o.changes.join("")),h.default.signal(n,"vim-mode-change",{mode:"normal"}),t.isRecording&&qr(t),n.enterVimMode()}function qt(n){H.unshift(n)}function zr(n,e,t,r,i){var o={keys:n,type:e};o[e]=t,o[e+"Args"]=r;for(var a in i)o[a]=i[a];qt(o)}z("insertModeEscKeysTimeout",200,"number"),h.default.keyMap["vim-insert"]={fallthrough:["default"],attach:O,detach:J,call:G},h.default.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:O,detach:J,call:G};function Jr(n,e,t,r){var i=I.registerController.getRegister(r);if(r==":"){i.keyBuffer[0]&&_e.processCommand(n,i.keyBuffer[0]),t.isPlaying=!1;return}var o=i.keyBuffer,a=0;t.isPlaying=!0,t.replaySearchQueries=i.searchQueries.slice(0);for(var s=0;s<o.length;s++)for(var l=o[s],u,c;l;)if(u=/<\w+-.+?>|<\w+>|./.exec(l),c=u[0],l=l.substring(u.index+c.length),$e.handleKey(n,c,"macro"),e.insertMode){var v=i.insertModeChanges[a++].changes;I.macroModeState.lastInsertModeChanges.changes=v,er(n,v,1),Xe(n)}t.isPlaying=!1}function Qr(n,e){if(!n.isPlaying){var t=n.latestRegister,r=I.registerController.getRegister(t);r&&r.pushText(e)}}function qr(n){if(!n.isPlaying){var e=n.latestRegister,t=I.registerController.getRegister(e);t&&t.pushInsertModeChanges&&t.pushInsertModeChanges(n.lastInsertModeChanges)}}function Gr(n,e){if(!n.isPlaying){var t=n.latestRegister,r=I.registerController.getRegister(t);r&&r.pushSearchQuery&&r.pushSearchQuery(e)}}function Gt(n,e){var t=I.macroModeState,r=t.lastInsertModeChanges;if(!t.isPlaying)for(;e;){if(r.expectCursorActivityForChange=!0,r.ignoreCount>1)r.ignoreCount--;else if(e.origin=="+input"||e.origin=="paste"||e.origin===void 0){var i=n.listSelections().length;i>1&&(r.ignoreCount=i);var o=e.text.join(`
`);r.maybeReset&&(r.changes=[],r.maybeReset=!1),o&&(n.state.overwrite&&!/\n/.test(o)?r.changes.push([o]):r.changes.push(o))}e=e.next}}function Xt(n){var e=n.state.vim;if(e.insertMode){var t=I.macroModeState;if(t.isPlaying)return;var r=t.lastInsertModeChanges;r.expectCursorActivityForChange?r.expectCursorActivityForChange=!1:r.maybeReset=!0}else n.curOp.isVimOp||Xr(n,e)}function Xr(n,e){var t=n.getCursor("anchor"),r=n.getCursor("head");if(e.visualMode&&!n.somethingSelected()?Pe(n,!1):!e.visualMode&&!e.insertMode&&n.somethingSelected()&&(e.visualMode=!0,e.visualLine=!1,h.default.signal(n,"vim-mode-change",{mode:"visual"})),e.visualMode){var i=oe(r,t)?0:-1,o=oe(r,t)?-1:0;r=Ce(r,0,i),t=Ce(t,0,o),e.sel={anchor:t,head:r},Ke(n,e,"<",Le(r,t)),Ke(n,e,">",We(r,t))}else e.insertMode||(e.lastHPos=n.getCursor().ch)}function gt(n){this.keyName=n}function Yt(n){var e=I.macroModeState,t=e.lastInsertModeChanges,r=h.default.keyName(n);if(!r)return;function i(){return t.maybeReset&&(t.changes=[],t.maybeReset=!1),t.changes.push(new gt(r)),!0}(r.indexOf("Delete")!=-1||r.indexOf("Backspace")!=-1)&&h.default.lookupKey(r,"vim-insert",i)}function Zt(n,e,t,r){var i=I.macroModeState;i.isPlaying=!0;var o=!!e.lastEditActionCommand,a=e.inputState;function s(){o?De.processAction(n,e,e.lastEditActionCommand):De.evalInput(n,e)}function l(c){if(i.lastInsertModeChanges.changes.length>0){c=e.lastEditActionCommand?c:1;var v=i.lastInsertModeChanges;er(n,v.changes,c)}}if(e.inputState=e.lastEditInputState,o&&e.lastEditActionCommand.interlaceInsertRepeat)for(var u=0;u<t;u++)s(),l(1);else r||s(),l(t);e.inputState=a,e.insertMode&&!r&&Xe(n),i.isPlaying=!1}function er(n,e,t){function r(v){return typeof v=="string"?h.default.commands[v](n):v(n),!0}var i=n.getCursor("head"),o=I.macroModeState.lastInsertModeChanges.visualBlock;o&&(Pt(n,i,o+1),t=n.listSelections().length,n.setCursor(i));for(var a=0;a<t;a++){o&&n.setCursor(Ce(i,a,0));for(var s=0;s<e.length;s++){var l=e[s];if(l instanceof gt)h.default.lookupKey(l.keyName,"vim-insert",r);else if(typeof l=="string")window.cm=n,n.replaceSelections(l);else{var u=n.getCursor(),c=Ce(u,0,l[0].length);n.replaceRange(l[0],u,c),n.setCursor(c)}}}o&&n.setCursor(Ce(i,0,1))}return He(),$e};h.default.Vim=x(),D.default=h.default}(kt)),kt}var St={},or;function hn(){return or||(or=1,function(D){Object.defineProperty(D,"__esModule",{value:!0}),D.default=void 0;function h(F){"@babel/helpers - typeof";return h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},h(F)}function b(F,K){if(!(F instanceof K))throw new TypeError("Cannot call a class as a function")}function R(F,K){for(var x=0;x<K.length;x++){var A=K[x];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(F,U(A.key),A)}}function C(F,K,x){return K&&R(F.prototype,K),Object.defineProperty(F,"prototype",{writable:!1}),F}function U(F){var K=H(F,"string");return h(K)=="symbol"?K:K+""}function H(F,K){if(h(F)!="object"||!F)return F;var x=F[Symbol.toPrimitive];if(x!==void 0){var A=x.call(F,K);if(h(A)!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(F)}D.default=function(){function F(K,x){var A=this,N=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;b(this,F),this.closeInput=function(){A.removeInputListeners(),A.input=null,A.setSec(""),A.editor&&A.editor.focus()},this.clear=function(){A.setInnerHtml_(A.node,"")},this.inputKeyUp=function(P){var J=A.input.options;J&&J.onKeyUp&&J.onKeyUp(P,P.target.value,A.closeInput)},this.inputKeyInput=function(P){var J=A.input.options;J&&J.onKeyInput&&J.onKeyUp(P,P.target.value,A.closeInput)},this.inputBlur=function(){var P=A.input.options;P.closeOnBlur&&A.closeInput()},this.inputKeyDown=function(P){var J=A.input,O=J.options,G=J.callback;O&&O.onKeyDown&&O.onKeyDown(P,P.target.value,A.closeInput)||((P.keyCode===27||O&&O.closeOnEnter!==!1&&P.keyCode==13)&&(A.input.node.blur(),P.stopPropagation(),A.closeInput()),P.keyCode===13&&G&&(P.stopPropagation(),P.preventDefault(),G(P.target.value)))},this.node=K,this.modeInfoNode=document.createElement("span"),this.secInfoNode=document.createElement("span"),this.notifNode=document.createElement("span"),this.notifNode.className="vim-notification",this.keyInfoNode=document.createElement("span"),this.keyInfoNode.setAttribute("style","float: right"),this.node.appendChild(this.modeInfoNode),this.node.appendChild(this.secInfoNode),this.node.appendChild(this.notifNode),this.node.appendChild(this.keyInfoNode),this.toggleVisibility(!1),this.editor=x,this.sanitizer=N}return C(F,[{key:"setMode",value:function(x){if(x.mode==="visual"){x.subMode==="linewise"?this.setText("--VISUAL LINE--"):x.subMode==="blockwise"?this.setText("--VISUAL BLOCK--"):this.setText("--VISUAL--");return}this.setText("--".concat(x.mode.toUpperCase(),"--"))}},{key:"setKeyBuffer",value:function(x){this.keyInfoNode.textContent=x}},{key:"setSec",value:function(x,A,N){if(this.notifNode.textContent="",x===void 0)return this.closeInput;this.setInnerHtml_(this.secInfoNode,x);var P=this.secInfoNode.querySelector("input");return P&&(P.focus(),this.input={callback:A,options:N,node:P},N&&(N.selectValueOnOpen&&P.select(),N.value&&(P.value=N.value)),this.addInputListeners()),this.closeInput}},{key:"setText",value:function(x){this.modeInfoNode.textContent=x}},{key:"toggleVisibility",value:function(x){x?this.node.style.display="block":this.node.style.display="none",this.input&&this.removeInputListeners(),clearInterval(this.notifTimeout)}},{key:"addInputListeners",value:function(){var x=this.input.node;x.addEventListener("keyup",this.inputKeyUp),x.addEventListener("keydown",this.inputKeyDown),x.addEventListener("input",this.inputKeyInput),x.addEventListener("blur",this.inputBlur)}},{key:"removeInputListeners",value:function(){if(!(!this.input||!this.input.node)){var x=this.input.node;x.removeEventListener("keyup",this.inputKeyUp),x.removeEventListener("keydown",this.inputKeyDown),x.removeEventListener("input",this.inputKeyInput),x.removeEventListener("blur",this.inputBlur)}}},{key:"showNotification",value:function(x){var A=this,N=document.createElement("span");this.setInnerHtml_(N,x),this.notifNode.textContent=N.textContent,this.notifTimeout=setTimeout(function(){A.notifNode.textContent=""},5e3)}},{key:"setInnerHtml_",value:function(x,A){for(;x.childNodes.length;)x.removeChild(x.childNodes[0]);A&&(this.sanitizer?x.appendChild(this.sanitizer(A)):x.appendChild(A))}}])}()}(St)),St}var ar;function pn(){return ar||(ar=1,function(D){Object.defineProperty(D,"__esModule",{value:!0}),Object.defineProperty(D,"StatusBar",{enumerable:!0,get:function(){return b.default}}),Object.defineProperty(D,"VimMode",{enumerable:!0,get:function(){return h.default}}),D.initVimMode=C;var h=R(dn()),b=R(hn());function R(U){return U&&U.__esModule?U:{default:U}}function C(U){var H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:b.default,K=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,x=new h.default(U);if(!H)return x.attach(),x;var A=new F(H,U,K),N="";return x.on("vim-mode-change",function(P){A.setMode(P)}),x.on("vim-keypress",function(P){P===":"?N="":N+=P,A.setKeyBuffer(N)}),x.on("vim-command-done",function(){N="",A.setKeyBuffer(N)}),x.on("dispose",function(){A.toggleVisibility(!1),A.closeInput(),A.clear()}),A.toggleVisibility(!0),x.setStatusBar(A),x.attach(),x}}(Ct)),Ct}var vn=pn();const lr=document.getElementById("container");if(!lr)throw new Error("Container element not found");const ae=Ue.create(lr,{value:"",language:"python",automaticLayout:!0,theme:"vs-dark"});window.qtmonaco={editor:ae,monaco:rn,vimMode:null,initialized:!1};let Qe=window.qtmonaco,et=null,ye=null,sr=null,Je=null;function gn(){console.log("Editor initialized"),Se("bridge_initialized",!0),Qe.initialized=!0}window.onload=function(){console.log("Window loaded, initializing QWebChannel"),new QWebChannel(window.qt.webChannelTransport,function(D){et=D.objects.connector,et?(et.javascript_data_sent.connect(yn),console.log("Successfully connected to javascript_data signal")):console.warn("Bridge javascript_data_sent.connect not available"),ae.onDidChangeModelContent(h=>{const b=ae.getModel();if(b){const R=b.getValue();Se("_current_text",R)}}),gn()})};function Se(D,h){et&&et._receive(D,JSON.stringify(h))}function yn(D,h){const b=JSON.parse(h);console.log(`Received update from Python: ${D} =`,b);const R=ae.getModel();switch(D){case"set_text":if(R){if(b.uri&&R.uri.toString()!==mt.parse(b.uri).toString()||b.language&&R.getLanguageId()!==b.language){R.dispose();let O=b.language??void 0,G=b.uri?mt.parse(b.uri):void 0;const Q=Ue.createModel(b.data,O,G);ae.setModel(Q),Se("_current_uri",Q.uri.toString());break}R.pushEditOperations([],[{range:R.getFullModelRange(),text:b.data}],()=>null);break}else{let O=b.language??void 0,G=b.uri?mt.parse(b.uri):void 0;const Q=Ue.createModel(b.data,O,G);ae.setModel(Q),Se("_current_uri",Q.uri.toString());break}case"read":const U=ae.getValue();Se("_current_text",U);break;case"update_editor_options":ae.updateOptions(b);break;case"set_cursor":{const O=b;if(R){const G=O.line||1,Q=O.column||1,me=O.moveToPosition||"",te=new tr(G,Q),Te=new nn(G,Q,G,Q);ae.setPosition(te),ae.setSelection(Te),typeof me=="string"&&me&&(me==="center"?ae.revealPositionInCenter(te):me==="top"?ae.revealPositionNearTop(te,Ue.ScrollType.Smooth):ae.revealPosition(te)),Se("_current_cursor",{line:G,column:Q})}break}case"highlight_lines":const H=b,F=new yt(H.start,1,H.end,1);Je?Je.clear():Je=ae.createDecorationsCollection();const K={range:F,options:{isWholeLine:!0,linesDecorationsClassName:"highlighted-line"}};Je.set([K]);break;case"remove_highlight":Je&&Je.clear();break;case"delete_line":if(!R)break;let x=null;if(typeof b=="number")x=b;else if(b==="current"){const O=ae.getPosition();O&&(x=O.lineNumber)}else{console.warn("Invalid data for delete_line, expected a line number or 'current'");break}if(x!==null){const O=R.getLineContent(x),Q={range:new yt(x,1,x,O.length+1),text:""};R.pushEditOperations([],[Q],()=>null)}break;case"insert":if(!R)break;let A=null;if(b.line!==null?A=new tr(b.line,b.column||1):A=ae.getPosition(),A){const O=b.text||"",G={range:new yt(A.lineNumber,A.column,A.lineNumber,A.column),text:O};R.pushEditOperations([],[G],()=>null)}break;case"readonly":const N=b===!0;ae.updateOptions({readOnly:N});break;case"language":{const O=ae.getModel();O&&Ue.setModelLanguage(O,b);break}case"add_action":let P=b;P&&typeof P=="object"&&(P.contextMenuGroupId="navigation",P.contextMenuOrder=1.5,P.run=()=>{Se("_context_menu_action",{id:P.id,label:P.label})},ae.addAction(P));break;case"theme":try{Ue.setTheme(b),console.log(`Applied theme: ${b}`),Se("_theme",b)}catch(O){console.warn(`Failed to apply theme "${b}":`,O),Ue.setTheme("vs-dark"),Se("_theme","vs-dark")}break;case"lsp_url":if(ye&&(ye.destroy(),ye=null),b&&typeof b=="string"){const O=b;console.log(`Setting up LSP client with URL: ${O}`),ye=new fn(O),ye.prependedData=sr||"",ye.onSignatureHelp=G=>{Se("_signature_help",G)}}break;case"set_lsp_header":sr=b,ye&&(ye.prependedData=b,ye.onSignatureHelp||(ye.onSignatureHelp=O=>{Se("_signature_help",O)}));break;case"get_lsp_header":const J=ye?ye.prependedData:"";Se("_lsp_header",J);break;case"vim_mode":if(b===!0){if(!Qe.vimMode){var C=document.getElementById("status");Qe.vimMode=vn.initVimMode(ae,C),console.log("Vim mode enabled")}}else Qe.vimMode&&(Qe.vimMode.dispose(),Qe.vimMode=null,console.log("Vim mode disabled"));break;case"update_workspace_config":if(!ye){console.log(ye),console.warn("LSP client not initialized, cannot update workspace config"),Se("_workspace_config_updated",{success:!1,error:"LSP client not initialized"});break}if(!b||typeof b!="object"){console.warn("Invalid data provided for workspace config update"),Se("_workspace_config_updated",{success:!1,error:"Invalid data provided"});break}ye.settings=b;break}}
