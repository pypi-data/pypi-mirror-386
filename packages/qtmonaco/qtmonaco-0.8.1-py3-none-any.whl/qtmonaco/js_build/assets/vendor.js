var Jt=Object.defineProperty;var Vt=(e,a,f)=>a in e?Jt(e,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):e[a]=f;var ee=(e,a,f)=>Vt(e,typeof a!="symbol"?a+"":a,f);var J={},je={},tt;function se(){if(tt)return je;tt=1,Object.defineProperty(je,"__esModule",{value:!0});let e;function a(){if(e===void 0)throw new Error("No runtime abstraction layer installed");return e}return function(f){function o(h){if(h===void 0)throw new Error("No runtime abstraction layer provided");e=h}f.install=o}(a||(a={})),je.default=a,je}var $={},rt;function Se(){if(rt)return $;rt=1,Object.defineProperty($,"__esModule",{value:!0}),$.stringArray=$.array=$.func=$.error=$.number=$.string=$.boolean=void 0;function e(s){return s===!0||s===!1}$.boolean=e;function a(s){return typeof s=="string"||s instanceof String}$.string=a;function f(s){return typeof s=="number"||s instanceof Number}$.number=f;function o(s){return s instanceof Error}$.error=o;function h(s){return typeof s=="function"}$.func=h;function r(s){return Array.isArray(s)}$.array=r;function c(s){return r(s)&&s.every(n=>a(n))}return $.stringArray=c,$}var te={},nt;function Ee(){if(nt)return te;nt=1,Object.defineProperty(te,"__esModule",{value:!0}),te.Emitter=te.Event=void 0;const e=se();var a;(function(h){const r={dispose(){}};h.None=function(){return r}})(a||(te.Event=a={}));class f{add(r,c=null,s){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(r),this._contexts.push(c),Array.isArray(s)&&s.push({dispose:()=>this.remove(r,c)})}remove(r,c=null){if(!this._callbacks)return;let s=!1;for(let n=0,d=this._callbacks.length;n<d;n++)if(this._callbacks[n]===r)if(this._contexts[n]===c){this._callbacks.splice(n,1),this._contexts.splice(n,1);return}else s=!0;if(s)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...r){if(!this._callbacks)return[];const c=[],s=this._callbacks.slice(0),n=this._contexts.slice(0);for(let d=0,l=s.length;d<l;d++)try{c.push(s[d].apply(n[d],r))}catch(m){(0,e.default)().console.error(m)}return c}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}}class o{constructor(r){this._options=r}get event(){return this._event||(this._event=(r,c,s)=>{this._callbacks||(this._callbacks=new f),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(r,c);const n={dispose:()=>{this._callbacks&&(this._callbacks.remove(r,c),n.dispose=o._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(s)&&s.push(n),n}),this._event}fire(r){this._callbacks&&this._callbacks.invoke.call(this._callbacks,r)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}return te.Emitter=o,o._noop=function(){},te}var Re={},it;function yt(){if(it)return Re;it=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.Semaphore=void 0;const e=se();class a{constructor(o=1){if(o<=0)throw new Error("Capacity must be greater than 0");this._capacity=o,this._active=0,this._waiting=[]}lock(o){return new Promise((h,r)=>{this._waiting.push({thunk:o,resolve:h,reject:r}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,e.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;const o=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{const h=o.thunk();h instanceof Promise?h.then(r=>{this._active--,o.resolve(r),this.runNext()},r=>{this._active--,o.reject(r),this.runNext()}):(this._active--,o.resolve(h),this.runNext())}catch(h){this._active--,o.reject(h),this.runNext()}}}return Re.Semaphore=a,Re}var st;function bt(){if(st)return J;st=1,Object.defineProperty(J,"__esModule",{value:!0}),J.ReadableStreamMessageReader=J.AbstractMessageReader=J.MessageReader=void 0;const e=se(),a=Se(),f=Ee(),o=yt();var h;(function(n){function d(l){let m=l;return m&&a.func(m.listen)&&a.func(m.dispose)&&a.func(m.onError)&&a.func(m.onClose)&&a.func(m.onPartialMessage)}n.is=d})(h||(J.MessageReader=h={}));class r{constructor(){this.errorEmitter=new f.Emitter,this.closeEmitter=new f.Emitter,this.partialMessageEmitter=new f.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(d){this.errorEmitter.fire(this.asError(d))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(d){this.partialMessageEmitter.fire(d)}asError(d){return d instanceof Error?d:new Error(`Reader received error. Reason: ${a.string(d.message)?d.message:"unknown"}`)}}J.AbstractMessageReader=r;var c;(function(n){function d(l){let m,g;const T=new Map;let S;const W=new Map;if(l===void 0||typeof l=="string")m=l??"utf-8";else{if(m=l.charset??"utf-8",l.contentDecoder!==void 0&&(g=l.contentDecoder,T.set(g.name,g)),l.contentDecoders!==void 0)for(const D of l.contentDecoders)T.set(D.name,D);if(l.contentTypeDecoder!==void 0&&(S=l.contentTypeDecoder,W.set(S.name,S)),l.contentTypeDecoders!==void 0)for(const D of l.contentTypeDecoders)W.set(D.name,D)}return S===void 0&&(S=(0,e.default)().applicationJson.decoder,W.set(S.name,S)),{charset:m,contentDecoder:g,contentDecoders:T,contentTypeDecoder:S,contentTypeDecoders:W}}n.fromOptions=d})(c||(c={}));class s extends r{constructor(d,l){super(),this.readable=d,this.options=c.fromOptions(l),this.buffer=(0,e.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new o.Semaphore(1)}set partialMessageTimeout(d){this._partialMessageTimeout=d}get partialMessageTimeout(){return this._partialMessageTimeout}listen(d){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=d;const l=this.readable.onData(m=>{this.onData(m)});return this.readable.onError(m=>this.fireError(m)),this.readable.onClose(()=>this.fireClose()),l}onData(d){try{for(this.buffer.append(d);;){if(this.nextMessageLength===-1){const m=this.buffer.tryReadHeaders(!0);if(!m)return;const g=m.get("content-length");if(!g){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(m))}`));return}const T=parseInt(g);if(isNaN(T)){this.fireError(new Error(`Content-Length value must be a number. Got ${g}`));return}this.nextMessageLength=T}const l=this.buffer.tryReadBody(this.nextMessageLength);if(l===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{const m=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(l):l,g=await this.options.contentTypeDecoder.decode(m,this.options);this.callback(g)}).catch(m=>{this.fireError(m)})}}catch(l){this.fireError(l)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,e.default)().timer.setTimeout((d,l)=>{this.partialMessageTimer=void 0,d===this.messageToken&&(this.firePartialMessage({messageToken:d,waitingTime:l}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}return J.ReadableStreamMessageReader=s,J}var Ht=bt();class Qt extends Ht.AbstractMessageReader{constructor(f){super();ee(this,"socket");ee(this,"state","initial");ee(this,"callback");ee(this,"events",[]);this.socket=f,this.socket.onMessage(o=>this.readMessage(o)),this.socket.onError(o=>this.fireError(o)),this.socket.onClose((o,h)=>{if(o!==1e3){const r={name:""+o,message:`Error during socket reconnect: code = ${o}, reason = ${h}`};this.fireError(r)}this.fireClose()})}listen(f){if(this.state==="initial")for(this.state="listening",this.callback=f;this.events.length!==0;){const o=this.events.pop();o.message!==void 0?this.readMessage(o.message):o.error!==void 0?this.fireError(o.error):this.fireClose()}return{dispose:()=>{this.callback===f&&(this.state="initial",this.callback=void 0)}}}dispose(){super.dispose(),this.state="initial",this.callback=void 0,this.events.splice(0,this.events.length)}readMessage(f){if(this.state==="initial")this.events.splice(0,0,{message:f});else if(this.state==="listening")try{const o=JSON.parse(f);this.callback(o)}catch(o){const h={name:"400",message:`Error during message parsing, reason = ${typeof o=="object"?o.message:"unknown"}`};this.fireError(h)}}fireError(f){this.state==="initial"?this.events.splice(0,0,{error:f}):this.state==="listening"&&super.fireError(f)}fireClose(){this.state==="initial"?this.events.splice(0,0,{}):this.state==="listening"&&super.fireClose(),this.state="closed"}}var V={},ot;function vt(){if(ot)return V;ot=1,Object.defineProperty(V,"__esModule",{value:!0}),V.WriteableStreamMessageWriter=V.AbstractMessageWriter=V.MessageWriter=void 0;const e=se(),a=Se(),f=yt(),o=Ee(),h="Content-Length: ",r=`\r
`;var c;(function(l){function m(g){let T=g;return T&&a.func(T.dispose)&&a.func(T.onClose)&&a.func(T.onError)&&a.func(T.write)}l.is=m})(c||(V.MessageWriter=c={}));class s{constructor(){this.errorEmitter=new o.Emitter,this.closeEmitter=new o.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(m,g,T){this.errorEmitter.fire([this.asError(m),g,T])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(m){return m instanceof Error?m:new Error(`Writer received error. Reason: ${a.string(m.message)?m.message:"unknown"}`)}}V.AbstractMessageWriter=s;var n;(function(l){function m(g){return g===void 0||typeof g=="string"?{charset:g??"utf-8",contentTypeEncoder:(0,e.default)().applicationJson.encoder}:{charset:g.charset??"utf-8",contentEncoder:g.contentEncoder,contentTypeEncoder:g.contentTypeEncoder??(0,e.default)().applicationJson.encoder}}l.fromOptions=m})(n||(n={}));class d extends s{constructor(m,g){super(),this.writable=m,this.options=n.fromOptions(g),this.errorCount=0,this.writeSemaphore=new f.Semaphore(1),this.writable.onError(T=>this.fireError(T)),this.writable.onClose(()=>this.fireClose())}async write(m){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(m,this.options).then(T=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(T):T).then(T=>{const S=[];return S.push(h,T.byteLength.toString(),r),S.push(r),this.doWrite(m,S,T)},T=>{throw this.fireError(T),T}))}async doWrite(m,g,T){try{return await this.writable.write(g.join(""),"ascii"),this.writable.write(T)}catch(S){return this.handleError(S,m),Promise.reject(S)}}handleError(m,g){this.errorCount++,this.fireError(m,g,this.errorCount)}end(){this.writable.end()}}return V.WriteableStreamMessageWriter=d,V}var Kt=vt();class Gt extends Kt.AbstractMessageWriter{constructor(f){super();ee(this,"errorCount",0);ee(this,"socket");this.socket=f}end(){}async write(f){try{const o=JSON.stringify(f);this.socket.send(o)}catch(o){this.errorCount++,this.fireError(o,f,this.errorCount)}}}var re={},Le={},Ie={},v={},at;function _t(){if(at)return v;at=1,Object.defineProperty(v,"__esModule",{value:!0}),v.Message=v.NotificationType9=v.NotificationType8=v.NotificationType7=v.NotificationType6=v.NotificationType5=v.NotificationType4=v.NotificationType3=v.NotificationType2=v.NotificationType1=v.NotificationType0=v.NotificationType=v.RequestType9=v.RequestType8=v.RequestType7=v.RequestType6=v.RequestType5=v.RequestType4=v.RequestType3=v.RequestType2=v.RequestType1=v.RequestType=v.RequestType0=v.AbstractMessageSignature=v.ParameterStructures=v.ResponseError=v.ErrorCodes=void 0;const e=Se();var a;(function(R){R.ParseError=-32700,R.InvalidRequest=-32600,R.MethodNotFound=-32601,R.InvalidParams=-32602,R.InternalError=-32603,R.jsonrpcReservedErrorRangeStart=-32099,R.serverErrorStart=-32099,R.MessageWriteError=-32099,R.MessageReadError=-32098,R.PendingResponseRejected=-32097,R.ConnectionInactive=-32096,R.ServerNotInitialized=-32002,R.UnknownErrorCode=-32001,R.jsonrpcReservedErrorRangeEnd=-32e3,R.serverErrorEnd=-32e3})(a||(v.ErrorCodes=a={}));class f extends Error{constructor(i,_,w){super(_),this.code=e.number(i)?i:a.UnknownErrorCode,this.data=w,Object.setPrototypeOf(this,f.prototype)}toJson(){const i={code:this.code,message:this.message};return this.data!==void 0&&(i.data=this.data),i}}v.ResponseError=f;class o{constructor(i){this.kind=i}static is(i){return i===o.auto||i===o.byName||i===o.byPosition}toString(){return this.kind}}v.ParameterStructures=o,o.auto=new o("auto"),o.byPosition=new o("byPosition"),o.byName=new o("byName");class h{constructor(i,_){this.method=i,this.numberOfParams=_}get parameterStructures(){return o.auto}}v.AbstractMessageSignature=h;class r extends h{constructor(i){super(i,0)}}v.RequestType0=r;class c extends h{constructor(i,_=o.auto){super(i,1),this._parameterStructures=_}get parameterStructures(){return this._parameterStructures}}v.RequestType=c;class s extends h{constructor(i,_=o.auto){super(i,1),this._parameterStructures=_}get parameterStructures(){return this._parameterStructures}}v.RequestType1=s;class n extends h{constructor(i){super(i,2)}}v.RequestType2=n;class d extends h{constructor(i){super(i,3)}}v.RequestType3=d;class l extends h{constructor(i){super(i,4)}}v.RequestType4=l;class m extends h{constructor(i){super(i,5)}}v.RequestType5=m;class g extends h{constructor(i){super(i,6)}}v.RequestType6=g;class T extends h{constructor(i){super(i,7)}}v.RequestType7=T;class S extends h{constructor(i){super(i,8)}}v.RequestType8=S;class W extends h{constructor(i){super(i,9)}}v.RequestType9=W;class D extends h{constructor(i,_=o.auto){super(i,1),this._parameterStructures=_}get parameterStructures(){return this._parameterStructures}}v.NotificationType=D;class U extends h{constructor(i){super(i,0)}}v.NotificationType0=U;class Q extends h{constructor(i,_=o.auto){super(i,1),this._parameterStructures=_}get parameterStructures(){return this._parameterStructures}}v.NotificationType1=Q;class pe extends h{constructor(i){super(i,2)}}v.NotificationType2=pe;class oe extends h{constructor(i){super(i,3)}}v.NotificationType3=oe;class ge extends h{constructor(i){super(i,4)}}v.NotificationType4=ge;class ae extends h{constructor(i){super(i,5)}}v.NotificationType5=ae;class ce extends h{constructor(i){super(i,6)}}v.NotificationType6=ce;class ue extends h{constructor(i){super(i,7)}}v.NotificationType7=ue;class de extends h{constructor(i){super(i,8)}}v.NotificationType8=de;class ke extends h{constructor(i){super(i,9)}}v.NotificationType9=ke;var B;return function(R){function i(b){const E=b;return E&&e.string(E.method)&&(e.string(E.id)||e.number(E.id))}R.isRequest=i;function _(b){const E=b;return E&&e.string(E.method)&&b.id===void 0}R.isNotification=_;function w(b){const E=b;return E&&(E.result!==void 0||!!E.error)&&(e.string(E.id)||e.number(E.id)||E.id===null)}R.isResponse=w}(B||(v.Message=B={})),v}var H={},ct;function Rt(){if(ct)return H;ct=1;var e;Object.defineProperty(H,"__esModule",{value:!0}),H.LRUCache=H.LinkedMap=H.Touch=void 0;var a;(function(h){h.None=0,h.First=1,h.AsOld=h.First,h.Last=2,h.AsNew=h.Last})(a||(H.Touch=a={}));class f{constructor(){this[e]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var r;return(r=this._head)==null?void 0:r.value}get last(){var r;return(r=this._tail)==null?void 0:r.value}has(r){return this._map.has(r)}get(r,c=a.None){const s=this._map.get(r);if(s)return c!==a.None&&this.touch(s,c),s.value}set(r,c,s=a.None){let n=this._map.get(r);if(n)n.value=c,s!==a.None&&this.touch(n,s);else{switch(n={key:r,value:c,next:void 0,previous:void 0},s){case a.None:this.addItemLast(n);break;case a.First:this.addItemFirst(n);break;case a.Last:this.addItemLast(n);break;default:this.addItemLast(n);break}this._map.set(r,n),this._size++}return this}delete(r){return!!this.remove(r)}remove(r){const c=this._map.get(r);if(c)return this._map.delete(r),this.removeItem(c),this._size--,c.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const r=this._head;return this._map.delete(r.key),this.removeItem(r),this._size--,r.value}forEach(r,c){const s=this._state;let n=this._head;for(;n;){if(c?r.bind(c)(n.value,n.key,this):r(n.value,n.key,this),this._state!==s)throw new Error("LinkedMap got modified during iteration.");n=n.next}}keys(){const r=this._state;let c=this._head;const s={[Symbol.iterator]:()=>s,next:()=>{if(this._state!==r)throw new Error("LinkedMap got modified during iteration.");if(c){const n={value:c.key,done:!1};return c=c.next,n}else return{value:void 0,done:!0}}};return s}values(){const r=this._state;let c=this._head;const s={[Symbol.iterator]:()=>s,next:()=>{if(this._state!==r)throw new Error("LinkedMap got modified during iteration.");if(c){const n={value:c.value,done:!1};return c=c.next,n}else return{value:void 0,done:!0}}};return s}entries(){const r=this._state;let c=this._head;const s={[Symbol.iterator]:()=>s,next:()=>{if(this._state!==r)throw new Error("LinkedMap got modified during iteration.");if(c){const n={value:[c.key,c.value],done:!1};return c=c.next,n}else return{value:void 0,done:!0}}};return s}[(e=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(r){if(r>=this.size)return;if(r===0){this.clear();return}let c=this._head,s=this.size;for(;c&&s>r;)this._map.delete(c.key),c=c.next,s--;this._head=c,this._size=s,c&&(c.previous=void 0),this._state++}addItemFirst(r){if(!this._head&&!this._tail)this._tail=r;else if(this._head)r.next=this._head,this._head.previous=r;else throw new Error("Invalid list");this._head=r,this._state++}addItemLast(r){if(!this._head&&!this._tail)this._head=r;else if(this._tail)r.previous=this._tail,this._tail.next=r;else throw new Error("Invalid list");this._tail=r,this._state++}removeItem(r){if(r===this._head&&r===this._tail)this._head=void 0,this._tail=void 0;else if(r===this._head){if(!r.next)throw new Error("Invalid list");r.next.previous=void 0,this._head=r.next}else if(r===this._tail){if(!r.previous)throw new Error("Invalid list");r.previous.next=void 0,this._tail=r.previous}else{const c=r.next,s=r.previous;if(!c||!s)throw new Error("Invalid list");c.previous=s,s.next=c}r.next=void 0,r.previous=void 0,this._state++}touch(r,c){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(c!==a.First&&c!==a.Last)){if(c===a.First){if(r===this._head)return;const s=r.next,n=r.previous;r===this._tail?(n.next=void 0,this._tail=n):(s.previous=n,n.next=s),r.previous=void 0,r.next=this._head,this._head.previous=r,this._head=r,this._state++}else if(c===a.Last){if(r===this._tail)return;const s=r.next,n=r.previous;r===this._head?(s.previous=void 0,this._head=s):(s.previous=n,n.next=s),r.next=void 0,r.previous=this._tail,this._tail.next=r,this._tail=r,this._state++}}}toJSON(){const r=[];return this.forEach((c,s)=>{r.push([s,c])}),r}fromJSON(r){this.clear();for(const[c,s]of r)this.set(c,s)}}H.LinkedMap=f;class o extends f{constructor(r,c=1){super(),this._limit=r,this._ratio=Math.min(Math.max(0,c),1)}get limit(){return this._limit}set limit(r){this._limit=r,this.checkTrim()}get ratio(){return this._ratio}set ratio(r){this._ratio=Math.min(Math.max(0,r),1),this.checkTrim()}get(r,c=a.AsNew){return super.get(r,c)}peek(r){return super.get(r,a.None)}set(r,c){return super.set(r,c,a.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}}return H.LRUCache=o,H}var we={},ut;function Xt(){if(ut)return we;ut=1,Object.defineProperty(we,"__esModule",{value:!0}),we.Disposable=void 0;var e;return function(a){function f(o){return{dispose:o}}a.create=f}(e||(we.Disposable=e={})),we}var ne={},dt;function ze(){if(dt)return ne;dt=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.CancellationTokenSource=ne.CancellationToken=void 0;const e=se(),a=Se(),f=Ee();var o;(function(s){s.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:f.Event.None}),s.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:f.Event.None});function n(d){const l=d;return l&&(l===s.None||l===s.Cancelled||a.boolean(l.isCancellationRequested)&&!!l.onCancellationRequested)}s.is=n})(o||(ne.CancellationToken=o={}));const h=Object.freeze(function(s,n){const d=(0,e.default)().timer.setTimeout(s.bind(n),0);return{dispose(){d.dispose()}}});class r{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?h:(this._emitter||(this._emitter=new f.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}class c{get token(){return this._token||(this._token=new r),this._token}cancel(){this._token?this._token.cancel():this._token=o.Cancelled}dispose(){this._token?this._token instanceof r&&this._token.dispose():this._token=o.None}}return ne.CancellationTokenSource=c,ne}var ie={},lt;function Yt(){if(lt)return ie;lt=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.SharedArrayReceiverStrategy=ie.SharedArraySenderStrategy=void 0;const e=ze();var a;(function(c){c.Continue=0,c.Cancelled=1})(a||(a={}));class f{constructor(){this.buffers=new Map}enableCancellation(s){if(s.id===null)return;const n=new SharedArrayBuffer(4),d=new Int32Array(n,0,1);d[0]=a.Continue,this.buffers.set(s.id,n),s.$cancellationData=n}async sendCancellation(s,n){const d=this.buffers.get(n);if(d===void 0)return;const l=new Int32Array(d,0,1);Atomics.store(l,0,a.Cancelled)}cleanup(s){this.buffers.delete(s)}dispose(){this.buffers.clear()}}ie.SharedArraySenderStrategy=f;class o{constructor(s){this.data=new Int32Array(s,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===a.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}}class h{constructor(s){this.token=new o(s)}cancel(){}dispose(){}}class r{constructor(){this.kind="request"}createCancellationTokenSource(s){const n=s.$cancellationData;return n===void 0?new e.CancellationTokenSource:new h(n)}}return ie.SharedArrayReceiverStrategy=r,ie}var Te={},ft;function Zt(){if(ft)return Te;ft=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.AbstractMessageBuffer=void 0;const e=13,a=10,f=`\r
`;class o{constructor(r="utf-8"){this._encoding=r,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(r){const c=typeof r=="string"?this.fromString(r,this._encoding):r;this._chunks.push(c),this._totalLength+=c.byteLength}tryReadHeaders(r=!1){if(this._chunks.length===0)return;let c=0,s=0,n=0,d=0;e:for(;s<this._chunks.length;){const T=this._chunks[s];for(n=0;n<T.length;){switch(T[n]){case e:switch(c){case 0:c=1;break;case 2:c=3;break;default:c=0}break;case a:switch(c){case 1:c=2;break;case 3:c=4,n++;break e;default:c=0}break;default:c=0}n++}d+=T.byteLength,s++}if(c!==4)return;const l=this._read(d+n),m=new Map,g=this.toString(l,"ascii").split(f);if(g.length<2)return m;for(let T=0;T<g.length-2;T++){const S=g[T],W=S.indexOf(":");if(W===-1)throw new Error(`Message header must separate key and value using ':'
${S}`);const D=S.substr(0,W),U=S.substr(W+1).trim();m.set(r?D.toLowerCase():D,U)}return m}tryReadBody(r){if(!(this._totalLength<r))return this._read(r)}get numberOfBytes(){return this._totalLength}_read(r){if(r===0)return this.emptyBuffer();if(r>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===r){const d=this._chunks[0];return this._chunks.shift(),this._totalLength-=r,this.asNative(d)}if(this._chunks[0].byteLength>r){const d=this._chunks[0],l=this.asNative(d,r);return this._chunks[0]=d.slice(r),this._totalLength-=r,l}const c=this.allocNative(r);let s=0,n=0;for(;r>0;){const d=this._chunks[n];if(d.byteLength>r){const l=d.slice(0,r);c.set(l,s),s+=r,this._chunks[n]=d.slice(r),this._totalLength-=r,r-=r}else c.set(d,s),s+=d.byteLength,this._chunks.shift(),this._totalLength-=d.byteLength,r-=d.byteLength}return c}}return Te.AbstractMessageBuffer=o,Te}var We={},ht;function xt(){return ht||(ht=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createMessageConnection=e.ConnectionOptions=e.MessageStrategy=e.CancellationStrategy=e.CancellationSenderStrategy=e.CancellationReceiverStrategy=e.RequestCancellationReceiverStrategy=e.IdCancellationReceiverStrategy=e.ConnectionStrategy=e.ConnectionError=e.ConnectionErrors=e.LogTraceNotification=e.SetTraceNotification=e.TraceFormat=e.TraceValues=e.Trace=e.NullLogger=e.ProgressType=e.ProgressToken=void 0;const a=se(),f=Se(),o=_t(),h=Rt(),r=Ee(),c=ze();var s;(function(i){i.type=new o.NotificationType("$/cancelRequest")})(s||(s={}));var n;(function(i){function _(w){return typeof w=="string"||typeof w=="number"}i.is=_})(n||(e.ProgressToken=n={}));var d;(function(i){i.type=new o.NotificationType("$/progress")})(d||(d={}));class l{constructor(){}}e.ProgressType=l;var m;(function(i){function _(w){return f.func(w)}i.is=_})(m||(m={})),e.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var g;(function(i){i[i.Off=0]="Off",i[i.Messages=1]="Messages",i[i.Compact=2]="Compact",i[i.Verbose=3]="Verbose"})(g||(e.Trace=g={}));var T;(function(i){i.Off="off",i.Messages="messages",i.Compact="compact",i.Verbose="verbose"})(T||(e.TraceValues=T={})),function(i){function _(b){if(!f.string(b))return i.Off;switch(b=b.toLowerCase(),b){case"off":return i.Off;case"messages":return i.Messages;case"compact":return i.Compact;case"verbose":return i.Verbose;default:return i.Off}}i.fromString=_;function w(b){switch(b){case i.Off:return"off";case i.Messages:return"messages";case i.Compact:return"compact";case i.Verbose:return"verbose";default:return"off"}}i.toString=w}(g||(e.Trace=g={}));var S;(function(i){i.Text="text",i.JSON="json"})(S||(e.TraceFormat=S={})),function(i){function _(w){return f.string(w)?(w=w.toLowerCase(),w==="json"?i.JSON:i.Text):i.Text}i.fromString=_}(S||(e.TraceFormat=S={}));var W;(function(i){i.type=new o.NotificationType("$/setTrace")})(W||(e.SetTraceNotification=W={}));var D;(function(i){i.type=new o.NotificationType("$/logTrace")})(D||(e.LogTraceNotification=D={}));var U;(function(i){i[i.Closed=1]="Closed",i[i.Disposed=2]="Disposed",i[i.AlreadyListening=3]="AlreadyListening"})(U||(e.ConnectionErrors=U={}));class Q extends Error{constructor(_,w){super(w),this.code=_,Object.setPrototypeOf(this,Q.prototype)}}e.ConnectionError=Q;var pe;(function(i){function _(w){const b=w;return b&&f.func(b.cancelUndispatched)}i.is=_})(pe||(e.ConnectionStrategy=pe={}));var oe;(function(i){function _(w){const b=w;return b&&(b.kind===void 0||b.kind==="id")&&f.func(b.createCancellationTokenSource)&&(b.dispose===void 0||f.func(b.dispose))}i.is=_})(oe||(e.IdCancellationReceiverStrategy=oe={}));var ge;(function(i){function _(w){const b=w;return b&&b.kind==="request"&&f.func(b.createCancellationTokenSource)&&(b.dispose===void 0||f.func(b.dispose))}i.is=_})(ge||(e.RequestCancellationReceiverStrategy=ge={}));var ae;(function(i){i.Message=Object.freeze({createCancellationTokenSource(w){return new c.CancellationTokenSource}});function _(w){return oe.is(w)||ge.is(w)}i.is=_})(ae||(e.CancellationReceiverStrategy=ae={}));var ce;(function(i){i.Message=Object.freeze({sendCancellation(w,b){return w.sendNotification(s.type,{id:b})},cleanup(w){}});function _(w){const b=w;return b&&f.func(b.sendCancellation)&&f.func(b.cleanup)}i.is=_})(ce||(e.CancellationSenderStrategy=ce={}));var ue;(function(i){i.Message=Object.freeze({receiver:ae.Message,sender:ce.Message});function _(w){const b=w;return b&&ae.is(b.receiver)&&ce.is(b.sender)}i.is=_})(ue||(e.CancellationStrategy=ue={}));var de;(function(i){function _(w){const b=w;return b&&f.func(b.handleMessage)}i.is=_})(de||(e.MessageStrategy=de={}));var ke;(function(i){function _(w){const b=w;return b&&(ue.is(b.cancellationStrategy)||pe.is(b.connectionStrategy)||de.is(b.messageStrategy))}i.is=_})(ke||(e.ConnectionOptions=ke={}));var B;(function(i){i[i.New=1]="New",i[i.Listening=2]="Listening",i[i.Closed=3]="Closed",i[i.Disposed=4]="Disposed"})(B||(B={}));function R(i,_,w,b){const E=w!==void 0?w:e.NullLogger;let wt=0,Tt=0,St=0;const me="2.0";let ye;const Ne=new Map;let be;const Ce=new Map,Pe=new Map;let qe,Z=new h.LinkedMap,K=new Map,Me=new Set,F=new Map,M=g.Off,x=S.Text,q,G=B.New;const Ae=new r.Emitter,Ue=new r.Emitter,Fe=new r.Emitter,Je=new r.Emitter,Ve=new r.Emitter,X=b&&b.cancellationStrategy?b.cancellationStrategy:ue.Message;function He(t){if(t===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+t.toString()}function Et(t){return t===null?"res-unknown-"+(++St).toString():"res-"+t.toString()}function kt(){return"not-"+(++Tt).toString()}function Nt(t,u){o.Message.isRequest(u)?t.set(He(u.id),u):o.Message.isResponse(u)?t.set(Et(u.id),u):t.set(kt(),u)}function Ct(t){}function Qe(){return G===B.Listening}function Ke(){return G===B.Closed}function le(){return G===B.Disposed}function Ge(){(G===B.New||G===B.Listening)&&(G=B.Closed,Ue.fire(void 0))}function Pt(t){Ae.fire([t,void 0,void 0])}function Mt(t){Ae.fire(t)}i.onClose(Ge),i.onError(Pt),_.onClose(Ge),_.onError(Mt);function Xe(){qe||Z.size===0||(qe=(0,a.default)().timer.setImmediate(()=>{qe=void 0,Ot()}))}function Ye(t){o.Message.isRequest(t)?Lt(t):o.Message.isNotification(t)?At(t):o.Message.isResponse(t)?qt(t):$t(t)}function Ot(){if(Z.size===0)return;const t=Z.shift();try{const u=b==null?void 0:b.messageStrategy;de.is(u)?u.handleMessage(t,Ye):Ye(t)}finally{Xe()}}const jt=t=>{try{if(o.Message.isNotification(t)&&t.method===s.type.method){const u=t.params.id,p=He(u),y=Z.get(p);if(o.Message.isRequest(y)){const C=b==null?void 0:b.connectionStrategy,P=C&&C.cancelUndispatched?C.cancelUndispatched(y,Ct):void 0;if(P&&(P.error!==void 0||P.result!==void 0)){Z.delete(p),F.delete(u),P.id=y.id,Oe(P,t.method,Date.now()),_.write(P).catch(()=>E.error("Sending response for canceled message failed."));return}}const O=F.get(u);if(O!==void 0){O.cancel(),$e(t);return}else Me.add(u)}Nt(Z,t)}finally{Xe()}};function Lt(t){if(le())return;function u(k,j,N){const A={jsonrpc:me,id:t.id};k instanceof o.ResponseError?A.error=k.toJson():A.result=k===void 0?null:k,Oe(A,j,N),_.write(A).catch(()=>E.error("Sending response failed."))}function p(k,j,N){const A={jsonrpc:me,id:t.id,error:k.toJson()};Oe(A,j,N),_.write(A).catch(()=>E.error("Sending response failed."))}function y(k,j,N){k===void 0&&(k=null);const A={jsonrpc:me,id:t.id,result:k};Oe(A,j,N),_.write(A).catch(()=>E.error("Sending response failed."))}Wt(t);const O=Ne.get(t.method);let C,P;O&&(C=O.type,P=O.handler);const L=Date.now();if(P||ye){const k=t.id??String(Date.now()),j=oe.is(X.receiver)?X.receiver.createCancellationTokenSource(k):X.receiver.createCancellationTokenSource(t);t.id!==null&&Me.has(t.id)&&j.cancel(),t.id!==null&&F.set(k,j);try{let N;if(P)if(t.params===void 0){if(C!==void 0&&C.numberOfParams!==0){p(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${t.method} defines ${C.numberOfParams} params but received none.`),t.method,L);return}N=P(j.token)}else if(Array.isArray(t.params)){if(C!==void 0&&C.parameterStructures===o.ParameterStructures.byName){p(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${t.method} defines parameters by name but received parameters by position`),t.method,L);return}N=P(...t.params,j.token)}else{if(C!==void 0&&C.parameterStructures===o.ParameterStructures.byPosition){p(new o.ResponseError(o.ErrorCodes.InvalidParams,`Request ${t.method} defines parameters by position but received parameters by name`),t.method,L);return}N=P(t.params,j.token)}else ye&&(N=ye(t.method,t.params,j.token));const A=N;N?A.then?A.then(I=>{F.delete(k),u(I,t.method,L)},I=>{F.delete(k),I instanceof o.ResponseError?p(I,t.method,L):I&&f.string(I.message)?p(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${t.method} failed with message: ${I.message}`),t.method,L):p(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${t.method} failed unexpectedly without providing any details.`),t.method,L)}):(F.delete(k),u(N,t.method,L)):(F.delete(k),y(N,t.method,L))}catch(N){F.delete(k),N instanceof o.ResponseError?u(N,t.method,L):N&&f.string(N.message)?p(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${t.method} failed with message: ${N.message}`),t.method,L):p(new o.ResponseError(o.ErrorCodes.InternalError,`Request ${t.method} failed unexpectedly without providing any details.`),t.method,L)}}else p(new o.ResponseError(o.ErrorCodes.MethodNotFound,`Unhandled method ${t.method}`),t.method,L)}function qt(t){if(!le())if(t.id===null)t.error?E.error(`Received response message without id: Error is: 
${JSON.stringify(t.error,void 0,4)}`):E.error("Received response message without id. No further error information provided.");else{const u=t.id,p=K.get(u);if(Bt(t,p),p!==void 0){K.delete(u);try{if(t.error){const y=t.error;p.reject(new o.ResponseError(y.code,y.message,y.data))}else if(t.result!==void 0)p.resolve(t.result);else throw new Error("Should never happen.")}catch(y){y.message?E.error(`Response handler '${p.method}' failed with message: ${y.message}`):E.error(`Response handler '${p.method}' failed unexpectedly.`)}}}}function At(t){if(le())return;let u,p;if(t.method===s.type.method){const y=t.params.id;Me.delete(y),$e(t);return}else{const y=Ce.get(t.method);y&&(p=y.handler,u=y.type)}if(p||be)try{if($e(t),p)if(t.params===void 0)u!==void 0&&u.numberOfParams!==0&&u.parameterStructures!==o.ParameterStructures.byName&&E.error(`Notification ${t.method} defines ${u.numberOfParams} params but received none.`),p();else if(Array.isArray(t.params)){const y=t.params;t.method===d.type.method&&y.length===2&&n.is(y[0])?p({token:y[0],value:y[1]}):(u!==void 0&&(u.parameterStructures===o.ParameterStructures.byName&&E.error(`Notification ${t.method} defines parameters by name but received parameters by position`),u.numberOfParams!==t.params.length&&E.error(`Notification ${t.method} defines ${u.numberOfParams} params but received ${y.length} arguments`)),p(...y))}else u!==void 0&&u.parameterStructures===o.ParameterStructures.byPosition&&E.error(`Notification ${t.method} defines parameters by position but received parameters by name`),p(t.params);else be&&be(t.method,t.params)}catch(y){y.message?E.error(`Notification handler '${t.method}' failed with message: ${y.message}`):E.error(`Notification handler '${t.method}' failed unexpectedly.`)}else Fe.fire(t)}function $t(t){if(!t){E.error("Received empty message.");return}E.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(t,null,4)}`);const u=t;if(f.string(u.id)||f.number(u.id)){const p=u.id,y=K.get(p);y&&y.reject(new Error("The received response has neither a result nor an error property."))}}function Y(t){if(t!=null)switch(M){case g.Verbose:return JSON.stringify(t,null,4);case g.Compact:return JSON.stringify(t);default:return}}function Dt(t){if(!(M===g.Off||!q))if(x===S.Text){let u;(M===g.Verbose||M===g.Compact)&&t.params&&(u=`Params: ${Y(t.params)}

`),q.log(`Sending request '${t.method} - (${t.id})'.`,u)}else fe("send-request",t)}function It(t){if(!(M===g.Off||!q))if(x===S.Text){let u;(M===g.Verbose||M===g.Compact)&&(t.params?u=`Params: ${Y(t.params)}

`:u=`No parameters provided.

`),q.log(`Sending notification '${t.method}'.`,u)}else fe("send-notification",t)}function Oe(t,u,p){if(!(M===g.Off||!q))if(x===S.Text){let y;(M===g.Verbose||M===g.Compact)&&(t.error&&t.error.data?y=`Error data: ${Y(t.error.data)}

`:t.result?y=`Result: ${Y(t.result)}

`:t.error===void 0&&(y=`No result returned.

`)),q.log(`Sending response '${u} - (${t.id})'. Processing request took ${Date.now()-p}ms`,y)}else fe("send-response",t)}function Wt(t){if(!(M===g.Off||!q))if(x===S.Text){let u;(M===g.Verbose||M===g.Compact)&&t.params&&(u=`Params: ${Y(t.params)}

`),q.log(`Received request '${t.method} - (${t.id})'.`,u)}else fe("receive-request",t)}function $e(t){if(!(M===g.Off||!q||t.method===D.type.method))if(x===S.Text){let u;(M===g.Verbose||M===g.Compact)&&(t.params?u=`Params: ${Y(t.params)}

`:u=`No parameters provided.

`),q.log(`Received notification '${t.method}'.`,u)}else fe("receive-notification",t)}function Bt(t,u){if(!(M===g.Off||!q))if(x===S.Text){let p;if((M===g.Verbose||M===g.Compact)&&(t.error&&t.error.data?p=`Error data: ${Y(t.error.data)}

`:t.result?p=`Result: ${Y(t.result)}

`:t.error===void 0&&(p=`No result returned.

`)),u){const y=t.error?` Request failed: ${t.error.message} (${t.error.code}).`:"";q.log(`Received response '${u.method} - (${t.id})' in ${Date.now()-u.timerStart}ms.${y}`,p)}else q.log(`Received response ${t.id} without active response promise.`,p)}else fe("receive-response",t)}function fe(t,u){if(!q||M===g.Off)return;const p={isLSPMessage:!0,type:t,message:u,timestamp:Date.now()};q.log(p)}function ve(){if(Ke())throw new Q(U.Closed,"Connection is closed.");if(le())throw new Q(U.Disposed,"Connection is disposed.")}function zt(){if(Qe())throw new Q(U.AlreadyListening,"Connection is already listening")}function Ut(){if(!Qe())throw new Error("Call listen() first.")}function _e(t){return t===void 0?null:t}function Ze(t){if(t!==null)return t}function xe(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function De(t,u){switch(t){case o.ParameterStructures.auto:return xe(u)?Ze(u):[_e(u)];case o.ParameterStructures.byName:if(!xe(u))throw new Error("Received parameters by name but param is not an object literal.");return Ze(u);case o.ParameterStructures.byPosition:return[_e(u)];default:throw new Error(`Unknown parameter structure ${t.toString()}`)}}function et(t,u){let p;const y=t.numberOfParams;switch(y){case 0:p=void 0;break;case 1:p=De(t.parameterStructures,u[0]);break;default:p=[];for(let O=0;O<u.length&&O<y;O++)p.push(_e(u[O]));if(u.length<y)for(let O=u.length;O<y;O++)p.push(null);break}return p}const he={sendNotification:(t,...u)=>{ve();let p,y;if(f.string(t)){p=t;const C=u[0];let P=0,L=o.ParameterStructures.auto;o.ParameterStructures.is(C)&&(P=1,L=C);let k=u.length;const j=k-P;switch(j){case 0:y=void 0;break;case 1:y=De(L,u[P]);break;default:if(L===o.ParameterStructures.byName)throw new Error(`Received ${j} parameters for 'by Name' notification parameter structure.`);y=u.slice(P,k).map(N=>_e(N));break}}else{const C=u;p=t.method,y=et(t,C)}const O={jsonrpc:me,method:p,params:y};return It(O),_.write(O).catch(C=>{throw E.error("Sending notification failed."),C})},onNotification:(t,u)=>{ve();let p;return f.func(t)?be=t:u&&(f.string(t)?(p=t,Ce.set(t,{type:void 0,handler:u})):(p=t.method,Ce.set(t.method,{type:t,handler:u}))),{dispose:()=>{p!==void 0?Ce.delete(p):be=void 0}}},onProgress:(t,u,p)=>{if(Pe.has(u))throw new Error(`Progress handler for token ${u} already registered`);return Pe.set(u,p),{dispose:()=>{Pe.delete(u)}}},sendProgress:(t,u,p)=>he.sendNotification(d.type,{token:u,value:p}),onUnhandledProgress:Je.event,sendRequest:(t,...u)=>{ve(),Ut();let p,y,O;if(f.string(t)){p=t;const k=u[0],j=u[u.length-1];let N=0,A=o.ParameterStructures.auto;o.ParameterStructures.is(k)&&(N=1,A=k);let I=u.length;c.CancellationToken.is(j)&&(I=I-1,O=j);const z=I-N;switch(z){case 0:y=void 0;break;case 1:y=De(A,u[N]);break;default:if(A===o.ParameterStructures.byName)throw new Error(`Received ${z} parameters for 'by Name' request parameter structure.`);y=u.slice(N,I).map(Ft=>_e(Ft));break}}else{const k=u;p=t.method,y=et(t,k);const j=t.numberOfParams;O=c.CancellationToken.is(k[j])?k[j]:void 0}const C=wt++;let P;O&&(P=O.onCancellationRequested(()=>{const k=X.sender.sendCancellation(he,C);return k===void 0?(E.log(`Received no promise from cancellation strategy when cancelling id ${C}`),Promise.resolve()):k.catch(()=>{E.log(`Sending cancellation messages for id ${C} failed`)})}));const L={jsonrpc:me,id:C,method:p,params:y};return Dt(L),typeof X.sender.enableCancellation=="function"&&X.sender.enableCancellation(L),new Promise(async(k,j)=>{const N=z=>{k(z),X.sender.cleanup(C),P==null||P.dispose()},A=z=>{j(z),X.sender.cleanup(C),P==null||P.dispose()},I={method:p,timerStart:Date.now(),resolve:N,reject:A};try{K.set(C,I),await _.write(L)}catch(z){throw K.delete(C),I.reject(new o.ResponseError(o.ErrorCodes.MessageWriteError,z.message?z.message:"Unknown reason")),E.error("Sending request failed."),z}})},onRequest:(t,u)=>{ve();let p=null;return m.is(t)?(p=void 0,ye=t):f.string(t)?(p=null,u!==void 0&&(p=t,Ne.set(t,{handler:u,type:void 0}))):u!==void 0&&(p=t.method,Ne.set(t.method,{type:t,handler:u})),{dispose:()=>{p!==null&&(p!==void 0?Ne.delete(p):ye=void 0)}}},hasPendingResponse:()=>K.size>0,trace:async(t,u,p)=>{let y=!1,O=S.Text;p!==void 0&&(f.boolean(p)?y=p:(y=p.sendNotification||!1,O=p.traceFormat||S.Text)),M=t,x=O,M===g.Off?q=void 0:q=u,y&&!Ke()&&!le()&&await he.sendNotification(W.type,{value:g.toString(t)})},onError:Ae.event,onClose:Ue.event,onUnhandledNotification:Fe.event,onDispose:Ve.event,end:()=>{_.end()},dispose:()=>{if(le())return;G=B.Disposed,Ve.fire(void 0);const t=new o.ResponseError(o.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(const u of K.values())u.reject(t);K=new Map,F=new Map,Me=new Set,Z=new h.LinkedMap,f.func(_.dispose)&&_.dispose(),f.func(i.dispose)&&i.dispose()},listen:()=>{ve(),zt(),G=B.Listening,i.listen(jt)},inspect:()=>{(0,a.default)().console.log("inspect")}};return he.onNotification(D.type,t=>{if(M===g.Off||!q)return;const u=M===g.Verbose||M===g.Compact;q.log(t.message,u?t.verbose:void 0)}),he.onNotification(d.type,t=>{const u=Pe.get(t.token);u?u(t.value):Je.fire(t)}),he}e.createMessageConnection=R}(We)),We}var pt;function Be(){return pt||(pt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProgressType=e.ProgressToken=e.createMessageConnection=e.NullLogger=e.ConnectionOptions=e.ConnectionStrategy=e.AbstractMessageBuffer=e.WriteableStreamMessageWriter=e.AbstractMessageWriter=e.MessageWriter=e.ReadableStreamMessageReader=e.AbstractMessageReader=e.MessageReader=e.SharedArrayReceiverStrategy=e.SharedArraySenderStrategy=e.CancellationToken=e.CancellationTokenSource=e.Emitter=e.Event=e.Disposable=e.LRUCache=e.Touch=e.LinkedMap=e.ParameterStructures=e.NotificationType9=e.NotificationType8=e.NotificationType7=e.NotificationType6=e.NotificationType5=e.NotificationType4=e.NotificationType3=e.NotificationType2=e.NotificationType1=e.NotificationType0=e.NotificationType=e.ErrorCodes=e.ResponseError=e.RequestType9=e.RequestType8=e.RequestType7=e.RequestType6=e.RequestType5=e.RequestType4=e.RequestType3=e.RequestType2=e.RequestType1=e.RequestType0=e.RequestType=e.Message=e.RAL=void 0,e.MessageStrategy=e.CancellationStrategy=e.CancellationSenderStrategy=e.CancellationReceiverStrategy=e.ConnectionError=e.ConnectionErrors=e.LogTraceNotification=e.SetTraceNotification=e.TraceFormat=e.TraceValues=e.Trace=void 0;const a=_t();Object.defineProperty(e,"Message",{enumerable:!0,get:function(){return a.Message}}),Object.defineProperty(e,"RequestType",{enumerable:!0,get:function(){return a.RequestType}}),Object.defineProperty(e,"RequestType0",{enumerable:!0,get:function(){return a.RequestType0}}),Object.defineProperty(e,"RequestType1",{enumerable:!0,get:function(){return a.RequestType1}}),Object.defineProperty(e,"RequestType2",{enumerable:!0,get:function(){return a.RequestType2}}),Object.defineProperty(e,"RequestType3",{enumerable:!0,get:function(){return a.RequestType3}}),Object.defineProperty(e,"RequestType4",{enumerable:!0,get:function(){return a.RequestType4}}),Object.defineProperty(e,"RequestType5",{enumerable:!0,get:function(){return a.RequestType5}}),Object.defineProperty(e,"RequestType6",{enumerable:!0,get:function(){return a.RequestType6}}),Object.defineProperty(e,"RequestType7",{enumerable:!0,get:function(){return a.RequestType7}}),Object.defineProperty(e,"RequestType8",{enumerable:!0,get:function(){return a.RequestType8}}),Object.defineProperty(e,"RequestType9",{enumerable:!0,get:function(){return a.RequestType9}}),Object.defineProperty(e,"ResponseError",{enumerable:!0,get:function(){return a.ResponseError}}),Object.defineProperty(e,"ErrorCodes",{enumerable:!0,get:function(){return a.ErrorCodes}}),Object.defineProperty(e,"NotificationType",{enumerable:!0,get:function(){return a.NotificationType}}),Object.defineProperty(e,"NotificationType0",{enumerable:!0,get:function(){return a.NotificationType0}}),Object.defineProperty(e,"NotificationType1",{enumerable:!0,get:function(){return a.NotificationType1}}),Object.defineProperty(e,"NotificationType2",{enumerable:!0,get:function(){return a.NotificationType2}}),Object.defineProperty(e,"NotificationType3",{enumerable:!0,get:function(){return a.NotificationType3}}),Object.defineProperty(e,"NotificationType4",{enumerable:!0,get:function(){return a.NotificationType4}}),Object.defineProperty(e,"NotificationType5",{enumerable:!0,get:function(){return a.NotificationType5}}),Object.defineProperty(e,"NotificationType6",{enumerable:!0,get:function(){return a.NotificationType6}}),Object.defineProperty(e,"NotificationType7",{enumerable:!0,get:function(){return a.NotificationType7}}),Object.defineProperty(e,"NotificationType8",{enumerable:!0,get:function(){return a.NotificationType8}}),Object.defineProperty(e,"NotificationType9",{enumerable:!0,get:function(){return a.NotificationType9}}),Object.defineProperty(e,"ParameterStructures",{enumerable:!0,get:function(){return a.ParameterStructures}});const f=Rt();Object.defineProperty(e,"LinkedMap",{enumerable:!0,get:function(){return f.LinkedMap}}),Object.defineProperty(e,"LRUCache",{enumerable:!0,get:function(){return f.LRUCache}}),Object.defineProperty(e,"Touch",{enumerable:!0,get:function(){return f.Touch}});const o=Xt();Object.defineProperty(e,"Disposable",{enumerable:!0,get:function(){return o.Disposable}});const h=Ee();Object.defineProperty(e,"Event",{enumerable:!0,get:function(){return h.Event}}),Object.defineProperty(e,"Emitter",{enumerable:!0,get:function(){return h.Emitter}});const r=ze();Object.defineProperty(e,"CancellationTokenSource",{enumerable:!0,get:function(){return r.CancellationTokenSource}}),Object.defineProperty(e,"CancellationToken",{enumerable:!0,get:function(){return r.CancellationToken}});const c=Yt();Object.defineProperty(e,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return c.SharedArraySenderStrategy}}),Object.defineProperty(e,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return c.SharedArrayReceiverStrategy}});const s=bt();Object.defineProperty(e,"MessageReader",{enumerable:!0,get:function(){return s.MessageReader}}),Object.defineProperty(e,"AbstractMessageReader",{enumerable:!0,get:function(){return s.AbstractMessageReader}}),Object.defineProperty(e,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return s.ReadableStreamMessageReader}});const n=vt();Object.defineProperty(e,"MessageWriter",{enumerable:!0,get:function(){return n.MessageWriter}}),Object.defineProperty(e,"AbstractMessageWriter",{enumerable:!0,get:function(){return n.AbstractMessageWriter}}),Object.defineProperty(e,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return n.WriteableStreamMessageWriter}});const d=Zt();Object.defineProperty(e,"AbstractMessageBuffer",{enumerable:!0,get:function(){return d.AbstractMessageBuffer}});const l=xt();Object.defineProperty(e,"ConnectionStrategy",{enumerable:!0,get:function(){return l.ConnectionStrategy}}),Object.defineProperty(e,"ConnectionOptions",{enumerable:!0,get:function(){return l.ConnectionOptions}}),Object.defineProperty(e,"NullLogger",{enumerable:!0,get:function(){return l.NullLogger}}),Object.defineProperty(e,"createMessageConnection",{enumerable:!0,get:function(){return l.createMessageConnection}}),Object.defineProperty(e,"ProgressToken",{enumerable:!0,get:function(){return l.ProgressToken}}),Object.defineProperty(e,"ProgressType",{enumerable:!0,get:function(){return l.ProgressType}}),Object.defineProperty(e,"Trace",{enumerable:!0,get:function(){return l.Trace}}),Object.defineProperty(e,"TraceValues",{enumerable:!0,get:function(){return l.TraceValues}}),Object.defineProperty(e,"TraceFormat",{enumerable:!0,get:function(){return l.TraceFormat}}),Object.defineProperty(e,"SetTraceNotification",{enumerable:!0,get:function(){return l.SetTraceNotification}}),Object.defineProperty(e,"LogTraceNotification",{enumerable:!0,get:function(){return l.LogTraceNotification}}),Object.defineProperty(e,"ConnectionErrors",{enumerable:!0,get:function(){return l.ConnectionErrors}}),Object.defineProperty(e,"ConnectionError",{enumerable:!0,get:function(){return l.ConnectionError}}),Object.defineProperty(e,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return l.CancellationReceiverStrategy}}),Object.defineProperty(e,"CancellationSenderStrategy",{enumerable:!0,get:function(){return l.CancellationSenderStrategy}}),Object.defineProperty(e,"CancellationStrategy",{enumerable:!0,get:function(){return l.CancellationStrategy}}),Object.defineProperty(e,"MessageStrategy",{enumerable:!0,get:function(){return l.MessageStrategy}});const m=se();e.RAL=m.default}(Ie)),Ie}var gt;function er(){if(gt)return Le;gt=1,Object.defineProperty(Le,"__esModule",{value:!0});const e=Be();class a extends e.AbstractMessageBuffer{constructor(n="utf-8"){super(n),this.asciiDecoder=new TextDecoder("ascii")}emptyBuffer(){return a.emptyBuffer}fromString(n,d){return new TextEncoder().encode(n)}toString(n,d){return d==="ascii"?this.asciiDecoder.decode(n):new TextDecoder(d).decode(n)}asNative(n,d){return d===void 0?n:n.slice(0,d)}allocNative(n){return new Uint8Array(n)}}a.emptyBuffer=new Uint8Array(0);class f{constructor(n){this.socket=n,this._onData=new e.Emitter,this._messageListener=d=>{d.data.arrayBuffer().then(m=>{this._onData.fire(new Uint8Array(m))},()=>{(0,e.RAL)().console.error("Converting blob to array buffer failed.")})},this.socket.addEventListener("message",this._messageListener)}onClose(n){return this.socket.addEventListener("close",n),e.Disposable.create(()=>this.socket.removeEventListener("close",n))}onError(n){return this.socket.addEventListener("error",n),e.Disposable.create(()=>this.socket.removeEventListener("error",n))}onEnd(n){return this.socket.addEventListener("end",n),e.Disposable.create(()=>this.socket.removeEventListener("end",n))}onData(n){return this._onData.event(n)}}class o{constructor(n){this.socket=n}onClose(n){return this.socket.addEventListener("close",n),e.Disposable.create(()=>this.socket.removeEventListener("close",n))}onError(n){return this.socket.addEventListener("error",n),e.Disposable.create(()=>this.socket.removeEventListener("error",n))}onEnd(n){return this.socket.addEventListener("end",n),e.Disposable.create(()=>this.socket.removeEventListener("end",n))}write(n,d){if(typeof n=="string"){if(d!==void 0&&d!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${d}`);this.socket.send(n)}else this.socket.send(n);return Promise.resolve()}end(){this.socket.close()}}const h=new TextEncoder,r=Object.freeze({messageBuffer:Object.freeze({create:s=>new a(s)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(s,n)=>{if(n.charset!=="utf-8")throw new Error(`In a Browser environments only utf-8 text encoding is supported. But got encoding: ${n.charset}`);return Promise.resolve(h.encode(JSON.stringify(s,void 0,0)))}}),decoder:Object.freeze({name:"application/json",decode:(s,n)=>{if(!(s instanceof Uint8Array))throw new Error("In a Browser environments only Uint8Arrays are supported.");return Promise.resolve(JSON.parse(new TextDecoder(n.charset).decode(s)))}})}),stream:Object.freeze({asReadableStream:s=>new f(s),asWritableStream:s=>new o(s)}),console,timer:Object.freeze({setTimeout(s,n,...d){const l=setTimeout(s,n,...d);return{dispose:()=>clearTimeout(l)}},setImmediate(s,...n){const d=setTimeout(s,0,...n);return{dispose:()=>clearTimeout(d)}},setInterval(s,n,...d){const l=setInterval(s,n,...d);return{dispose:()=>clearInterval(l)}}})});function c(){return r}return function(s){function n(){e.RAL.install(r)}s.install=n}(c||(c={})),Le.default=c,Le}var mt;function tr(){return mt||(mt=1,function(e){var a=re&&re.__createBinding||(Object.create?function(n,d,l,m){m===void 0&&(m=l);var g=Object.getOwnPropertyDescriptor(d,l);(!g||("get"in g?!d.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return d[l]}}),Object.defineProperty(n,m,g)}:function(n,d,l,m){m===void 0&&(m=l),n[m]=d[l]}),f=re&&re.__exportStar||function(n,d){for(var l in n)l!=="default"&&!Object.prototype.hasOwnProperty.call(d,l)&&a(d,n,l)};Object.defineProperty(e,"__esModule",{value:!0}),e.createMessageConnection=e.BrowserMessageWriter=e.BrowserMessageReader=void 0,er().default.install();const h=Be();f(Be(),e);class r extends h.AbstractMessageReader{constructor(d){super(),this._onData=new h.Emitter,this._messageListener=l=>{this._onData.fire(l.data)},d.addEventListener("error",l=>this.fireError(l)),d.onmessage=this._messageListener}listen(d){return this._onData.event(d)}}e.BrowserMessageReader=r;class c extends h.AbstractMessageWriter{constructor(d){super(),this.port=d,this.errorCount=0,d.addEventListener("error",l=>this.fireError(l))}write(d){try{return this.port.postMessage(d),Promise.resolve()}catch(l){return this.handleError(l,d),Promise.reject(l)}}handleError(d,l){this.errorCount++,this.fireError(d,l,this.errorCount)}end(){}}e.BrowserMessageWriter=c;function s(n,d,l,m){return l===void 0&&(l=h.NullLogger),h.ConnectionStrategy.is(m)&&(m={connectionStrategy:m}),(0,h.createMessageConnection)(n,d,l,m)}e.createMessageConnection=s}(re)),re}var rr=tr();function nr(e,a){const f=new Qt(e),o=new Gt(e),h=rr.createMessageConnection(f,o,a);return h.onClose(()=>h.dispose()),h}class ir{error(a){console.error(a)}warn(a){console.warn(a)}info(a){console.info(a)}log(a){console.log(a)}debug(a){console.debug(a)}}function ar(e){const{webSocket:a,onConnection:f}=e,o=e.logger||new ir;a.onopen=()=>{const h=sr(a),r=nr(h,o);f(r)}}function sr(e){return{send:a=>e.send(a),onMessage:a=>{e.onmessage=f=>a(f.data)},onError:a=>{e.onerror=f=>{Object.hasOwn(f,"message")&&a(f.message)}},onClose:a=>{e.onclose=f=>a(f.code,f.reason)},dispose:()=>e.close()}}export{ar as l};
