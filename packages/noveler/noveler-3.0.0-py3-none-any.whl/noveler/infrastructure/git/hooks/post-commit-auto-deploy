#!/bin/bash
#
# Git post-commit ãƒ•ãƒƒã‚¯ï¼šè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
# ã‚³ãƒŸãƒƒãƒˆå¾Œã«å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è‡ªå‹•æ›´æ–°
#

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
HOOK_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
SCRIPTS_ROOT="$( cd "$HOOK_DIR/.." &> /dev/null && pwd )"

echo "ğŸ”„ Commit detected - Auto-deploying to projects..."

# TDD+DDDæº–æ‹ ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
python3 "$SCRIPTS_ROOT/tools/deploy_scripts_cli.py" \
    --mode production \
    --no-verify \
    > /tmp/auto-deploy.log 2>&1

# çµæœã‚’ç¢ºèª
if [ $? -eq 0 ]; then
    echo "âœ… Auto-deployment completed successfully"
    # æˆåŠŸæ™‚ã¯ç°¡æ½”ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿
    tail -n 5 /tmp/auto-deploy.log | grep "âœ…\|ğŸ“¦\|ğŸ‰"
else
    echo "âŒ Auto-deployment failed - check /tmp/auto-deploy.log"
    echo "Manual deployment may be required:"
    echo "  cd scripts && python3 tools/deploy_scripts_cli.py"
fi

echo ""
