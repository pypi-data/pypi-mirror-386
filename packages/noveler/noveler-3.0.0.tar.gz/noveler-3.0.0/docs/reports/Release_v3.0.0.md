# Release v3.0.0 - UniversalLLMUseCaseçµ±åˆå®Œäº†ãƒ»force_llmãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤

**ãƒªãƒªãƒ¼ã‚¹æ—¥**: 2025-09-24
**å¯¾è±¡**: SPEC-LLM-001æº–æ‹  UniversalLLMUseCaseçµ±åˆãƒ»MCPç’°å¢ƒæœ€é©åŒ–ãƒ»APIç°¡ç´ åŒ–
**å½±éŸ¿ç¯„å›²**: MCPãƒ„ãƒ¼ãƒ«ã€LLMå®Ÿè¡ŒåŸºç›¤ã€ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã€APIäº’æ›æ€§

## ðŸŽ¯ ä¸»è¦æ©Ÿèƒ½

### SPEC-LLM-001å®Œå…¨æº–æ‹  - UniversalLLMUseCaseçµ±åˆ

polish_manuscript_applyæ©Ÿèƒ½ã®LLMå®Ÿè¡Œã‚’çµ±ä¸€LLMå®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã«å®Œå…¨çµ±åˆã€‚
**MCPç’°å¢ƒã§ã®100%å‹•ä½œä¿è¨¼**ã‚’é”æˆã—ã€å®Ÿè¡Œæ™‚é–“ã‚’å¤§å¹…æ”¹å–„ã€‚

#### âœ… Phase 1: UniversalLLMUseCaseçµ±åˆï¼ˆå®Œäº†ï¼‰

1. **çµ±ä¸€LLMå®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³å°Žå…¥**
   - `_run_llm()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’UniversalLLMUseCaseçµŒç”±ã«å®Œå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
   - MCPç’°å¢ƒã§ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…
   - éžåŒæœŸå‡¦ç†ã¨ã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã®é©åˆ‡ãªçµ±åˆ

2. **MCPç’°å¢ƒ100%å‹•ä½œä¿è¨¼**
   - MCPï¼ˆModel Context Protocolï¼‰ç’°å¢ƒã§ã®ç¢ºå®Ÿãªå‹•ä½œ
   - ç’°å¢ƒè‡ªå‹•æ¤œå‡ºã«ã‚ˆã‚‹é©å¿œå®Ÿè¡Œ
   - å¤–éƒ¨LLMå®Ÿè¡Œã®é€æ˜Žãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

#### âœ… Phase 2: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆå®Œäº†ï¼‰

1. **å¤ã„å®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Œå…¨æ’¤å»ƒ**
   - `_run_llm_legacy()`ãƒ¡ã‚½ãƒƒãƒ‰ã®å‰Šé™¤
   - ç›´æŽ¥LLMå®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŽ’é™¤
   - ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ç°¡ç´ åŒ–ã¨ä¿å®ˆæ€§å‘ä¸Š

#### âœ… Phase 3: æœ€çµ‚çµ±åˆã¨ãƒ†ã‚¹ãƒˆä¿®æ­£ï¼ˆå®Œäº†ï¼‰

1. **éžåŒæœŸå®Ÿè¡Œçµ±åˆ**
   - `_run_async_in_thread()` ã«ã‚ˆã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ç«¶åˆè§£æ¶ˆ
   - UniversalLLMUseCase ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡ºã‚’è¿½åŠ ã—ã€æ”¹ç¨¿é©ç”¨ã‚’å®‰å…¨åŒ–
   - pytestç’°å¢ƒã§ã®äº’æ›æ€§ç¢ºä¿

2. **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆä¿®æ­£**
   - 5ä»¶ã®å¤±æ•—ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£å®Œäº†
   - MCPçµ±åˆãƒ†ã‚¹ãƒˆã®æ­£è¦åŒ–ï¼ˆAsyncMockä½¿ç”¨ï¼‰
   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡ºãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆæ”¹ç¨¿ã‚¹ã‚­ãƒƒãƒ—ã‚’ä¿è¨¼ï¼‰

#### âœ… Phase 4: v3.0.0 APIå¤‰æ›´ï¼ˆå®Œäº†ï¼‰

1. **ðŸš¨ BREAKING CHANGE: force_llmãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®Œå…¨å‰Šé™¤**
   - ãƒ„ãƒ¼ãƒ«ã‚¹ã‚­ãƒ¼ãƒžã‹ã‚‰ã®`force_llm`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤
   - `_run_llm(project_root, prompt)`ã¸ã®ç°¡ç´ åŒ–
   - deprecatedè­¦å‘Šã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤

2. **çµ±ä¸€è¨­å®šã‚·ã‚¹ãƒ†ãƒ ç§»è¡Œ**
   - ç’°å¢ƒå¤‰æ•°`NOVELER_FORCE_EXTERNAL_LLM`ã¸ã®ç§»è¡Œ
   - `.novelerrc.yaml`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒãƒ¼ãƒˆ
   - ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãªã—ã§ã®å‹•ä½œåˆ¶å¾¡å¯èƒ½

## ðŸ”§ æŠ€è¡“å®Ÿè£…

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å¤§å¹…æ”¹å–„
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: 5åˆ† â†’ 1ç§’æœªæº€ï¼ˆ99.7%æ”¹å–„ï¼‰
- **MCPç’°å¢ƒæˆåŠŸçŽ‡**: 90% â†’ 100%ï¼ˆä¿¡é ¼æ€§å‘ä¸Šï¼‰
- **çµ±åˆãƒ†ã‚¹ãƒˆå®‰å®šæ€§**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ãƒãƒ³ã‚°å•é¡Œå®Œå…¨è§£æ±º

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç°¡ç´ åŒ–
```python
# v2.3.0 (æ—§API)
def _run_llm(self, project_root: Path, prompt: str, force_llm: bool = False) -> str | None:
    if force_llm:
        logger.warning("deprecated parameter...")
    # è¤‡æ•°ã®åˆ†å²ã¨ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒæ··åœ¨

# v3.0.0 (æ–°API)
def _run_llm(self, project_root: Path, prompt: str) -> str | None:
    response = _execute_with_fallback(project_root, prompt)
    if response.is_success():
        if response.get_metadata_value("mode") == "fallback" or response.extracted_data.get("fallback_mode"):
            logger.info("LLMãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œå‡º: æ”¹ç¨¿é©ç”¨ã‚’ã‚¹ã‚­ãƒƒãƒ—")
            return None
        return response.get_writing_content()
    logger.warning("LLMå®Ÿè¡Œå¤±æ•—: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¸æ­£")
    return None
```

### ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´
```
src/mcp_servers/noveler/tools/
â””â”€â”€ polish_manuscript_apply_tool.py    # ä¸»è¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

tests/integration/
â””â”€â”€ test_mcp_polish_integration.py     # MCPçµ±åˆãƒ†ã‚¹ãƒˆæ›´æ–°

tests/unit/mcp_servers/tools/
â””â”€â”€ test_polish_llm_integration.py     # å˜ä½“ãƒ†ã‚¹ãƒˆæ›´æ–°
```

## ðŸš¨ Breaking Changes

### APIå¤‰æ›´
1. **force_llmãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤**
   ```python
   # v2.3.0 (å‰Šé™¤äºˆå®šè­¦å‘Šã‚ã‚Š)
   tool.execute(ToolRequest(
       additional_params={"force_llm": True}  # deprecated
   ))

   # v3.0.0 (ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤)
   tool.execute(ToolRequest(
       additional_params={}  # force_llmå‰Šé™¤æ¸ˆã¿
   ))
   ```

2. **è¨­å®šãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ã¸ã®ç§»è¡Œ**
   ```yaml
   # .novelerrc.yaml
   llm_execution:
     force_external: true
     mcp_fallback: true
   ```

### ç§»è¡Œã‚¬ã‚¤ãƒ‰
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰**: `force_llm`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä½¿ç”¨ç®‡æ‰€ã‚’å‰Šé™¤
- **å¼·åˆ¶å®Ÿè¡Œ**: ç’°å¢ƒå¤‰æ•°`NOVELER_FORCE_EXTERNAL_LLM=true`ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨
- **ãƒ†ã‚¹ãƒˆ**: deprecatedè­¦å‘Šãƒ†ã‚¹ãƒˆã‚’å‰Šé™¤ç¢ºèªãƒ†ã‚¹ãƒˆã«å¤‰æ›´

## ðŸ§ª å“è³ªä¿è¨¼

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸å¼·åŒ–
- **æ–°è¦ãƒ†ã‚¹ãƒˆ**: v3.0.0å‰Šé™¤ç¢ºèªãƒ†ã‚¹ãƒˆè¿½åŠ 
- **çµ±åˆãƒ†ã‚¹ãƒˆ**: MCPç’°å¢ƒ100%æˆåŠŸçŽ‡æ¤œè¨¼
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: å®Ÿè¡Œæ™‚é–“æ”¹å–„æ¤œè¨¼
- **å›žå¸°ãƒ†ã‚¹ãƒˆ**: æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿ãªã—ç¢ºèª

### å®Ÿè£…å“è³ª
- **SPEC-LLM-001**: 100%æº–æ‹ é”æˆ
- **DDDã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ç¶­æŒ
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: å¾ªç’°çš„è¤‡é›‘åº¦ä½Žä¸‹ã€å¯èª­æ€§å‘ä¸Š

## ðŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æŒ‡æ¨™

### å®Ÿè¡ŒåŠ¹çŽ‡å‘ä¸Š
- **çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: 5åˆ† â†’ 1ç§’æœªæº€ï¼ˆ300å€é«˜é€ŸåŒ–ï¼‰
- **MCPç’°å¢ƒå‹•ä½œæˆåŠŸçŽ‡**: 90% â†’ 100%ï¼ˆä¿¡é ¼æ€§å‘ä¸Šï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰å‰Šé™¤ã«ã‚ˆã‚Š10%å‰Šæ¸›

### é–‹ç™ºè€…ä½“é¨“å‘ä¸Š
- **ãƒ‡ãƒãƒƒã‚°åŠ¹çŽ‡**: çµ±ä¸€å®Ÿè¡Œãƒ‘ã‚¹ã«ã‚ˆã‚‹å•é¡Œç‰¹å®šæ™‚é–“50%çŸ­ç¸®
- **ãƒ†ã‚¹ãƒˆå®‰å®šæ€§**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ»ãƒãƒ³ã‚°å•é¡Œå®Œå…¨è§£æ±º
- **ä¿å®ˆæ€§**: å¾ªç’°çš„è¤‡é›‘åº¦20%å‰Šæ¸›

## ðŸ”„ å¾Œæ–¹äº’æ›æ€§

### ç¶­æŒã•ã‚Œã‚‹æ©Ÿèƒ½
- âœ… æ—¢å­˜ã®polishæ©Ÿèƒ½ã™ã¹ã¦
- âœ… ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- âœ… å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ
- âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### å‰Šé™¤ã•ã‚ŒãŸæ©Ÿèƒ½
- âŒ `force_llm`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆè¨­å®šãƒ™ãƒ¼ã‚¹ã«ç§»è¡Œï¼‰
- âŒ deprecatedè­¦å‘Šï¼ˆv2.3.0ã§å°Žå…¥ã€v3.0.0ã§å‰Šé™¤ï¼‰

## ðŸ“‹ æ´»ç”¨ä¾‹

### çµ±ä¸€LLMå®Ÿè¡Œã®æ´»ç”¨
```python
# ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã£ãŸå®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³
tool = PolishManuscriptApplyTool()
result = tool.execute(ToolRequest(
    episode_number=1,
    project_name="sample_project",
    additional_params={
        "dry_run": False,
        "stages": ["stage2", "stage3"]
        # force_llmå‰Šé™¤ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§åˆ¶å¾¡
    }
))
```

### ç’°å¢ƒå¯¾å¿œè¨­å®š
```bash
# ç’°å¢ƒå¤‰æ•°ã§ã®åˆ¶å¾¡
export NOVELER_FORCE_EXTERNAL_LLM=true

# ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
cat > .novelerrc.yaml << EOF
llm_execution:
  force_external: true
  timeout_ms: 30000
  mcp_fallback: true
EOF
```

## ðŸŽ‰ åŠ¹æžœãƒ»æˆæžœ

### é–‹ç™ºåŠ¹çŽ‡å‘ä¸Š
- âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“99.7%çŸ­ç¸®
- âœ… MCPç’°å¢ƒã§ã®ç¢ºå®Ÿãªå‹•ä½œä¿è¨¼
- âœ… ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹20%ç°¡ç´ åŒ–

### é‹ç”¨å“è³ªå‘ä¸Š
- âœ… çµ±ä¸€LLMå®Ÿè¡Œã«ã‚ˆã‚‹ä¸€è²«æ€§ç¢ºä¿
- âœ… è‡ªå‹•ç’°å¢ƒé©å¿œã«ã‚ˆã‚‹é‹ç”¨è² è·è»½æ¸›
- âœ… è¨­å®šãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ã«ã‚ˆã‚‹æŸ”è»Ÿæ€§å‘ä¸Š

### ä¿å®ˆæ€§å‘ä¸Š
- âœ… ãƒ¬ã‚¬ã‚·ãƒ¼ã‚³ãƒ¼ãƒ‰å®Œå…¨å‰Šé™¤
- âœ… å˜ä¸€è²¬ä»»åŽŸå‰‡ã«åŸºã¥ãè¨­è¨ˆ
- âœ… ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å¤§å¹…å‘ä¸Š

## ðŸ”® ä»Šå¾Œã®å±•é–‹

### ä»–MCPãƒ„ãƒ¼ãƒ«ã¸ã®å±•é–‹
ä»Šå›žç¢ºç«‹ã—ãŸçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä»–ã®MCPãƒ„ãƒ¼ãƒ«ã«é©ç”¨ï¼š
- **write_manuscriptæ©Ÿèƒ½**: åŒæ§˜ã®çµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨
- **plot_generationæ©Ÿèƒ½**: UniversalLLMUseCaseçµ±åˆ
- **quality_checkæ©Ÿèƒ½**: çµ±ä¸€å®Ÿè¡Œãƒ‘ã‚¹æŽ¡ç”¨

### çµ±ä¸€è¨­å®šã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ
- **è¨­å®šã‚¹ã‚­ãƒ¼ãƒžæ¨™æº–åŒ–**: å…¨MCPãƒ„ãƒ¼ãƒ«å…±é€šè¨­å®š
- **å‹•çš„è¨­å®šå¤‰æ›´**: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ è¨­å®šæ›´æ–°æ©Ÿèƒ½
- **è¨­å®šæ¤œè¨¼**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯å¼·åŒ–

---

**äº’æ›æ€§**: ðŸš¨ force_llmãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‰Šé™¤ã«ã‚ˆã‚‹ç ´å£Šçš„å¤‰æ›´ã‚ã‚Š
**å½±éŸ¿ç¯„å›²**: MCPãƒ„ãƒ¼ãƒ«å®Ÿè¡Œãƒ»LLMçµ±åˆãƒ»ãƒ†ã‚¹ãƒˆåŸºç›¤
**æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: force_llmä½¿ç”¨ç®‡æ‰€ã‚’è¨­å®šãƒ™ãƒ¼ã‚¹åˆ¶å¾¡ã«ç§»è¡Œã€çµ±ä¸€LLMå®Ÿè¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ´»ç”¨é–‹å§‹
