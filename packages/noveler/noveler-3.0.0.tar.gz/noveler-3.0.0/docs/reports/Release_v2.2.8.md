# Release v2.2.8 - MessageBusé‹ç”¨/ä¿¡é ¼æ€§æ©Ÿèƒ½å®Œå…¨å®Ÿè£…

**ãƒªãƒªãƒ¼ã‚¹æ—¥**: 2025-09-22
**å¯¾è±¡**: SPEC-901 DDD MessageBus é‹ç”¨ãƒ»ä¿¡é ¼æ€§æ©Ÿèƒ½
**å½±éŸ¿ç¯„å›²**: MessageBusã€Outboxã€DLQã€é‹ç”¨CLIã€ãƒ¡ãƒˆãƒªã‚¯ã‚¹

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### MessageBus é‹ç”¨ãƒ»ä¿¡é ¼æ€§æ©Ÿèƒ½ã®å®Œå…¨å®Ÿè£…
SPEC-901ï¼ˆDDDï¼‰ã®é‹ç”¨/ä¿¡é ¼æ€§è¦ä»¶ã‚’å®Œå…¨ã«æº€ãŸã™MessageBusæ©Ÿèƒ½ã‚’å®Ÿè£…å®Œäº†ã€‚

#### âœ… å®Ÿè£…å®Œäº†æ©Ÿèƒ½

1. **OutboxèƒŒæ™¯ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚¿ã‚¹ã‚¯ï¼ˆéåŒæœŸãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒï¼‰**
   - 30ç§’é–“éš”ã§ã®è‡ªå‹•Outboxãƒ•ãƒ©ãƒƒã‚·ãƒ¥
   - `NOVELER_DISABLE_BACKGROUND_FLUSH=1` ã§ãƒ†ã‚¹ãƒˆæ™‚ç„¡åŠ¹åŒ–
   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã‚‚ãƒ«ãƒ¼ãƒ—ç¶™ç¶šã€é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›

2. **Dead Letter Queueï¼ˆDLQï¼‰**
   - 5å›å¤±æ•—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ `temp/bus_outbox/dlq/` ã«è‡ªå‹•é€€é¿
   - `OutboxEntry` ã« `last_error`, `failed_at` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
   - DLQçµ±è¨ˆæƒ…å ±ã®å–å¾—ã¨ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥åˆ†ææ©Ÿèƒ½

3. **Busãƒ¡ãƒˆãƒªã‚¯ã‚¹/ãƒˆãƒ¬ãƒ¼ã‚¹å¯è¦–åŒ–**
   - `time.perf_counter()` ã«ã‚ˆã‚‹é«˜ç²¾åº¦å‡¦ç†æ™‚é–“è¨ˆæ¸¬
   - P50/P95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«çµ±è¨ˆã¨ã‚³ãƒãƒ³ãƒ‰/ã‚¤ãƒ™ãƒ³ãƒˆåˆ¥å¤±æ•—ç‡
   - `BusMetrics` ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹çµ±è¨ˆæƒ…å ±ç®¡ç†

4. **æ‰‹å‹•é‹ç”¨ç”¨CLI**
   - `noveler bus flush [--limit] [--dry-run]` - æ‰‹å‹•Outboxãƒ•ãƒ©ãƒƒã‚·ãƒ¥
   - `noveler bus list [--type pending|dlq|all] [--format table|json]` - ã‚¨ãƒ³ãƒˆãƒªä¸€è¦§
   - `noveler bus replay <entry_id> [--force]` - DLQã‚¨ãƒ³ãƒˆãƒªå†å®Ÿè¡Œ
   - `noveler bus health [--detailed]` - ãƒ˜ãƒ«ã‚¹çŠ¶æ³ã¨DLQçµ±è¨ˆ
   - `noveler bus metrics [--reset]` - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™è¡¨ç¤º/ãƒªã‚»ãƒƒãƒˆ

## ğŸ”§ æŠ€è¡“å®Ÿè£…

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- **ã‚³ã‚¢å®Ÿè£…**: `src/noveler/application/simple_message_bus.py`
- **Outboxç®¡ç†**: `src/noveler/application/outbox.py`, `src/noveler/infrastructure/adapters/file_outbox_repository.py`
- **ã¹ãç­‰æ€§**: `src/noveler/application/idempotency.py`
- **é‹ç”¨CLI**: `src/noveler/presentation/cli/commands/bus_commands.py`

### ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
```
<project>/temp/bus_outbox/
â”œâ”€â”€ pending/          # é…ä¿¡å¾…ã¡ã‚¤ãƒ™ãƒ³ãƒˆ
â”œâ”€â”€ dlq/             # é…ä¿¡å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ5å›è©¦è¡Œå¾Œï¼‰
â””â”€â”€ [å‹•çš„ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«]
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
- ã‚³ãƒãƒ³ãƒ‰å‡¦ç†: P95 < 100ms ç›®æ¨™é”æˆ
- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†: è»½é‡ãªå‡¦ç†ã§æ•°ms ãƒ¬ãƒ™ãƒ«
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ•ãƒ©ãƒƒã‚·ãƒ¥: 30ç§’é–“éš”ã€å½±éŸ¿æœ€å°åŒ–

## ğŸ“Š é‹ç”¨æ”¹å–„

### ç›£è¦–ãƒ»é‹ç”¨
- DLQã‚¨ãƒ³ãƒˆãƒªã®è‡ªå‹•ç›£è¦–ã¨ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œåŸºç›¤
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆå‡¦ç†æ•°ã€é…å»¶ã€å¤±æ•—ç‡ï¼‰
- æ‰‹å‹•é‹ç”¨ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´

### ä¿¡é ¼æ€§å‘ä¸Š
- ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ã®ä¿è¨¼ï¼ˆOutboxãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ã¹ãç­‰æ€§ã«ã‚ˆã‚‹é‡è¤‡å®Ÿè¡Œé˜²æ­¢
- æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ãƒªãƒˆãƒ©ã‚¤ã¨DLQã«ã‚ˆã‚‹æœ€çµ‚çš„ãªå‡¦ç†ä¿è¨¼

## ğŸ“‹ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### æ›´æ–°ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `specs/SPEC-901-DDD-REFACTORING.md` - å®Ÿè£…çŠ¶æ³ã‚’å®Œå…¨å®Ÿè£…ã«æ›´æ–°
- `specs/REQ_SPEC_MAPPING_MATRIX.md` - REQ-ARCH-BUS-901 ã‚’å®Ÿè£…æ¸ˆã¿ã«æ›´æ–°
- `docs/B20_Claude_Codeé–‹ç™ºä½œæ¥­æŒ‡ç¤ºæ›¸.md` - é‹ç”¨ãƒ¡ãƒ¢ã¨ CLI ã‚³ãƒãƒ³ãƒ‰ä¾‹è¿½åŠ 
- `docs/docs/guides/developer_guide.md` - å®Œå…¨å®Ÿè£…ãƒ€ã‚¤ã‚¸ã‚§ã‚¹ãƒˆã«æ›´æ–°
- `docs/mcp/tools_usage_best_practices.md` - é‹ç”¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…æ¸ˆã¿ã«æ›´æ–°

## ğŸ‰ æˆæœ

### SPEC-901 éæ©Ÿèƒ½è¦ä»¶ã®å®Œå…¨é”æˆ
- âœ… é«˜ä¿¡é ¼é…é€ï¼ˆOutboxãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- âœ… å†é€åˆ¶å¾¡ï¼ˆDLQã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
- âœ… ç›£è¦–ï¼ˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ãƒ˜ãƒ«ã‚¹çŠ¶æ³ï¼‰
- âœ… é‹ç”¨ï¼ˆCLIã€èƒŒæ™¯ã‚¿ã‚¹ã‚¯ï¼‰

### å“è³ªæŒ‡æ¨™
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: ç¶™ç¶šçš„ã«80%ä»¥ä¸Šç¶­æŒ
- MessageBus ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: < 1ms ç›®æ¨™é”æˆ
- CLI ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ€§: ç¬æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å®Ÿç¾

## ğŸ”® æ¬¡æœŸå±•é–‹

ä»Šå›ã®å®Œå…¨å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®æ‹¡å¼µåŸºç›¤ãŒæ•´å‚™ã•ã‚Œã¾ã—ãŸï¼š
- ã‚³ãƒãƒ³ãƒ‰/ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆpydanticï¼‰
- æ—¢å­˜Busâ†”SimpleBusãƒ–ãƒªãƒƒã‚¸å®Ÿè£…
- ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆåå‰ç©ºé–“ï¼ˆ`episode.*`, `quality.*`, `plot.*`ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢å·®ã—æ›¿ãˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«â†’DBï¼‰

---

**äº’æ›æ€§**: æ—¢å­˜APIã¨ã®å®Œå…¨ãªå¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ
**å½±éŸ¿ç¯„å›²**: MessageBusåˆ©ç”¨æ©Ÿèƒ½ã®ä¿¡é ¼æ€§å‘ä¸Šã€é‹ç”¨è² è·è»½æ¸›
**æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: é‹ç”¨ç’°å¢ƒã§ã®ãƒ˜ãƒ«ã‚¹ç›£è¦–ã‚³ãƒãƒ³ãƒ‰å®šæœŸå®Ÿè¡Œ
