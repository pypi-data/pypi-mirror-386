# SPEC-A31-SESSION-001: Claude Code セッション内分析システム仕様

## システム概要
Claude Code実行中セッションで、A31重点項目を用いた自動分析を実行し、
外部API依存なしでリアルタイム品質評価と結果統合を実現するシステム。

## 機能要件

### FR-SESSION-001: セッション内分析エンジン
- Claude Code セッション内で直接プロンプトベース分析を実行
- A31重点項目ごとの特化プロンプトチェーン実行
- 分析結果の構造化とバリデーション
- リアルタイムプログレス表示

### FR-SESSION-002: プロンプトチェーン実行
- 重点項目優先度順での段階的分析実行
- 各項目に最適化されたプロンプトテンプレート適用
- 分析結果の中間蓄積と検証
- 失敗時の自動リトライ機構

### FR-SESSION-003: リアルタイム結果統合
- 分析結果のA31チェックリストへの自動反映
- 改善提案のコメント形式での追加
- 完了ステータスの自動更新
- 品質スコアの再計算と記録

### FR-SESSION-004: 完全自動化CLI
- ワンコマンドでの end-to-end 分析実行
- プログレス表示とエラーハンドリング
- 分析完了サマリーの詳細表示
- 結果ファイルの自動生成と保存

## 非機能要件

### NFR-SESSION-001: パフォーマンス
- 重点項目分析完了時間: ≤30秒/20項目
- メモリ使用量: ≤500MB（大容量原稿対応）
- 並列処理による分析速度最適化

### NFR-SESSION-002: 信頼性
- プロンプト実行成功率: ≥95%
- 分析結果整合性: 100%保証
- セッションタイムアウト対策

### NFR-SESSION-003: 拡張性
- 新規分析項目の動的追加対応
- カスタムプロンプトテンプレートサポート
- 分析戦略の柔軟な切り替え

## アーキテクチャ制約
- DDD準拠: Domain → Application → Infrastructure
- TDD準拠: 仕様書 → テスト → 実装
- scripts.プレフィックス必須
- 型安全性: mypy strict準拠
- エラーハンドリング: 例外安全性保証

## ユースケースシナリオ

### 基本フロー
1. ユーザーが `novel a31-claude analyze-in-session` 実行
2. A31チェックリストから重点項目を自動抽出
3. 各重点項目に対してプロンプトチェーン実行
4. 分析結果をリアルタイムでA31に統合
5. 完了サマリーと改善提案を表示

### 拡張フロー
1. 段階的分析モードでの実行
2. 特定カテゴリフォーカス分析
3. 分析結果の詳細レポート生成
4. 品質トレンド分析の自動実行
