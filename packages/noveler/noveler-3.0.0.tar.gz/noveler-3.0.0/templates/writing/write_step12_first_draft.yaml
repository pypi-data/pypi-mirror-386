# STEP 12: 初稿執筆（Schema v2）

metadata:
  step_id: 12
  step_name: "初稿執筆"
  phase: "writing_execution"
  schema_version: "2.1.0"
  last_updated: "2025-10-20"
  author: "noveler system"
  description: "A38設計を統合し、なろう基準の初稿を作成"
  estimated_duration: "60-120分"

llm_config:
  role_messages:
    system: |
      あなたは熟練の小説家です。以下を厳守してください:

      【必須ルール】
      1. constraints.hard_rules を必ず遵守
      2. 出力形式: 生のYAMLテキストのみ（```yamlなどのコードブロック禁止）
      3. 追加説明・前置き文・コメント・補足は一切不要
      4. artifacts.required_fields を必ず含める
      5. YAMLインデントはスペース2固定、タブ禁止
      6. 本文はmanuscriptフィールドにブロックリテラル（|）で格納
    user: |
      STEP 0-11の設計を統合し、禁止表現を避けつつ、8000字以上の初稿を作成してください。
      inputs/constraints/tasks/artifacts を参照し、writing_style_examples に従ってください。

prompt:
  main_instruction: |
    目的は「エピソード{episode_number}の初稿生成」です。inputs/constraints/tasks を満たし、
    artifacts の仕様に従った生のYAMLを出力してください（追加説明は不要）。

inputs:
  files:
    - path: "{project_root}/60_作業ファイル/EP{episode_number:03d}_step0*.yaml"
      required: true
      description: 構造設計一式（STEP0-11）
  variables:
    episode_number: { type: int, required: true }
    project_root: { type: path, required: true }

constraints:
  hard_rules:
    - "文字数: 8000字以上（日本語Unicode）"
    - "視点統一: 1シーン1視点"
    - "禁止表現排除: 直説説明/感情直書き/説明的記述の回避"
  soft_targets:
    - "セクション配分: 15/70/15%"
    - "会話主導のテンポ（地の文は補助）"
    - "山場/クライマックスは後半2/3に配置"
  writing_style_examples:
    - technique: "断定モノローグ"
      good: "これは罠だ。逃げるしかない。"
      bad: "これは罠かもしれない。おそらく逃げたほうがいいだろう。"
      rationale: "迷いを削除し、キャラの決断を明確化"
    - technique: "1文1動作"
      good: "彼は立ち上がった。ドアを開けた。廊下へ出た。"
      bad: "彼は立ち上がってドアを開けて廊下へ出た。"
      rationale: "短文のリズムでテンポを作る"
    - technique: "短尺会話"
      good: "「行くぞ」「ああ」「準備はいいか」「できてる」"
      bad: "「私たちはこれから行くべきだと思うんだけど、どう思う？」"
      rationale: "会話は即断即決、説明を削る"
    - technique: "オチのリズム"
      good: "彼は笑った。理由は単純だ。もう逃げられない。"
      bad: "彼は笑った。なぜなら、もう逃げられないという状況に陥っていたからだ。"
      rationale: "短文で区切り、余韻を作る"
    - technique: "会話掛け合い"
      good: "「なぜだ」「理由はない」「嘘をつくな」「本当だ」"
      bad: "「なぜそうしたのか理由を教えてくれないか」「特に理由はない」"
      rationale: "台詞は短く、テンポを優先"

tasks:
  bullets:
    - 設計（配分/感情曲線/対話/世界観/伏線）を統合する
    - 感情/状況は行動・身体反応・比喩で表現する
    - 会話は目的駆動（情報/感情/関係の前進）を満たす
    - 伏線は自然に埋め込み、回収候補を明示しない
  details:
    - name: 統合作業
      items:
        - id: integrate.section_balance
          text: セクション配分どおりの展開
        - id: integrate.emotion_curve
          text: emotion_curve に沿った起伏
        - id: integrate.dialogue_subtext
          text: dialogue の subtext を保持
        - id: integrate.world_reveal
          text: 世界観開示は段階的に
    - name: 表現方針
      items:
        - id: style.banned
          text: 直説説明/感情直書きの回避
        - id: style.golden
          text: Golden Sample文体（断定モノローグ/1文1動作/掛け合い/オチ）

artifacts:
  format: md
  path_template: "{project_root}/60_作業ファイル/EP{episode_number:03d}_step12.md"
  required_fields: ["body_present"]
  schema_reference: |
    manuscript: string (必須、ブロックリテラル形式で格納)
    metadata:
      episode_number: integer (必須)
      title: string (必須)
      word_count: integer (必須、8000以上)
      kpi_notes: string (任意)
  example: |
    # ��{episode_number:03d}�b

    �i����8000���ȏ��̏��e�j

acceptance_criteria:
  checklist:
    - "Markdown only output"
    - "Header line present: # EP{episode_number:03d}話"
  metrics:

    - name: "unicode_char_count"
      target: ">= 8000"
      method: "manuscript内のUnicode文字数"
    - name: "metadata_completeness"
      target: ">= 1.0"
      method: "metadata必須フィールド充足率"

next:
  next_step_id: 13
  message_template: |
    次のステップは以下で実行:
    execute_writing_step episode_number={episode_number} step_id=13

variables:
  - step_id
  - step_name
  - episode_number
  - completed_steps
  - total_steps
  - phase

control_settings:
  strict_single_step: true
  require_completion_confirm: true
  auto_advance_disabled: true
  batch_execution_blocked: true


