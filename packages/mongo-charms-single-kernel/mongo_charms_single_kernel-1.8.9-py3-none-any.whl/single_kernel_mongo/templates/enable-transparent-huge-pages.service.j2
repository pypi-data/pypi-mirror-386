[Unit]
Description=Enable Transparent Hugepages (THP)
DefaultDependencies=no
After=sysinit.target local-fs.target
Before={{service_file}}

[Service]
Type=oneshot
ExecStartPre=/bin/sh -c 'echo 0 | tee /sys/kernel/mm/transparent_hugepage/khugepaged/max_ptes_none > /dev/null'
ExecStartPre=/bin/sh -c 'echo defer+madvise | tee /sys/kernel/mm/transparent_hugepage/defrag > /dev/null '
ExecStart=/bin/sh -c 'echo always | tee /sys/kernel/mm/transparent_hugepage/enabled > /dev/null'

[Install]
WantedBy=basic.target
